<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 25 Difference-in-differences | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="Examples in marketing (Liaukonyte, Teixeira, and Wilbur 2015): TV ad on online shopping (Akca and Rao 2020): aggregators for airlines business effect (Pattabhiramaiah, Sriram, and Manchanda 2018):...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 25 Difference-in-differences | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/difference-in-differences.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="Examples in marketing (Liaukonyte, Teixeira, and Wilbur 2015): TV ad on online shopping (Akca and Rao 2020): aggregators for airlines business effect (Pattabhiramaiah, Sriram, and Manchanda 2018):...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 25 Difference-in-differences | A Guide on Data Analysis">
<meta name="twitter:description" content="Examples in marketing (Liaukonyte, Teixeira, and Wilbur 2015): TV ad on online shopping (Akca and Rao 2020): aggregators for airlines business effect (Pattabhiramaiah, Sriram, and Manchanda 2018):...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-stat.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="model-specification.html"><span class="header-section-number">10</span> Model Specification</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">11</span> Imputation (Missing Data)</a></li>
<li><a class="" href="data.html"><span class="header-section-number">12</span> Data</a></li>
<li><a class="" href="variable-transformation.html"><span class="header-section-number">13</span> Variable Transformation</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">14</span> Hypothesis Testing</a></li>
<li><a class="" href="marginal-effects.html"><span class="header-section-number">15</span> Marginal Effects</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">16</span> Prediction and Estimation</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">17</span> Moderation</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="causal-inference.html"><span class="header-section-number">18</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="" href="experimental-design.html"><span class="header-section-number">19</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">20</span> Sampling</a></li>
<li><a class="" href="analysis-of-variance-anova.html"><span class="header-section-number">21</span> Analysis of Variance (ANOVA)</a></li>
<li><a class="" href="multivariate-methods.html"><span class="header-section-number">22</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="quasi-experimental.html"><span class="header-section-number">23</span> Quasi-experimental</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">24</span> Regression Discontinuity</a></li>
<li><a class="active" href="difference-in-differences.html"><span class="header-section-number">25</span> Difference-in-differences</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">26</span> Synthetic Control</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">27</span> Event Studies</a></li>
<li><a class="" href="matching-methods.html"><span class="header-section-number">28</span> Matching Methods</a></li>
<li><a class="" href="interrupted-time-series.html"><span class="header-section-number">29</span> Interrupted Time Series</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">30</span> Endogeneity</a></li>
<li><a class="" href="controls.html"><span class="header-section-number">31</span> Controls</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">32</span> Mediation</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">33</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">34</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">35</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">36</span> Sensitivity Analysis/ Robustness Check</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="difference-in-differences" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> Difference-in-differences<a class="anchor" aria-label="anchor" href="#difference-in-differences"><i class="fas fa-link"></i></a>
</h1>
<p>Examples in marketing</p>
<ul>
<li>
<span class="citation">(<a href="references.html#ref-liaukonyte2015" role="doc-biblioref">Liaukonyte, Teixeira, and Wilbur 2015</a>)</span>: TV ad on online shopping</li>
<li>
<span class="citation">(<a href="references.html#ref-akca2020" role="doc-biblioref">Akca and Rao 2020</a>)</span>: aggregators for airlines business effect</li>
<li>
<span class="citation">(<a href="references.html#ref-pattabhiramaiah2018" role="doc-biblioref">Pattabhiramaiah, Sriram, and Manchanda 2018</a>)</span>: paywall affects readership</li>
<li>
<span class="citation">(<a href="references.html#ref-wang2018" role="doc-biblioref">Wang, Lewis, and Schweidel 2018</a>)</span>: political ad source and message tone on vote shares and turnout using discontinuities in the level of political ads at the borders</li>
<li>
<span class="citation">(<a href="references.html#ref-datta2018" role="doc-biblioref">Datta, Knox, and Bronnenberg 2018</a>)</span>: streaming service on total music consumption using timing of users adoption of a music streaming service</li>
<li>
<span class="citation">(<a href="references.html#ref-janakiraman2018" role="doc-biblioref">Janakiraman, Lim, and Rishika 2018</a>)</span>: data breach announcement affect customer spending using timing of data breach and variation whether customer info was breached in that event</li>
<li>
<span class="citation">(<a href="references.html#ref-lim2020" role="doc-biblioref">Lim et al. 2020</a>)</span>: nutritional labels on nutritional quality for other brands in a category using variation in timing of adoption of nutritional labels across categories</li>
<li>
<span class="citation">(<a href="references.html#ref-guo2020" role="doc-biblioref">Guo, Sriram, and Manchanda 2020</a>)</span>: payment disclosure laws effect on physician prescription behavior using Timing of the Massachusetts open payment law as the exogenous shock</li>
<li>
<span class="citation">(<a href="references.html#ref-israeli2018" role="doc-biblioref">Israeli 2018</a>)</span>: digital monitoring and enforcement on violations using enforcement of min ad price policies</li>
<li>
<span class="citation">(<a href="references.html#ref-ramani2019" role="doc-biblioref">Ramani and Srinivasan 2019</a>)</span>: firms respond to foreign direct investment liberalization using India’s reform in 1991.</li>
<li>
<span class="citation">(<a href="references.html#ref-he2022" role="doc-biblioref">He, Hollenbeck, and Proserpio 2022</a>)</span>: using Amazon policy change to examine the causal impact of fake reviews on sales, average ratings.</li>
<li>
<span class="citation">(<a href="references.html#ref-peukert2022" role="doc-biblioref">Peukert et al. 2022</a>)</span>: using European General data protection Regulation, examine the impact of policy change on website usage.</li>
</ul>
<p>Show the mechanism via</p>
<ul>
<li><p>Mediation analysis: see <span class="citation">(<a href="references.html#ref-habel2021" role="doc-biblioref">Habel, Alavi, and Linsenmayer 2021</a>)</span></p></li>
<li><p>Moderation analysis: see <span class="citation">(<a href="references.html#ref-goldfarb2011" role="doc-biblioref">Goldfarb and Tucker 2011</a>)</span></p></li>
</ul>
<div id="simple-dif-n-dif" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> Simple Dif-n-dif<a class="anchor" aria-label="anchor" href="#simple-dif-n-dif"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>A tool developed intuitively to study “natural experiment”, but its uses are much broader.</p></li>
<li><p><a href="data.html#fixed-effects-estimator">Fixed Effects Estimator</a> is the foundation for DID</p></li>
<li>
<p>Why is dif-in-dif attractive? Identification strategy: Inter-temporal variation between groups</p>
<ul>
<li><p><strong>Cross-sectional estimator</strong> helps avoid omitted (unobserved) <strong>common trends</strong></p></li>
<li><p><strong>Time-series estimator</strong> helps overcome omitted (unobserved) <strong>cross-sectional differences</strong></p></li>
</ul>
</li>
</ul>
<p>Consider</p>
<ul>
<li><p><span class="math inline">\(D_i = 1\)</span> treatment group</p></li>
<li><p><span class="math inline">\(D_i = 0\)</span> control group</p></li>
<li><p><span class="math inline">\(T= 1\)</span> After the treatment</p></li>
<li><p><span class="math inline">\(T =0\)</span> Before the treatment</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>After (T = 1)</th>
<th>Before (T = 0)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treated <span class="math inline">\(D_i =1\)</span>
</td>
<td><span class="math inline">\(E[Y_{1i}(1)|D_i = 1]\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)|D)i=1]\)</span></td>
</tr>
<tr class="even">
<td>Control <span class="math inline">\(D_i = 0\)</span>
</td>
<td><span class="math inline">\(E[Y_{0i}(1) |D_i =0]\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)|D_i=0]\)</span></td>
</tr>
</tbody>
</table></div>
<p>missing <span class="math inline">\(E[Y_{0i}(1)|D=1]\)</span></p>
<p><strong>The Average Treatment Effect on Treated (ATT)</strong></p>
<p><span class="math display">\[
E[Y_1(1) - Y_0(1)|D=1] \\
= \{E[Y(1)|D=1] - E[Y(1)|D=0] \} - \{E[Y(0)|D=1] - E[Y(0)|D=0] \}
\]</span></p>
<p>More elaboration:</p>
<ul>
<li>For the treatment group, we isolate the difference between being treated and not being treated. If the untreated group would have been affected in a different way, the DiD design and estimate would tell us nothing.</li>
<li>Alternatively, because we can’t observe treatment variation in the control group, we can’t say anything about the treatment effect on this group.</li>
</ul>
<p><br></p>
<p><strong>Extension</strong></p>
<p>More than 2 groups (multiple treatments and multiple controls), and more than 2 period (pre and post)</p>
<p><span class="math display">\[
Y_{igt} = \alpha_g + \gamma_t + \beta I_{gt} + \delta X_{igt} + \epsilon_{igt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\alpha_g\)</span> is the group-specific fixed effect</p></li>
<li><p><span class="math inline">\(\gamma_t\)</span> = time specific fixed effect</p></li>
<li><p><span class="math inline">\(\beta\)</span> = dif-in-dif effect</p></li>
<li><p><span class="math inline">\(I_{gt}\)</span> = interaction terms (n treatment indicators x n post-treatment dummies) (capture effect heterogeneity over time)</p></li>
</ul>
<p>This specification is the “two-way fixed effects DiD” - <strong>TWFE</strong> (i.e., 2 sets of fixed effects: group + time).</p>
<ul>
<li>However, if you have <a href="difference-in-differences.html#staggered-dif-n-dif">Staggered Dif-n-dif</a> (i.e., treatment is applied at different times to different groups). TWFE is really bad.</li>
</ul>
<p><br></p>
<p>Notes:</p>
<ul>
<li>
<p><a href="matching-methods.html#matching-methods">Matching Methods</a></p>
<ul>
<li><p>Match treatment and control based on pre-treatment observables</p></li>
<li><p>Modify SEs appropriately <span class="citation">(<a href="references.html#ref-heckman1997" role="doc-biblioref">J. J. Heckman, Ichimura, and Todd 1997</a>)</span></p></li>
</ul>
</li>
<li>
<p>It’s always good to show results with and without controls because</p>
<ul>
<li><p>If the controls are fixed within group or within time, then those should be absorbed under those fixed effects</p></li>
<li><p>If the controls are dynamic across group and across, then your parallel trends assumption is not plausible.</p></li>
</ul>
</li>
<li>
<p>SEs are typically clustered within groups, but this approach can make our SEs too small, that leads to overconfidence in our estimates. Hence, <span class="citation">Bertrand, Duflo, and Mullainathan (<a href="references.html#ref-bertrand2004much" role="doc-biblioref">2004</a>)</span> suggest either</p>
<ol style="list-style-type: decimal">
<li><p>aggregating data to just one pre-treatment and one post-treatment period per group</p></li>
<li><p>using cluster bootstrapped SEs.</p></li>
</ol>
</li>
</ul>
<p><br></p>
<div id="examples" class="section level3" number="25.1.1">
<h3>
<span class="header-section-number">25.1.1</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h3>
<div id="example-from-princeton" class="section level4" number="25.1.1.1">
<h4>
<span class="header-section-number">25.1.1.1</span> Example from <a href="https://www.princeton.edu/~otorres/DID101R.pdf">Princeton</a><a class="anchor" aria-label="anchor" href="#example-from-princeton"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign/">foreign</a></span><span class="op">)</span></span>
<span><span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html">read.dta</a></span><span class="op">(</span><span class="st">"http://dss.princeton.edu/training/Panel101.dta"</span><span class="op">)</span></span></code></pre></div>
<p>create a dummy variable to indicate the time when the treatment started</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span><span class="op">$</span><span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1994</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>create a dummy variable to identify the treatment group</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span><span class="op">$</span><span class="va">treated</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"E"</span> <span class="op">|</span></span>
<span>                            <span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"F"</span> <span class="op">|</span> <span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"G"</span> ,</span>
<span>                        <span class="fl">1</span>,</span>
<span>                        <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>create an interaction between time and treated</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span><span class="op">$</span><span class="va">did</span> <span class="op">=</span> <span class="va">mydata</span><span class="op">$</span><span class="va">time</span> <span class="op">*</span> <span class="va">mydata</span><span class="op">$</span><span class="va">treated</span></span></code></pre></div>
<p>estimate the DID estimator</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">didreg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">did</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">didreg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = y ~ treated + time + did, data = mydata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;        Min         1Q     Median         3Q        Max </span></span>
<span><span class="co">#&gt; -9.768e+09 -1.623e+09  1.167e+08  1.393e+09  6.807e+09 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span><span class="co">#&gt; (Intercept)  3.581e+08  7.382e+08   0.485   0.6292  </span></span>
<span><span class="co">#&gt; treated      1.776e+09  1.128e+09   1.575   0.1200  </span></span>
<span><span class="co">#&gt; time         2.289e+09  9.530e+08   2.402   0.0191 *</span></span>
<span><span class="co">#&gt; did         -2.520e+09  1.456e+09  -1.731   0.0882 .</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.953e+09 on 66 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.08273,    Adjusted R-squared:  0.04104 </span></span>
<span><span class="co">#&gt; F-statistic: 1.984 on 3 and 66 DF,  p-value: 0.1249</span></span></code></pre></div>
<p>The <code>did</code> coefficient is the differences-in-differences estimator. Treat has a negative effect</p>
<p><br></p>
</div>
<div id="example-by-card1993" class="section level4" number="25.1.1.2">
<h4>
<span class="header-section-number">25.1.1.2</span> Example by <span class="citation">Card and Krueger (<a href="references.html#ref-card1993" role="doc-biblioref">1993</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-card1993"><i class="fas fa-link"></i></a>
</h4>
<p>found that increase in minimum wage increases employment</p>
<p>Experimental Setting:</p>
<ul>
<li><p>New Jersey (treatment) increased minimum wage</p></li>
<li><p>Penn (control) did not increase minimum wage</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th></th>
<th>After</th>
<th>Before</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td>NJ</td>
<td>A</td>
<td>B</td>
<td>A - B</td>
</tr>
<tr class="even">
<td>Control</td>
<td>PA</td>
<td>C</td>
<td>D</td>
<td>C - D</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>A - C</td>
<td>B - D</td>
<td>(A - B) - (C - D)</td>
</tr>
</tbody>
</table></div>
<p>where</p>
<ul>
<li><p>A - B = treatment effect + effect of time (additive)</p></li>
<li><p>C - D = effect of time</p></li>
<li><p>(A - B) - (C - D) = dif-n-dif</p></li>
</ul>
<p><strong>The identifying assumptions</strong>:</p>
<ul>
<li><p>Can’t have <strong>switchers</strong></p></li>
<li>
<p>PA is the control group</p>
<ul>
<li><p>is a good counter factual</p></li>
<li><p>is what NJ would look like if they hadn’t had the treatment</p></li>
</ul>
</li>
</ul>
<p><span class="math display">\[
Y_{jt} = \beta_0 + NJ_j \beta_1 + POST_t \beta_2 + (NJ_j \times POST_t)\beta_3+ X_{jt}\beta_4 + \epsilon_{jt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(j\)</span> = restaurant</p></li>
<li><p><span class="math inline">\(NJ\)</span> = dummy where 1 = NJ, and 0 = PA</p></li>
<li><p><span class="math inline">\(POST\)</span> = dummy where 1 = post, and 0 = pre</p></li>
</ul>
<p>Notes:</p>
<ul>
<li><p>We don’t need <span class="math inline">\(\beta_4\)</span> in our model to have unbiased <span class="math inline">\(\beta_3\)</span>, but including it would give our coefficients efficiency</p></li>
<li><p>If we use <span class="math inline">\(\Delta Y_{jt}\)</span> as the dependent variable, we don’t need <span class="math inline">\(POST_t \beta_2\)</span> anymore</p></li>
<li><p>Alternative model specification is that the authors use NJ high wage restaurant as control group (still choose those that are close to the border)</p></li>
<li><p>The reason why they can’t control for everything (PA + NJ high wage) is because it’s hard to interpret the causal treatment</p></li>
<li>
<p>Dif-n-dif utilizes similarity in pretrend of the dependent variables. However, this is neither a necessary nor sufficient for the identifying assumption.</p>
<ul>
<li><p>It’s not sufficient because they can have multiple treatments (technically, you could include more control, but your treatment can’t interact)</p></li>
<li><p>It’s not necessary because trends can be parallel after treatment</p></li>
</ul>
</li>
<li><p>However, we can’t never be certain; we just try to find evidence consistent with our theory so that dif-n-dif can work.</p></li>
<li><p>Notice that we don’t need before treatment the <strong>levels of the dependent variable</strong> to be the same (e.g., same wage average in both NJ and PA), dif-n-dif only needs <strong>pre-trend (i.e., slope)</strong> to be the same for the two groups.</p></li>
</ul>
<p><br></p>
</div>
<div id="example-by-butcher2014" class="section level4" number="25.1.1.3">
<h4>
<span class="header-section-number">25.1.1.3</span> Example by <span class="citation">Butcher, McEwan, and Weerapana (<a href="references.html#ref-butcher2014" role="doc-biblioref">2014</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-butcher2014"><i class="fas fa-link"></i></a>
</h4>
<p>Theory:</p>
<ul>
<li>
<p>Highest achieving students are usually in hard science. Why?</p>
<ul>
<li><p>Hard to give students students the benefit of doubt for hard science</p></li>
<li><p>How unpleasant and how easy to get a job. Degrees with lower market value typically want to make you feel more pleasant</p></li>
</ul>
</li>
</ul>
<p>Under OLS</p>
<p><span class="math display">\[
E_{ij} = \beta_0 + X_i \beta_1 + G_j \beta_2 + \epsilon_{ij}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(X_i\)</span> = student attributes</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> = causal estimate (from grade change)</p></li>
<li><p><span class="math inline">\(E_{ij}\)</span> = Did you choose to enroll in major <span class="math inline">\(j\)</span></p></li>
<li><p><span class="math inline">\(G_j\)</span> = grade given in major <span class="math inline">\(j\)</span></p></li>
</ul>
<p>Examine <span class="math inline">\(\hat{\beta}_2\)</span></p>
<ul>
<li><p>Negative bias: Endogenous response because department with lower enrollment rate will give better grade</p></li>
<li><p>Positive bias: hard science is already having best students (i.e., ability), so if they don’t their grades can be even lower</p></li>
</ul>
<p>Under dif-n-dif</p>
<p><span class="math display">\[
Y_{idt} = \beta_0 + POST_t \beta_1 + Treat_d \beta_2 + (POST_t \times Treat_d)\beta_3 + X_{idt} + \epsilon_{idt}
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(Y_{idt}\)</span> = grade average</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="18%">
<col width="46%">
<col width="9%">
<col width="8%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Intercept</th>
<th>Treat</th>
<th>Post</th>
<th>Treat*Post</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treat Pre</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Treat Post</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Control Pre</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Control Post</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td></td>
<td>Average for pre-control <span class="math inline">\(\beta_0\)</span>
</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></div>
<p>A more general specification of the dif-n-dif is that</p>
<p><span class="math display">\[
Y_{idt} = \alpha_0 + (POST_t \times Treat_d) \alpha_1 + \theta_d + \delta_t + X_{idt} + u_{idt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\((\theta_d + \delta_t)\)</span> richer , more df than <span class="math inline">\(Treat_d \beta_2 + Post_t \beta_1\)</span> (because fixed effects subsume Post and treat)</p></li>
<li><p><span class="math inline">\(\alpha_1\)</span> should be equivalent to <span class="math inline">\(\beta_3\)</span> (if your model assumptions are correct)</p></li>
</ul>
<p>Under causal inference, <span class="math inline">\(R^2\)</span> is not so important.</p>
</div>
</div>
</div>
<div id="two-way-fixed-effects" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> Two-way Fixed-effects<a class="anchor" aria-label="anchor" href="#two-way-fixed-effects"><i class="fas fa-link"></i></a>
</h2>
<p>A generalization of the dif-n-dif model is the two-way fixed-effects models where you have multiple groups and time effects. But this is not a designed-based, non-parametric causal estimator <span class="citation">(<a href="references.html#ref-imai2020" role="doc-biblioref">Imai and Kim 2020</a>)</span></p>
<p>When applying TWFE to multiple groups and multiple periods, the supposedly causal coefficient is the weighted average of all two-group/two-period DiD estimators in the data where some of the weights can be negative. More specifically, the weights are proportional to group sizes and treatment indicator’s variation in each pair, where units in the middle of the panel have the highest weight.</p>
<p>The canonical/standard TWFE only works when</p>
<ul>
<li><p>Effects are homogeneous across units and across time periods (i.e., no dynamic changes in the effects of treatment). See <span class="citation">(<a href="references.html#ref-goodman-bacon2021" role="doc-biblioref">Goodman-Bacon 2021</a>; <a href="references.html#ref-dechaisemartin2020" role="doc-biblioref">Chaisemartin and D’Haultfœuille 2020</a>; <a href="references.html#ref-sun2021" role="doc-biblioref">L. Sun and Abraham 2021</a>; <a href="references.html#ref-borusyak2021" role="doc-biblioref">Borusyak, Hull, and Jaravel 2021</a>)</span> for details.</p></li>
<li><p>2 time periods.</p></li>
</ul>
<p>Within this setting, TWFE works because, using the baseline (e.g., control units where their treatment status is unchanged across time periods), the comparison can be</p>
<ul>
<li>
<p>Good for</p>
<ul>
<li><p>Newly treated units vs. control</p></li>
<li><p>Newly treated units vs not-yet treated</p></li>
</ul>
</li>
<li>
<p>Bad for</p>
<ul>
<li>Newly treated vs. already treated (because already treated cannot serve as the potential outcome for the newly treated).</li>
</ul>
</li>
</ul>
<p>Note: Notation for this section is consistent with <span class="citation">(<a href="references.html#ref-arkhangelsky2021double" role="doc-biblioref">Arkhangelsky, Imbens, et al. 2021</a>)</span></p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \lambda_t + \tau W_{it} + \beta X_{it} + \epsilon_{it}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Y_{it}\)</span> is the outcome</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> is the unit FE</p></li>
<li><p><span class="math inline">\(\lambda_t\)</span> is the time FE</p></li>
<li><p><span class="math inline">\(\tau\)</span> is the causal effect of treatment</p></li>
<li><p><span class="math inline">\(W_{it}\)</span> is the treatment indicator</p></li>
<li><p><span class="math inline">\(X_{it}\)</span> are covariates</p></li>
</ul>
<p>When <span class="math inline">\(T = 2\)</span>, the TWFE is the traditional DiD model</p>
<p>Under the following assumption, <span class="math inline">\(\hat{\tau}_{OLS}\)</span> is unbiased:</p>
<ol style="list-style-type: decimal">
<li>homogeneous treatment effect</li>
<li>parallel trends assumptions</li>
<li>linear additive effects <span class="citation">(<a href="references.html#ref-imai2020" role="doc-biblioref">Imai and Kim 2020</a>)</span>
</li>
</ol>
<p>To be robust against</p>
<ol style="list-style-type: decimal">
<li>time- and unit-varying effects</li>
</ol>
<p>We can use the reshaped inverse probability weighting (RIPW)- TWFE estimator</p>
<p>With the following assumptions:</p>
<ul>
<li><p>SUTVA</p></li>
<li><p>Binary treatment: <span class="math inline">\(\mathbf{W}_i = (W_{i1}, \dots, W_{it})\)</span> where <span class="math inline">\(\mathbf{W}_i \sim \mathbf{\pi}_i\)</span> generalized propensity score (i.e., each person treatment likelihood follow <span class="math inline">\(\pi\)</span> regardless of the period)</p></li>
</ul>
<p>Then, the unit-time specific effect is <span class="math inline">\(\tau_{it} = Y_{it}(1) - Y_{it}(0)\)</span></p>
<p>Then the Doubly Average Treatment Effect (DATE) is</p>
<p><span class="math display">\[
\tau(\xi) = \sum_{T=1}^T \xi_t \left(\frac{1}{n} \sum_{i = 1}^n \tau_{it} \right)
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\frac{1}{n} \sum_{i = 1}^n \tau_{it}\)</span> is the unweighted effect of treatment across units (i.e., time-specific ATE).</p></li>
<li><p><span class="math inline">\(\xi = (\xi_1, \dots, \xi_t)\)</span> are user-specific weights for each time period.</p></li>
<li><p>This estimand is called DATE because it’s weighted (averaged) across both time and units.</p></li>
</ul>
<p>A special case of DATE is when both time and unit-weights are equal</p>
<p><span class="math display">\[
\tau_{eq} = \frac{1}{nT} \sum_{t=1}^T \sum_{i = 1}^n \tau_{it}
\]</span></p>
<p>Borrowing the idea of inverse propensity-weighted least squares estimator in the cross-sectional case that we reweight the objective function via the treatment assignment mechanism:</p>
<p><span class="math display">\[
\hat{\tau} \triangleq \arg \min_{\tau} \sum_{i = 1}^n (Y_i -\mu - W_i \tau)^2 \frac{1}{\pi_i (W_i)}
\]</span></p>
<p>where</p>
<ul>
<li><p>the first term is the least squares objective</p></li>
<li><p>the second term is the propensity score</p></li>
</ul>
<p>In the panel data case, the IPW estimator will be</p>
<p><span class="math display">\[
\hat{\tau}_{IPW} \triangleq \arg \min_{\tau} \sum_{i = 1}^n \sum_{t =1}^T (Y_{i t}-\alpha_i - \lambda_t - W_{it} \tau)^2 \frac{1}{\pi_i (W_i)}
\]</span></p>
<p>Then, to have DATE that users can specify the structure of time weight, we use reshaped IPW estimator <span class="citation">(<a href="references.html#ref-arkhangelsky2021double" role="doc-biblioref">Arkhangelsky, Imbens, et al. 2021</a>)</span></p>
<p><span class="math display">\[
\hat{\tau}_{RIPW} (\Pi) \triangleq \arg \min_{\tau} \sum_{i = 1}^n \sum_{t =1}^T (Y_{i t}-\alpha_i - \lambda_t - W_{it} \tau)^2 \frac{\Pi(W_i)}{\pi_i (W_i)}
\]</span></p>
<p>where it’s a function of a data-independent distribution <span class="math inline">\(\Pi\)</span> that depends on the support of the treatment path <span class="math inline">\(\mathbb{S} = \cup_i Supp(W_i)\)</span></p>
<p>This generalization can transform to</p>
<ul>
<li><p>IPW-TWFE estimator when <span class="math inline">\(\Pi \sim Unif(\mathbb{S})\)</span></p></li>
<li><p>randomized experiment when <span class="math inline">\(\Pi = \pi_i\)</span></p></li>
</ul>
<p>To choose <span class="math inline">\(\Pi\)</span>, we don’t need to data, we just need possible assignments in your setting.</p>
<ul>
<li><p>For most practical problems (DiD, staggered, transient), we have closed form solutions</p></li>
<li><p>For generic solver, we can use nonlinear programming (e..g, BFGS algorithm)</p></li>
</ul>
<p><br></p>
<p>As argued in <span class="citation">(<a href="references.html#ref-imai2020" role="doc-biblioref">Imai and Kim 2020</a>)</span> that TWFE is not a non-parametric approach, it can be subjected to incorrect model assumption (i.e., model dependence).</p>
<ul>
<li><p>Hence, they advocate for matching methods for time-series cross-sectional data <span class="citation">(<a href="references.html#ref-imai2021" role="doc-biblioref">Imai, Kim, and Wang 2021</a>)</span></p></li>
<li><p>Use <code>wfe</code> and <code>PanelMatch</code> to apply their paper.</p></li>
</ul>
<p>This package is based on <span class="citation">(<a href="references.html#ref-somaini2016" role="doc-biblioref">Somaini and Wolak 2016</a>)</span></p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bacondecomp</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">bacondecomp</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/bacondecomp/man/castle.html">castle</a></span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paulosomaini/xtreg2way">xtreg2way</a></span><span class="op">)</span></span>
<span><span class="co"># output &lt;- xtreg2way(y,</span></span>
<span><span class="co">#                     data.frame(x1, x2),</span></span>
<span><span class="co">#                     iid,</span></span>
<span><span class="co">#                     tid,</span></span>
<span><span class="co">#                     w,</span></span>
<span><span class="co">#                     noise = "1",</span></span>
<span><span class="co">#                     se = "1")</span></span>
<span></span>
<span><span class="co"># equilvalently</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xtreg2way/man/xtreg2way.html">xtreg2way</a></span><span class="op">(</span><span class="va">l_homicide</span> <span class="op">~</span> <span class="va">post</span>,</span>
<span>                    <span class="va">df</span>,</span>
<span>                    iid <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">state</span>, <span class="co"># group id</span></span>
<span>                    tid <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>, <span class="co"># time id</span></span>
<span>                    <span class="co"># w, # vector of weight</span></span>
<span>                    se <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">betaHat</span></span>
<span><span class="co">#&gt;                  [,1]</span></span>
<span><span class="co">#&gt; l_homicide 0.08181162</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">aVarHat</span></span>
<span><span class="co">#&gt;             [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.003751709</span></span>
<span></span>
<span><span class="co"># to save time, you can use your structure in the last output for a new set of variables</span></span>
<span><span class="co"># output2 &lt;- xtreg2way(y, x1, struc=output$struc)</span></span></code></pre></div>
<p>Standard errors estimation options</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th>Set</th>
<th>Estimation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>se = "0"</code></td>
<td>Assume homoskedasticity and no within group correlation or serial correlation</td>
</tr>
<tr class="even">
<td>
<code>se = "1"</code> (default)</td>
<td>robust to heteroskadasticity and serial correlation <span class="citation">(<a href="references.html#ref-arellano1987computing" role="doc-biblioref">Arellano et al. 1987</a>)</span>
</td>
</tr>
<tr class="odd">
<td><code>se = "2"</code></td>
<td>robust to heteroskedasticity, but assumes no correlation within group or serial correlation</td>
</tr>
<tr class="even">
<td><code>se = "11"</code></td>
<td>Aerllano SE with df correction performed by Stata xtreg <span class="citation">(<a href="references.html#ref-somaini2021twfem" role="doc-biblioref">Somaini and Wolak 2021</a>)</span>
</td>
</tr>
</tbody>
</table></div>
<p>Alternatively, you can also do it manually or with the <code>plm</code> package, but you have to be careful with how the SEs are estimated</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sites.google.com/site/npgraham1/research/code">multiwayvcov</a></span><span class="op">)</span> <span class="co"># get vcov matrix </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span> <span class="co"># robust SEs estimation</span></span>
<span></span>
<span><span class="co"># manual</span></span>
<span><span class="va">output3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">l_homicide</span> <span class="op">~</span> <span class="va">post</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get variance-covariance matrix</span></span>
<span><span class="va">vcov_tw</span> <span class="op">&lt;-</span> <span class="fu">multiwayvcov</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/multiwayvcov/man/cluster.vcov.html">cluster.vcov</a></span><span class="op">(</span><span class="va">output3</span>,</span>
<span>                        <span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span>, <span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>,</span>
<span>                        use_white <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                        df_correction <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">output3</span>, <span class="va">vcov_tw</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> </span>
<span><span class="co">#&gt;   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; 0.08181162 0.05671410 1.44252696 0.14979397</span></span></code></pre></div>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using the plm package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=plm">plm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">output4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/plm.html">plm</a></span><span class="op">(</span><span class="va">l_homicide</span> <span class="op">~</span> <span class="va">post</span>, </span>
<span>               data <span class="op">=</span> <span class="va">df</span>, </span>
<span>               index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"year"</span><span class="op">)</span>, </span>
<span>               model <span class="op">=</span> <span class="st">"within"</span>, </span>
<span>               effect <span class="op">=</span> <span class="st">"twoways"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">output4</span>, vcov <span class="op">=</span> <span class="va">vcovHC</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; t test of coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; post 0.081812   0.057748  1.4167   0.1572</span></span></code></pre></div>
<p>As you can see, differences stem from SE estimation, not the coefficient estimate.</p>
<p><br></p>
<div id="multiple-periods-and-variation-in-treatment-timing" class="section level3" number="25.2.1">
<h3>
<span class="header-section-number">25.2.1</span> Multiple periods and variation in treatment timing<a class="anchor" aria-label="anchor" href="#multiple-periods-and-variation-in-treatment-timing"><i class="fas fa-link"></i></a>
</h3>
<p>This is an extension of the DiD framework to settings where you have</p>
<ul>
<li><p>more than 2 time periods</p></li>
<li><p>different treatment timing</p></li>
</ul>
<p>When treatment effects are heterogeneous across time or units, the standard <a href="difference-in-differences.html#two-way-fixed-effects">Two-way Fixed-effects</a> is inappropriate.</p>
<p>Notation is consistent with <code>did</code> <a href="https://cran.r-project.org/web/packages/did/vignettes/multi-period-did.html">package</a> <span class="citation">(<a href="references.html#ref-callaway2021" role="doc-biblioref">Callaway and Sant’Anna 2021</a>)</span></p>
<ul>
<li><p><span class="math inline">\(Y_{it}(0)\)</span> is the potential outcome for unit <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(Y_{it}(g)\)</span> is the potential outcome for unit <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span> if it’s treated in period <span class="math inline">\(g\)</span></p></li>
<li><p><span class="math inline">\(Y_{it}\)</span> is the observed outcome for unit <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span></p></li>
</ul>
<p><span class="math display">\[
Y_{it} =
\begin{cases}
Y_{it} = Y_{it}(0) &amp; \forall i \in \text{never-treated group} \\
Y_{it} = 1\{G_i &gt; t\} Y_{it}(0) +  1\{G_i \le t \}Y_{it}(G_i) &amp; \forall i \in \text{other groups}
\end{cases}
\]</span></p>
<ul>
<li><p><span class="math inline">\(G_i\)</span> is the time period when <span class="math inline">\(i\)</span> is treated</p></li>
<li><p><span class="math inline">\(C_i\)</span> is a dummy when <span class="math inline">\(i\)</span> belongs to the <strong>never-treated</strong> group</p></li>
<li><p><span class="math inline">\(D_{it}\)</span> is a dummy for whether <span class="math inline">\(i\)</span> is treated in period <span class="math inline">\(t\)</span></p></li>
</ul>
<p>Assumptions:</p>
<ul>
<li><p>Staggered treatment adoption: once treated, a unit cannot be untreated (revert)</p></li>
<li>
<p>Parallel trends assumptions::</p>
<ul>
<li>
<p>Based on never-treated units: <span class="math inline">\(E[Y_t(0)- Y_{t-1}(0)|G= g] = E[Y_t(0) - Y_{t-1}(0)|C=1]\)</span></p>
<ul>
<li>Without treatment, the average potential outcomes for group <span class="math inline">\(g\)</span> equals the average potential outcomes for the never-treated group (i.e., control group), which means that we have (1) enough data on the never-treated group (2) the control group is similar to the eventually treated group.</li>
</ul>
</li>
<li>
<p>Based on not-yet treated units: <span class="math inline">\(E[Y_t(0) - Y_{t-1}(0)|G = g] = E[Y_t(0) - Y_{t-1}(0)|D_s = 0, G \neq g]\)</span></p>
<ul>
<li><p>Not-yet treated units by time <span class="math inline">\(s\)</span> ( <span class="math inline">\(s \ge t\)</span>) can be used as comparison groups to calculate the average treatment effects for the group first treated in time <span class="math inline">\(g\)</span></p></li>
<li><p>Additional assumption: pre-treatment trends across groups <span class="citation">(<a href="references.html#ref-marcus2021role" role="doc-biblioref">Marcus and Sant’Anna 2021</a>)</span></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Group-Time ATE</p>
<ul>
<li>This is the equivalent of the average treatment effect in the standard case (2 groups, 2 periods) under multiple time periods.</li>
</ul>
<p><span class="math display">\[
ATT(g,t) = E[Y_t(g) - Y_t(0) |G = g]
\]</span></p>
<p>which is the average treatment effect for group <span class="math inline">\(g\)</span> in period <span class="math inline">\(t\)</span></p>
<ul>
<li>
<p>Identification: When the parallel trends assumption based on</p>
<ul>
<li><p>Never-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1} |G = g] - E[Y_t - Y_{g-1}|C=1] \forall t \ge g\)</span></p></li>
<li><p>Not-yet-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1}|G= g] - E[Y_t - Y_{g-1}|D_t = 0, G \neq g] \forall t \ge g\)</span></p></li>
</ul>
</li>
<li>
<p>Identification: when the parallel trends assumption only holds conditional on covariates and based on</p>
<ul>
<li><p>Never-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1} |X, G = g] - E[Y_t - Y_{g-1}|X, C=1] \forall t \ge g\)</span></p></li>
<li><p>Not-yet-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1}|X, G= g] - E[Y_t - Y_{g-1}|X, D_t = 0, G \neq g] \forall t \ge g\)</span></p></li>
<li><p>This is plausible when you have suspected selection bias that can be corrected by using covariates (i.e., very much similar to matching methods to have plausible parallel trends).</p></li>
</ul>
</li>
</ul>
<p>3 possible parameters of interest are:</p>
<ol style="list-style-type: decimal">
<li>Average treatment effect per group</li>
</ol>
<p><span class="math display">\[
\theta_S(g) = \frac{1}{\tau - g + 1} \sum_{t = 2}^\tau \mathbb{1} \{ \le t \} ATT(g,t)
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Average treatment effect across groups (that were treated) (similar to average treatment effect on the treated in the canonical case)</li>
</ol>
<p><span class="math display">\[
\theta_S^O := \sum_{g=2}^\tau \theta_S(g) P(G=g)
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Average treatment effect dynamics (i.e., average treatment effect for groups that have been exposed to the treatment for <span class="math inline">\(e\)</span> time periods):</li>
</ol>
<p><span class="math display">\[
\theta_D(e) := \sum_{g=2}^\tau \mathbb{1} \{g + e \le \tau \}ATT(g,g + e) P(G = g|G + e \le \tau)
\]</span></p>
<p><br></p>
</div>
<div id="staggered-dif-n-dif" class="section level3" number="25.2.2">
<h3>
<span class="header-section-number">25.2.2</span> Staggered Dif-n-dif<a class="anchor" aria-label="anchor" href="#staggered-dif-n-dif"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>When subjects are treated at different point in time (variation in treatment timing across units), we have to use staggered DiD (also known as DiD event study or dynamic DiD).</li>
<li>For design where a treatment is applied and units are exposed to this treatment at all time afterward, see <span class="citation">(<a href="references.html#ref-athey2022" role="doc-biblioref">Athey and Imbens 2022</a>)</span>
</li>
</ul>
<p>Basic design <span class="citation">(<a href="references.html#ref-stevenson2006" role="doc-biblioref">Stevenson and Wolfers 2006</a>)</span></p>
<p><span class="math display">\[
Y_{it} = \sum_k \beta_k Treatment_{it}^k + \sum_i \eta_i  State_i \\
+ \sum_t \lambda_t Year_t + Controls_{it} + \epsilon_{it}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Treatment_{it}^k\)</span> is a series of dummy variables equal to 1 if state <span class="math inline">\(i\)</span> is treated <span class="math inline">\(k\)</span> years ago in period <span class="math inline">\(t\)</span></p></li>
<li><p>SE is usually clustered at the group level (occasionally time level).</p></li>
<li><p>To avoid collinearity, the period right before treatment is usually chosen to drop.</p></li>
</ul>
<p>In this setting, we try to show that the treatment and control groups are not statistically different (i.e., the coefficient estimates before treatment are not different from 0) to show pre-treatment parallel trends.</p>
<p>However, this two-way fixed effects design has been criticized by <span class="citation">(<a href="references.html#ref-sun2021" role="doc-biblioref">L. Sun and Abraham 2021</a>; <a href="references.html#ref-callaway2021" role="doc-biblioref">Callaway and Sant’Anna 2021</a>; <a href="references.html#ref-goodman-bacon2021" role="doc-biblioref">Goodman-Bacon 2021</a>)</span>. When researchers include leads and lags of the treatment to see the long-term effects of the treatment, these leads and lags can be biased by effects from other periods, and pre-trends can falsely arise due to treatment effects heterogeneity.</p>
<p>Applying the new proposed method, finance and accounting researchers find that in many cases, the causal estimates turn out to be null <span class="citation">(<a href="references.html#ref-baker2022much" role="doc-biblioref">Baker, Larcker, and Wang 2022</a>)</span>.</p>
<p><strong>Assumptions</strong></p>
<ul>
<li><p><strong>Rollout Exogeneity</strong>: if the treatment is randomly implemented over time (i.e., unrelated to variables that could also affect our dependent variables</p></li>
<li><p><strong>No confounding events</strong></p></li>
<li>
<p><strong>Exclusion restrictions</strong></p>
<ul>
<li><p><strong><em>No-anticipation assumption</em></strong>: future treatment time do not affect current outcomes</p></li>
<li><p><strong><em>Invariance-to-history assumption</em></strong>: the time a unit under treatment does not affect the outcome (i.e., the time exposed does not matter, just whether exposed or not). This presents causal effect of early or late adoption on the outcome.</p></li>
</ul>
</li>
<li><p>And all the assumptions in listed in the <a href="difference-in-differences.html#multiple-periods-and-variation-in-treatment-timing">Multiple periods and variation in treatment timing</a></p></li>
<li>
<p>Auxiliary assumptions:</p>
<ul>
<li><p>Constant treatment effects across units</p></li>
<li><p>Constant treatment effect over time</p></li>
<li><p>Random sampling</p></li>
<li><p>Effect Additivity</p></li>
</ul>
</li>
</ul>
<div id="example-by-doleac2020" class="section level4" number="25.2.2.1">
<h4>
<span class="header-section-number">25.2.2.1</span> Example by <span class="citation">Doleac and Hansen (<a href="references.html#ref-doleac2020" role="doc-biblioref">2020</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-doleac2020"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>The purpose of banning a checking box for ex-criminal was banned because we thought that it gives more access to felons</p></li>
<li><p>Even if we ban the box, employers wouldn’t just change their behaviors. But then the unintended consequence is that employers statistically discriminate based on race</p></li>
</ul>
<p>3 types of ban the box</p>
<ol style="list-style-type: decimal">
<li>Public employer only</li>
<li>Private employer with government contract</li>
<li>All employers</li>
</ol>
<p>Main identification strategy</p>
<ul>
<li>If any county in the Metropolitan Statistical Area (MSA) adopts ban the box, it means the whole MSA is treated. Or if the state adopts “ban the ban,” every county is treated</li>
</ul>
<p>Under <a href="difference-in-differences.html#simple-dif-n-dif">Simple Dif-n-dif</a></p>
<p><span class="math display">\[
Y_{it} = \beta_0 + \beta_1 Post_t + \beta_2 treat_i + \beta_2 (Post_t \times Treat_i) + \epsilon_{it}
\]</span></p>
<p>But if there is no common post time, then we should use <a href="difference-in-differences.html#staggered-dif-n-dif">Staggered Dif-n-dif</a></p>
<p><span class="math display">\[
E_{imrt} = \alpha + \beta_1 BTB_{imt} W_{imt} + \beta_2 BTB_{mt} + \beta_3 BTB_{mt} H_{imt}+\\ \delta_m + D_{imt} \beta_5 + \lambda_{rt} + \delta_m\times f(t) \beta_7 + e_{imrt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(i\)</span> = person; <span class="math inline">\(m\)</span> = MSA; <span class="math inline">\(r\)</span> = region (US regions e.g., Midwest) ; <span class="math inline">\(r\)</span> = region; <span class="math inline">\(t\)</span> = year</p></li>
<li><p><span class="math inline">\(W\)</span> = White; <span class="math inline">\(B\)</span> = Black; <span class="math inline">\(H\)</span> = Hispanic</p></li>
<li><p><span class="math inline">\(\beta_1 BTB_{imt} W_{imt} + \beta_2 BTB_{mt} + \beta_3 BTB_{mt} H_{imt}\)</span> are the 3 dif-n-dif variables (<span class="math inline">\(BTB\)</span> = “ban the box”)</p></li>
<li><p><span class="math inline">\(\delta_m\)</span> = dummy for MSI</p></li>
<li><p><span class="math inline">\(D_{imt}\)</span> = control for people</p></li>
<li><p><span class="math inline">\(\lambda_{rt}\)</span> = region by time fixed effect</p></li>
<li><p><span class="math inline">\(\delta_m \times f(t)\)</span> = linear time trend within MSA (but we should not need this if we have good pre-trend)</p></li>
</ul>
<p>If we put <span class="math inline">\(\lambda_r - \lambda_t\)</span> (separately) we will more broad fixed effect, while <span class="math inline">\(\lambda_{rt}\)</span> will give us deeper and narrower fixed effect.</p>
<p>Before running this model, we have to drop all other races. And <span class="math inline">\(\beta_1, \beta_2, \beta_3\)</span> are not collinear because there are all interaction terms with <span class="math inline">\(BTB_{mt}\)</span></p>
<p>If we just want to estimate the model for black men, we will modify it to be</p>
<p><span class="math display">\[
E_{imrt} = \alpha + BTB_{mt} \beta_1 + \delta_m + D_{imt} \beta_5 + \lambda_{rt} + (\delta_m \times f(t)) \beta_7 + e_{imrt}
\]</span></p>
<p><span class="math display">\[
E_{imrt} = \alpha + BTB_{m (t - 3t)} \theta_1 + BTB_{m(t-2)} \theta_2 + BTB_{mt} \theta_4 \\
+ BTB_{m(t+1)}\theta_5 + BTB_{m(t+2)}\theta_6 + BTB_{m(t+3t)}\theta_7 \\
+ [\delta_m + D_{imt}\beta_5 + \lambda_r + (\delta_m \times (f(t))\beta_7 + e_{imrt}]
\]</span></p>
<p>We have to leave <span class="math inline">\(BTB_{m(t-1)}\theta_3\)</span> out for the category would not be perfect collinearity</p>
<p>So the year before BTB (<span class="math inline">\(\theta_1, \theta_2, \theta_3\)</span>) should be similar to each other (i.e., same pre-trend). Remember, we only run for places with BTB.</p>
<p>If <span class="math inline">\(\theta_2\)</span> is statistically different from <span class="math inline">\(\theta_3\)</span> (baseline), then there could be a problem, but it could also make sense if we have pre-trend announcement.</p>
<p><br></p>
<p>Example by <a href="https://rpubs.com/phle/r_tutorial_difference_in_differences">Philipp Leppert</a> replicating <a href="https://davidcard.berkeley.edu/data_sets.html">Card and Krueger (1994)</a></p>
<p>Example by <a href="https://bookdown.org/aschmi11/causal_inf/difference-in-differences.html">Anthony Schmidt</a></p>
<p><br></p>
</div>
</div>
<div id="multiple-treatment-groups" class="section level3" number="25.2.3">
<h3>
<span class="header-section-number">25.2.3</span> Multiple Treatment groups<a class="anchor" aria-label="anchor" href="#multiple-treatment-groups"><i class="fas fa-link"></i></a>
</h3>
<p>When you have 2 treatments in a setting, you should always try to model both of them under one regression to see whether they are significantly different.</p>
<ul>
<li>Never use one treated groups as control for the other, and run separate regression.</li>
</ul>
<p><span class="math display">\[
Y_{it} = \alpha + \gamma_1 Treat1_{i} + \gamma_2 Treat2_{i} + \lambda Post_t  + \delta_1(Treat1_i \times Post_t) + \delta_2(Treat2_i \times Post_t) + \epsilon_{it}
\]</span></p>
</div>
</div>
<div id="mediation-under-did" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Mediation Under DiD<a class="anchor" aria-label="anchor" href="#mediation-under-did"><i class="fas fa-link"></i></a>
</h2>
<p>Check this <a href="https://stats.stackexchange.com/questions/261218/difference-in-difference-model-with-mediators-estimating-the-effect-of-differen">post</a></p>
</div>
<div id="assumptions-2" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p><strong>Parallel Trends</strong>: Difference between the treatment and control groups remain constant if there were no treatment.</p>
<ul>
<li>
<p>should be used in cases where</p>
<ul>
<li><p>you observe before and after an event</p></li>
<li><p>you have treatment and control groups</p></li>
</ul>
</li>
<li>
<p>not in cases where</p>
<ul>
<li><p>treatment is not random</p></li>
<li><p>confounders.</p></li>
</ul>
</li>
<li>
<p>To support we use</p>
<ul>
<li><p><a href="difference-in-differences.html#placebo-test">Placebo test</a></p></li>
<li><p><a href="difference-in-differences.html#prior-parallel-trends-test">Prior Parallel Trends Test</a></p></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Linear additive effects</strong> (of group/unit specific and time-specific):</p>
<ul>
<li><p>If they are not additively interact, we have to use the weighted 2FE estimator <span class="citation">(<a href="references.html#ref-imai2020" role="doc-biblioref">Imai and Kim 2020</a>)</span></p></li>
<li><p>Typically seen in the <a href="difference-in-differences.html#staggered-dif-n-dif">Staggered Dif-n-dif</a></p></li>
</ul>
</li>
<li><p>No anticipation: There is no causal effect of the treatment before its implementation.</p></li>
</ul>
<p><strong>Possible issues</strong></p>
<ul>
<li>
<p>Estimate dependent on functional form:</p>
<ul>
<li>When the size of the response depends (nonlinearly) on the size of the intervention, we might want to look at the the difference in the group with high intensity vs. low.</li>
</ul>
</li>
<li>
<p>Selection on (time–varying) unobservables</p>
<ul>
<li>Can use the overall sensitivity of coefficient estimates to hidden bias using <a href="difference-in-differences.html#rosenbaum-bounds">Rosenbaum Bounds</a>
</li>
</ul>
</li>
<li>
<p>Long-term effects</p>
<ul>
<li>Parallel trends are more likely to be observed over shorter period (window of observation)</li>
</ul>
</li>
<li>
<p>Heterogeneous effects</p>
<ul>
<li>Different intensity (e.g., doses) for different groups.</li>
</ul>
</li>
<li>
<p>Ashenfelter dip <span class="citation">(<a href="references.html#ref-ashenfelter1985" role="doc-biblioref">Ashenfelter and Card 1985</a>)</span> (job training program participant are more likely to experience an earning drop prior enrolling in these programs)</p>
<ul>
<li>Participants are systemically different from nonparticipants before the treatment, leading to the question of permanent or transitory changes.</li>
<li>A fix to this transient endogeneity is to calculate long-run differences (exclude a number of periods symmetrically around the adoption/ implementation date). If we see a sustained impact, then we have strong evidence for the causal impact of a policy. <span class="citation">(<a href="references.html#ref-proserpio2017" role="doc-biblioref">Proserpio and Zervas 2017b</a>)</span> <span class="citation">(<a href="references.html#ref-heckman1999c" role="doc-biblioref">James J. Heckman and Smith 1999</a>)</span> <span class="citation">(<a href="references.html#ref-jepsen2014" role="doc-biblioref">Jepsen, Troske, and Coomes 2014</a>)</span> <span class="citation">(<a href="references.html#ref-li2011" role="doc-biblioref">X. Li, Gan, and Hu 2011</a>)</span>
</li>
</ul>
</li>
<li>
<p>Response to event might not be immediate (can’t be observed right away in the dependent variable)</p>
<ul>
<li>Using lagged dependent variable <span class="math inline">\(Y_{it-1}\)</span> might be more appropriate <span class="citation">(<a href="references.html#ref-blundell1998" role="doc-biblioref">Blundell and Bond 1998</a>)</span>
</li>
</ul>
</li>
<li><p>Other factors that affect the difference in trends between the two groups (i.e., treatment and control) will bias your estimation.</p></li>
<li><p>Correlated observations within a group or time</p></li>
<li><p>Incidental parameters problems <span class="citation">(<a href="references.html#ref-lancaster2000" role="doc-biblioref">Lancaster 2000</a>)</span>: it’s always better to use individual and time fixed effect.</p></li>
<li><p>When examining the effects of variation in treatment timing, we have to be careful because negative weights (per group) can be negative if there is a heterogeneity in the treatment effects over time. Example: [<span class="citation">Athey and Imbens (<a href="references.html#ref-athey2022" role="doc-biblioref">2022</a>)</span>]<span class="citation">(<a href="references.html#ref-borusyak2021" role="doc-biblioref">Borusyak, Hull, and Jaravel 2021</a>)</span><span class="citation">(<a href="references.html#ref-goodman-bacon2021" role="doc-biblioref">Goodman-Bacon 2021</a>)</span>. In this case you should use new estimands proposed by [<span class="citation">Callaway and Sant’Anna (<a href="references.html#ref-callaway2021" role="doc-biblioref">2021</a>)</span>]<span class="citation">(<a href="references.html#ref-dechaisemartin2020" role="doc-biblioref">Chaisemartin and D’Haultfœuille 2020</a>)</span>, in the <code>did</code> package. If you expect lags and leads, see <span class="citation">(<a href="references.html#ref-sun2021" role="doc-biblioref">L. Sun and Abraham 2021</a>)</span></p></li>
<li><p><span class="citation">(<a href="references.html#ref-gibbons2018" role="doc-biblioref">Gibbons, Suárez Serrato, and Urbancic 2018</a>)</span> caution when we suspect the treatment effect and treatment variance vary across groups</p></li>
</ul>
<div id="prior-parallel-trends-test" class="section level3" number="25.4.1">
<h3>
<span class="header-section-number">25.4.1</span> Prior Parallel Trends Test<a class="anchor" aria-label="anchor" href="#prior-parallel-trends-test"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Plot the average outcomes over time for both treatment and control group before and after the treatment in time.</li>
<li>Statistical test for difference in trends (using data from before the treatment period)</li>
</ol>
<p><span class="math display">\[
Y = \alpha_g + \beta_1 T + \beta_2 T\times G + \epsilon
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Y\)</span> = the outcome variable</p></li>
<li><p><span class="math inline">\(\alpha_g\)</span> = group fixed effects</p></li>
<li><p><span class="math inline">\(T\)</span> = time (e.g., specific year, or month)</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> = different time trends for each group</p></li>
</ul>
<p>Hence, if <span class="math inline">\(\beta_2 =0\)</span> provides evidence that there are no differences in the trend for the two groups prior the time treatment.</p>
<p>You can also use different functional forms (e..g, polynomial or nonlinear).</p>
<p>If <span class="math inline">\(\beta_2 \neq 0\)</span> statistically, possible reasons can be:</p>
<ul>
<li><p>Statistical significance can be driven by large sample</p></li>
<li><p>Or the trends are so consistent, and just one period deviation can throw off the trends. Hence, statistical statistical significance.</p></li>
</ul>
<p>Technically, we can still salvage the research by including time fixed effects, instead of just the before-and-after time fixed effect (actually, most researchers do this mechanically anyway nowadays). However, a side effect can be that the time fixed effects can also absorb some part your treatment effect as well, especially in cases where the treatment effects vary with time (i.e., stronger or weaker over time) <span class="citation">(<a href="references.html#ref-wolfers2003" role="doc-biblioref">Wolfers 2003</a>)</span>.</p>
<p>Debate:</p>
<ul>
<li>
<p><span class="citation">(<a href="references.html#ref-kahn2020promise" role="doc-biblioref">Kahn-Lang and Lang 2020</a>)</span> argue that DiD will be more plausible when the treatment and control groups are similar not only in <strong>trends</strong>, but also in <strong>levels</strong>. Because when we observe dissimilar in levels prior to the treatment, why is it okay to think that this will not affect future trends?</p>
<ul>
<li><p>Show a plot of the dependent variable’s time series for treated and control groups and also a similar plot with matched sample. <span class="citation">(<a href="references.html#ref-ryan2019now" role="doc-biblioref">Ryan et al. 2019</a>)</span> show evidence of matched DiD did well in the setting of non-parallel trends (at least in health care setting).</p></li>
<li><p>In the case that we don’t have similar levels ex ante between treatment and control groups, functional form assumptions matter and we need justification for our choice.</p></li>
</ul>
</li>
<li>
<p>Pre-trend statistical tests: <span class="citation">(<a href="references.html#ref-roth2022pretest" role="doc-biblioref">Roth 2022</a>)</span> provides evidence that these test are usually underpowered.</p>
<ul>
<li>See <a href="https://github.com/jonathandroth/PretrendsPower">PretrendsPower</a> and <a href="https://github.com/jonathandroth/pretrends">pretrends</a> packages for correcting this.</li>
</ul>
</li>
</ul>
</div>
<div id="placebo-test" class="section level3" number="25.4.2">
<h3>
<span class="header-section-number">25.4.2</span> Placebo Test<a class="anchor" aria-label="anchor" href="#placebo-test"><i class="fas fa-link"></i></a>
</h3>
<p>Procedure:</p>
<ol style="list-style-type: decimal">
<li>Sample data only in the period before the treatment in time.</li>
<li>Consider different fake cutoff in time, either
<ol style="list-style-type: decimal">
<li><p>Try the whole sequence in time</p></li>
<li><p>Generate random treatment period, and use <strong>randomization inference</strong> to account for sampling distribution of the fake effect.</p></li>
</ol>
</li>
<li>Estimate the DiD model but with the post-time = 1 with the fake cutoff</li>
<li>A significant DiD coefficient means that you violate the parallel trends! You have a big problem.</li>
</ol>
<p>Alternatively,</p>
<ul>
<li>When data have multiple control groups, drop the treated group, and assign another control group as a “fake” treated group. But even if it fails (i.e., you find a significant DiD effect) among the control groups, it can still be fine. However, this method is used under <a href="synthetic-control.html#synthetic-control">Synthetic Control</a>
</li>
</ul>
<p><br></p>
<p><strong>Robustness Check</strong></p>
<ul>
<li>
<p>Placebo DiD (if the DiD estimate <span class="math inline">\(\neq 0\)</span>, parallel trend is violated, and original DiD is biased):</p>
<ul>
<li><p>Group: Use fake treatment groups: A population that was <strong>not</strong> affect by the treatment</p></li>
<li><p>Time: Redo the DiD analysis for period before the treatment (expected treatment effect is 0) (e..g, for previous year or period).</p></li>
</ul>
</li>
<li><p>Possible alternative control group: Expected results should be similar</p></li>
<li><p>Try different windows (further away from the treatment point, other factors can creep in and nullify your effect).</p></li>
<li><p>Treatment Reversal (what if we don’t see the treatment event)</p></li>
<li><p>Higher-order polynomial time trend (to relax linearity assumption)</p></li>
<li>
<p>Test whether other dependent variables that should be affected by the event are indeed unaffected.</p>
<ul>
<li>Use the same control and treatment period (DiD <span class="math inline">\(\neq0\)</span>, there is a problem)</li>
</ul>
</li>
</ul>
<p><br></p>
</div>
<div id="rosenbaum-bounds" class="section level3" number="25.4.3">
<h3>
<span class="header-section-number">25.4.3</span> Rosenbaum Bounds<a class="anchor" aria-label="anchor" href="#rosenbaum-bounds"><i class="fas fa-link"></i></a>
</h3>
<p><a href="difference-in-differences.html#rosenbaum-bounds">Rosenbaum Bounds</a> assess the overall sensitivity of coefficient estimates to hidden bias <span class="citation">(<a href="references.html#ref-rosenbaum2002overt" role="doc-biblioref">Paul R. Rosenbaum 2002a</a>)</span> without having knowledge (e.g., direction) of the bias. This method is also known as worst case analyses <span class="citation">(<a href="references.html#ref-diprete20047" role="doc-biblioref">DiPrete and Gangl 2004</a>)</span>.</p>
<p>Consider the treatment assignment is based in a way that the odds of treatment of a unit and its control is different by a multiplier <span class="math inline">\(\Gamma\)</span> (where <span class="math inline">\(\Gamma = 1\)</span> mean that the odds of assignment is identical, which mean random treatment assignment).</p>
<ul>
<li>This bias is the product of an unobservable that influences both treatment selection and outcome by a factor <span class="math inline">\(\Gamma\)</span> (omitted variable bias)</li>
</ul>
<p>Using this technique, we may estimate the upper limit of the p-value for the treatment effect while assuming selection on unobservables of magnitude <span class="math inline">\(\Gamma\)</span>.</p>
<p>Usually, we would create a table of different levels of <span class="math inline">\(\Gamma\)</span> to assess how the magnitude of biases can affect our evidence of the treatment effect (estimate).</p>
<p>If we have treatment assignment is clustered (e.g., within school, within state) we need to adjust the bounds for clustered treatment assignment <span class="citation">(<a href="references.html#ref-hansen2014clustered" role="doc-biblioref">Ben B. Hansen, Rosenbaum, and Small 2014</a>)</span> (similar to clustered standard errors)</p>
<p>Then, we can report the minimum value of <span class="math inline">\(\Gamma\)</span> at which the treatment treat is nullified (i.e., become insignificant). And the literature’s rules of thumb is that if <span class="math inline">\(\Gamma &gt; 2\)</span>, then we have strong evidence for our treatment effect is robust to large biases <span class="citation">(<a href="references.html#ref-proserpio2017online" role="doc-biblioref">Proserpio and Zervas 2017a</a>)</span></p>
<p>Packages</p>
<ul>
<li><p><code>rbounds</code> <span class="citation">(<a href="references.html#ref-keele2010overview" role="doc-biblioref">Keele 2010</a>)</span></p></li>
<li><p><code>sensitivitymv</code> <span class="citation">(<a href="references.html#ref-rosenbaum2015two" role="doc-biblioref">Paul R. Rosenbaum 2015</a>)</span></p></li>
<li><p><code>sensitivitymw</code> <span class="citation">(<a href="references.html#ref-rosenbaum2015two" role="doc-biblioref">Paul R. Rosenbaum 2015</a>)</span></p></li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regression-discontinuity.html"><span class="header-section-number">24</span> Regression Discontinuity</a></div>
<div class="next"><a href="synthetic-control.html"><span class="header-section-number">26</span> Synthetic Control</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#difference-in-differences"><span class="header-section-number">25</span> Difference-in-differences</a></li>
<li>
<a class="nav-link" href="#simple-dif-n-dif"><span class="header-section-number">25.1</span> Simple Dif-n-dif</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#examples"><span class="header-section-number">25.1.1</span> Examples</a></li></ul>
</li>
<li>
<a class="nav-link" href="#two-way-fixed-effects"><span class="header-section-number">25.2</span> Two-way Fixed-effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiple-periods-and-variation-in-treatment-timing"><span class="header-section-number">25.2.1</span> Multiple periods and variation in treatment timing</a></li>
<li><a class="nav-link" href="#staggered-dif-n-dif"><span class="header-section-number">25.2.2</span> Staggered Dif-n-dif</a></li>
<li><a class="nav-link" href="#multiple-treatment-groups"><span class="header-section-number">25.2.3</span> Multiple Treatment groups</a></li>
</ul>
</li>
<li><a class="nav-link" href="#mediation-under-did"><span class="header-section-number">25.3</span> Mediation Under DiD</a></li>
<li>
<a class="nav-link" href="#assumptions-2"><span class="header-section-number">25.4</span> Assumptions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#prior-parallel-trends-test"><span class="header-section-number">25.4.1</span> Prior Parallel Trends Test</a></li>
<li><a class="nav-link" href="#placebo-test"><span class="header-section-number">25.4.2</span> Placebo Test</a></li>
<li><a class="nav-link" href="#rosenbaum-bounds"><span class="header-section-number">25.4.3</span> Rosenbaum Bounds</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/23-dif-in-dif.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/23-dif-in-dif.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2022-12-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
