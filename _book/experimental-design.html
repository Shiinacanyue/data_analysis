<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Experimental Design | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="Randomized Control Trials (RCT) or Experiments have always been and are likely to continue in the future to be the holy grail of causal inference, because of unbiased estimates elimination of...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 17 Experimental Design | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/experimental-design.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="Randomized Control Trials (RCT) or Experiments have always been and are likely to continue in the future to be the holy grail of causal inference, because of unbiased estimates elimination of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 Experimental Design | A Guide on Data Analysis">
<meta name="twitter:description" content="Randomized Control Trials (RCT) or Experiments have always been and are likely to continue in the future to be the holy grail of causal inference, because of unbiased estimates elimination of...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-stat.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="model-specification.html"><span class="header-section-number">10</span> Model Specification</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">11</span> Imputation (Missing Data)</a></li>
<li><a class="" href="data.html"><span class="header-section-number">12</span> Data</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">13</span> Hypothesis Testing</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">14</span> Prediction and Estimation</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">15</span> Moderation</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="causal-inference.html"><span class="header-section-number">16</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="active" href="experimental-design.html"><span class="header-section-number">17</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">18</span> Sampling</a></li>
<li><a class="" href="analysis-of-variance-anova.html"><span class="header-section-number">19</span> Analysis of Variance (ANOVA)</a></li>
<li><a class="" href="multivariate-methods.html"><span class="header-section-number">20</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="quasi-experimental.html"><span class="header-section-number">21</span> Quasi-experimental</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">22</span> Regression Discontinuity</a></li>
<li><a class="" href="difference-in-differences.html"><span class="header-section-number">23</span> Difference-in-differences</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">24</span> Synthetic Control</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">25</span> Event Studies</a></li>
<li><a class="" href="matching-methods.html"><span class="header-section-number">26</span> Matching Methods</a></li>
<li><a class="" href="interrupted-time-series.html"><span class="header-section-number">27</span> Interrupted Time Series</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">28</span> Endogeneity</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">29</span> Mediation</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">30</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">31</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">32</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">33</span> Sensitivity Analysis/ Robustness Check</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="experimental-design" class="section level1" number="17">
<h1>
<span class="header-section-number">17</span> Experimental Design<a class="anchor" aria-label="anchor" href="#experimental-design"><i class="fas fa-link"></i></a>
</h1>
<ul>
<li>Randomized Control Trials (RCT) or Experiments have always been and are likely to continue in the future to be the holy grail of causal inference, because of
<ul>
<li><p>unbiased estimates</p></li>
<li><p>elimination of confounding factors on average (covariate imbalance is always possible. Hence, you want to do <a href="experimental-design.html#rerandomization">Rerandomization</a> to achieve platinum standard set by <span class="citation">(<a href="references.html#ref-tukey1993" role="doc-biblioref">Tukey 1993</a>)</span>)</p></li>
</ul>
</li>
<li>RCT means you have two group treatment (or experimental) gorp and control group. Hence, as you introduce the treatment (your exogenous variable) to the treatment group, the only expected difference in the outcomes of the two group should be due to the treatment.</li>
<li>Subjects from the same population will be <strong>randomly assigned</strong> to either treatment or control group. This random assignment give us the confidence that changes in the outcome variable will be due only the treatment, not any other source (variable).</li>
<li>It can be easier for hard science to have RCT because they can introduce the treatment, and have control environments. But it’s hard for social scientists because their subjects are usually human, and some treatment can be hard to introduce, or environments are uncontrollable. Hence, social scientists have to develop different tools (<a href="quasi-experimental.html#quasi-experimental">Quasi-experimental</a>) to recover causal inference or to recreate the treatment and control group environment.</li>
<li>With RCT, you can easily establish internal validity</li>
<li>Even though random assignment is not the same thing as <em>ceteris paribus</em> (i.e., holding everything else constant), it should have the same effect (i.e., under random manipulation, <em>other things equal</em> can be observed, on average, across treatment and control groups).</li>
</ul>
<p><strong>Selection Problem</strong></p>
<p>Assume we have</p>
<ul>
<li><p>binary treatment <span class="math inline">\(D_i =(0,1)\)</span></p></li>
<li>
<p>outcome of interest <span class="math inline">\(Y_i\)</span> for individual <span class="math inline">\(i\)</span></p>
<ul>
<li><p><span class="math inline">\(Y_{0i}\)</span> are those were <strong>not treated</strong></p></li>
<li><p><span class="math inline">\(Y_{1i}\)</span> are those were <strong>treated</strong></p></li>
</ul>
</li>
</ul>
<p><span class="math display">\[
\text{Potential Outcome} =
\begin{cases}
Y_{1i} \text{ if } D_i = 1 \\
Y_{0i} \text{ if } D_i = 0
\end{cases}
\]</span></p>
<p>Then, what we observe in the outcome variable is</p>
<p><span class="math display">\[
Y_i = Y_{0i} + (Y_{1i} - Y_{0i})D_i
\]</span></p>
<p>It’s likely that <span class="math inline">\(Y_{1i}\)</span> and <span class="math inline">\(Y_{0i}\)</span> both have their own distributions (i.e., different treatment effect for different people). Since we can’t see both outcomes for the same individual (unless we have a time machine), then we can only make inference regarding the average outcome of those who were treated and those who were not.</p>
<p><span class="math display">\[
\begin{aligned}
E[Y_i | D_i = 1] - E[Y_i | D_i = 0] &amp;= (E[Y_{1i} | D_i = 1] - E[Y_{0i}|D_i = 1] ) + (E[Y_{0i} |D_i = 1] - E[Y_{0i} |D_i = 0]) \\
&amp;= (E[Y_{1i}-Y_{0i}|D_1 = 1] ) + (E[Y_{0i} |D_i = 1] - E[Y_{0i} |D_i = 0]) \\
\text{Observed difference in treatment} &amp;= \text{Average treatment effect on the treated} + \text{Selection bias}
\end{aligned}
\]</span></p>
<ul>
<li><p><strong>The average treatment effect</strong> is the average between between a person who is treated and the same person (in another parallel universe) who is not treated</p></li>
<li><p><strong>The selection bias</strong> is the difference between those who were treated and those who weren’t treated</p></li>
</ul>
<p>With <strong>random assignment</strong> of treatment (<span class="math inline">\(D_i\)</span>) under <a href="experimental-design.html#experimental-design">Experimental Design</a>, we can have <span class="math inline">\(D_i\)</span> independent of potential outcomes</p>
<p><span class="math display">\[
\begin{aligned}
E[Y_i | D_i = 1] - E[Y_i|D_i = 0] &amp;= E[Y_{1i}|D_i = 1]-E[Y_{0i}|D_i = 0)]\\
&amp;= E[Y_{1i}|D_i = 1]-E[Y_{0i}|D_i = 0)] &amp;&amp; D_i \perp Y_i \\
&amp;= E[Y_{1i} - Y_{0i}|D_i = 1] \\
&amp;= E[Y_{1i} - Y_{0i}]
\end{aligned}
\]</span></p>
<p><br></p>
<p><strong>Another representation under regression</strong></p>
<p>Suppose that you know the effect is</p>
<p><span class="math display">\[
Y_{1i} - Y_{0i} = \rho
\]</span></p>
<p>The observed outcome variable (for an individual) can be rewritten as</p>
<p><span class="math display">\[
\begin{aligned}
Y_i &amp;= E(Y_{0i}) + (Y_{1i}-Y_{0i})D_i + [Y_{0i} - E(Y_{0i})]\\
&amp;= \alpha + \rho D_i + \eta_i
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\eta_i\)</span> = random variation of <span class="math inline">\(Y_{0i}\)</span></p>
<p>Hence, the conditional expectation of an individual outcome on treatment status is</p>
<p><span class="math display">\[
\begin{aligned}
E[Y_i |D_i = 1] &amp;= \alpha + \rho &amp;+ E[\eta_i |D_i = 1] \\
E[Y_i |D_i = 0] &amp;= \alpha &amp;+ E[\eta_i |D_i = 0]
\end{aligned}
\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[
E[Y_i |D_i = 1] - E[Y_i |D_i = 0] = \rho + E[\eta_i |D_i = 1] -E[\eta_i |D_i = 0]
\]</span></p>
<p>where <span class="math inline">\(E[\eta_i |D_i = 1] -E[\eta_i |D_i = 0]\)</span> is the selection bias - correlation between the regression error term (<span class="math inline">\(\eta_i\)</span>), and the regressor (<span class="math inline">\(D_i\)</span>)</p>
<p>Under regression, we have</p>
<p><span class="math display">\[
E[\eta_i |D_i = 1] -E[\eta_i |D_i = 0] = E[Y_{0i} |D_i = 1] -E[Y_{0i}|D_i = 0]
\]</span></p>
<p>which is the difference in outcomes between <strong>those who weren’t treated get treated</strong> and <strong>those who weren’t treated stay untreated</strong></p>
<p>Say you have control variables (<span class="math inline">\(X_i\)</span>), that is <strong>uncorrelated with the treatment</strong> (<span class="math inline">\(D_i\)</span>), then you can include in your model, and it won’t (in principle) affect your estimate of the treatment effect (<span class="math inline">\(\rho\)</span>) with an added benefit of reducing the residual variance, which subsequently reduces the standard error of other estimates.</p>
<p><span class="math display">\[
Y_i = \alpha + \rho D_i + X_i'\gamma + \eta_i
\]</span></p>
<p>Examples in marketing:</p>
<ul>
<li><p><span class="citation">(<a href="references.html#ref-gordon2019" role="doc-biblioref">Gordon et al. 2019</a>)</span></p></li>
<li><p><span class="citation">(<a href="references.html#ref-lewis2015" role="doc-biblioref">Lewis and Rao 2015</a>)</span></p></li>
</ul>
<p><br></p>
<div id="semi-random-experiment" class="section level2" number="17.1">
<h2>
<span class="header-section-number">17.1</span> Semi-random Experiment<a class="anchor" aria-label="anchor" href="#semi-random-experiment"><i class="fas fa-link"></i></a>
</h2>
<p>Chicago Open Enrollment Program <span class="citation">(<a href="references.html#ref-cullen2005" role="doc-biblioref">Cullen, Jacob, and Levitt 2005</a>)</span></p>
<ul>
<li><p>Students can apply to “choice” schools</p></li>
<li><p>Many schools are oversubscribed (Demand &gt; Supply)</p></li>
<li><p>Resolve scarcity via random lotteries</p></li>
<li><p>Non-random enrollment, we only have random lottery which mean the above</p></li>
</ul>
<p>Let</p>
<p><span class="math display">\[
\delta_j = E(Y_i | Enroll_{ij} = 1; Apply_{ij} = 1) - E(Y_i | Enroll_{ij} = 0; Apply_{ij} = 1)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\theta_j = E(Y_i | Win_{ij} = 1; Apply_{ij} = 1) - E(Y_i | Win_{ij} = 0; Apply_{ij} = 1)
\]</span></p>
<p>Hence, we can clearly see that <span class="math inline">\(\delta_j \neq \theta_j\)</span> because you can only enroll, but you cannot ensure that you will win. Thus, <strong>intention to treat is different from treatment effect</strong>.</p>
<p>Non-random enrollment, we only have random lottery which means we can only estimate <span class="math inline">\(\theta_j\)</span></p>
<p>To recover the true treatment effect, we can use</p>
<p><span class="math display">\[
\delta_j = \frac{E(Y_i|W_{ij} = 1; A_{ij} = 1) - E(Y_i | W_{ij}=0; A_{ij} = 1)}{P(Enroll_{ij} = 1| W_{ij}= 1; A_{ij}=1) - P(Enroll_{ij} = 1| W_{ij}=0; A_{ij}=1)}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\delta_j\)</span> = treatment effect</p></li>
<li><p><span class="math inline">\(W\)</span> = Whether students win the lottery</p></li>
<li><p><span class="math inline">\(A\)</span> = Whether student apply for the lottery</p></li>
<li><p>i = application</p></li>
<li><p>j = school</p></li>
</ul>
<p>Say that we have</p>
<p><strong>10 win</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Number students</th>
<th>Type</th>
<th>Selection effect</th>
<th>Treatment effect</th>
<th>Total effect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Always Takers</td>
<td>+0.2</td>
<td>+1</td>
<td>+1.2</td>
</tr>
<tr class="even">
<td>2</td>
<td>Compliers</td>
<td>0</td>
<td>+1</td>
<td>+1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Never Takers</td>
<td>-0.1</td>
<td>0</td>
<td>-0.1</td>
</tr>
</tbody>
</table></div>
<p><strong>10 lose</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Number students</th>
<th>Type</th>
<th>Selection effect</th>
<th>Treatment effect</th>
<th>Total effect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Always Takers</td>
<td>+0.2</td>
<td>+1</td>
<td>+1.2</td>
</tr>
<tr class="even">
<td>2</td>
<td>Compliers</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Never Takers</td>
<td>-0.1</td>
<td>0</td>
<td>-0.1</td>
</tr>
</tbody>
</table></div>
<p>Intent to treatment = Average effect of who you give option to choose</p>
<p><span class="math display">\[
\begin{aligned}
E(Y_i | W_{ij}=1; A_{ij} = 1) &amp;= \frac{1*(1.2)+ 2*(1) + 7 * (-0.1)}{10}\\
&amp;= 0.25
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
E(Y_i | W_{ij}=0; A_{ij} = 1) &amp;= \frac{1*(1.2)+ 2*(0) + 7 * (-0.1)}{10}\\
&amp;= 0.05
\end{aligned}
\]</span></p>
<p>Hence,</p>
<p><span class="math display">\[
\begin{aligned}
\text{Intent to treatment} &amp;= 0.25 - 0.05 = 0.2 \\
\text{Treatment effect} &amp;= 1
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
P(Enroll_{ij} = 1 | W_{ij} = 1; A_{ij}=1 ) &amp;= \frac{1+2}{10} = 0.3 \\
P(Enroll_{ij} = 1 | W_{ij} = 0; A_{ij}=1 ) &amp;= \frac{1}{10} = 0.1
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\text{Treatment effect} = \frac{0.2}{0.3-0.1} = 1
\]</span></p>
<p>After knowing how to recover the treatment effect, we turn our attention to the main model</p>
<p><span class="math display">\[
Y_{ia} = \delta W_{ia} + \lambda L_{ia} + e_{ia}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(W\)</span> = whether a student wins a lottery</p></li>
<li><p><span class="math inline">\(L\)</span> = whether student enrolls in the lottery</p></li>
<li><p><span class="math inline">\(\delta\)</span> = intent to treat</p></li>
</ul>
<p>Hence,</p>
<ul>
<li><p>Conditional on lottery, the <span class="math inline">\(\delta\)</span> is valid</p></li>
<li><p>But without lottery, your <span class="math inline">\(\delta\)</span> is not random</p></li>
<li><p>Winning and losing are only identified within lottery</p></li>
<li><p>Each lottery has multiple entries. Thus, we can have within estimator</p></li>
</ul>
<p>We can also include other control variables (<span class="math inline">\(X_i \theta\)</span>)</p>
<p><span class="math display">\[
Y_{ia} = \delta_1 W_{ia} + \lambda_1 L_{ia} + X_i \theta + u_{ia}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
E(\delta) &amp;= E(\delta_1) \\
E(\lambda) &amp;\neq E(\lambda_1) &amp;&amp; \text{because choosing a lottery is not random}
\end{aligned}
\]</span></p>
<p>Including <span class="math inline">\((X_i \theta)\)</span> just shifts around control variables (i.e., reweighting of lottery), which would not affect your treatment effect <span class="math inline">\(E(\delta)\)</span></p>
</div>
<div id="rerandomization" class="section level2" number="17.2">
<h2>
<span class="header-section-number">17.2</span> Rerandomization<a class="anchor" aria-label="anchor" href="#rerandomization"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Since randomization only balances baseline covariates on average, imbalance in covairates due to random chance can still happen.</p></li>
<li><p>In case that you have a “bad” randomization (i.e., imbalance for important baseline covariates), <span class="citation">(<a href="references.html#ref-morgan2012" role="doc-biblioref">Morgan and Rubin 2012</a>)</span> introduce the idea of rerandomization.</p></li>
<li><p>Rerandomization is checking balance during the randomization process (before the experiment), to eliminate bad allocation (i.e., those with unacceptable balance).</p></li>
<li>
<p>The greater the number of variables, the greater the likelihood that at least one covariate would be imbalanced across treatment groups.</p>
<ul>
<li>Example: For 10 covariates, the probability of a significant difference at <span class="math inline">\(\alpha = .05\)</span> for at least one covariate is <span class="math inline">\(1 - (1-.05)^{10} = 0.4 = 40\%\)</span>
</li>
</ul>
</li>
<li>
<p>Rerandomization increase treatment effect estimate precision if the covariates are correlated with the outcome.</p>
<ul>
<li>Improvement in precision for treatment effect estimate depends on (1) improvement in covariate balance and (2) correlation between covariates and the outcome.</li>
</ul>
</li>
<li><p>You also need to take into account rerandomization into your analysis when making inference.</p></li>
<li><p>Rerandomization is equivalent to increasing our sample size.</p></li>
<li>
<p>Alternatives include</p>
<ul>
<li><p>Stratified randomization <span class="citation">(<a href="references.html#ref-johansson2022" role="doc-biblioref">Johansson and Schultzberg 2022</a>)</span></p></li>
<li><p>Matched randomization <span class="citation">(<a href="references.html#ref-greevy2004" role="doc-biblioref">Greevy 2004</a>; <a href="references.html#ref-kapelner2014" role="doc-biblioref">Kapelner and Krieger 2014</a>)</span></p></li>
<li><p>Minimization <span class="citation">(<a href="references.html#ref-pocock1975" role="doc-biblioref">Pocock and Simon 1975</a>; <a href="references.html#ref-correcti1976" role="doc-biblioref"><span>“Corrections: Sequential Treatment Assignment with Balancing for Prognostic Factors in the Controlled Clinical Trial”</span> 1976</a>)</span></p></li>
</ul>
</li>
</ul>
<p><a href="https://healthpolicy.usc.edu/evidence-base/rerandomization-what-is-it-and-why-should-you-use-it-for-random-assignment/"><img src="images/The-Randomization-Procedure.png" title="Figure from USC Schaeffer Center" alt="Figure from USC Schaeffer Center"></a></p>
<p>Graph from USC Schaeffer Center</p>
<p><br></p>
<p>Rerandomization Criterion</p>
<ul>
<li>Acceptable randomization is based on a function of covariate matrix <span class="math inline">\(\mathbf{X}\)</span> and vector of treatment assignments <span class="math inline">\(\mathbf{W}\)</span>
</li>
</ul>
<p><span class="math display">\[
W_i =
\begin{cases}
1 \text{ if treated} \\
0 \text{ if control}
\end{cases}
\]</span></p>
<ul>
<li>Mahalanobis Distance, <span class="math inline">\(M\)</span>, can be used as criteria for acceptable balance</li>
</ul>
<p>Let <span class="math inline">\(M\)</span> be the multivariate distance between groups means</p>
<p><span class="math display">\[
M = (\bar{\mathbf{X}}_T - \bar{\mathbf{X}}_C)' cov(\bar{\mathbf{X}}_T - \bar{\mathbf{X}}_C)^{-1} (\bar{\mathbf{X}}_T - \bar{\mathbf{X}}_C) \\
= (\frac{1}{n_T}+ \frac{1}{n_C})^{-1}(\bar{\mathbf{X}}_T - \bar{\mathbf{X}}_C)' cov(\mathbf{X})^{-1}(\bar{\mathbf{X}}_T - \bar{\mathbf{X}}_C)
\]</span></p>
<p>With large sample size and “pure” randomization <span class="math inline">\(M \sim \chi^2_k\)</span> where <span class="math inline">\(k\)</span> is the number of covariates to be balanced</p>
<p>Then let <span class="math inline">\(p_a\)</span> be the probability of accepting a randomization. Choosing appropriate <span class="math inline">\(p_a\)</span> is a tradeoff between balance and time.</p>
<p>Then the rule of thumb is rerandomize when <span class="math inline">\(M &gt; a\)</span></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="causal-inference.html"><span class="header-section-number">16</span> Causal Inference</a></div>
<div class="next"><a href="sampling.html"><span class="header-section-number">18</span> Sampling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#experimental-design"><span class="header-section-number">17</span> Experimental Design</a></li>
<li><a class="nav-link" href="#semi-random-experiment"><span class="header-section-number">17.1</span> Semi-random Experiment</a></li>
<li><a class="nav-link" href="#rerandomization"><span class="header-section-number">17.2</span> Rerandomization</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/17-experiment.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/17-experiment.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2022-09-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
