<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 20 Quasi-experimental | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="In most cases, it means that you have pre- and post-intervention data. A great resource for causal inference is Causal Inference Mixtape, especially if you like to read about the history of causal...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 20 Quasi-experimental | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/quasi-experimental.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="In most cases, it means that you have pre- and post-intervention data. A great resource for causal inference is Causal Inference Mixtape, especially if you like to read about the history of causal...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 20 Quasi-experimental | A Guide on Data Analysis">
<meta name="twitter:description" content="In most cases, it means that you have pre- and post-intervention data. A great resource for causal inference is Causal Inference Mixtape, especially if you like to read about the history of causal...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">BASIC</li>
<li><a class="" href="descriptive-stat.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li class="book-part">RAMIFICATIONS</li>
<li><a class="" href="model-specification.html"><span class="header-section-number">10</span> Model Specification</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">11</span> Imputation (Missing Data)</a></li>
<li><a class="" href="data.html"><span class="header-section-number">12</span> Data</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">13</span> Hypothesis Testing</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">14</span> Prediction and Estimation</a></li>
<li class="book-part">EXPERIMENTAL DESIGN</li>
<li><a class="" href="sampling.html"><span class="header-section-number">15</span> Sampling</a></li>
<li><a class="" href="analysis-of-variance-anova.html"><span class="header-section-number">16</span> Analysis of Variance (ANOVA)</a></li>
<li><a class="" href="multivariate-methods.html"><span class="header-section-number">17</span> Multivariate Methods</a></li>
<li class="book-part">CAUSAL INFERENCE</li>
<li><a class="" href="causal-inference.html"><span class="header-section-number">18</span> Causal Inference</a></li>
<li><a class="" href="experimental-design.html"><span class="header-section-number">19</span> Experimental Design</a></li>
<li><a class="active" href="quasi-experimental.html"><span class="header-section-number">20</span> Quasi-experimental</a></li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">21</span> Endogeneity</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">22</span> Mediation</a></li>
<li class="book-part">MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">23</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">24</span> Exploratory Data Analysis</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="quasi-experimental" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Quasi-experimental<a class="anchor" aria-label="anchor" href="#quasi-experimental"><i class="fas fa-link"></i></a>
</h1>
<p>In most cases, it means that you have pre- and post-intervention data.</p>
<p>A great resource for causal inference is <a href="https://mixtape.scunning.com/introduction.html">Causal Inference Mixtape</a>, especially if you like to read about the history of causal inference as a field as well (codes for Stata, R, and Python).</p>
<div id="regression-discontinuity" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Regression Discontinuity<a class="anchor" aria-label="anchor" href="#regression-discontinuity"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>A regression discontinuity occurs when there is a discrete change (jump) in treatment likelihood in the distribution of a continuous (or roughly continuous) variable (i.e., <strong>running/forcing/assignment variable</strong>).</p>
<ul>
<li>Running variable can also be time, but the argument for time to be continuous is hard to argue because usually we do not see increment of time (e.g., quarterly or annual data). Unless we have minute or hour data, then we might be able to argue for it.</li>
</ul>
</li>
<li><p>Review paper <span class="citation">(<a href="references.html#ref-imbens2007" role="doc-biblioref">Imbens and Lemieux 2007</a>; <a href="references.html#ref-lee2010" role="doc-biblioref">D. S. Lee and Lemieux 2010</a>)</span></p></li>
<li>
<p>Other readings:</p>
<ul>
<li><p><a href="https://ies.ed.gov/ncee/wwc/Docs/ReferenceResources/wwc_rd.pdf" class="uri">https://ies.ed.gov/ncee/wwc/Docs/ReferenceResources/wwc_rd.pdf</a></p></li>
<li><p><a href="https://ies.ed.gov/ncee/wwc/Docs/ReferenceResources/wwc_rdd_standards_122315.pdf" class="uri">https://ies.ed.gov/ncee/wwc/Docs/ReferenceResources/wwc_rdd_standards_122315.pdf</a></p></li>
</ul>
</li>
<li>
<p>RD is a localized experiment at the cutoff point</p>
<ul>
<li>Hence, we always have to qualify (perfunctory) our statement in research articles that “our research might not generalize to beyond the bandwidth.”</li>
</ul>
</li>
<li><p>In reality, RD and experimental (from random assignment) estimates are very similar (<span class="citation">(<a href="references.html#ref-chaplin2018" role="doc-biblioref">Chaplin et al. 2018</a>; <a href="references.html#ref-bertanha2014" role="doc-biblioref">Bertanha and Imbens 2014</a>)</span>; <a href="https://www.mathematica.org/publications/replicating-experimental-impact-estimates-using-a-regression-discontinuity-approach">Mathematica</a> ). But still, it’s hard to prove empirically for every context (there might be future study that finds a huge difference between local estimate - causal - and overall estimate - random assignment.</p></li>
<li><p>Threats: only valid near threshold: inference at threshold is valid on average. Interestingly, random experiment showed the validity already.</p></li>
<li><p>Tradeoff between efficiency and bias</p></li>
<li><p>Regression discontinuity is under the framework of <a href="endogeneity.html#instrumental-variable">Instrumental Variable</a></p></li>
<li><p>The hard part is to find a setting that can apply, but once you find one, it’s easy to apply</p></li>
<li><p>We can also have multiple cutoff lines. However, for each cutoff line, there can only be one breakup point</p></li>
<li><p>RD can have multiple coinciding effects (i.e., joint distribution or bundled treatment), then RD effect in this case would be the joint effect.</p></li>
<li><p>As the running variable becomes more discrete your framework should be <a href="quasi-experimental.html#interrupted-time-series">Interrupted Time Series</a>, but more granular levels you can use RD. When you have infinite data (or substantially large) the two frameworks are identical. RD is always better than <a href="quasi-experimental.html#interrupted-time-series">Interrupted Time Series</a></p></li>
</ul>
<p>There are several types of Regression Discontinuity:</p>
<ol style="list-style-type: decimal">
<li>
<p>Sharp RD: Change in treatment probability at the cutoff point is 1</p>
<ul>
<li>Kink design: Instead of a discontinuity in the level of running variable, we have a discontinuity in the slope of the function (while the function/level can remain continuous) <span class="citation">(<a href="references.html#ref-nielsen2010" role="doc-biblioref">Nielsen, Sørensen, and Taber 2010</a>)</span>. See <span class="citation">(<a href="references.html#ref-b%C3%B6ckerman2018" role="doc-biblioref">Böckerman, Kanninen, and Suoniemi 2018</a>)</span> for application, and <span class="citation">(<a href="references.html#ref-card2012" role="doc-biblioref">Card et al. 2012</a>; <a href="references.html#ref-card2015b" role="doc-biblioref">Card et al. 2015</a>)</span> for theory.</li>
</ul>
</li>
<li><p>Fuzzy RD: Change in treatment probability less than 1</p></li>
</ol>
<p>Consider</p>
<p><span class="math display">\[
D_i = 1_{X_i &gt; c}
\]</span></p>
<p><span class="math display">\[
D_i = 
\begin{cases}
D_i = 1 \text{ if } X_i &gt; C \\
D_i = 0 \text{ if } X_i &lt; C
\end{cases}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(D_i\)</span> = treatment effect</p></li>
<li><p><span class="math inline">\(X_i\)</span> = score variable (continuous)</p></li>
<li><p><span class="math inline">\(c\)</span> = cutoff point</p></li>
</ul>
<p><strong>Identifying assumption</strong> of RD:</p>
<p><span class="math display">\[
\begin{aligned}
\alpha_{SRDD} &amp;= E[Y_{1i} - Y_{0i} | X_i = c] \\
&amp;= E[Y_{1i}|X_i = c] - E[Y_{0i}|X_i = c]\\
&amp;= \lim_{x \to c^+} E[Y_{1i}|X_i = c] - \lim_{x \to c^=} E[Y_{0i}|X_i = c]
\end{aligned}
\]</span></p>
<p>RDD estimates the local average treatment effect (LATE), at the cutoff point which is not at the individual or population levels.</p>
<p>Since researchers typically care more about the internal validity, than external validity, localness affects only external validity.</p>
<p><strong>Assumptions</strong>:</p>
<ul>
<li><p>Independent assignment</p></li>
<li>
<p>Continuity of conditional regression functions</p>
<ul>
<li>
<span class="math inline">\(E[Y(0)|X=x]\)</span> and <span class="math inline">\(E[Y(1)|X=x]\)</span> are continuous in x.</li>
</ul>
</li>
<li><p>RD is valid if cutpoint is <strong>exogenous (i.e., no endogenous selection)</strong> and running variable is <strong>not manipulable</strong></p></li>
<li><p>Only treatment(s) (e.g., could be joint distribution of multiple treatments) cause discontinuity or jump in the outcome variable</p></li>
<li><p>All other factors are smooth through the cutoff (i.e., threshold) value. (we can also test this assumption by seeing no discontinuity in other factors).</p></li>
</ul>
<p><br></p>
<p><strong>Threats to RD</strong></p>
<ul>
<li>
<p>Variables (other than treatment) change discontinously at the cutoff</p>
<ul>
<li>We can test for jumps in these variables (including pre-treatment outcome)</li>
</ul>
</li>
<li><p>Multiple discontinuities for the assignment variable</p></li>
<li>
<p>Manipulation of the assignment variable</p>
<ul>
<li>At the cutoff point, check for continuity in the density of the assignment variable.</li>
</ul>
</li>
</ul>
<p><br></p>
<div id="specification-checks" class="section level3" number="20.1.1">
<h3>
<span class="header-section-number">20.1.1</span> Specification Checks<a class="anchor" aria-label="anchor" href="#specification-checks"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><a href="quasi-experimental.html#balance-checks">Balance Checks</a></li>
<li><a href="quasi-experimental.html#sortingbunchingmanipulation">Sorting/Bunching/Manipulation</a></li>
<li><a href="quasi-experimental.html#placebo-tests">Placebo Tests</a></li>
<li><a href="quasi-experimental.html#sensitivity-to-bandwidth-choice">Sensitivity to Bandwidth Choice</a></li>
</ol>
<p><br></p>
<div id="balance-checks" class="section level4" number="20.1.1.1">
<h4>
<span class="header-section-number">20.1.1.1</span> Balance Checks<a class="anchor" aria-label="anchor" href="#balance-checks"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>Also known as checking for Discontinuities in Average Covariates</p></li>
<li><p>Null Hypothesis: The average effect of covariates on pseudo outcomes (i.e., those qualitatively cannot be affected by the treatment) is 0.</p></li>
<li><p>If this hypothesis is rejected, you better have a good reason to why because it can cast serious doubt on your RD design.</p></li>
</ul>
<p><br></p>
</div>
<div id="sortingbunchingmanipulation" class="section level4" number="20.1.1.2">
<h4>
<span class="header-section-number">20.1.1.2</span> Sorting/Bunching/Manipulation<a class="anchor" aria-label="anchor" href="#sortingbunchingmanipulation"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>Also known as checking for A Discontinuity in the Distribution of the Forcing Variable</p></li>
<li><p>Also known as clustering or density test</p></li>
<li><p>Formal test is McCrary sorting test <span class="citation">(<a href="references.html#ref-mccrary2008" role="doc-biblioref">McCrary 2008</a>)</span> or <span class="citation">(<a href="references.html#ref-cattaneo2019" role="doc-biblioref">Cattaneo, Jansson, and Ma 2019</a>)</span></p></li>
<li>
<p>Since human subjects can manipulate the running variable to be just above or below the cutoff (assuming that the running variable is manipulable), especially when the cutoff point is known in advance for all subjects, this can result in a discontinuity in the distribution of the running variable at the cutoff (i.e., we will see “bunching” behavior right before or after the cutoff)&gt;</p>
<ul>
<li><p>People would like to sort into treatment if it’s desirable. The density of the running variable would be 0 just below the threshold</p></li>
<li><p>People would like to be out of treatment if it’s undesirable</p></li>
</ul>
</li>
<li>
<p><span class="citation">(<a href="references.html#ref-mccrary2008" role="doc-biblioref">McCrary 2008</a>)</span> proposes a density test (i.e., a formal test for manipulation of the assignment variable).</p>
<ul>
<li><p><span class="math inline">\(H_0\)</span>: The continuity of the density of the running variable (i.e., the covariate that underlies the assignment at the discontinuity point)</p></li>
<li><p><span class="math inline">\(H_a\)</span>: A jump in the density function at that point</p></li>
<li><p>Even though it’s not a requirement that the density of the running must be continuous at the cutoff, but a discontinuity can suggest manipulations.</p></li>
</ul>
</li>
<li><p><span class="citation">(<a href="references.html#ref-lee2009" role="doc-biblioref">D. Lee and Lemieux 2009</a>)</span> offers a guide to know when you should warrant the manipulation</p></li>
<li>
<p>Usually it’s better to know your research design inside out so that you can suspect any manipulation attempts.</p>
<ul>
<li>We would suspect the direction of the manipulation. And typically, it’s one-way manipulation. In cases where we might have both ways, theoretically they would cancel each other out.</li>
</ul>
</li>
<li><p>We could also observe partial manipulation in reality (e.g., when subjects can only imperfectly manipulate). But typically, as we treat it like fuzzy RD, we would not have identification problems. But complete manipulation would lead to serious identification issues.</p></li>
<li><p>Remember: even in cases where we fail to reject the null hypothesis for the density test, we could not rule out completely that identification problem exists (just like any other hypotheses)</p></li>
<li><p>Bunching happens when people self-select to a specific value in the range of a variable (e.g., key policy thresholds).</p></li>
<li><p>Review paper <span class="citation">(<a href="references.html#ref-kleven2016" role="doc-biblioref">Kleven 2016</a>)</span></p></li>
<li><p><strong>This test can only detect manipulation that changes the distribution of the running variable</strong>. If you can choose the cutoff point or you have 2-sided manipulation, this test will fail to detect it.</p></li>
<li><p>Histogram in bunching is similar to a density curve (we want narrower bins, wider bins bias elasticity estimates)</p></li>
<li><p>We can also use bunching method to study individuals’ or firm’s responsiveness to changes in policy.</p></li>
<li>
<p>Under RD, we assume that we don’t have any manipulation in the running variable. However, bunching behavior is a manipulation by firms or individuals. Thus, violating this assumption.</p>
<ul>
<li><p>Bunching can fix this problem by estimating what densities of individuals would have been without manipulation (i.e., manipulation-free counterfactual).</p></li>
<li><p><strong>The fraction of persons who manipulated</strong> is then calculated by comparing the observed distribution to manipulation-free counterfactual distributions.</p></li>
<li><p>Under RD, we do not need this step because the observed and manipulation-free counterfactual distributions are assumed to be the same. RD assume there is no manipulation (i.e., assume the manipulation-free counterfactual distribution)</p></li>
</ul>
</li>
</ul>
<p>When running variable and outcome variable are simultaneously determined, we can use a modified RDD estimator to have consistent estimate. <span class="citation">(<a href="references.html#ref-bajari2011" role="doc-biblioref">Bajari et al. 2011</a>)</span></p>
<ul>
<li>
<p><strong>Assumptions</strong>:</p>
<ul>
<li><p>Manipulation is <strong>one-sided</strong>: People move one way (i.e., either below the threshold to above the threshold or vice versa, but not to or away the threshold), which is similar to the monotonicity assumption under instrumental variable <a href="endogeneity.html#instrumental-variable">21.3.1</a></p></li>
<li><p>Manipulation is <strong>bounded</strong> (also known as regularity assumption): so that we can use people far away from this threshold to derive at our counterfactual distribution <span class="citation">(<a href="references.html#ref-blomquist2017" role="doc-biblioref">Blomquist et al. 2017</a>)</span></p></li>
</ul>
</li>
</ul>
<p>Steps:</p>
<ol style="list-style-type: decimal">
<li>Identify the window in which the running variable contains bunching behavior. We can do this step empirically based on data <span class="citation">(<a href="references.html#ref-bosch2020" role="doc-biblioref">Bosch, Dekker, and Strohmaier 2020</a>)</span>. Additionally robustness test is needed (i.e., varying the manipulation window).</li>
<li>Estimate the manipulation-free counterfactual</li>
<li>Calculating the standard errors for inference can follow <span class="citation">(<a href="references.html#ref-chetty2011" role="doc-biblioref">R. Chetty et al. 2011</a>)</span> where we bootstrap resampling residuals in the estimation of the counts of individuals within bins (large data can render this step unnecessary).</li>
</ol>
<p>If we pass the bunching test, we can move on to the [Placebo Test]</p>
<p><span class="citation"><a href="references.html#ref-mccrary2008" role="doc-biblioref">McCrary</a> (<a href="references.html#ref-mccrary2008" role="doc-biblioref">2008</a>)</span> test</p>
<p>A jump in the density at the threshold (i.e., discontinuity) hold can serve as evidence for sorting around the cutoff point</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rdd</span><span class="op">)</span>

<span class="co"># you only need the runing variable and hte cutoff point</span>

<span class="co"># Example by the package's authors</span>
<span class="co">#No discontinuity</span>
<span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/rdd/man/DCdensity.html">DCdensity</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-1-1.png" width="90%" style="display: block; margin: auto;"></div>
<pre><code>#&gt; [1] 0.8058466
#Discontinuity
x&lt;-runif(1000,-1,1)
x&lt;-x+2*(runif(1000,-1,1)&gt;0&amp;x&lt;0)
DCdensity(x,0)</code></pre>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-1-2.png" width="90%" style="display: block; margin: auto;"></div>
<pre><code>#&gt; [1] 0.00181709</code></pre>
<p><span class="citation"><a href="references.html#ref-cattaneo2019" role="doc-biblioref">Cattaneo, Jansson, and Ma</a> (<a href="references.html#ref-cattaneo2019" role="doc-biblioref">2019</a>)</span> test</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rddensity</span><span class="op">)</span>

<span class="co"># Example by the package's authors</span>
<span class="co"># Continuous Density</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">2000</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">rdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rddensity/man/rddensity.html">rddensity</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">x</span>, vce <span class="op">=</span> <span class="st">"jackknife"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">rdd</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Manipulation testing using local polynomial density estimation.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of obs =       2000</span>
<span class="co">#&gt; Model =               unrestricted</span>
<span class="co">#&gt; Kernel =              triangular</span>
<span class="co">#&gt; BW method =           estimated</span>
<span class="co">#&gt; VCE method =          jackknife</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; c = 0                 Left of c           Right of c          </span>
<span class="co">#&gt; Number of obs         1376                624                 </span>
<span class="co">#&gt; Eff. Number of obs    354                 345                 </span>
<span class="co">#&gt; Order est. (p)        2                   2                   </span>
<span class="co">#&gt; Order bias (q)        3                   3                   </span>
<span class="co">#&gt; BW est. (h)           0.514               0.609               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Method                T                   P &gt; |T|             </span>
<span class="co">#&gt; Robust                -0.6798             0.4966              </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; P-values of binomial tests (H0: p=0.5).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Window Length / 2          &lt;c     &gt;=c    P&gt;|T|</span>
<span class="co">#&gt; 0.013                      11       9    0.8238</span>
<span class="co">#&gt; 0.026                      19      15    0.6076</span>
<span class="co">#&gt; 0.038                      29      21    0.3222</span>
<span class="co">#&gt; 0.051                      42      26    0.0681</span>
<span class="co">#&gt; 0.064                      44      33    0.2543</span>
<span class="co">#&gt; 0.077                      48      45    0.8358</span>
<span class="co">#&gt; 0.090                      55      51    0.7709</span>
<span class="co">#&gt; 0.102                      66      59    0.5917</span>
<span class="co">#&gt; 0.115                      74      67    0.6135</span>
<span class="co">#&gt; 0.128                      82      71    0.4189</span>
<span class="co"># you have to specify your own plot (read package manual)</span></code></pre></div>
<p><br></p>
</div>
<div id="placebo-tests" class="section level4" number="20.1.1.3">
<h4>
<span class="header-section-number">20.1.1.3</span> Placebo Tests<a class="anchor" aria-label="anchor" href="#placebo-tests"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>Also known as Discontinuities in Average Outcomes at Other Values</p></li>
<li>
<p>We should not see any jumps at other values (either <span class="math inline">\(X_i &lt;c\)</span> or <span class="math inline">\(X_i \ge c\)</span>)</p>
<ul>
<li>Use the same bandwidth you use for the cutoff, and move it along the running variable: testing for a jump in the conditional mean of the outcome at the median of the running variable.</li>
</ul>
</li>
<li><p>Also known as falsification checks</p></li>
<li><p>Before and after the cutoff point, we can run the placebo test to see whether X’s are different).</p></li>
<li><p>The placebo test is where you expect your coefficients to be not different from 0.</p></li>
<li>
<p>This test can be used for</p>
<ul>
<li><p>Testing no discontinuity in predetermined variables:</p></li>
<li><p>Testing other discontinuities</p></li>
<li><p>Inclusion and exclusion of covariates: RDD parameter estimates should not be sensitive to the inclusion or exclusion of other covariates.</p></li>
</ul>
</li>
<li><p>This is analogous to <a href="experimental-design.html#experimental-design">Experimental Design</a> where we cannot only test whether the observables are similar in both treatment and control groups (if we reject this, then we don’t have random assignment), but we cannot test unobservables.</p></li>
</ul>
<p>Balance on observable characteristics on both sides</p>
<p><span class="math display">\[
Z_i = \alpha_0 + \alpha_1 f(x_i) + [I(x_i \ge c)] \alpha_2 + [f(x_i) \times I(x_i \ge c)]\alpha_3 + u_i
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(x_i\)</span> is the running variable</p></li>
<li><p><span class="math inline">\(Z_i\)</span> is other characteristics of people (e.g., age, etc)</p></li>
</ul>
<p>Theoretically, <span class="math inline">\(Z_i\)</span> should no be affected by treatment. Hence, <span class="math inline">\(E(\alpha_2) = 0\)</span></p>
<p>Moreover, when you have multiple <span class="math inline">\(Z_i\)</span>, you typically have to simulate joint distribution (to avoid having significant coefficient based on chance).</p>
<p>The only way that you don’t need to generate joint distribution is when all <span class="math inline">\(Z_i\)</span>’s are independent (unlikely in reality).</p>
<p>Under RD, you shouldn’t have to do any <a href="quasi-experimental.html#matching-methods">Matching Methods</a>. Because just like when you have random assignment, there is no need to make balanced dataset before and after the cutoff. If you have to do balancing, then your RD assumptions are probably wrong in the first place.</p>
</div>
<div id="sensitivity-to-bandwidth-choice" class="section level4" number="20.1.1.4">
<h4>
<span class="header-section-number">20.1.1.4</span> Sensitivity to Bandwidth Choice<a class="anchor" aria-label="anchor" href="#sensitivity-to-bandwidth-choice"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<p>2 methods for bandwidth selection</p>
<ul>
<li><p>Ad hoc or substantively driven</p></li>
<li><p>Data driven</p></li>
</ul>
</li>
<li><p>The objective is to minimize the mean squared error between the estimated and actual treatment effects.</p></li>
<li><p>Then, we need to see how sensitive our results will be dependent on the choice of bandwidth.</p></li>
<li><p>In some cases, the best bandwidth for testing covariates may not be the best bandwidth for treating them, but it may be close.</p></li>
</ul>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find optimal bandwidth by Imbens-Kalyanaraman</span>
<span class="fu">rdd</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rdd/man/IKbandwidth.html">IKbandwidth</a></span><span class="op">(</span><span class="va">running_var</span>, <span class="va">outcome_var</span>, cutpoint <span class="op">=</span> <span class="st">""</span>, kernel <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span> <span class="co"># can also pick other kernels</span></code></pre></div>
</div>
<div id="fuzzy-rd-design" class="section level4" number="20.1.1.5">
<h4>
<span class="header-section-number">20.1.1.5</span> Fuzzy RD Design<a class="anchor" aria-label="anchor" href="#fuzzy-rd-design"><i class="fas fa-link"></i></a>
</h4>
<p>When you have cutoff that does not perfect determine treatment, but creates a discontinuity in the likelihood of receiving the treatment, you need another instrument</p>
<p>For those that are close to the cutoff, we create an instrument for <span class="math inline">\(D_i\)</span></p>
<p><span class="math display">\[
Z_i=
\begin{cases}
1 &amp; \text{if } X_i \ge c \\
0 &amp; \text{if } X_c &lt; c
\end{cases}
\]</span></p>
<p>Then, we can estimate the effect of the treatment for compliers only (i.e., those treatment <span class="math inline">\(D_i\)</span> depends on <span class="math inline">\(Z_i\)</span>)</p>
<p>The LATE parameter</p>
<p><span class="math display">\[
\lim_{c - \epsilon \le X \le c + \epsilon, \epsilon \to 0}( \frac{E(Y |Z = 1) - E(Y |Z=0)}{E(D|Z = 1) - E(D|Z = 0)})
\]</span></p>
<p>equivalently,</p>
<p><span class="math display">\[
\frac{lim_{x \downarrow c}E(Y|X = x) - \lim_{x \uparrow c} E(Y|X = x)}{\lim_{x \downarrow c } E(D |X = x) - \lim_{x \uparrow c}E(D |X=x)}
\]</span></p>
<p>Two equivalent ways to estimate</p>
<ol style="list-style-type: decimal">
<li>
<p>First</p>
<ol style="list-style-type: decimal">
<li><p>Sharp RDD for <span class="math inline">\(Y\)</span></p></li>
<li><p>Sharp RDD for <span class="math inline">\(D\)</span></p></li>
<li><p>Take the estimate from step 1 divide by that of step 2</p></li>
</ol>
</li>
<li><p>Second: Subset those observations that are close to <span class="math inline">\(c\)</span> and run instrumental variable <span class="math inline">\(Z\)</span></p></li>
</ol>
<p><br></p>
</div>
<div id="regression-kink-design" class="section level4" number="20.1.1.6">
<h4>
<span class="header-section-number">20.1.1.6</span> Regression Kink Design<a class="anchor" aria-label="anchor" href="#regression-kink-design"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>If the slope of the treatment intensity changes at the cutoff (instead of the level of treatment assignment), we can have regression kink design</p></li>
<li><p>Example: unemployment benefits</p></li>
</ul>
<p><br></p>
</div>
</div>
<div id="steps-for-sharp-rd" class="section level3" number="20.1.2">
<h3>
<span class="header-section-number">20.1.2</span> Steps for Sharp RD<a class="anchor" aria-label="anchor" href="#steps-for-sharp-rd"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Graph the data by computing the average value of the outcome variable over a set of bins (large enough to see a smooth graph, and small enough to make the jump around the cutoff clear).</p></li>
<li><p>Run regression on both sides of the cutoff to get the treatment effect</p></li>
<li>
<p>Robustness checks:</p>
<ol style="list-style-type: decimal">
<li><p>Assess possible jumps in other variables around the cutoff</p></li>
<li><p>Hypothesis testing for bunching</p></li>
<li><p>Placebo tests</p></li>
<li><p>Varying bandwidth</p></li>
</ol>
</li>
</ol>
<p><br></p>
</div>
<div id="steps-for-fuzzy-rd" class="section level3" number="20.1.3">
<h3>
<span class="header-section-number">20.1.3</span> Steps for Fuzzy RD<a class="anchor" aria-label="anchor" href="#steps-for-fuzzy-rd"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Graph the data by computing the average value of the outcome variable over a set of bins (large enough to see a smooth graph, and small enough to make the jump around the cutoff clear).</p></li>
<li><p>Graph the probability of treatment</p></li>
<li><p>Estimate the treatment effect using 2SLS</p></li>
<li>
<p>Robustness checks:</p>
<ol style="list-style-type: decimal">
<li><p>Assess possible jumps in other variables around the cutoff</p></li>
<li><p>Hypothesis testing for bunching</p></li>
<li><p>Placebo tests</p></li>
<li><p>Varying bandwidth</p></li>
</ol>
</li>
</ol>
<p><br></p>
</div>
<div id="evaluation-of-an-rd" class="section level3" number="20.1.4">
<h3>
<span class="header-section-number">20.1.4</span> Evaluation of an RD<a class="anchor" aria-label="anchor" href="#evaluation-of-an-rd"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<p>Evidence for (either formal tests or graphs)</p>
<ul>
<li><p>Treatment and outcomes change discontinuously at the cutoff, while other variables and pre-treatment outcomes do not.</p></li>
<li><p>No manipulation of the assignment variable.</p></li>
</ul>
</li>
<li><p>Results are robust to various functional forms of the forcing variable</p></li>
<li><p>Is there any other (unobserved) confound that could cause the discontinuous change at the cutoff (i.e., multiple forcing variables / bundling of institutions)?</p></li>
<li><p>External Validity: How likely the result at the cutoff will generalize?</p></li>
</ul>
<p><br></p>
<p><strong>General Model</strong></p>
<p><span class="math display">\[
Y_i = \beta_0 + f(x_i) \beta_1 + [I(x_i \ge c)]\beta_2 + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(f(x_i)\)</span> is any functional form of <span class="math inline">\(x_i\)</span></p>
<p><strong>Simple case</strong></p>
<p>When <span class="math inline">\(f(x_i) = x_i\)</span> (linear function)</p>
<p><span class="math display">\[
Y_i = \beta_0 + x_i \beta_1 + [I(x_i \ge c)]\beta_2 + \epsilon_i
\]</span></p>
<div class="inline-figure"><img src="images/rd1.PNG" style="display: block; margin: 1em auto"></div>
<p>RD gives you <span class="math inline">\(\beta_2\)</span> (causal effect) of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> at the cutoff point</p>
<p>In practice, everyone does</p>
<p><span class="math display">\[
Y_i = \alpha_0 + f(x) \alpha _1 + [I(x_i \ge c)]\alpha_2 + [f(x_i)\times [I(x_i \ge c)]\alpha_3 + u_i
\]</span></p>
<div class="inline-figure"><img src="images/rd2.PNG" style="display: block; margin: 1em auto"></div>
<p>where we estimate different slope on different sides of the line</p>
<p>and if you estimate <span class="math inline">\(\alpha_3\)</span> to be no different from 0 then we return to the simple case</p>
<p><strong>Notes</strong>:</p>
<ul>
<li><p>Sparse data can make <span class="math inline">\(\alpha_3\)</span> large differential effect</p></li>
<li><p>People are very skeptical when you have complex <span class="math inline">\(f(x_i)\)</span>, usual simple function forms (e.g., linear, squared term, etc.) should be good. However, if you still insist, then <strong>non-parametric estimation</strong> can be your best bet.</p></li>
</ul>
<p>Bandwidth of <span class="math inline">\(c\)</span> (window)</p>
<ul>
<li><p>Closer to <span class="math inline">\(c\)</span> can give you lower bias, but also efficiency</p></li>
<li><p>Wider <span class="math inline">\(c\)</span> can increase bias, but higher efficiency.</p></li>
<li><p>Optimal bandwidth is very controversial, but usually we have to do it in the appendix for research article anyway.</p></li>
<li>
<p>We can either</p>
<ul>
<li><p>drop observations outside of bandwidth or</p></li>
<li><p>weight depends on how far and close to <span class="math inline">\(c\)</span></p></li>
</ul>
</li>
</ul>
</div>
<div id="examples" class="section level3" number="20.1.5">
<h3>
<span class="header-section-number">20.1.5</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h3>
<div id="example-1-1" class="section level4" number="20.1.5.1">
<h4>
<span class="header-section-number">20.1.5.1</span> Example 1<a class="anchor" aria-label="anchor" href="#example-1-1"><i class="fas fa-link"></i></a>
</h4>
<p>Example by <a href="https://towardsdatascience.com/the-crown-jewel-of-causal-inference-regression-discontinuity-design-rdd-bad37a68e786">Leihua Ye</a></p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 X_i + \beta_2 W_i + u_i
\]</span></p>
<p><span class="math display">\[
X_i = 
\begin{cases}
1, W_i \ge c \\
0, W_i &lt; c
\end{cases}
\]</span></p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#cutoff point = 3.5</span>
<span class="va">GPA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">future_success</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">GPA</span> <span class="op">+</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="va">GPA</span> <span class="op">&gt;=</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="co">#install and load the package ‘rddtools’</span>
<span class="co">#install.packages(“rddtools”)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://qua.st/rddtools/">rddtools</a></span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rddtools/man/rdd_data.html">rdd_data</a></span><span class="op">(</span><span class="va">future_success</span>, <span class="va">GPA</span>, cutpoint <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span>
<span class="co"># plot the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
    <span class="va">data</span>,
    col <span class="op">=</span>  <span class="st">"red"</span>,
    cex <span class="op">=</span> <span class="fl">0.1</span>,
    xlab <span class="op">=</span>  <span class="st">"GPA"</span>,
    ylab <span class="op">=</span>  <span class="st">"future_success"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-4-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># estimate the sharp RDD model</span>
<span class="va">rdd_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rddtools/man/rdd_reg_lm.html">rdd_reg_lm</a></span><span class="op">(</span>rdd_object <span class="op">=</span> <span class="va">data</span>, slope <span class="op">=</span>  <span class="st">"same"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">rdd_mod</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ ., data = dat_step1, weights = weights)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;      Min       1Q   Median       3Q      Max </span>
<span class="co">#&gt; -2.93235 -0.66786 -0.00799  0.69991  3.01768 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept) 17.08582    0.07178  238.03   &lt;2e-16 ***</span>
<span class="co">#&gt; D            9.95513    0.11848   84.03   &lt;2e-16 ***</span>
<span class="co">#&gt; x            2.01615    0.03546   56.85   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.046 on 997 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.9617, Adjusted R-squared:  0.9616 </span>
<span class="co">#&gt; F-statistic: 1.253e+04 on 2 and 997 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the RDD model along with binned observations</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
    <span class="va">rdd_mod</span>,
    cex <span class="op">=</span> <span class="fl">0.1</span>,
    col <span class="op">=</span>  <span class="st">"red"</span>,
    xlab <span class="op">=</span>  <span class="st">"GPA"</span>,
    ylab <span class="op">=</span>  <span class="st">"future_success"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-6-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="example-2" class="section level4" number="20.1.5.2">
<h4>
<span class="header-section-number">20.1.5.2</span> Example 2<a class="anchor" aria-label="anchor" href="#example-2"><i class="fas fa-link"></i></a>
</h4>
<p><span class="citation"><a href="references.html#ref-bowblis2019" role="doc-biblioref">Bowblis and Smith</a> (<a href="references.html#ref-bowblis2019" role="doc-biblioref">2019</a>)</span></p>
<p>Occupational licensing can either increase or decrease market efficiency:</p>
<ul>
<li><p>More information means more efficiency</p></li>
<li><p>Increased entry barriers (i.e., friction) increase efficiency</p></li>
</ul>
<p>Components of RD</p>
<ul>
<li>Running variable</li>
<li>Cutoff: 120 beds or above</li>
<li>Treatment: you have to have the treatment before the cutoff point.</li>
</ul>
<p>Under OLS</p>
<p><span class="math display">\[
Y_i = \alpha_0 + X_i \alpha_1 + LW_i \alpha_2 + \epsilon_i
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(LW_i\)</span> Licensed/certified workers (in fraction format for each center).</p></li>
<li><p><span class="math inline">\(Y_i\)</span> = Quality of service</p></li>
</ul>
<p>Bias in <span class="math inline">\(\alpha_2\)</span></p>
<ul>
<li><p>Mitigation-based: terrible quality can lead to more hiring, which negatively bias <span class="math inline">\(\alpha_2\)</span></p></li>
<li><p>Preference-based: places that have higher quality staff want to keep high quality staffs.</p></li>
</ul>
<p>Under RD</p>
<p><span class="math display">\[
Y_{ist} = \beta_0 + [I(Bed \ge121)_{ist}]\beta_1 + f(Size_{ist}) \beta_2 + [f(Size_{ist}) \times I(Bed \ge 121)_{ist}] \beta_3 \\
+ X_{it} \delta + \gamma_s + \theta_t + \epsilon_{ist}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(s\)</span> = state</p></li>
<li><p><span class="math inline">\(t\)</span> = year</p></li>
<li><p><span class="math inline">\(i\)</span> = hospital</p></li>
</ul>
<p>This RD is fuzzy</p>
<p>If right near the threshold (bandwidth), we have states with different sorting (i.e., non-random), then we need the fixed-effect for state <span class="math inline">\(s\)</span>. But then your RD assumption wrong anyway, then you won’t do it in the first place</p>
<p>Technically, we could also run the fixed-effect regression, but because it’s lower in the causal inference hierarchy. Hence, we don’t do it.</p>
<p>Moreover, in the RD framework, we don’t include <span class="math inline">\(t\)</span> before treatment (but in the FE we have to include before and after)</p>
<p>If we include <span class="math inline">\(\pi_i\)</span> for each hospital, then we don’t have variation in the causal estimates (because hardly any hospital changes their bed size in the panel)</p>
<p>When you have <span class="math inline">\(\beta_1\)</span> as the intent to treat (because the treatment effect does not coincide with the intent to treat)</p>
<p>You cannot take those fuzzy cases out, because it will introduce the selection bias.</p>
<p>Note that we cannot drop cases based on behavioral choice (because we will exclude non-compliers), but we can drop when we have particular behaviors ((e.g., people like round numbers).</p>
<p>Thus, we have to use Instrument variable <a href="endogeneity.html#instrumental-variable">21.3.1</a></p>
<p>Stage 1:</p>
<p><span class="math display">\[
QSW_{ist} = \alpha_0 + [I(Bed \ge121)_{ist}]\alpha_1 + f(Size_{ist}) \alpha_2 + [f(Size_{ist}) \times I(Bed \ge 121)_{ist}] \alpha_3 \\
+ X_{it} \delta + \gamma_s + \theta_t + \epsilon_{ist}
\]</span></p>
<p>(Note: you should have different fixed effects and error term - <span class="math inline">\(\delta, \gamma_s, \theta_t, \epsilon_{ist}\)</span> from the first equation, but I ran out of Greek letters)</p>
<p>Stage 2:</p>
<p><span class="math display">\[
Y_{ist} = \gamma_0 + \gamma_1 \hat{QWS}_{ist} + f(Size_{ist}) \delta_2 + [f(Size_{ist}) \times I(Bed \ge 121)] \delta_3 \\
 + X_{it} \lambda + \eta_s + \tau_t + u_{ist}
\]</span></p>
<p>The bigger the jump (discontinuity), the more similar the 2 coefficients (<span class="math inline">\(\gamma_1 \approx \beta_1\)</span>) where <span class="math inline">\(\gamma_1\)</span> is the average treatment effect (of exposing to the policy)</p>
<p><span class="math inline">\(\beta_1\)</span> will always be closer to 0 than <span class="math inline">\(\gamma_1\)</span></p>
<p>Figure 1 shows bunching at every 5 units cutoff, but 120 is still out there.</p>
<p>If we have manipulable bunching, there should be decrease at 130</p>
<p>Since we have limited number of mass points (at the round numbers), we should clustered standard errors by the mass point</p>
<p><br></p>
</div>
<div id="example-3" class="section level4" number="20.1.5.3">
<h4>
<span class="header-section-number">20.1.5.3</span> Example 3<a class="anchor" aria-label="anchor" href="#example-3"><i class="fas fa-link"></i></a>
</h4>
<p>Replication of <span class="citation">(<a href="references.html#ref-carpenter2009" role="doc-biblioref">Carpenter and Dobkin 2009</a>)</span> by <a href="https://rpubs.com/phle/r_tutorial_regression_discontinuity_design">Philipp Leppert</a>, dataset from <a href="https://www.openicpsr.org/openicpsr/project/113550/version/V1/view?flag=follow&amp;pageSize=100&amp;sortOrder=(?title)&amp;sortAsc=true">here</a></p>
</div>
<div id="example-4" class="section level4" number="20.1.5.4">
<h4>
<span class="header-section-number">20.1.5.4</span> Example 4<a class="anchor" aria-label="anchor" href="#example-4"><i class="fas fa-link"></i></a>
</h4>
<p>For a detailed application, see <span class="citation">(<a href="references.html#ref-thoemmes2016" role="doc-biblioref">Thoemmes, Liao, and Jin 2016</a>)</span> where they use <code>rdd</code>, <code>rdrobust</code>, <code>rddtools</code></p>
<p><br></p>
</div>
</div>
</div>
<div id="difference-in-differences" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> Difference-In-Differences<a class="anchor" aria-label="anchor" href="#difference-in-differences"><i class="fas fa-link"></i></a>
</h2>
<div id="simple-dif-n-dif" class="section level3" number="20.2.1">
<h3>
<span class="header-section-number">20.2.1</span> Simple Dif-n-dif<a class="anchor" aria-label="anchor" href="#simple-dif-n-dif"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>A tool developed intuitively to study “natural experiment,” but its uses are much broader.</p></li>
<li><p><a href="data.html#fixed-effects-estimator">Fixed Effects Estimator</a> is the foundation for DID</p></li>
</ul>
<p>Consider</p>
<ul>
<li><p><span class="math inline">\(D_i = 1\)</span> treatment group</p></li>
<li><p><span class="math inline">\(D_i = 0\)</span> control group</p></li>
<li><p><span class="math inline">\(T= 1\)</span> After the treatment</p></li>
<li><p><span class="math inline">\(T =0\)</span> Before the treatment</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>After (T = 1)</th>
<th>Before (T = 0)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treated <span class="math inline">\(D_i =1\)</span>
</td>
<td><span class="math inline">\(E[Y_{1i}(1)|D_i = 1]\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)|D)i=1]\)</span></td>
</tr>
<tr class="even">
<td>Control <span class="math inline">\(D_i = 0\)</span>
</td>
<td><span class="math inline">\(E[Y_{0i}(1) |D_i =0]\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)|D_i=0]\)</span></td>
</tr>
</tbody>
</table></div>
<p>missing <span class="math inline">\(E[Y_{0i}(1)|D=1]\)</span></p>
<p>The Average Treatment Effect on Treated</p>
<p><span class="math display">\[
E[Y_1(1) - Y_0(1)|D=1] \\
= \{E[Y(1)|D=1] - E[Y(1)|D=0] \} - \{E[Y(0)|D=1] - E[Y(0)|D=0] \}
\]</span></p>
<p><strong>Assumption</strong></p>
<ul>
<li>Parallel Trends: Difference between the treatment and control groups remain constant if there were no treatment.</li>
</ul>
<p>should be used in cases where</p>
<ul>
<li><p>you observe before and after an event</p></li>
<li><p>you have treatment and control groups</p></li>
</ul>
<p>not in cases where</p>
<ul>
<li><p>treatment is not random</p></li>
<li><p>confounders.</p></li>
</ul>
<p><strong>Possible issues</strong></p>
<ul>
<li><p>Estimate dependent on functional form</p></li>
<li>
<p>Long-term effects</p>
<ul>
<li>Parallel trends are more likely to be observed over shorter period (window of observation)</li>
</ul>
</li>
<li>
<p>Heterogeneous effects</p>
<ul>
<li>Different intensity (e.g., doses) for different groups.</li>
</ul>
</li>
<li>
<p>Ashenfelter dip</p>
<ul>
<li>Participants are systemitcally different from nonparticipants before the treatment, leading to the question of permanent or transitory changes.</li>
</ul>
</li>
</ul>
<p><strong>Robustness Check</strong></p>
<ul>
<li><p>Redo the DiD analysis for period before the treatment (expected treatment effect is 0).</p></li>
<li><p>Possible alternative control group: Expected results should be similar</p></li>
<li><p>Try different windows (further away from the treatment point, other factors can creep in and nullify your effect).</p></li>
<li><p>Treatment Reversal</p></li>
</ul>
<div id="example-from-princeton" class="section level4" number="20.2.1.1">
<h4>
<span class="header-section-number">20.2.1.1</span> Example from <a href="https://www.princeton.edu/~otorres/DID101R.pdf">Princeton</a><a class="anchor" aria-label="anchor" href="#example-from-princeton"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign/">foreign</a></span><span class="op">)</span>
<span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dta.html">read.dta</a></span><span class="op">(</span><span class="st">"http://dss.princeton.edu/training/Panel101.dta"</span><span class="op">)</span></code></pre></div>
<p>create a dummy variable to indicate the time when the treatment started</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mydata</span><span class="op">$</span><span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1994</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>create a dummy variable to identify the treatment group</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mydata</span><span class="op">$</span><span class="va">treated</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"E"</span> <span class="op">|</span>
                            <span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"F"</span> <span class="op">|</span> <span class="va">mydata</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">"G"</span> ,
                        <span class="fl">1</span>,
                        <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>create an interaction between time and treated</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mydata</span><span class="op">$</span><span class="va">did</span> <span class="op">=</span> <span class="va">mydata</span><span class="op">$</span><span class="va">time</span> <span class="op">*</span> <span class="va">mydata</span><span class="op">$</span><span class="va">treated</span></code></pre></div>
<p>estimate the DID estimator</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">didreg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">did</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">didreg</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ treated + time + did, data = mydata)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;        Min         1Q     Median         3Q        Max </span>
<span class="co">#&gt; -9.768e+09 -1.623e+09  1.167e+08  1.393e+09  6.807e+09 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="co">#&gt; (Intercept)  3.581e+08  7.382e+08   0.485   0.6292  </span>
<span class="co">#&gt; treated      1.776e+09  1.128e+09   1.575   0.1200  </span>
<span class="co">#&gt; time         2.289e+09  9.530e+08   2.402   0.0191 *</span>
<span class="co">#&gt; did         -2.520e+09  1.456e+09  -1.731   0.0882 .</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 2.953e+09 on 66 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.08273,    Adjusted R-squared:  0.04104 </span>
<span class="co">#&gt; F-statistic: 1.984 on 3 and 66 DF,  p-value: 0.1249</span></code></pre></div>
<p>The <code>did</code> coefficient is the differences-in-differences estimator. Treat has a negative effect</p>
<p><br></p>
</div>
<div id="example-by-card1993" class="section level4" number="20.2.1.2">
<h4>
<span class="header-section-number">20.2.1.2</span> Example by <span class="citation"><a href="references.html#ref-card1993" role="doc-biblioref">Card and Krueger</a> (<a href="references.html#ref-card1993" role="doc-biblioref">1993</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-card1993"><i class="fas fa-link"></i></a>
</h4>
<p>found that increase in minimum wage increases employment</p>
<p>Experimental Setting:</p>
<ul>
<li><p>New Jersey (treatment) increased minimum wage</p></li>
<li><p>Penn (control) did not increase minimum wage</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th></th>
<th>After</th>
<th>Before</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td>NJ</td>
<td>A</td>
<td>B</td>
<td>A - B</td>
</tr>
<tr class="even">
<td>Control</td>
<td>PA</td>
<td>C</td>
<td>D</td>
<td>C - D</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>A - C</td>
<td>B - D</td>
<td>(A - B) - (C - D)</td>
</tr>
</tbody>
</table></div>
<p>where</p>
<ul>
<li><p>A - B = treatment effect + effect of time (additive)</p></li>
<li><p>C - D = effect of time</p></li>
<li><p>(A - B) - (C - D) = dif-n-dif</p></li>
</ul>
<p><strong>The identifying assumptions</strong>:</p>
<ul>
<li><p>Can’t have <strong>switchers</strong></p></li>
<li>
<p>PA is the control group</p>
<ul>
<li><p>is a good counter factual</p></li>
<li><p>is what NJ would look like if they hadn’t had the treatment</p></li>
</ul>
</li>
</ul>
<p><span class="math display">\[
Y_{jt} = \beta_0 + NJ_j \beta_1 + POST_t \beta_2 + (NJ_j \times POST_t)\beta_3+ X_{jt}\beta_4 + \epsilon_{jt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(j\)</span> = restaurant</p></li>
<li><p><span class="math inline">\(NJ\)</span> = dummy where 1 = NJ, and 0 = PA</p></li>
<li><p><span class="math inline">\(POST\)</span> = dummy where 1 = post, and 0 = pre</p></li>
</ul>
<p>We don’t need <span class="math inline">\(\beta_4\)</span> in our model to have unbiased <span class="math inline">\(\beta_3\)</span>, but including it would give our coefficients efficiency</p>
<p>If we use <span class="math inline">\(\Delta Y_{jt}\)</span> as the dependent variable, we don’t need <span class="math inline">\(POST_t \beta_2\)</span> anymore</p>
<p>Alternative model specification is that the authors use NJ high wage restaurant as control group (still choose those that are close to the border)</p>
<p>The reason why they can’t control for everything (PA + NJ high wage) is because it’s hard to interpret the causal treatment</p>
<p>Dif-n-dif utilizes similarity in pretrend of the dependent variables. However, this is neither a necessary nor sufficient for the identifying assumption.</p>
<ul>
<li><p>It’s not sufficient because they can have multiple treatments (technically, you could include more control, but your treatment can’t interact)</p></li>
<li><p>It’s not necessary because trends can e parallel after treatment</p></li>
</ul>
<p>However, we can’t never be certain; we just try to find evidence consistent with our theory so that dif-n-dif can work.</p>
<p>Notice that we don’t need before treatment the <strong>levels of the dependent variable</strong> to be the same (e.g., same wage average in both NJ and PA), dif-n-dif only needs <strong>pre-trend (i.e., slope)</strong> to be the same for the two groups.</p>
<p><br></p>
</div>
<div id="example-by-butcher2014" class="section level4" number="20.2.1.3">
<h4>
<span class="header-section-number">20.2.1.3</span> Example by <span class="citation"><a href="references.html#ref-butcher2014" role="doc-biblioref">Butcher, McEwan, and Weerapana</a> (<a href="references.html#ref-butcher2014" role="doc-biblioref">2014</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-butcher2014"><i class="fas fa-link"></i></a>
</h4>
<p>Theory:</p>
<ul>
<li>
<p>Highest achieving students are usually in hard science. Why?</p>
<ul>
<li><p>Hard to give students students the benefit of doubt for hard science</p></li>
<li><p>How unpleasant and how easy to get a job. Degrees with lower market value typically want to make you feel more pleasant</p></li>
</ul>
</li>
</ul>
<p>Under OLS</p>
<p><span class="math display">\[
E_{ij} = \beta_0 + X_i \beta_1 + G_j \beta_2 + \epsilon_{ij}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(X_i\)</span> = student attributes</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> = causal estimate (from grade change)</p></li>
<li><p><span class="math inline">\(E_{ij}\)</span> = Did you choose to enroll in major <span class="math inline">\(j\)</span></p></li>
<li><p><span class="math inline">\(G_j\)</span> = grade given in major <span class="math inline">\(j\)</span></p></li>
</ul>
<p>Examine <span class="math inline">\(\hat{\beta}_2\)</span></p>
<ul>
<li><p>Negative bias: Endogenous response because department with lower enrollment rate will give better grade</p></li>
<li><p>Positive bias: hard science is already having best students (i.e., ability), so if they don’t their grades can be even lower</p></li>
</ul>
<p>Under dif-n-dif</p>
<p><span class="math display">\[
Y_{idt} = \beta_0 + POST_t \beta_1 + Treat_d \beta_2 + (POST_t \times Treat_d)\beta_3 + X_{idt} + \epsilon_{idt}
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(Y_{idt}\)</span> = grade average</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>Intercept</th>
<th>Treat</th>
<th>Post</th>
<th>Treat*Post</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Treat Pre</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Treat Post</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Control Pre</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>Control Post</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td></td>
<td>Average for pre-control <span class="math inline">\(\beta_0\)</span>
</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></div>
<p>A more general specification of the dif-n-dif is that</p>
<p><span class="math display">\[
Y_{idt} = \alpha_0 + (POST_t \times Treat_d) \alpha_1 + \theta_d + \delta_t + X_{idt} + u_{idt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\((\theta_d + \delta_t)\)</span> richer , more df than <span class="math inline">\(Treat_d \beta_2 + Post_t \beta_1\)</span> (because fixed effects subsume Post and treat)</p></li>
<li><p><span class="math inline">\(\alpha_1\)</span> should be equivalent to <span class="math inline">\(\beta_3\)</span> (if your model assumptions are correct)</p></li>
</ul>
<p>Under causal inference, <span class="math inline">\(R^2\)</span> is not so important.</p>
<p><br></p>
</div>
</div>
<div id="staggered-dif-n-dif" class="section level3" number="20.2.2">
<h3>
<span class="header-section-number">20.2.2</span> Staggered Dif-n-dif<a class="anchor" aria-label="anchor" href="#staggered-dif-n-dif"><i class="fas fa-link"></i></a>
</h3>
<div id="example-by-doleac2020" class="section level4" number="20.2.2.1">
<h4>
<span class="header-section-number">20.2.2.1</span> Example by <span class="citation"><a href="references.html#ref-doleac2020" role="doc-biblioref">Doleac and Hansen</a> (<a href="references.html#ref-doleac2020" role="doc-biblioref">2020</a>)</span><a class="anchor" aria-label="anchor" href="#example-by-doleac2020"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>The purpose of banning a checking box for ex-criminal was banned because we thought that it gives more access to felons</p></li>
<li><p>Even if we ban the box, employers wouldn’t just change their behaviors. But then the unintended consequence is that employers statistically discriminate based on race</p></li>
</ul>
<p>3 types of ban the box</p>
<ol style="list-style-type: decimal">
<li>Public employer only</li>
<li>Private employer with government contract</li>
<li>All employers</li>
</ol>
<p>Main identification strategy</p>
<ul>
<li>If any county in the Metropolitan Statistical Area (MSA) adopts ban the box, it means the whole MSA is treated. Or if the state adopts “ban the ban,” every county is treated</li>
</ul>
<p>Under <a href="quasi-experimental.html#simple-dif-n-dif">Simple Dif-n-dif</a></p>
<p><span class="math display">\[
Y_{it} = \beta_0 + \beta_1 Post_t + \beta_2 treat_i + \beta_2 (Post_t \times Treat_i) + \epsilon_{it}
\]</span></p>
<p>But if there is no common post time, then we should use <a href="quasi-experimental.html#staggered-dif-n-dif">Staggered Dif-n-dif</a></p>
<p><span class="math display">\[
E_{imrt} = \alpha + \beta_1 BTB_{imt} W_{imt} + \beta_2 BTB_{mt} + \beta_3 BTB_{mt} H_{imt}+\\ \delta_m + D_{imt} \beta_5 + \lambda_{rt} + \delta_m\times f(t) \beta_7 + e_{imrt}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(i\)</span> = person; <span class="math inline">\(m\)</span> = MSA; <span class="math inline">\(r\)</span> = region (US regions e.g., midwest) ; <span class="math inline">\(r\)</span> = region; <span class="math inline">\(t\)</span> = year</p></li>
<li><p><span class="math inline">\(W\)</span> = White; <span class="math inline">\(B\)</span> = Black; <span class="math inline">\(H\)</span> = Hispanic</p></li>
<li><p><span class="math inline">\(\beta_1 BTB_{imt} W_{imt} + \beta_2 BTB_{mt} + \beta_3 BTB_{mt} H_{imt}\)</span> are the 3 dif-n-dif variables (<span class="math inline">\(BTB\)</span> = “ban the box”)</p></li>
<li><p><span class="math inline">\(\delta_m\)</span> = dummy for MSI</p></li>
<li><p><span class="math inline">\(D_{imt}\)</span> = control for people</p></li>
<li><p><span class="math inline">\(\lambda_{rt}\)</span> = region by time fixed effect</p></li>
<li><p><span class="math inline">\(\delta_m \times f(t)\)</span> = linear time trend within MSA (but we should not need this if we have good pre-trend)</p></li>
</ul>
<p>If we put <span class="math inline">\(\lambda_r - \lambda_t\)</span> (separately) we will more broad fixed effect, while <span class="math inline">\(\lambda_{rt}\)</span> will give us deeper and narrower fixed effect.</p>
<p>Before running this model, we have to drop all other races. And <span class="math inline">\(\beta_1, \beta_2, \beta_3\)</span> are not collinear because there are all interaction terms with <span class="math inline">\(BTB_{mt}\)</span></p>
<p>If we just want to estimate the model for black men, we will modify it to be</p>
<p><span class="math display">\[
E_{imrt} = \alpha + BTB_{mt} \beta_1 + \delta_m + D_{imt} \beta_5 + \lambda_{rt} + (\delta_m \times f(t)) \beta_7 + e_{imrt}
\]</span></p>
<p><span class="math display">\[
E_{imrt} = \alpha + BTB_{m (t - 3t)} \theta_1 + BTB_{m(t-2)} \theta_2 + BTB_{mt} \theta_4 \\
+ BTB_{m(t+1)}\theta_5 + BTB_{m(t+2)}\theta_6 + BTB_{m(t+3t)}\theta_7 \\
+ [\delta_m + D_{imt}\beta_5 + \lambda_r + (\delta_m \times (f(t))\beta_7 + e_{imrt}]
\]</span></p>
<p>We have to leave <span class="math inline">\(BTB_{m(t-1)}\theta_3\)</span> out for the category would not be perfect collinearity</p>
<p>So the year before BTB (<span class="math inline">\(\theta_1, \theta_2, \theta_3\)</span>) should be similar to each other (i.e., same pre-trend). Remember, we only run for places with BTB.</p>
<p>If <span class="math inline">\(\theta_2\)</span> is statistically different from <span class="math inline">\(\theta_3\)</span> (baseline), then there could be a problem, but it could also make sense if we have pre-trend announcement.</p>
<p><br></p>
<p>Example by <a href="https://rpubs.com/phle/r_tutorial_difference_in_differences">Philipp Leppert</a> replicating <a href="https://davidcard.berkeley.edu/data_sets.html">Card and Krueger (1994)</a></p>
<p>Example by <a href="https://bookdown.org/aschmi11/causal_inf/difference-in-differences.html">Anthony Schmidt</a></p>
</div>
</div>
</div>
<div id="synthetic-control" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> Synthetic Control<a class="anchor" aria-label="anchor" href="#synthetic-control"><i class="fas fa-link"></i></a>
</h2>
<p>Synthetic control method (SCM) is a generalization of the dif-in-dif model</p>
<p>Advantages over dif-in-dif:</p>
<ol style="list-style-type: decimal">
<li>Maximization of the observable similarity between control and treatment (maybe also unobservables)</li>
<li>Can also be used in cases where no untreated case with similar on matching dimensions with treated cases</li>
<li>Objective selection of controls.</li>
</ol>
<p>a data driven procedure to construct more comparable control groups (i.e., black box).</p>
<p>To do causal inference with control and treatment group using <a href="quasi-experimental.html#matching-methods">Matching Methods</a>, you typically have to have similar covariates in the control and the treated groups. However, if you don’t methods like <a href="quasi-experimental.html#propensity-scores">Propensity Scores</a> and DID can perform rather poorly (i.e., large bias).</p>
<p>SCM is recommended when</p>
<ol style="list-style-type: decimal">
<li>Social events to evaluate large-scale program or policy</li>
<li>Only one treated case with several control candidates.</li>
</ol>
<p>Advantages:</p>
<ol style="list-style-type: decimal">
<li>From the selection criteria, researchers can understand the relative importance of each candidate</li>
<li>Post-intervention outcomes are not used in synthetic. Hence, you can’t retro-fit.</li>
<li>Observable similarity between control and treatment cases is maximized</li>
</ol>
<p><code>Synth</code> provides an algorithm that finds weighted combination of the comparison units where the weights are chosen such that it best resembles the values of predictors of the outcome variable for the affected units before the intervention.</p>
<div id="example-1-2" class="section level3" number="20.3.1">
<h3>
<span class="header-section-number">20.3.1</span> Example 1<a class="anchor" aria-label="anchor" href="#example-1-2"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://rpubs.com/danilofreire/synth">Danilo Freire</a></p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("Synth")</span>
<span class="co"># install.packages("gsynth")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stanford.edu/~jhain">"Synth"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://yiqingxu.org/packages/gsynth/gsynth_examples.html">"gsynth"</a></span><span class="op">)</span></code></pre></div>
<p>simulate data for 10 states and 30 years. State A receives the treatment <code>T = 20</code> after year 15.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">10</span><span class="op">)</span> 
<span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">X1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X1</span>, <span class="va">X2</span>, <span class="va">state</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X2</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">state.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">`T`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">15</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">15</span>, <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">+</span> <span class="fl">20</span>, <span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    300 obs. of  7 variables:</span>
<span class="co">#&gt;  $ Y        : num  2.29 4.51 2.07 8.87 4.37 1.32 8 7.49 6.98 3.72 ...</span>
<span class="co">#&gt;  $ X1       : num  1.37 2.18 1.16 3.6 2.33 1.18 2.49 2.74 2.58 1.69 ...</span>
<span class="co">#&gt;  $ X2       : num  1.96 0.4 -0.75 -0.56 -0.45 1.06 0.51 -2.1 0 0.54 ...</span>
<span class="co">#&gt;  $ state    : chr  "A" "A" "A" "A" ...</span>
<span class="co">#&gt;  $ year     : num  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ state.num: int  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ T        : num  0 0 0 0 0 0 0 0 0 0 ...</span></code></pre></div>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
        <span class="va">df</span>,
        predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span>,
        dependent     <span class="op">=</span> <span class="st">"Y"</span>,
        unit.variable <span class="op">=</span> <span class="st">"state.num"</span>,
        time.variable <span class="op">=</span> <span class="st">"year"</span>,
        unit.names.variable <span class="op">=</span> <span class="st">"state"</span>,
        treatment.identifier  <span class="op">=</span> <span class="fl">1</span>,
        controls.identifier   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,
        time.predictors.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span>,
        time.optimize.ssr     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span>,
        time.plot             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
    <span class="op">)</span>


<span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span><span class="va">dataprep.out</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 9.831789 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.3888387 0.6111613 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  0.1115941 0.1832781 0.1027237 0.312091 0.06096758 0.03509706 0.05893735 0.05746256 0.07784853</span></code></pre></div>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">print</a></span><span class="op">(</span><span class="va">synth.tables</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>
        dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
        synth.res    <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
      <span class="op">)</span>
<span class="co">#&gt; $tab.pred</span>
<span class="co">#&gt;    Treated Synthetic Sample Mean</span>
<span class="co">#&gt; X1   2.028     2.028       2.017</span>
<span class="co">#&gt; X2   0.513     0.513       0.394</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.v</span>
<span class="co">#&gt;    v.weights</span>
<span class="co">#&gt; X1 0.389    </span>
<span class="co">#&gt; X2 0.611    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.w</span>
<span class="co">#&gt;    w.weights unit.names unit.numbers</span>
<span class="co">#&gt; 2      0.112          B            2</span>
<span class="co">#&gt; 3      0.183          C            3</span>
<span class="co">#&gt; 4      0.103          D            4</span>
<span class="co">#&gt; 5      0.312          E            5</span>
<span class="co">#&gt; 6      0.061          F            6</span>
<span class="co">#&gt; 7      0.035          G            7</span>
<span class="co">#&gt; 8      0.059          H            8</span>
<span class="co">#&gt; 9      0.057          I            9</span>
<span class="co">#&gt; 10     0.078          J           10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.loss</span>
<span class="co">#&gt;            Loss W   Loss V</span>
<span class="co">#&gt; [1,] 9.761708e-12 9.831789</span></code></pre></div>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>synth.res    <span class="op">=</span> <span class="va">synth.out</span>,
          dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
          Ylab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span>,
          Xlab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span>,
          Legend       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"State A"</span>,<span class="st">"Synthetic State A"</span><span class="op">)</span>,
          Legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"topleft"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v   <span class="op">=</span> <span class="fl">15</span>,
       lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-17-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Gaps plot:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>synth.res    <span class="op">=</span> <span class="va">synth.out</span>,
          dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
          Ylab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gap"</span><span class="op">)</span>,
          Xlab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span>,
          Ylim         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span>,
          Main         <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v   <span class="op">=</span> <span class="fl">15</span>,
       lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-18-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Alternatively, <code>gsynth</code> provides options to estimate iterative fixed effects, and handle multiple treated units at tat time.</p>
<p>Here, we use two=way fixed effects and bootstrapped standard errors</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="quasi-experimental.html#cb342-1" aria-hidden="true" tabindex="-1"></a>gsynth.out <span class="ot">&lt;-</span> <span class="fu">gsynth</span>(</span>
<span id="cb342-2"><a href="quasi-experimental.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb342-3"><a href="quasi-experimental.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb342-4"><a href="quasi-experimental.html#cb342-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"year"</span>),</span>
<span id="cb342-5"><a href="quasi-experimental.html#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="st">"two-way"</span>,</span>
<span id="cb342-6"><a href="quasi-experimental.html#cb342-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> <span class="cn">TRUE</span>,</span>
<span id="cb342-7"><a href="quasi-experimental.html#cb342-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb342-8"><a href="quasi-experimental.html#cb342-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb342-9"><a href="quasi-experimental.html#cb342-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">inference =</span> <span class="st">"parametric"</span>,</span>
<span id="cb342-10"><a href="quasi-experimental.html#cb342-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">nboots =</span> <span class="dv">1000</span>,</span>
<span id="cb342-11"><a href="quasi-experimental.html#cb342-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel =</span> F <span class="co"># TRUE</span></span>
<span id="cb342-12"><a href="quasi-experimental.html#cb342-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb342-13"><a href="quasi-experimental.html#cb342-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cross-validating ... </span></span>
<span id="cb342-14"><a href="quasi-experimental.html#cb342-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 0; sigma2 = 1.13533; IC = 0.95632; PC = 0.96713; MSPE = 1.65502</span></span>
<span id="cb342-15"><a href="quasi-experimental.html#cb342-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 1; sigma2 = 0.96885; IC = 1.54420; PC = 4.30644; MSPE = 1.33375</span></span>
<span id="cb342-16"><a href="quasi-experimental.html#cb342-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 2; sigma2 = 0.81855; IC = 2.08062; PC = 6.58556; MSPE = 1.27341*</span></span>
<span id="cb342-17"><a href="quasi-experimental.html#cb342-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 3; sigma2 = 0.71670; IC = 2.61125; PC = 8.35187; MSPE = 1.79319</span></span>
<span id="cb342-18"><a href="quasi-experimental.html#cb342-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 4; sigma2 = 0.62823; IC = 3.10156; PC = 9.59221; MSPE = 2.02301</span></span>
<span id="cb342-19"><a href="quasi-experimental.html#cb342-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 5; sigma2 = 0.55497; IC = 3.55814; PC = 10.48406; MSPE = 2.79596</span></span>
<span id="cb342-20"><a href="quasi-experimental.html#cb342-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb342-21"><a href="quasi-experimental.html#cb342-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r* = 2</span></span>
<span id="cb342-22"><a href="quasi-experimental.html#cb342-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb342-23"><a href="quasi-experimental.html#cb342-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb342-24"><a href="quasi-experimental.html#cb342-24" aria-hidden="true" tabindex="-1"></a>Simulating errors .............</span>
<span id="cb342-25"><a href="quasi-experimental.html#cb342-25" aria-hidden="true" tabindex="-1"></a>Bootstrapping ...</span>
<span id="cb342-26"><a href="quasi-experimental.html#cb342-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ..........</span></span></code></pre></div>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-20-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span>, type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-21-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span>, type <span class="op">=</span> <span class="st">"counterfactual"</span>, raw <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># shows estimations for the control cases</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="example-2-1" class="section level3" number="20.3.2">
<h3>
<span class="header-section-number">20.3.2</span> Example 2<a class="anchor" aria-label="anchor" href="#example-2-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://towardsdatascience.com/causal-inference-using-synthetic-control-the-ultimate-guide-a622ad5cf827">Leihua Ye</a></p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain">Synth</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"basque"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">basque</span><span class="op">)</span> <span class="co">#774*17</span>
<span class="co">#&gt; [1] 774  17</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">basque</span><span class="op">)</span>
<span class="co">#&gt;   regionno     regionname year   gdpcap sec.agriculture sec.energy sec.industry</span>
<span class="co">#&gt; 1        1 Spain (Espana) 1955 2.354542              NA         NA           NA</span>
<span class="co">#&gt; 2        1 Spain (Espana) 1956 2.480149              NA         NA           NA</span>
<span class="co">#&gt; 3        1 Spain (Espana) 1957 2.603613              NA         NA           NA</span>
<span class="co">#&gt; 4        1 Spain (Espana) 1958 2.637104              NA         NA           NA</span>
<span class="co">#&gt; 5        1 Spain (Espana) 1959 2.669880              NA         NA           NA</span>
<span class="co">#&gt; 6        1 Spain (Espana) 1960 2.869966              NA         NA           NA</span>
<span class="co">#&gt;   sec.construction sec.services.venta sec.services.nonventa school.illit</span>
<span class="co">#&gt; 1               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 2               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 3               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 4               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 5               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 6               NA                 NA                    NA           NA</span>
<span class="co">#&gt;   school.prim school.med school.high school.post.high popdens invest</span>
<span class="co">#&gt; 1          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 2          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 3          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 4          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 5          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 6          NA         NA          NA               NA      NA     NA</span></code></pre></div>
<p>transform data to be used in <code><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth()</a></code></p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
    foo <span class="op">=</span> <span class="va">basque</span>,
    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"school.illit"</span>,
        <span class="st">"school.prim"</span>,
        <span class="st">"school.med"</span>,
        <span class="st">"school.high"</span>,
        <span class="st">"school.post.high"</span>,
        <span class="st">"invest"</span>
    <span class="op">)</span>,
    predictors.op <span class="op">=</span>  <span class="st">"mean"</span>,
    <span class="co"># the operator</span>
    time.predictors.prior <span class="op">=</span> <span class="fl">1964</span><span class="op">:</span><span class="fl">1969</span>,
    <span class="co">#the entire time frame from the #beginning to the end</span>
    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"gdpcap"</span>, <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,  <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.agriculture"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.energy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.industry"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.construction"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.venta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.nonventa"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"popdens"</span>, <span class="fl">1969</span>,  <span class="st">"mean"</span><span class="op">)</span>
    <span class="op">)</span>,
    dependent <span class="op">=</span>  <span class="st">"gdpcap"</span>,
    <span class="co"># dv</span>
    unit.variable <span class="op">=</span>  <span class="st">"regionno"</span>,
    <span class="co">#identifying unit numbers</span>
    unit.names.variable <span class="op">=</span>  <span class="st">"regionname"</span>,
    <span class="co">#identifying unit names</span>
    time.variable <span class="op">=</span>  <span class="st">"year"</span>,
    <span class="co">#time-periods</span>
    treatment.identifier <span class="op">=</span> <span class="fl">17</span>,
    <span class="co">#the treated case</span>
    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span>,
    <span class="co">#the control cases; all others #except number 17</span>
    time.optimize.ssr <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,
    <span class="co">#the time-period over which to optimize</span>
    time.plot <span class="op">=</span> <span class="fl">1955</span><span class="op">:</span><span class="fl">1997</span>
<span class="op">)</span><span class="co">#the entire time period before/after the treatment</span></code></pre></div>
<p>where</p>
<ul>
<li><p>X1 = the control case before the treatment</p></li>
<li><p>X0 = the control cases after the treatment</p></li>
<li><p>Z1: the treatment case before the treatment</p></li>
<li><p>Z0: the treatment case after the treatment</p></li>
</ul>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span>data.prep.obj <span class="op">=</span> <span class="va">dataprep.out</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.008864606 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.02773094 1.194e-07 1.60609e-05 0.0007163836 1.486e-07 0.002423908 0.0587055 0.2651997 0.02851006 0.291276 0.007994382 0.004053188 0.009398579 0.303975 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  2.53e-08 4.63e-08 6.44e-08 2.81e-08 3.37e-08 4.844e-07 4.2e-08 4.69e-08 0.8508145 9.75e-08 3.2e-08 5.54e-08 0.1491843 4.86e-08 9.89e-08 1.162e-07</span></code></pre></div>
<p>Calculate the difference between the real basque region and the synthetic control</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gaps</span> <span class="op">=</span> <span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y1plot</span> <span class="op">-</span> <span class="op">(</span><span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y0plot</span> 
                                     <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">%*%</a></span> <span class="va">synth.out</span><span class="op">$</span><span class="va">solution.w</span><span class="op">)</span>
<span class="va">gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;       1955       1956       1957 </span>
<span class="co">#&gt; 0.15023473 0.09168035 0.03716475</span></code></pre></div>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
                         synth.res <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">synth.tables</span><span class="op">)</span>
<span class="co">#&gt; [1] "tab.pred" "tab.v"    "tab.w"    "tab.loss"</span>
<span class="va">synth.tables</span><span class="op">$</span><span class="va">tab.pred</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,<span class="op">]</span>
<span class="co">#&gt;                                          Treated Synthetic Sample Mean</span>
<span class="co">#&gt; school.illit                              39.888   256.337     170.786</span>
<span class="co">#&gt; school.prim                             1031.742  2730.104    1127.186</span>
<span class="co">#&gt; school.med                                90.359   223.340      76.260</span>
<span class="co">#&gt; school.high                               25.728    63.437      24.235</span>
<span class="co">#&gt; school.post.high                          13.480    36.153      13.478</span>
<span class="co">#&gt; invest                                    24.647    21.583      21.424</span>
<span class="co">#&gt; special.gdpcap.1960.1969                   5.285     5.271       3.581</span>
<span class="co">#&gt; special.sec.agriculture.1961.1969          6.844     6.179      21.353</span>
<span class="co">#&gt; special.sec.energy.1961.1969               4.106     2.760       5.310</span>
<span class="co">#&gt; special.sec.industry.1961.1969            45.082    37.636      22.425</span>
<span class="co">#&gt; special.sec.construction.1961.1969         6.150     6.952       7.276</span>
<span class="co">#&gt; special.sec.services.venta.1961.1969      33.754    41.104      36.528</span>
<span class="co">#&gt; special.sec.services.nonventa.1961.1969    4.072     5.371       7.111</span></code></pre></div>
<p>Relative importance of each unit</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span><span class="op">$</span><span class="va">tab.w</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">14</span>, <span class="op">]</span>
<span class="co">#&gt;    w.weights            unit.names unit.numbers</span>
<span class="co">#&gt; 9      0.000    Castilla-La Mancha            9</span>
<span class="co">#&gt; 10     0.851              Cataluna           10</span>
<span class="co">#&gt; 11     0.000  Comunidad Valenciana           11</span>
<span class="co">#&gt; 12     0.000           Extremadura           12</span>
<span class="co">#&gt; 13     0.000               Galicia           13</span>
<span class="co">#&gt; 14     0.149 Madrid (Comunidad De)           14</span>
<span class="co">#&gt; 15     0.000    Murcia (Region de)           15</span></code></pre></div>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the changes before and after the treatment </span>
<span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"real per-capita gdp (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,
    Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Basque country"</span>,
               <span class="st">"synthetic Basque country"</span><span class="op">)</span>,
    Legend.position <span class="op">=</span> <span class="st">"bottomright"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-29-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span>  <span class="st">"gap in real per - capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span>  <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>,
    Main <span class="op">=</span> <span class="cn">NA</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-30-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Doubly Robust Difference-in-Differences</p>
<p>Example from <code>DRDID</code> package</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pedrohcgs.github.io/DRDID/">DRDID</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">nsw_long</span><span class="op">)</span>
<span class="co"># Form the Lalonde sample with CPS comparison group</span>
<span class="va">eval_lalonde_cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">nsw_long</span>, <span class="va">nsw_long</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">nsw_long</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Estimate Average Treatment Effect on Treated using Improved Locally Efficient Doubly Robust DID estimator</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://pedrohcgs.github.io/DRDID/reference/drdid.html">drdid</a></span><span class="op">(</span>
        yname <span class="op">=</span> <span class="st">"re"</span>,
        tname <span class="op">=</span> <span class="st">"year"</span>,
        idname <span class="op">=</span> <span class="st">"id"</span>,
        dname <span class="op">=</span> <span class="st">"experimental"</span>,
        xformla <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> <span class="va">hisp</span> <span class="op">+</span> <span class="va">re74</span>,
        data <span class="op">=</span> <span class="va">eval_lalonde_cps</span>,
        panel <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="co">#&gt;  Call:</span>
<span class="co">#&gt; drdid(yname = "re", tname = "year", idname = "id", dname = "experimental", </span>
<span class="co">#&gt;     xformla = ~age + educ + black + married + nodegree + hisp + </span>
<span class="co">#&gt;         re74, data = eval_lalonde_cps, panel = TRUE)</span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  Further improved locally efficient DR DID estimator for the ATT:</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;    ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] </span>
<span class="co">#&gt; -901.2703   393.6247   -2.2897     0.022    -1672.7747  -129.766 </span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  Estimator based on panel data.</span>
<span class="co">#&gt;  Outcome regression est. method: weighted least squares.</span>
<span class="co">#&gt;  Propensity score est. method: inverse prob. tilting.</span>
<span class="co">#&gt;  Analytical standard error.</span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  See Sant'Anna and Zhao (2020) for details.</span></code></pre></div>
</div>
<div id="example-3-1" class="section level3" number="20.3.3">
<h3>
<span class="header-section-number">20.3.3</span> Example 3<a class="anchor" aria-label="anchor" href="#example-3-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <code>Synth</code> package’s authors</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain">Synth</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"basque"</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth()</a></code> requires</p>
<ul>
<li><p><span class="math inline">\(X_1\)</span> vector of treatment predictors</p></li>
<li><p><span class="math inline">\(X_0\)</span> matrix of same variables for control group</p></li>
<li><p><span class="math inline">\(Z_1\)</span> vector of outcome variable for treatment group</p></li>
<li><p><span class="math inline">\(Z_0\)</span> matrix of outcome variable for control group</p></li>
</ul>
<p>use <code><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep()</a></code> to prepare data in the format that can be used throughout the <code>Synth</code> package</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
    foo <span class="op">=</span> <span class="va">basque</span>,
    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"school.illit"</span>,
        <span class="st">"school.prim"</span>,
        <span class="st">"school.med"</span>,
        <span class="st">"school.high"</span>,
        <span class="st">"school.post.high"</span>,
        <span class="st">"invest"</span>
    <span class="op">)</span>,
    predictors.op <span class="op">=</span> <span class="st">"mean"</span>,
    time.predictors.prior <span class="op">=</span> <span class="fl">1964</span><span class="op">:</span><span class="fl">1969</span>,
    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"gdpcap"</span>, <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span> , <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.agriculture"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.energy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.industry"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.construction"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.venta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.nonventa"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"popdens"</span>, <span class="fl">1969</span>, <span class="st">"mean"</span><span class="op">)</span>
    <span class="op">)</span>,
    dependent <span class="op">=</span> <span class="st">"gdpcap"</span>,
    unit.variable <span class="op">=</span> <span class="st">"regionno"</span>,
    unit.names.variable <span class="op">=</span> <span class="st">"regionname"</span>,
    time.variable <span class="op">=</span> <span class="st">"year"</span>,
    treatment.identifier <span class="op">=</span> <span class="fl">17</span>,
    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span>,
    time.optimize.ssr <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,
    time.plot <span class="op">=</span> <span class="fl">1955</span><span class="op">:</span><span class="fl">1997</span>
<span class="op">)</span></code></pre></div>
<p>find optimal weights that identifies the synthetic control for the treatment group</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span>data.prep.obj <span class="op">=</span> <span class="va">dataprep.out</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.008864606 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.02773094 1.194e-07 1.60609e-05 0.0007163836 1.486e-07 0.002423908 0.0587055 0.2651997 0.02851006 0.291276 0.007994382 0.004053188 0.009398579 0.303975 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  2.53e-08 4.63e-08 6.44e-08 2.81e-08 3.37e-08 4.844e-07 4.2e-08 4.69e-08 0.8508145 9.75e-08 3.2e-08 5.54e-08 0.1491843 4.86e-08 9.89e-08 1.162e-07</span></code></pre></div>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gaps</span> <span class="op">&lt;-</span> <span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y1plot</span> <span class="op">-</span> <span class="op">(</span><span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y0plot</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">%*%</a></span> <span class="va">synth.out</span><span class="op">$</span><span class="va">solution.w</span><span class="op">)</span>
<span class="va">gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;       1955       1956       1957 </span>
<span class="co">#&gt; 0.15023473 0.09168035 0.03716475</span></code></pre></div>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>, synth.res <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">synth.tables</span><span class="op">)</span> <span class="co"># you can pick tables to see </span>
<span class="co">#&gt; [1] "tab.pred" "tab.v"    "tab.w"    "tab.loss"</span></code></pre></div>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"real per-capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,
    Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Basque country"</span>,
               <span class="st">"synthetic Basque country"</span><span class="op">)</span>,
    Legend.position <span class="op">=</span> <span class="st">"bottomright"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-38-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"gap in real per-capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>,
    Main <span class="op">=</span> <span class="cn">NA</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-39-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>You could also run placebo tests</p>
<p><br></p>
</div>
<div id="example-4-1" class="section level3" number="20.3.4">
<h3>
<span class="header-section-number">20.3.4</span> Example 4<a class="anchor" aria-label="anchor" href="#example-4-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://cran.r-project.org/web/packages/microsynth/vignettes/introduction.html">Michael Robbins and Steven Davenport</a> who are authors of <code>MicroSynth</code> with the following improvements:</p>
<ul>
<li><p>Standardization <code>use.survey = TRUE</code> and permutation ( <code>perm = 250</code> and <code>jack = TRUE</code> ) for placebo tests</p></li>
<li><p>Omnibus statistic (set to <code>omnibus.var</code> ) for multiple outcome variables</p></li>
<li><p>incorporate multiple follow-up periods <code>end.post</code></p></li>
</ul>
<p>Notes:</p>
<ul>
<li>
<p>Both predictors and outcome will be used to match units before intervention</p>
<ul>
<li><p>Outcome variable has to be <strong>time-variant</strong></p></li>
<li><p>Predictors are <strong>time-invariant</strong></p></li>
</ul>
</li>
<li>
</ul>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">microsynth</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"seattledmi"</span><span class="op">)</span>

<span class="va">cov.var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TotalPop"</span>, <span class="st">"BLACK"</span>, <span class="st">"HISPANIC"</span>, <span class="st">"Males_1521"</span>, <span class="st">"HOUSEHOLDS"</span>, 
             <span class="st">"FAMILYHOUS"</span>, <span class="st">"FEMALE_HOU"</span>, <span class="st">"RENTER_HOU"</span>, <span class="st">"VACANT_HOU"</span><span class="op">)</span>
<span class="va">match.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"i_felony"</span>, <span class="st">"i_misdemea"</span>, <span class="st">"i_drugs"</span>, <span class="st">"any_crime"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sea1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/microsynth.html">microsynth</a></span><span class="op">(</span>
    <span class="va">seattledmi</span>,
    idvar <span class="op">=</span> <span class="st">"ID"</span>,
    timevar <span class="op">=</span> <span class="st">"time"</span>,
    intvar <span class="op">=</span> <span class="st">"Intervention"</span>,
    start.pre <span class="op">=</span> <span class="fl">1</span>,
    end.pre <span class="op">=</span> <span class="fl">12</span>,
    end.post <span class="op">=</span> <span class="fl">16</span>,
    match.out <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># outcome variable will be matched on exactly</span>
    match.covar <span class="op">=</span> <span class="va">cov.var</span>, <span class="co"># specify covariates will be matched on exactly</span>
    result.var <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># used to report results</span>
    omnibus.var <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># feature in the omnibus p-value</span>
    test <span class="op">=</span> <span class="st">"lower"</span>,
    n.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">sea1</span>
<span class="co">#&gt;  microsynth object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scope:</span>
<span class="co">#&gt;  Units:          Total: 9642 Treated: 39 Untreated: 9603</span>
<span class="co">#&gt;  Study Period(s):    Pre-period: 1 - 12  Post-period: 13 - 16</span>
<span class="co">#&gt;  Constraints:        Exact Match: 58     Minimized Distance: 0</span>
<span class="co">#&gt; Time-variant outcomes:</span>
<span class="co">#&gt;  Exact Match: i_felony, i_misdemea, i_drugs, any_crime (4)</span>
<span class="co">#&gt;  Minimized Distance: (0)</span>
<span class="co">#&gt; Time-invariant covariates:</span>
<span class="co">#&gt;  Exact Match: TotalPop, BLACK, HISPANIC, Males_1521, HOUSEHOLDS, FAMILYHOUS, FEMALE_HOU, RENTER_HOU, VACANT_HOU (9)</span>
<span class="co">#&gt;  Minimized Distance: (0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; end.post = 16</span>
<span class="co">#&gt;            Trt    Con Pct.Chng Linear.pVal Linear.Lower Linear.Upper</span>
<span class="co">#&gt; i_felony    46  68.22   -32.6%      0.0109       -50.3%        -8.4%</span>
<span class="co">#&gt; i_misdemea  45  71.80   -37.3%      0.0019       -52.8%       -16.7%</span>
<span class="co">#&gt; i_drugs     20  23.76   -15.8%      0.2559       -46.4%        32.1%</span>
<span class="co">#&gt; any_crime  788 986.44   -20.1%      0.0146       -32.9%        -4.9%</span>
<span class="co">#&gt; Omnibus     --     --       --      0.0006           --           --</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">sea1</span><span class="op">)</span>
<span class="co">#&gt; Weight Balance Table: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Targets Weighted.Control   All.scaled</span>
<span class="co">#&gt; Intercept          39        39.000239   39.0000000</span>
<span class="co">#&gt; TotalPop         2994      2994.051921 2384.7476665</span>
<span class="co">#&gt; BLACK             173       173.000957  190.5224020</span>
<span class="co">#&gt; HISPANIC          149       149.002632  159.2682016</span>
<span class="co">#&gt; Males_1521         49        49.000000   97.3746111</span>
<span class="co">#&gt; HOUSEHOLDS       1968      1968.033976 1113.5588052</span>
<span class="co">#&gt; FAMILYHOUS        519       519.010767  475.1876167</span>
<span class="co">#&gt; FEMALE_HOU        101       101.000957   81.1549471</span>
<span class="co">#&gt; RENTER_HOU       1868      1868.020338  581.9340386</span>
<span class="co">#&gt; VACANT_HOU        160       160.011485   98.4222153</span>
<span class="co">#&gt; i_felony.12        14        14.000000    4.9023024</span>
<span class="co">#&gt; i_felony.11        11        11.000239    4.6313006</span>
<span class="co">#&gt; i_felony.10         9         9.000000    3.0740510</span>
<span class="co">#&gt; i_felony.9          5         5.000000    3.2641568</span>
<span class="co">#&gt; i_felony.8         20        20.000000    4.4331052</span>
<span class="co">#&gt; i_felony.7          8         8.000000    3.7616677</span>
<span class="co">#&gt; i_felony.6         13        13.000000    3.0012446</span>
<span class="co">#&gt; i_felony.5         20        20.000718    3.1549471</span>
<span class="co">#&gt; i_felony.4         10        10.000000    4.0245800</span>
<span class="co">#&gt; i_felony.3          7         7.000000    3.3693217</span>
<span class="co">#&gt; i_felony.2         13        13.000239    3.2803360</span>
<span class="co">#&gt; i_felony.1         12        12.000000    3.4380834</span>
<span class="co">#&gt; i_misdemea.12      15        15.000239    4.2470442</span>
<span class="co">#&gt; i_misdemea.11      12        12.000000    4.6070317</span>
<span class="co">#&gt; i_misdemea.10      12        12.000000    4.0771624</span>
<span class="co">#&gt; i_misdemea.9       14        14.000000    3.7414437</span>
<span class="co">#&gt; i_misdemea.8       12        12.000000    3.9679527</span>
<span class="co">#&gt; i_misdemea.7       20        20.000000    4.2551338</span>
<span class="co">#&gt; i_misdemea.6       16        16.000479    3.5594275</span>
<span class="co">#&gt; i_misdemea.5       24        24.000000    3.5634723</span>
<span class="co">#&gt; i_misdemea.4       21        21.000239    4.3360299</span>
<span class="co">#&gt; i_misdemea.3       21        21.000000    4.3845675</span>
<span class="co">#&gt; i_misdemea.2       14        14.000000    3.5351587</span>
<span class="co">#&gt; i_misdemea.1       16        16.000000    4.1540137</span>
<span class="co">#&gt; i_drugs.12         13        13.000000    1.6543248</span>
<span class="co">#&gt; i_drugs.11          8         8.000000    1.5127567</span>
<span class="co">#&gt; i_drugs.10          3         3.000000    1.3226509</span>
<span class="co">#&gt; i_drugs.9           4         4.000000    0.9788426</span>
<span class="co">#&gt; i_drugs.8           4         4.000000    1.1123211</span>
<span class="co">#&gt; i_drugs.7          10        10.000000    1.0516490</span>
<span class="co">#&gt; i_drugs.6           4         4.000000    1.2377100</span>
<span class="co">#&gt; i_drugs.5           2         2.000000    1.2296204</span>
<span class="co">#&gt; i_drugs.4           1         1.000000    1.1244555</span>
<span class="co">#&gt; i_drugs.3           5         5.000000    1.3550093</span>
<span class="co">#&gt; i_drugs.2          12        12.000000    1.1365899</span>
<span class="co">#&gt; i_drugs.1           8         8.000239    1.3590541</span>
<span class="co">#&gt; any_crime.12      272       272.001196   65.3397635</span>
<span class="co">#&gt; any_crime.11      227       227.001675   64.2395769</span>
<span class="co">#&gt; any_crime.10      183       183.000957   55.6929060</span>
<span class="co">#&gt; any_crime.9       176       176.000479   53.2377100</span>
<span class="co">#&gt; any_crime.8       228       228.000479   55.8142502</span>
<span class="co">#&gt; any_crime.7       246       246.002393   55.8061605</span>
<span class="co">#&gt; any_crime.6       200       200.000957   52.8291848</span>
<span class="co">#&gt; any_crime.5       270       270.001436   50.6530803</span>
<span class="co">#&gt; any_crime.4       250       250.000957   57.2946484</span>
<span class="co">#&gt; any_crime.3       236       236.000957   58.8680772</span>
<span class="co">#&gt; any_crime.2       250       250.001196   51.5429371</span>
<span class="co">#&gt; any_crime.1       242       242.000957   55.1144991</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; end.post = 16</span>
<span class="co">#&gt;            Trt    Con Pct.Chng Linear.pVal Linear.Lower Linear.Upper</span>
<span class="co">#&gt; i_felony    46  68.22   -32.6%      0.0109       -50.3%        -8.4%</span>
<span class="co">#&gt; i_misdemea  45  71.80   -37.3%      0.0019       -52.8%       -16.7%</span>
<span class="co">#&gt; i_drugs     20  23.76   -15.8%      0.2559       -46.4%        32.1%</span>
<span class="co">#&gt; any_crime  788 986.44   -20.1%      0.0146       -32.9%        -4.9%</span>
<span class="co">#&gt; Omnibus     --     --       --      0.0006           --           --</span></code></pre></div>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/plot_microsynth.html">plot_microsynth</a></span><span class="op">(</span><span class="va">sea1</span><span class="op">)</span></code></pre></div>
<p><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-42-1.png" width="90%" style="display: block; margin: auto;"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-42-2.png" width="90%" style="display: block; margin: auto;"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-42-3.png" width="90%" style="display: block; margin: auto;"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-42-4.png" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sea2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/microsynth.html">microsynth</a></span><span class="op">(</span><span class="va">seattledmi</span>, 
                   idvar<span class="op">=</span><span class="st">"ID"</span>, timevar<span class="op">=</span><span class="st">"time"</span>, intvar<span class="op">=</span><span class="st">"Intervention"</span>, 
                   start.pre<span class="op">=</span><span class="fl">1</span>, end.pre<span class="op">=</span><span class="fl">12</span>, end.post<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">16</span><span class="op">)</span>,
                   match.out<span class="op">=</span><span class="va">match.out</span>, match.covar<span class="op">=</span><span class="va">cov.var</span>, 
                   result.var<span class="op">=</span><span class="va">match.out</span>, omnibus.var<span class="op">=</span><span class="va">match.out</span>, 
                   test<span class="op">=</span><span class="st">"lower"</span>, 
                   perm<span class="op">=</span><span class="fl">250</span>, jack<span class="op">=</span><span class="cn">TRUE</span>,
                   n.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="selection-on-observables" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> Selection on observables<a class="anchor" aria-label="anchor" href="#selection-on-observables"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Example</strong></p>
<p><span class="citation"><a href="references.html#ref-aaronson2007" role="doc-biblioref">Aaronson, Barrow, and Sander</a> (<a href="references.html#ref-aaronson2007" role="doc-biblioref">2007</a>)</span></p>
<p>Do teachers qualifications (causally) affect student test scores?</p>
<p>Step 1:</p>
<p><span class="math display">\[
Y_{ijt} = \delta_0 + Y_{ij(t-1)} \delta_1 + X_{it} \delta_2 + Z_{jt} \delta_3 + \epsilon_{ijt}
\]</span></p>
<p>There can always be another variable</p>
<p>Any observable sorting is imperfect</p>
<p>Step 2:</p>
<p><span class="math display">\[
Y_{ijst} = \alpha_0 + Y_{ij(t-1)}\alpha_1 + X_{it} \alpha_2 + Z_{jt} \alpha_3 + \gamma_s + u_{isjt}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\delta_3 &gt;0\)</span></p></li>
<li><p><span class="math inline">\(\delta_3 &gt; \alpha_3\)</span></p></li>
<li><p><span class="math inline">\(\gamma_s\)</span> = school fixed effect</p></li>
</ul>
<p>Sorting is less within school. Hence, we can introduce the school fixed effect</p>
<p>Step 3:</p>
<p>Find schools that look like they are putting students in class randomly (or as good as random) + we run step 2</p>
<p><span class="math display">\[
Y_{isjt} = Y_{isj(t-1)} \lambda + X_{it} \alpha_1 +Z_{jt} \alpha_{21}+ (Z_{jt} \times D_i)\alpha_{22}+ \gamma_5 + u_{isjt}
\]</span></p>
<ul>
<li><p><span class="math inline">\(D_{it}\)</span> is an element of <span class="math inline">\(X_{it}\)</span></p></li>
<li><p><span class="math inline">\(Z_{it}\)</span> = teacher experience</p></li>
</ul>
<p><span class="math display">\[
D_{it}=
\begin{cases}
1 &amp; \text{ if high poverty} \\
0 &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math inline">\(H_0:\)</span> <span class="math inline">\(\alpha_{22} = 0\)</span> test for effect heterogeneity whether the effect of teacher experience (<span class="math inline">\(Z_{jt}\)</span>) is different</p>
<ul>
<li><p>For low poverty is <span class="math inline">\(\alpha_{21}\)</span></p></li>
<li><p>For high poverty effect is <span class="math inline">\(\alpha_{21} + \alpha_{22}\)</span></p></li>
</ul>
<p><br></p>
</div>
<div id="matching-methods" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> Matching Methods<a class="anchor" aria-label="anchor" href="#matching-methods"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Motivation</strong></p>
<p>Effect of college quality on earnings</p>
<p>They ultimately estimate the treatment effect on the treated of attending a top (high ACT) versus bottom (low ACT) quartile college</p>
<p>Matching is <a href="quasi-experimental.html#selection-on-observables">Selection on observables</a> and only works if you have good observables.</p>
<p>Relative to <a href="linear-regression.html#ordinary-least-squares">OLS</a></p>
<ol style="list-style-type: decimal">
<li>Matching makes the <strong>common support</strong> explicit (and changes default from “ignore” to “enforce”)</li>
<li>Relaxes linear function form. Thus, less parametric.</li>
</ol>
<p>It also helps if you have high ratio of controls to treatments.</p>
<p><br></p>
<p>For detail summary <span class="citation">(<a href="references.html#ref-Stuart_2010" role="doc-biblioref">Stuart 2010</a>)</span></p>
<p>Matching is defined as “any method that aims to equate (or”balance”) the distribution of covariates in the treated and control groups.” <span class="citation">(<a href="references.html#ref-Stuart_2010" role="doc-biblioref">Stuart 2010, 1</a>)</span></p>
<p>Equivalently, matching is a selection on observables identifications strategy.</p>
<p><strong>If you think your OLS estimate is biased, a matching estimate (almost surely) is too.</strong></p>
<p>Unconditionally, consider</p>
<p><span class="math display">\[
E(Y_i^T | T) - E(Y_i^C |C) + E(Y_i^C | T) - E(Y_i^C | T) \\
= E(Y_i^T - Y_i^C | T) + [E(Y_i^C | T) - E(Y_i^C |C)] \\
= E(Y_i^T - Y_i^C | T) + \text{selection bias}
\]</span></p>
<p>where <span class="math inline">\(E(Y_i^T - Y_i^C | T)\)</span> is the causal inference that we want to know.</p>
<p>Randomization eliminates the selection bias.</p>
<p>If we don’t have randomization, then <span class="math inline">\(E(Y_i^C | T) \neq E(Y_i^C |C)\)</span></p>
<p>Matching tries to do selection on observables <span class="math inline">\(E(Y_i^C | X, T) = E(Y_i^C|X, C)\)</span></p>
<p><a href="quasi-experimental.html#propensity-scores">Propensity Scores</a> basically do <span class="math inline">\(E(Y_i^C| P(X) , T) = E(Y_i^C | P(X), C)\)</span></p>
<p><strong>Matching standard errors will exceed OLS standard errors</strong></p>
<p>The treatment should have larger predictive power than the control because you use treatment to pick control (not control to pick treatment).</p>
<p>The average treatment effect (ATE) is</p>
<p><span class="math display">\[
\frac{1}{N_T} \sum_{i=1}^{N_T} (Y_i^T - \frac{1}{N_{C_T}} \sum_{i=1}^{N_{C_T}} Y_i^C)
\]</span></p>
<p>Since there is no closed-form solution for the standard error of the average treatment effect, we have to use bootstrapping to get standard error.</p>
<p><br></p>
<p>Professor Gary King advocates instead of using the word “matching,” we should use “<strong>pruning</strong>” (i.e., deleting observations). It is a preprocessing step where it prunes nonmatches to make control variables less important in your analysis.</p>
<p>Without Matching</p>
<ul>
<li>
<strong>Imbalance data</strong> leads to <strong>model dependence</strong> lead to a lot of <strong>researcher discretion</strong> leads to <strong>bias</strong>
</li>
</ul>
<p>With Matching</p>
<ul>
<li>We have balance data which essentially erase human discretion</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>Table @ref(tab:Gary King - International Methods Colloquium talk 2015)</caption>
<thead><tr class="header">
<th>Balance Covariates</th>
<th>Complete Randomization</th>
<th>Fully Exact</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Observed</td>
<td>On average</td>
<td>Exact</td>
</tr>
<tr class="even">
<td>Unobserved</td>
<td>On average</td>
<td>On average</td>
</tr>
</tbody>
</table></div>
<p>Fully blocked is superior on</p>
<ul>
<li><p>imbalance</p></li>
<li><p>model dependence</p></li>
<li><p>power</p></li>
<li><p>efficiency</p></li>
<li><p>bias</p></li>
<li><p>research costs</p></li>
<li><p>robustness</p></li>
</ul>
<p>Matching is used when</p>
<ul>
<li><p>Outcomes are not available to select subjects for follow-up</p></li>
<li><p>Outcomes are available to improve precision of the estimate (i.e., reduce bias)</p></li>
</ul>
<p>Hence, we can only observe one outcome of a unit (either treated or control), we can think of this problem as missing data as well. Thus, this section is closely related to <a href="imputation-missing-data.html#imputation-missing-data">Imputation (Missing Data)</a></p>
<p>In observational studies, we cannot randomize the treatment effect. Subjects select their own treatments, which could introduce selection bias (i.e., systematic differences between group differences that confound the effects of response variable differences).</p>
<p><br></p>
<p>Matching is used to</p>
<ul>
<li><p>reduce model dependence</p></li>
<li><p>diagnose balance in the dataset</p></li>
</ul>
<p>Assumptions of matching:</p>
<ol style="list-style-type: decimal">
<li>
<p>treatment assignment is independent of potential outcomes given the covariates</p>
<ul>
<li><p><span class="math inline">\(T \perp (Y(0),Y(1))|X\)</span></p></li>
<li><p>known as ignorability, or ignorable, no hidden bias, or unconfounded.</p></li>
<li>
<p>You typically satisfy this assumption when unobserved covariates correlated with observed covariates.</p>
<ul>
<li>But when unobserved covariates are unrelated to the observed covariates, you can use sensitivity analysis to check your result, or use “design sensitivity” <span class="citation">(<a href="references.html#ref-Heller_2009" role="doc-biblioref">Heller, Rosenbaum, and Small 2009</a>)</span>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>positive probability of receiving treatment for all X</p>
<ul>
<li><span class="math inline">\(0 &lt; P(T=1|X)&lt;1 \forall X\)</span></li>
</ul>
</li>
<li>
<p>Stable Unit Treatment value Assumption (SUTVA)</p>
<ul>
<li>
<p>Outcomes of A are not affected by treatment of B.</p>
<ul>
<li>Very hard in cases where there is “spillover” effects (interactions between control and treatment). To combat, we need to reduce interactions.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Generalization</p>
<ul>
<li><p><span class="math inline">\(P_t\)</span>: treated population -&gt; <span class="math inline">\(N_t\)</span>: random sample from treated</p></li>
<li><p><span class="math inline">\(P_c\)</span>: control population -&gt; <span class="math inline">\(N_c\)</span>: random sample from control</p></li>
<li><p><span class="math inline">\(\mu_i\)</span> = means ; <span class="math inline">\(\Sigma_i\)</span> = variance covariance matrix of the <span class="math inline">\(p\)</span> covariates in group i (<span class="math inline">\(i = t,c\)</span>)</p></li>
<li><p><span class="math inline">\(X_j\)</span> = <span class="math inline">\(p\)</span> covariates of individual <span class="math inline">\(j\)</span></p></li>
<li><p><span class="math inline">\(T_j\)</span> = treatment assignment</p></li>
<li><p><span class="math inline">\(Y_j\)</span> = observed outcome</p></li>
<li><p>Assume: <span class="math inline">\(N_t &lt; N_c\)</span></p></li>
<li>
<p>Treatment effect is <span class="math inline">\(\tau(x) = R_1(x) - R_0(x)\)</span> where</p>
<ul>
<li><p><span class="math inline">\(R_1(x) = E(Y(1)|X)\)</span></p></li>
<li><p><span class="math inline">\(R_0(x) = E(Y(0)|X)\)</span></p></li>
</ul>
</li>
<li>
<p>Assume: parallel trends hence <span class="math inline">\(\tau(x) = \tau \forall x\)</span></p>
<ul>
<li>If the parallel trends are not assumed, an average effect can be estimated.</li>
</ul>
</li>
<li>
<p>Common estimands:</p>
<ul>
<li><p>Average effect of the treatment on the treated (ATT): effects on treatment group</p></li>
<li><p>Average treatment effect (ATE): effect on both treatment and control</p></li>
</ul>
</li>
</ul>
<p>Steps:</p>
<ol style="list-style-type: decimal">
<li>
<p>Define “closeness”: decide distance measure to be used</p>
<ol style="list-style-type: decimal">
<li>
<p>Which variables to include:</p>
<ol style="list-style-type: decimal">
<li>
<p>Ignorability (no unobserved differences between treatment and control)</p>
<ol style="list-style-type: decimal">
<li><p>Since cost of including unrelated variables is small, you should include as many as possible (unless sample size/power doesn’t allow you to because of increased variance)</p></li>
<li><p>Do not include variables that were affected by the treatment.</p></li>
<li><p>Note: if a matching variable (i.e., heavy drug users) is highly correlated to the outcome variable (i.e., heavy drinkers) , you will be better to exclude it in the matching set.</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Which distance measures: more below</p></li>
</ol>
</li>
<li>
<p>Matching methods</p>
<ol style="list-style-type: decimal">
<li>
<p>Nearest neighbor matching</p>
<ol style="list-style-type: decimal">
<li><p>Simple (greedy) matching: performs poorly when there is competition for controls.</p></li>
<li><p>Optimal matching: considers global distance measure</p></li>
<li><p>Ratio matching: to combat increase bias and reduced variation when you have k:1 matching, one can use approximations by Rubin and Thomas (1996).</p></li>
<li><p>With or without replacement: with replacement is typically better, but one needs to account for dependent in the matched sample when doing later analysis (can use frequency weights to combat).</p></li>
</ol>
</li>
<li>
<p>Subclassification, Full Matching and Weighting</p>
<p>Neareast neighbor matching assign is 0 (control) or 1 (treated), while these methods use weights between 0 and 1.</p>
<ol style="list-style-type: decimal">
<li><p>Subclassification: distribution into multiple subclass (e.g., 5-10)</p></li>
<li><p>Full matching: optimal ly minimize the average of the distances between each treated unit and each control unit within each matched set.</p></li>
<li>
<p>Weighting adjustments: weighting technique uses propensity scores to estimate ATE. If the weights are extreme, the variance can be large not due to the underlying probabilities, but due to the estimation procure. To combat this, use (1) weight trimming, or (2) doubly -robust methods when propensity scores are used for weighing or matching.</p>
<ol style="list-style-type: decimal">
<li><p>Inverse probability of treatment weighting (IPTW) <span class="math inline">\(w_i = \frac{T_i}{\hat{e}_i} + \frac{1 - T_i}{1 - \hat{e}_i}\)</span></p></li>
<li><p>Odds <span class="math inline">\(w_i = T_i + (1-T_i) \frac{\hat{e}_i}{1-\hat{e}_i}\)</span></p></li>
<li><p>Kernel weighting (e.g., in economics) averages over multiple units in the control group.</p></li>
</ol>
</li>
</ol>
</li>
<li>
<p>Assessing Common Support</p>
<ul>
<li>common support means overlapping of the propensity score distributions in the treatment and control groups. Propensity score is used to discard control units from the common support. Alternatively, convex hull of the covariates in the multi-dimensional space.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Assessing the quality of matched samples (Diagnose)</p>
<ul>
<li>
<p>Balance = similarity of the empirical distribution of the full set of covariates in the matched treated and control groups. Equivalently, treatment is unrelated to the covariates</p>
<ul>
<li>
<span class="math inline">\(\tilde{p}(X|T=1) = \tilde{p}(X|T=0)\)</span> where <span class="math inline">\(\tilde{p}\)</span> is the empirical distribution.</li>
</ul>
</li>
<li>
<p>Numerical Diagnostics</p>
<ol style="list-style-type: decimal">
<li><p>standardized difference in means of each covariate (most common), also known as”standardized bias”, “standardized difference in means.”</p></li>
<li><p>standardized difference of means of the propensity score (should be &lt; 0.25) <span class="citation">(<a href="references.html#ref-Rubin_2001" role="doc-biblioref">Rubin 2001</a>)</span></p></li>
<li><p>ratio of the variances of the propensity score in the treated and control groups (should be between 0.5 and 2). <span class="citation">(<a href="references.html#ref-Rubin_2001" role="doc-biblioref">Rubin 2001</a>)</span></p></li>
<li>
<p>For each covariate, the ratio fo the variance of the residuals orthogonal to the propensity score in the treated and control groups.</p>
<p>Note: can’t use hypothesis tests or p-values because of (1) in-sample property (not population), (2) conflation of changes in balance with changes in statistical power.</p>
</li>
</ol>
</li>
<li>
<p>Graphical Diagnostics</p>
<ul>
<li><p>QQ plots</p></li>
<li><p>Empirical Distribution Plot</p></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Estimate the treatment effect</p>
<ol style="list-style-type: decimal">
<li>
<p>After k:1</p>
<ol style="list-style-type: decimal">
<li>Need to account for weights when use matching with replacement.</li>
</ol>
</li>
<li>
<p>After Subclassification and Full Matching</p>
<ol style="list-style-type: decimal">
<li><p>weighting the subclass estimates by the number of treated units in each subclass for ATT</p></li>
<li><p>WEighting by the overall number of individual in each subclass for ATE.</p></li>
</ol>
</li>
<li><p>Variance estimation: should incorporate uncertainties in both the matching procedure (step 3) and the estimation procedure (step 4)</p></li>
</ol>
</li>
</ol>
<p><br></p>
<p>Notes:</p>
<ul>
<li><p>With missing data, use generalized boosted models, or multiple imputation <span class="citation">(<a href="references.html#ref-Qu_2009" role="doc-biblioref">Qu and Lipkovich 2009</a>)</span></p></li>
<li>
<p>Violation of ignorable treatment assignment (i.e., unobservables affect treatment and outcome). control by</p>
<ul>
<li><p>measure pre-treatment measure of the outcome variable</p></li>
<li><p>find the difference in outcomes between multiple control groups. If there is a significant difference, there is evidence for violation.</p></li>
<li><p>find the range of correlations between unobservables and both treatment assignment and outcome to nullify the significant effect.</p></li>
</ul>
</li>
<li>
<p>Choosing between methods</p>
<ul>
<li><p>smallest standardized difference of mean across the largest number of covariates</p></li>
<li><p>minimize the standardized difference of means of a few particularly prognostic covariates</p></li>
<li><p>fest number of large standardized difference of means (&gt; 0.25)</p></li>
<li><p><span class="citation">(<a href="references.html#ref-Diamond_2013" role="doc-biblioref">Diamond and Sekhon 2013</a>)</span> automates the process</p></li>
</ul>
</li>
<li>
<p>In practice</p>
<ul>
<li><p>If ATE, ask if there is enough overlap of the treated and control groups’ propensity score to estimate ATE, if not use ATT instead</p></li>
<li><p>If ATT, ask if there are controls across the full range of the treated group</p></li>
</ul>
</li>
<li>
<p>Choose matching method</p>
<ul>
<li><p>If ATE, use IPTW or full matching</p></li>
<li><p>If ATT, and more controls than treated (at least 3 times), k:1 nearest neighbor without replacement</p></li>
<li><p>If ATT, and few controls , use subclassification, full matching, and weighting by the odds</p></li>
</ul>
</li>
<li>
<p>Diagnostic</p>
<ul>
<li><p>If balance, use regression on matched samples</p></li>
<li><p>If imbalance on few covariates, treat them with Mahalanobis</p></li>
<li><p>If imbalance on many covariates, try k:1 matching with replacement</p></li>
</ul>
</li>
</ul>
<p>Ways to define the distance <span class="math inline">\(D_{ij}\)</span></p>
<ol style="list-style-type: decimal">
<li>Exact</li>
</ol>
<p><span class="math display">\[
D_{ij} = 
\begin{cases}
0, \text{ if } X_i = X_j, \\
\infty, \text{ if } X_i \neq X_j
\end{cases}
\]</span></p>
<p>An advanced is <a href="quasi-experimental.html#coarsened-exact-matching">Coarsened Exact Matching</a></p>
<ol start="2" style="list-style-type: decimal">
<li>Mahalanobis</li>
</ol>
<p><span class="math display">\[
D_{ij} = (X_i - X_j)'\Sigma^{-1} (X_i - X_j)
\]</span></p>
<p>where</p>
<p><span class="math inline">\(\Sigma\)</span> = variance covariance matrix of X in the</p>
<ul>
<li><p>control group if ATT is interested</p></li>
<li><p>polled treatment and control groups if ATE is interested</p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Propensity score:</li>
</ol>
<p><span class="math display">\[
D_{ij} = |e_i - e_j|
\]</span></p>
<p>where <span class="math inline">\(e_k\)</span> = the propensity score for individual k</p>
<p>An advanced is Prognosis score <span class="citation">(<a href="references.html#ref-Hansen_2008" role="doc-biblioref">Hansen 2008</a>)</span>, but you have to know (i.e., specify) the relationship between the covariates and outcome.</p>
<ol start="4" style="list-style-type: decimal">
<li>Linear propensity score</li>
</ol>
<p><span class="math display">\[
D_{ij} = |logit(e_i) - logit(e_j)|
\]</span></p>
<p>The exact and Mahalanobis are not good in high dimensional or non normally distributed X’s cases.</p>
<p>We can combine Mahalanobis matching with propensity score calipers <span class="citation">(<a href="references.html#ref-Rubin_2000" role="doc-biblioref">Rubin and Thomas 2000</a>)</span></p>
<p>Other advanced methods for longitudinal settings</p>
<ul>
<li><p>marginal structural models <span class="citation">(<a href="references.html#ref-Robins_2000" role="doc-biblioref">Robins, Hernán, and Brumback 2000</a>)</span></p></li>
<li><p>balanced risk set matching <span class="citation">(<a href="references.html#ref-Li_2001" role="doc-biblioref">Li, Propert, and Rosenbaum 2001</a>)</span></p></li>
</ul>
<p><br>
Most matching methods are based on (ex-post)</p>
<ul>
<li><p>propensity score</p></li>
<li><p>distance metric</p></li>
<li><p>covariates</p></li>
</ul>
<p>Packages</p>
<ul>
<li><p><code>cem</code> Coarsened exact matching</p></li>
<li><p><code>Matching</code> Multivariate and propensity score matching with balance optimization</p></li>
<li><p><code>MatchIt</code> Nonparametric preprocessing for parametric causal inference. Have nearest neighbor, Mahalanobis, caliper, exact, full, optimal, subclassification</p></li>
<li><p><code>MatchingFrontier</code> optimize balance and sample size <span class="citation">(<a href="references.html#ref-King_2016" role="doc-biblioref">G. King, Lucas, and Nielsen 2016</a>)</span></p></li>
<li><p><code>optmatch</code>optimal matching with variable ratio, optimal and full matching</p></li>
<li><p><code>PSAgraphics</code> Propensity score graphics</p></li>
<li><p><code>rbounds</code> sensitivity analysis with matched data, examine ignorable treatment assignment assumption</p></li>
<li><p><code>twang</code> weighting and analysis of non-equivalent groups</p></li>
<li><p><code>CBPS</code> covariate balancing propensity score. Can also be used in the longitudinal setting with marginal structural models.</p></li>
<li><p><code>PanelMatch</code> based on <a href="https://imai.fas.harvard.edu/research/files/tscs.pdf">Imai, Kim, and Wang (2018)</a></p></li>
</ul>
<p><br></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="62%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Matching</th>
<th>Regression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Not as sensitive to the functional form of the covariates</td>
<td>can estimate the effect of a continuous treatment</td>
</tr>
<tr class="even">
<td>
<p>Easier to asses whether it’s working</p>
<p>Easier to explain</p>
<p>allows a nice visualization of an evaluation</p>
</td>
<td>estimate the effect of all the variables (not just the treatment)</td>
</tr>
<tr class="odd">
<td>If you treatment is fairly rare, you may have a lot of control observations that are obviously no comparable</td>
<td>can estimate interactions of treatment with covariates</td>
</tr>
<tr class="even">
<td>Less parametric</td>
<td>More parametric</td>
</tr>
<tr class="odd">
<td>Enforces common support (i.e., space where treatment and control have the same characteristics)</td>
<td></td>
</tr>
</tbody>
</table></div>
<p>However, the problem of <strong>omitted variables</strong> (i.e., those that affect both the outcome and whether observation was treated) - unobserved confounders is still present in matching methods.</p>
<p><br></p>
<p>Difference between matching and regression following Jorn-Ste§en Pischke’s <a href="https://econ.lse.ac.uk/staff/spischke/ec533/regression%20vs%20matching.pdf">lecture</a></p>
<p>Suppose we want to estimate the effect of treatment on the treated</p>
<p><span class="math display">\[
\begin{aligned}
\delta_{TOT} &amp;= E[ Y_{1i} - Y_{0i} | D_i = 1 ] \\
&amp;= E\{E[Y_{1i} | X_i, D_i = 1] - E[Y_{0i}|X_i, D_i = 1]|D_i = 1\} &amp;&amp; \text{law of itereated expectations}
\end{aligned}
\]</span></p>
<p>Under conditional independence</p>
<p><span class="math display">\[
E[Y_{0i} |X_i , D_i = 0 ] = E[Y_{0i} | X_i, D_i = 1]
\]</span></p>
<p>then</p>
<p><span class="math display">\[
\begin{aligned}
\delta_{TOT} &amp;= E \{ E[ Y_{1i} | X_i, D_i = 1] - E[ Y_{0i}|X_i, D_i = 0 ]|D_i = 1\} \\
&amp;= E\{E[y_i | X_i, D_i = 1] - E[y_i |X_i, D_i = 0 ] | D_i = 1\} \\
&amp;= E[\delta_X |D_i = 1]
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\delta_X\)</span> is an X-specific difference in means at covariate value <span class="math inline">\(X_i\)</span></p>
<p>When <span class="math inline">\(X_i\)</span> is discrete, the matching estimand is</p>
<p><span class="math display">\[
\delta_M = \sum_x \delta_x P(X_i = x |D_i = 1)
\]</span></p>
<p>where <span class="math inline">\(P(X_i = x |D_i = 1)\)</span> is the probability mass function for <span class="math inline">\(X_i\)</span> given <span class="math inline">\(D_i = 1\)</span></p>
<p>According to Bayes rule,</p>
<p><span class="math display">\[
P(X_i = x | D_i = 1) = \frac{P(D_i = 1 | X_i = x) \times P(X_i = x)}{P(D_i = 1)}
\]</span></p>
<p>hence,</p>
<p><span class="math display">\[
\begin{aligned}
\delta_M &amp;= \frac{\sum_x \delta_x P (D_i = 1 | X_i = x) P (X_i = x)}{\sum_x P(D_i = 1 |X_i = x)P(X_i = x)} \\
&amp;= \sum_x \delta_x \frac{ P (D_i = 1 | X_i = x) P (X_i = x)}{\sum_x P(D_i = 1 |X_i = x)P(X_i = x)}
\end{aligned}
\]</span></p>
<p>On the other hand, suppose we have regression</p>
<p><span class="math display">\[
y_i = \sum_x d_{ix} \beta_x + \delta_R D_i + \epsilon_i
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(d_{ix}\)</span> = dummy that indicates <span class="math inline">\(X_i = x\)</span></p></li>
<li><p><span class="math inline">\(\beta_x\)</span> = regression-effect for <span class="math inline">\(X_i = x\)</span></p></li>
<li><p><span class="math inline">\(\delta_R\)</span> = regression estimand where</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\delta_R &amp;= \frac{\sum_x \delta_x [P(D_i = 1 | X_i = x) (1 - P(D_i = 1 | X_i = x))]P(X_i = x)}{\sum_x [P(D_i = 1| X_i = x)(1 - P(D_i = 1 | X_i = x))]P(X_i = x)} \\
&amp;= \sum_x \delta_x \frac{[P(D_i = 1 | X_i = x) (1 - P(D_i = 1 | X_i = x))]P(X_i = x)}{\sum_x [P(D_i = 1| X_i = x)(1 - P(D_i = 1 | X_i = x))]P(X_i = x)}
\end{aligned}
\]</span></p>
<p>the difference between the regression and matching estimand is the weights they use to combine the covariate specific treatment effect <span class="math inline">\(\delta_x\)</span></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="2%">
<col width="17%">
<col width="44%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>uses weights which depend on</th>
<th>interpretation</th>
<th>makes sense because</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Matching</td>
<td>
<p><span class="math inline">\(P(D_i = 1|X_i = x)\)</span></p>
<p>the fraction of treated observations in a covariate cell (i.e., or the mean of <span class="math inline">\(D_i\)</span>)</p>
</td>
<td>This is larger in cells with many treated observations.</td>
<td>we want the effect of treatment on the treated</td>
</tr>
<tr class="even">
<td>Regression</td>
<td>
<p><span class="math inline">\(P(D_i = 1 |X_i = x)(1 - P(D_i = 1| X_i ))\)</span></p>
<p>the variance of <span class="math inline">\(D_i\)</span> in the covariate cell</p>
</td>
<td>This weight is largest in cells where there are half treated and half untreated observations. (this is the reason why we want to treat our sample so it is balanced, before running regular regression model, as mentioned above).</td>
<td>these cells will produce the lowest variance estimates of <span class="math inline">\(\delta_x\)</span>. If all the <span class="math inline">\(\delta_x\)</span> are the same, the most efficient estimand uses the lowest variance cells most heavily.</td>
</tr>
</tbody>
</table></div>
<p>The goal of matching is to produce covariate balance (i.e., distributions of covariates in treatment and control groups are approximately similar as they would be in a successful randomized experiment).</p>
<div id="matchit" class="section level3" number="20.5.1">
<h3>
<span class="header-section-number">20.5.1</span> MatchIt<a class="anchor" aria-label="anchor" href="#matchit"><i class="fas fa-link"></i></a>
</h3>
<p>Procedure typically involves (proposed by <a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html">Noah Freifer</a> using <code>MatchIt</code>)</p>
<ol style="list-style-type: decimal">
<li>planning</li>
<li>matching</li>
<li>checking (balance)</li>
<li>estimating the treatment effect</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/">MatchIt</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></code></pre></div>
<p>examine <code>treat</code> on <code>re78</code></p>
<ol style="list-style-type: decimal">
<li>Planning</li>
</ol>
<ul>
<li><p>select type of effect to be estimated (e.g., mediation effect, conditional effect, marginal effect)</p></li>
<li><p>select the target population</p></li>
<li><p>select variables to match/balance <span class="citation">(<a href="references.html#ref-Austin_2011" role="doc-biblioref">Austin 2011</a>)</span> <span class="citation">(<a href="references.html#ref-VanderWeele_2019" role="doc-biblioref">VanderWeele 2019</a>)</span></p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Check Initial Imbalance</li>
</ol>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># No matching; constructing a pre-match matchit object</span>
<span class="va">m.out0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span>
    <span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span>
        <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,
    data <span class="op">=</span> <span class="va">lalonde</span>,
    method <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># assess balance before matching</span>
    distance <span class="op">=</span> <span class="st">"glm"</span> <span class="co"># logistic regression</span>
<span class="op">)</span>

<span class="co"># Checking balance prior to matching</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">m.out0</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; matchit(formula = treat ~ age + educ + race + married + nodegree + </span>
<span class="co">#&gt;     re74 + re75, data = lalonde, method = NULL, distance = "glm")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary of Balance for All Data:</span>
<span class="co">#&gt;            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="co">#&gt; distance          0.5774        0.1822          1.7941     0.9211    0.3774</span>
<span class="co">#&gt; age              25.8162       28.0303         -0.3094     0.4400    0.0813</span>
<span class="co">#&gt; educ             10.3459       10.2354          0.0550     0.4959    0.0347</span>
<span class="co">#&gt; raceblack         0.8432        0.2028          1.7615          .    0.6404</span>
<span class="co">#&gt; racehispan        0.0595        0.1422         -0.3498          .    0.0827</span>
<span class="co">#&gt; racewhite         0.0973        0.6550         -1.8819          .    0.5577</span>
<span class="co">#&gt; married           0.1892        0.5128         -0.8263          .    0.3236</span>
<span class="co">#&gt; nodegree          0.7081        0.5967          0.2450          .    0.1114</span>
<span class="co">#&gt; re74           2095.5737     5619.2365         -0.7211     0.5181    0.2248</span>
<span class="co">#&gt; re75           1532.0553     2466.4844         -0.2903     0.9563    0.1342</span>
<span class="co">#&gt;            eCDF Max</span>
<span class="co">#&gt; distance     0.6444</span>
<span class="co">#&gt; age          0.1577</span>
<span class="co">#&gt; educ         0.1114</span>
<span class="co">#&gt; raceblack    0.6404</span>
<span class="co">#&gt; racehispan   0.0827</span>
<span class="co">#&gt; racewhite    0.5577</span>
<span class="co">#&gt; married      0.3236</span>
<span class="co">#&gt; nodegree     0.1114</span>
<span class="co">#&gt; re74         0.4470</span>
<span class="co">#&gt; re75         0.2876</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Sizes:</span>
<span class="co">#&gt;           Control Treated</span>
<span class="co">#&gt; All           429     185</span>
<span class="co">#&gt; Matched       429     185</span>
<span class="co">#&gt; Unmatched       0       0</span>
<span class="co">#&gt; Discarded       0       0</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Matching</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 1:1 NN PS matching w/o replacement</span>
<span class="va">m.out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"nearest"</span>, distance <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span>
<span class="va">m.out1</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Variable ratio 1:1 nearest neighbor matching without replacement</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with logistic regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 370 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Check balance</li>
</ol>
<p>Sometimes you have to make trade-off between balance and sample size.</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Checking balance after NN matching</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">m.out1</span>, un <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; matchit(formula = treat ~ age + educ + race + married + nodegree + </span>
<span class="co">#&gt;     re74 + re75, data = lalonde, method = "nearest", distance = "glm")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary of Balance for Matched Data:</span>
<span class="co">#&gt;            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="co">#&gt; distance          0.5774        0.3629          0.9739     0.7566    0.1321</span>
<span class="co">#&gt; age              25.8162       25.3027          0.0718     0.4568    0.0847</span>
<span class="co">#&gt; educ             10.3459       10.6054         -0.1290     0.5721    0.0239</span>
<span class="co">#&gt; raceblack         0.8432        0.4703          1.0259          .    0.3730</span>
<span class="co">#&gt; racehispan        0.0595        0.2162         -0.6629          .    0.1568</span>
<span class="co">#&gt; racewhite         0.0973        0.3135         -0.7296          .    0.2162</span>
<span class="co">#&gt; married           0.1892        0.2108         -0.0552          .    0.0216</span>
<span class="co">#&gt; nodegree          0.7081        0.6378          0.1546          .    0.0703</span>
<span class="co">#&gt; re74           2095.5737     2342.1076         -0.0505     1.3289    0.0469</span>
<span class="co">#&gt; re75           1532.0553     1614.7451         -0.0257     1.4956    0.0452</span>
<span class="co">#&gt;            eCDF Max Std. Pair Dist.</span>
<span class="co">#&gt; distance     0.4216          0.9740</span>
<span class="co">#&gt; age          0.2541          1.3938</span>
<span class="co">#&gt; educ         0.0757          1.2474</span>
<span class="co">#&gt; raceblack    0.3730          1.0259</span>
<span class="co">#&gt; racehispan   0.1568          1.0743</span>
<span class="co">#&gt; racewhite    0.2162          0.8390</span>
<span class="co">#&gt; married      0.0216          0.8281</span>
<span class="co">#&gt; nodegree     0.0703          1.0106</span>
<span class="co">#&gt; re74         0.2757          0.7965</span>
<span class="co">#&gt; re75         0.2054          0.7381</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Sizes:</span>
<span class="co">#&gt;           Control Treated</span>
<span class="co">#&gt; All           429     185</span>
<span class="co">#&gt; Matched       185     185</span>
<span class="co">#&gt; Unmatched     244       0</span>
<span class="co">#&gt; Discarded       0       0</span>
<span class="co"># examine visually </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m.out1</span>, type <span class="op">=</span> <span class="st">"jitter"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-47-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m.out1</span>, type <span class="op">=</span> <span class="st">"qq"</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span>,
     which.xs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"married"</span>, <span class="st">"re75"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-47-2.png" width="90%" style="display: block; margin: auto;"></div>
<p>Try Full Match (i.e., every treated matches with one control, and every control with one treated).</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Full matching on a probit PS</span>
<span class="va">m.out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"full"</span>, distance <span class="op">=</span> <span class="st">"glm"</span>, link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span>
<span class="va">m.out2</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Optimal full matching</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with probit regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 614 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<p>Checking balance again</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Checking balance after full matching</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">m.out2</span>, un <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; matchit(formula = treat ~ age + educ + race + married + nodegree + </span>
<span class="co">#&gt;     re74 + re75, data = lalonde, method = "full", distance = "glm", </span>
<span class="co">#&gt;     link = "probit")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary of Balance for Matched Data:</span>
<span class="co">#&gt;            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="co">#&gt; distance          0.5773        0.5765          0.0040     0.9943    0.0042</span>
<span class="co">#&gt; age              25.8162       25.6722          0.0201     0.4614    0.0848</span>
<span class="co">#&gt; educ             10.3459       10.3693         -0.0116     0.6173    0.0194</span>
<span class="co">#&gt; raceblack         0.8432        0.8389          0.0119          .    0.0043</span>
<span class="co">#&gt; racehispan        0.0595        0.0500          0.0402          .    0.0095</span>
<span class="co">#&gt; racewhite         0.0973        0.1111         -0.0467          .    0.0138</span>
<span class="co">#&gt; married           0.1892        0.1580          0.0797          .    0.0312</span>
<span class="co">#&gt; nodegree          0.7081        0.6898          0.0404          .    0.0184</span>
<span class="co">#&gt; re74           2095.5737     2103.5534         -0.0016     1.3513    0.0328</span>
<span class="co">#&gt; re75           1532.0553     1552.4673         -0.0063     1.5678    0.0496</span>
<span class="co">#&gt;            eCDF Max Std. Pair Dist.</span>
<span class="co">#&gt; distance     0.0541          0.0198</span>
<span class="co">#&gt; age          0.2846          1.2741</span>
<span class="co">#&gt; educ         0.0597          1.2233</span>
<span class="co">#&gt; raceblack    0.0043          0.0162</span>
<span class="co">#&gt; racehispan   0.0095          0.4985</span>
<span class="co">#&gt; racewhite    0.0138          0.3911</span>
<span class="co">#&gt; married      0.0312          0.4866</span>
<span class="co">#&gt; nodegree     0.0184          0.9593</span>
<span class="co">#&gt; re74         0.2159          0.8533</span>
<span class="co">#&gt; re75         0.2013          0.8279</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample Sizes:</span>
<span class="co">#&gt;               Control Treated</span>
<span class="co">#&gt; All            429.       185</span>
<span class="co">#&gt; Matched (ESS)   53.51     185</span>
<span class="co">#&gt; Matched        429.       185</span>
<span class="co">#&gt; Unmatched        0.         0</span>
<span class="co">#&gt; Discarded        0.         0</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">m.out2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-49-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Exact Matching</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Full matching on a probit PS</span>
<span class="va">m.out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span>
<span class="va">m.out3</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Exact matching</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 25 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<p>Subclassfication</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span>
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"subclass"</span><span class="op">)</span>
<span class="va">m.out4</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Subclassification (6 subclasses)</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with logistic regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 614 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span>
<span class="co"># Or you can use in conjunction with "nearest"</span>
<span class="va">m.out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"nearest"</span>, option <span class="op">=</span> <span class="st">"subclass"</span><span class="op">)</span>
<span class="va">m.out4</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Variable ratio 1:1 nearest neighbor matching without replacement</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with logistic regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 370 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<p>Optimal Matching</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.out5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"optimal"</span>,ratio <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">m.out5</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: Variable ratio 2:1 optimal pair matching</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with logistic regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 555 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<p>Genetic Matching</p>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m.out6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> 
                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,
                 method <span class="op">=</span> <span class="st">"genetic"</span><span class="op">)</span>
<span class="va">m.out6</span>
<span class="co">#&gt; A matchit object</span>
<span class="co">#&gt;  - method: 1:1 genetic matching without replacement</span>
<span class="co">#&gt;  - distance: Propensity score</span>
<span class="co">#&gt;              - estimated with logistic regression</span>
<span class="co">#&gt;  - number of obs.: 614 (original), 370 (matched)</span>
<span class="co">#&gt;  - target estimand: ATT</span>
<span class="co">#&gt;  - covariates: age, educ, race, married, nodegree, re74, re75</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Estimating the Treatment Effect</li>
</ol>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get matched data</span>
<span class="va">m.data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html">match.data</a></span><span class="op">(</span><span class="va">m.out1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">m.data1</span><span class="op">)</span>
<span class="co">#&gt;      treat age educ   race married nodegree re74 re75       re78  distance</span>
<span class="co">#&gt; NSW1     1  37   11  black       1        1    0    0  9930.0460 0.6387699</span>
<span class="co">#&gt; NSW2     1  22    9 hispan       0        1    0    0  3595.8940 0.2246342</span>
<span class="co">#&gt; NSW3     1  30   12  black       0        0    0    0 24909.4500 0.6782439</span>
<span class="co">#&gt; NSW4     1  27   11  black       0        1    0    0  7506.1460 0.7763241</span>
<span class="co">#&gt; NSW5     1  33    8  black       0        1    0    0   289.7899 0.7016387</span>
<span class="co">#&gt; NSW6     1  22    9  black       0        1    0    0  4056.4940 0.6990699</span>
<span class="co">#&gt;      weights subclass</span>
<span class="co">#&gt; NSW1       1        1</span>
<span class="co">#&gt; NSW2       1       98</span>
<span class="co">#&gt; NSW3       1      109</span>
<span class="co">#&gt; NSW4       1      120</span>
<span class="co">#&gt; NSW5       1      131</span>
<span class="co">#&gt; NSW6       1      142</span></code></pre></div>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"lmtest"</span><span class="op">)</span> <span class="co">#coeftest</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://sandwich.R-Forge.R-project.org/">"sandwich"</a></span><span class="op">)</span> <span class="co">#vcovCL</span>

<span class="co"># imbalance matched dataset</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> 
             <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">m.data1</span>, weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fit1</span>, vcov. <span class="op">=</span> <span class="va">vcovCL</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">subclass</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; t test of coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                Estimate  Std. Error t value Pr(&gt;|t|)   </span>
<span class="co">#&gt; (Intercept) -2.5816e+03  3.3209e+03 -0.7774 0.437439   </span>
<span class="co">#&gt; treat        1.3449e+03  7.3084e+02  1.8403 0.066552 . </span>
<span class="co">#&gt; age          7.8035e+00  4.4148e+01  0.1768 0.859797   </span>
<span class="co">#&gt; educ         6.0220e+02  2.1007e+02  2.8667 0.004391 **</span>
<span class="co">#&gt; racehispan   1.5335e+03  1.0248e+03  1.4964 0.135417   </span>
<span class="co">#&gt; racewhite    4.6943e+02  8.9854e+02  0.5224 0.601687   </span>
<span class="co">#&gt; married     -1.5825e+02  9.3354e+02 -0.1695 0.865482   </span>
<span class="co">#&gt; nodegree     9.2328e+02  1.1496e+03  0.8032 0.422412   </span>
<span class="co">#&gt; re74         2.6362e-02  1.6646e-01  0.1584 0.874257   </span>
<span class="co">#&gt; re75         2.2068e-01  1.6771e-01  1.3158 0.189069   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p><code>treat</code> coefficient = estimated ATT</p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># balance matched dataset </span>
<span class="va">m.data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html">match.data</a></span><span class="op">(</span><span class="va">m.out2</span><span class="op">)</span>

<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> 
             <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">m.data2</span>, weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fit2</span>, vcov. <span class="op">=</span> <span class="va">vcovCL</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">subclass</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; t test of coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                Estimate  Std. Error t value  Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  2.8493e+03  3.1547e+03  0.9032 0.3667819    </span>
<span class="co">#&gt; treat        1.9797e+03  7.5611e+02  2.6183 0.0090589 ** </span>
<span class="co">#&gt; age         -4.5799e+01  3.7917e+01 -1.2079 0.2275592    </span>
<span class="co">#&gt; educ         2.3234e+02  2.0245e+02  1.1477 0.2515594    </span>
<span class="co">#&gt; racehispan   9.6380e+02  1.4435e+03  0.6677 0.5045794    </span>
<span class="co">#&gt; racewhite    1.7067e+03  8.2231e+02  2.0755 0.0383636 *  </span>
<span class="co">#&gt; married      9.0378e+02  1.1858e+03  0.7622 0.4462384    </span>
<span class="co">#&gt; nodegree    -1.2712e+03  1.2691e+03 -1.0017 0.3169017    </span>
<span class="co">#&gt; re74        -1.1459e-02  1.4547e-01 -0.0788 0.9372369    </span>
<span class="co">#&gt; re75         5.4080e-01  1.4212e-01  3.8053 0.0001561 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>When reporting, remember to mention</p>
<ol style="list-style-type: decimal">
<li>the matching specification (method, and additional options)</li>
<li>the distance measure (e.g., propensity score)</li>
<li>other methods, and rationale for the final chosen method.</li>
<li>balance statistics of the matched dataset.</li>
<li>number of matched, unmatched, discarded</li>
<li>estimation method for treatment effect.</li>
</ol>
</div>
<div id="matchingfrontier" class="section level3" number="20.5.2">
<h3>
<span class="header-section-number">20.5.2</span> MatchingFrontier<a class="anchor" aria-label="anchor" href="#matchingfrontier"><i class="fas fa-link"></i></a>
</h3>
<p>As mentioned in <code>MatchIt</code>, you have to make trade-off (also known as bias-variance trade-off) between balance and sample size. An automated procedure to optimize this trade-off is implemented in <code>MatchingFrontier</code> <span class="citation">(<a href="references.html#ref-King_2016" role="doc-biblioref">G. King, Lucas, and Nielsen 2016</a>)</span>, which solves this joint optimization problem.</p>
<p>I follow <code>MatchingFrontier</code> <a href="https://projects.iq.harvard.edu/files/frontier/files/using_matchingfrontier.pdf">guide</a></p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="quasi-experimental.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(devtools)</span></span>
<span id="cb381-2"><a href="quasi-experimental.html#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github('ChristopherLucas/MatchingFrontier')</span></span>
<span id="cb381-3"><a href="quasi-experimental.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchingFrontier)</span>
<span id="cb381-4"><a href="quasi-experimental.html#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"lalonde"</span>)</span>
<span id="cb381-5"><a href="quasi-experimental.html#cb381-5" aria-hidden="true" tabindex="-1"></a><span class="co"># choose var to match on</span></span>
<span id="cb381-6"><a href="quasi-experimental.html#cb381-6" aria-hidden="true" tabindex="-1"></a>match.on <span class="ot">&lt;-</span> <span class="fu">colnames</span>(lalonde)[<span class="sc">!</span>(<span class="fu">colnames</span>(lalonde) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'re78'</span>, <span class="st">'treat'</span>))]</span>
<span id="cb381-7"><a href="quasi-experimental.html#cb381-7" aria-hidden="true" tabindex="-1"></a>match.on</span>
<span id="cb381-8"><a href="quasi-experimental.html#cb381-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "age"       "education" "black"     "hispanic"  "married"   "nodegree" </span></span>
<span id="cb381-9"><a href="quasi-experimental.html#cb381-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] "re74"      "re75"</span></span>
<span id="cb381-10"><a href="quasi-experimental.html#cb381-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mahanlanobis frontier (default)</span></span>
<span id="cb381-11"><a href="quasi-experimental.html#cb381-11" aria-hidden="true" tabindex="-1"></a>mahal.frontier <span class="ot">&lt;-</span></span>
<span id="cb381-12"><a href="quasi-experimental.html#cb381-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">makeFrontier</span>(</span>
<span id="cb381-13"><a href="quasi-experimental.html#cb381-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">dataset =</span> lalonde,</span>
<span id="cb381-14"><a href="quasi-experimental.html#cb381-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">"treat"</span>,</span>
<span id="cb381-15"><a href="quasi-experimental.html#cb381-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">match.on =</span> match.on</span>
<span id="cb381-16"><a href="quasi-experimental.html#cb381-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb381-17"><a href="quasi-experimental.html#cb381-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating Mahalanobis distances...</span></span>
<span id="cb381-18"><a href="quasi-experimental.html#cb381-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating theoretical frontier...</span></span>
<span id="cb381-19"><a href="quasi-experimental.html#cb381-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating information for plotting the frontier...</span></span>
<span id="cb381-20"><a href="quasi-experimental.html#cb381-20" aria-hidden="true" tabindex="-1"></a>mahal.frontier</span>
<span id="cb381-21"><a href="quasi-experimental.html#cb381-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; An imbalance frontier with 997 points.</span></span>
<span id="cb381-22"><a href="quasi-experimental.html#cb381-22" aria-hidden="true" tabindex="-1"></a><span class="co"># L1 frontier</span></span>
<span id="cb381-23"><a href="quasi-experimental.html#cb381-23" aria-hidden="true" tabindex="-1"></a>L1.frontier <span class="ot">&lt;-</span></span>
<span id="cb381-24"><a href="quasi-experimental.html#cb381-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">makeFrontier</span>(</span>
<span id="cb381-25"><a href="quasi-experimental.html#cb381-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">dataset =</span> lalonde,</span>
<span id="cb381-26"><a href="quasi-experimental.html#cb381-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">'treat'</span>,</span>
<span id="cb381-27"><a href="quasi-experimental.html#cb381-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">match.on =</span> match.on,</span>
<span id="cb381-28"><a href="quasi-experimental.html#cb381-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">QOI =</span> <span class="st">'SATT'</span>,</span>
<span id="cb381-29"><a href="quasi-experimental.html#cb381-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">metric =</span> <span class="st">'L1'</span>,</span>
<span id="cb381-30"><a href="quasi-experimental.html#cb381-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">ratio =</span> <span class="st">'fixed'</span></span>
<span id="cb381-31"><a href="quasi-experimental.html#cb381-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb381-32"><a href="quasi-experimental.html#cb381-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating L1 binnings...</span></span>
<span id="cb381-33"><a href="quasi-experimental.html#cb381-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating L1 frontier... This may take a few minutes...</span></span>
<span id="cb381-34"><a href="quasi-experimental.html#cb381-34" aria-hidden="true" tabindex="-1"></a>L1.frontier</span>
<span id="cb381-35"><a href="quasi-experimental.html#cb381-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; An imbalance frontier with 976 points.</span></span>
<span id="cb381-36"><a href="quasi-experimental.html#cb381-36" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate effects along the frontier</span></span>
<span id="cb381-37"><a href="quasi-experimental.html#cb381-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-38"><a href="quasi-experimental.html#cb381-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Set base form</span></span>
<span id="cb381-39"><a href="quasi-experimental.html#cb381-39" aria-hidden="true" tabindex="-1"></a>my.form <span class="ot">&lt;-</span></span>
<span id="cb381-40"><a href="quasi-experimental.html#cb381-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.formula</span>(re78 <span class="sc">~</span> treat <span class="sc">+</span> age <span class="sc">+</span> black <span class="sc">+</span> education <span class="sc">+</span> hispanic <span class="sc">+</span> married <span class="sc">+</span> nodegree <span class="sc">+</span> re74 <span class="sc">+</span> re75)</span>
<span id="cb381-41"><a href="quasi-experimental.html#cb381-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-42"><a href="quasi-experimental.html#cb381-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate effects for the mahalanobis frontier</span></span>
<span id="cb381-43"><a href="quasi-experimental.html#cb381-43" aria-hidden="true" tabindex="-1"></a>mahal.estimates <span class="ot">&lt;-</span></span>
<span id="cb381-44"><a href="quasi-experimental.html#cb381-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">estimateEffects</span>(</span>
<span id="cb381-45"><a href="quasi-experimental.html#cb381-45" aria-hidden="true" tabindex="-1"></a>        mahal.frontier,</span>
<span id="cb381-46"><a href="quasi-experimental.html#cb381-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'re78 ~ treat'</span>,</span>
<span id="cb381-47"><a href="quasi-experimental.html#cb381-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">mod.dependence.formula =</span> my.form,</span>
<span id="cb381-48"><a href="quasi-experimental.html#cb381-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">continuous.vars =</span> <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'education'</span>, <span class="st">'re74'</span>, <span class="st">'re75'</span>),</span>
<span id="cb381-49"><a href="quasi-experimental.html#cb381-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">prop.estimated =</span> .<span class="dv">1</span>,</span>
<span id="cb381-50"><a href="quasi-experimental.html#cb381-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">means.as.cutpoints =</span> <span class="cn">TRUE</span></span>
<span id="cb381-51"><a href="quasi-experimental.html#cb381-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb381-52"><a href="quasi-experimental.html#cb381-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb381-53"><a href="quasi-experimental.html#cb381-53" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-54"><a href="quasi-experimental.html#cb381-54" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb381-55"><a href="quasi-experimental.html#cb381-55" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-56"><a href="quasi-experimental.html#cb381-56" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=</span>                                                                     <span class="er">|</span>   <span class="dv">1</span>%</span>
<span id="cb381-57"><a href="quasi-experimental.html#cb381-57" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-58"><a href="quasi-experimental.html#cb381-58" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=</span>                                                                     <span class="er">|</span>   <span class="dv">2</span>%</span>
<span id="cb381-59"><a href="quasi-experimental.html#cb381-59" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-60"><a href="quasi-experimental.html#cb381-60" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==</span>                                                                    <span class="er">|</span>   <span class="dv">3</span>%</span>
<span id="cb381-61"><a href="quasi-experimental.html#cb381-61" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-62"><a href="quasi-experimental.html#cb381-62" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===</span>                                                                   <span class="er">|</span>   <span class="dv">4</span>%</span>
<span id="cb381-63"><a href="quasi-experimental.html#cb381-63" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-64"><a href="quasi-experimental.html#cb381-64" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====</span>                                                                  <span class="er">|</span>   <span class="dv">5</span>%</span>
<span id="cb381-65"><a href="quasi-experimental.html#cb381-65" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-66"><a href="quasi-experimental.html#cb381-66" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====</span>                                                                  <span class="er">|</span>   <span class="dv">6</span>%</span>
<span id="cb381-67"><a href="quasi-experimental.html#cb381-67" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-68"><a href="quasi-experimental.html#cb381-68" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====</span>                                                                 <span class="er">|</span>   <span class="dv">7</span>%</span>
<span id="cb381-69"><a href="quasi-experimental.html#cb381-69" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-70"><a href="quasi-experimental.html#cb381-70" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">8</span>%</span>
<span id="cb381-71"><a href="quasi-experimental.html#cb381-71" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-72"><a href="quasi-experimental.html#cb381-72" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">9</span>%</span>
<span id="cb381-73"><a href="quasi-experimental.html#cb381-73" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-74"><a href="quasi-experimental.html#cb381-74" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======</span>                                                               <span class="er">|</span>  <span class="dv">10</span>%</span>
<span id="cb381-75"><a href="quasi-experimental.html#cb381-75" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-76"><a href="quasi-experimental.html#cb381-76" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========</span>                                                              <span class="er">|</span>  <span class="dv">11</span>%</span>
<span id="cb381-77"><a href="quasi-experimental.html#cb381-77" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-78"><a href="quasi-experimental.html#cb381-78" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========</span>                                                              <span class="er">|</span>  <span class="dv">12</span>%</span>
<span id="cb381-79"><a href="quasi-experimental.html#cb381-79" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-80"><a href="quasi-experimental.html#cb381-80" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">13</span>%</span>
<span id="cb381-81"><a href="quasi-experimental.html#cb381-81" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-82"><a href="quasi-experimental.html#cb381-82" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb381-83"><a href="quasi-experimental.html#cb381-83" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-84"><a href="quasi-experimental.html#cb381-84" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========</span>                                                           <span class="er">|</span>  <span class="dv">15</span>%</span>
<span id="cb381-85"><a href="quasi-experimental.html#cb381-85" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-86"><a href="quasi-experimental.html#cb381-86" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========</span>                                                           <span class="er">|</span>  <span class="dv">16</span>%</span>
<span id="cb381-87"><a href="quasi-experimental.html#cb381-87" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-88"><a href="quasi-experimental.html#cb381-88" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============</span>                                                          <span class="er">|</span>  <span class="dv">17</span>%</span>
<span id="cb381-89"><a href="quasi-experimental.html#cb381-89" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-90"><a href="quasi-experimental.html#cb381-90" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============</span>                                                         <span class="er">|</span>  <span class="dv">18</span>%</span>
<span id="cb381-91"><a href="quasi-experimental.html#cb381-91" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-92"><a href="quasi-experimental.html#cb381-92" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============</span>                                                         <span class="er">|</span>  <span class="dv">19</span>%</span>
<span id="cb381-93"><a href="quasi-experimental.html#cb381-93" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-94"><a href="quasi-experimental.html#cb381-94" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============</span>                                                        <span class="er">|</span>  <span class="dv">20</span>%</span>
<span id="cb381-95"><a href="quasi-experimental.html#cb381-95" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-96"><a href="quasi-experimental.html#cb381-96" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============</span>                                                       <span class="er">|</span>  <span class="dv">21</span>%</span>
<span id="cb381-97"><a href="quasi-experimental.html#cb381-97" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-98"><a href="quasi-experimental.html#cb381-98" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================</span>                                                      <span class="er">|</span>  <span class="dv">22</span>%</span>
<span id="cb381-99"><a href="quasi-experimental.html#cb381-99" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-100"><a href="quasi-experimental.html#cb381-100" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================</span>                                                      <span class="er">|</span>  <span class="dv">23</span>%</span>
<span id="cb381-101"><a href="quasi-experimental.html#cb381-101" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-102"><a href="quasi-experimental.html#cb381-102" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================</span>                                                     <span class="er">|</span>  <span class="dv">24</span>%</span>
<span id="cb381-103"><a href="quasi-experimental.html#cb381-103" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-104"><a href="quasi-experimental.html#cb381-104" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================</span>                                                    <span class="er">|</span>  <span class="dv">25</span>%</span>
<span id="cb381-105"><a href="quasi-experimental.html#cb381-105" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-106"><a href="quasi-experimental.html#cb381-106" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================</span>                                                    <span class="er">|</span>  <span class="dv">26</span>%</span>
<span id="cb381-107"><a href="quasi-experimental.html#cb381-107" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-108"><a href="quasi-experimental.html#cb381-108" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================</span>                                                   <span class="er">|</span>  <span class="dv">27</span>%</span>
<span id="cb381-109"><a href="quasi-experimental.html#cb381-109" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-110"><a href="quasi-experimental.html#cb381-110" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">28</span>%</span>
<span id="cb381-111"><a href="quasi-experimental.html#cb381-111" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-112"><a href="quasi-experimental.html#cb381-112" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb381-113"><a href="quasi-experimental.html#cb381-113" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-114"><a href="quasi-experimental.html#cb381-114" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb381-115"><a href="quasi-experimental.html#cb381-115" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-116"><a href="quasi-experimental.html#cb381-116" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================</span>                                                <span class="er">|</span>  <span class="dv">31</span>%</span>
<span id="cb381-117"><a href="quasi-experimental.html#cb381-117" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-118"><a href="quasi-experimental.html#cb381-118" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================</span>                                               <span class="er">|</span>  <span class="dv">32</span>%</span>
<span id="cb381-119"><a href="quasi-experimental.html#cb381-119" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-120"><a href="quasi-experimental.html#cb381-120" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================</span>                                               <span class="er">|</span>  <span class="dv">33</span>%</span>
<span id="cb381-121"><a href="quasi-experimental.html#cb381-121" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-122"><a href="quasi-experimental.html#cb381-122" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================</span>                                              <span class="er">|</span>  <span class="dv">34</span>%</span>
<span id="cb381-123"><a href="quasi-experimental.html#cb381-123" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-124"><a href="quasi-experimental.html#cb381-124" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================</span>                                             <span class="er">|</span>  <span class="dv">35</span>%</span>
<span id="cb381-125"><a href="quasi-experimental.html#cb381-125" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-126"><a href="quasi-experimental.html#cb381-126" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================</span>                                             <span class="er">|</span>  <span class="dv">36</span>%</span>
<span id="cb381-127"><a href="quasi-experimental.html#cb381-127" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-128"><a href="quasi-experimental.html#cb381-128" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================</span>                                            <span class="er">|</span>  <span class="dv">37</span>%</span>
<span id="cb381-129"><a href="quasi-experimental.html#cb381-129" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-130"><a href="quasi-experimental.html#cb381-130" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================</span>                                           <span class="er">|</span>  <span class="dv">38</span>%</span>
<span id="cb381-131"><a href="quasi-experimental.html#cb381-131" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-132"><a href="quasi-experimental.html#cb381-132" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">39</span>%</span>
<span id="cb381-133"><a href="quasi-experimental.html#cb381-133" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-134"><a href="quasi-experimental.html#cb381-134" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb381-135"><a href="quasi-experimental.html#cb381-135" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-136"><a href="quasi-experimental.html#cb381-136" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================</span>                                         <span class="er">|</span>  <span class="dv">41</span>%</span>
<span id="cb381-137"><a href="quasi-experimental.html#cb381-137" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-138"><a href="quasi-experimental.html#cb381-138" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">42</span>%</span>
<span id="cb381-139"><a href="quasi-experimental.html#cb381-139" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-140"><a href="quasi-experimental.html#cb381-140" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb381-141"><a href="quasi-experimental.html#cb381-141" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-142"><a href="quasi-experimental.html#cb381-142" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================</span>                                       <span class="er">|</span>  <span class="dv">44</span>%</span>
<span id="cb381-143"><a href="quasi-experimental.html#cb381-143" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-144"><a href="quasi-experimental.html#cb381-144" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================</span>                                      <span class="er">|</span>  <span class="dv">45</span>%</span>
<span id="cb381-145"><a href="quasi-experimental.html#cb381-145" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-146"><a href="quasi-experimental.html#cb381-146" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">46</span>%</span>
<span id="cb381-147"><a href="quasi-experimental.html#cb381-147" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-148"><a href="quasi-experimental.html#cb381-148" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">47</span>%</span>
<span id="cb381-149"><a href="quasi-experimental.html#cb381-149" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-150"><a href="quasi-experimental.html#cb381-150" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================</span>                                    <span class="er">|</span>  <span class="dv">48</span>%</span>
<span id="cb381-151"><a href="quasi-experimental.html#cb381-151" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-152"><a href="quasi-experimental.html#cb381-152" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================</span>                                   <span class="er">|</span>  <span class="dv">49</span>%</span>
<span id="cb381-153"><a href="quasi-experimental.html#cb381-153" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-154"><a href="quasi-experimental.html#cb381-154" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================</span>                                   <span class="er">|</span>  <span class="dv">51</span>%</span>
<span id="cb381-155"><a href="quasi-experimental.html#cb381-155" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-156"><a href="quasi-experimental.html#cb381-156" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================</span>                                  <span class="er">|</span>  <span class="dv">52</span>%</span>
<span id="cb381-157"><a href="quasi-experimental.html#cb381-157" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-158"><a href="quasi-experimental.html#cb381-158" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================</span>                                 <span class="er">|</span>  <span class="dv">53</span>%</span>
<span id="cb381-159"><a href="quasi-experimental.html#cb381-159" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-160"><a href="quasi-experimental.html#cb381-160" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================</span>                                 <span class="er">|</span>  <span class="dv">54</span>%</span>
<span id="cb381-161"><a href="quasi-experimental.html#cb381-161" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-162"><a href="quasi-experimental.html#cb381-162" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================</span>                                <span class="er">|</span>  <span class="dv">55</span>%</span>
<span id="cb381-163"><a href="quasi-experimental.html#cb381-163" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-164"><a href="quasi-experimental.html#cb381-164" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================</span>                               <span class="er">|</span>  <span class="dv">56</span>%</span>
<span id="cb381-165"><a href="quasi-experimental.html#cb381-165" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-166"><a href="quasi-experimental.html#cb381-166" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb381-167"><a href="quasi-experimental.html#cb381-167" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-168"><a href="quasi-experimental.html#cb381-168" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">58</span>%</span>
<span id="cb381-169"><a href="quasi-experimental.html#cb381-169" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-170"><a href="quasi-experimental.html#cb381-170" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================</span>                             <span class="er">|</span>  <span class="dv">59</span>%</span>
<span id="cb381-171"><a href="quasi-experimental.html#cb381-171" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-172"><a href="quasi-experimental.html#cb381-172" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================</span>                            <span class="er">|</span>  <span class="dv">60</span>%</span>
<span id="cb381-173"><a href="quasi-experimental.html#cb381-173" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-174"><a href="quasi-experimental.html#cb381-174" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================</span>                            <span class="er">|</span>  <span class="dv">61</span>%</span>
<span id="cb381-175"><a href="quasi-experimental.html#cb381-175" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-176"><a href="quasi-experimental.html#cb381-176" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================</span>                           <span class="er">|</span>  <span class="dv">62</span>%</span>
<span id="cb381-177"><a href="quasi-experimental.html#cb381-177" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-178"><a href="quasi-experimental.html#cb381-178" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================</span>                          <span class="er">|</span>  <span class="dv">63</span>%</span>
<span id="cb381-179"><a href="quasi-experimental.html#cb381-179" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-180"><a href="quasi-experimental.html#cb381-180" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================</span>                         <span class="er">|</span>  <span class="dv">64</span>%</span>
<span id="cb381-181"><a href="quasi-experimental.html#cb381-181" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-182"><a href="quasi-experimental.html#cb381-182" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================</span>                         <span class="er">|</span>  <span class="dv">65</span>%</span>
<span id="cb381-183"><a href="quasi-experimental.html#cb381-183" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-184"><a href="quasi-experimental.html#cb381-184" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================</span>                        <span class="er">|</span>  <span class="dv">66</span>%</span>
<span id="cb381-185"><a href="quasi-experimental.html#cb381-185" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-186"><a href="quasi-experimental.html#cb381-186" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================================</span>                       <span class="er">|</span>  <span class="dv">67</span>%</span>
<span id="cb381-187"><a href="quasi-experimental.html#cb381-187" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-188"><a href="quasi-experimental.html#cb381-188" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================================</span>                       <span class="er">|</span>  <span class="dv">68</span>%</span>
<span id="cb381-189"><a href="quasi-experimental.html#cb381-189" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-190"><a href="quasi-experimental.html#cb381-190" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================</span>                      <span class="er">|</span>  <span class="dv">69</span>%</span>
<span id="cb381-191"><a href="quasi-experimental.html#cb381-191" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-192"><a href="quasi-experimental.html#cb381-192" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================</span>                     <span class="er">|</span>  <span class="dv">70</span>%</span>
<span id="cb381-193"><a href="quasi-experimental.html#cb381-193" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-194"><a href="quasi-experimental.html#cb381-194" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================</span>                     <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb381-195"><a href="quasi-experimental.html#cb381-195" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-196"><a href="quasi-experimental.html#cb381-196" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">72</span>%</span>
<span id="cb381-197"><a href="quasi-experimental.html#cb381-197" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-198"><a href="quasi-experimental.html#cb381-198" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================</span>                   <span class="er">|</span>  <span class="dv">73</span>%</span>
<span id="cb381-199"><a href="quasi-experimental.html#cb381-199" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-200"><a href="quasi-experimental.html#cb381-200" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================</span>                  <span class="er">|</span>  <span class="dv">74</span>%</span>
<span id="cb381-201"><a href="quasi-experimental.html#cb381-201" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-202"><a href="quasi-experimental.html#cb381-202" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================</span>                  <span class="er">|</span>  <span class="dv">75</span>%</span>
<span id="cb381-203"><a href="quasi-experimental.html#cb381-203" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-204"><a href="quasi-experimental.html#cb381-204" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================</span>                 <span class="er">|</span>  <span class="dv">76</span>%</span>
<span id="cb381-205"><a href="quasi-experimental.html#cb381-205" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-206"><a href="quasi-experimental.html#cb381-206" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================</span>                <span class="er">|</span>  <span class="dv">77</span>%</span>
<span id="cb381-207"><a href="quasi-experimental.html#cb381-207" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-208"><a href="quasi-experimental.html#cb381-208" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================</span>                <span class="er">|</span>  <span class="dv">78</span>%</span>
<span id="cb381-209"><a href="quasi-experimental.html#cb381-209" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-210"><a href="quasi-experimental.html#cb381-210" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================================</span>               <span class="er">|</span>  <span class="dv">79</span>%</span>
<span id="cb381-211"><a href="quasi-experimental.html#cb381-211" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-212"><a href="quasi-experimental.html#cb381-212" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================================</span>              <span class="er">|</span>  <span class="dv">80</span>%</span>
<span id="cb381-213"><a href="quasi-experimental.html#cb381-213" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-214"><a href="quasi-experimental.html#cb381-214" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================================</span>             <span class="er">|</span>  <span class="dv">81</span>%</span>
<span id="cb381-215"><a href="quasi-experimental.html#cb381-215" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-216"><a href="quasi-experimental.html#cb381-216" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================================</span>             <span class="er">|</span>  <span class="dv">82</span>%</span>
<span id="cb381-217"><a href="quasi-experimental.html#cb381-217" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-218"><a href="quasi-experimental.html#cb381-218" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================================</span>            <span class="er">|</span>  <span class="dv">83</span>%</span>
<span id="cb381-219"><a href="quasi-experimental.html#cb381-219" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-220"><a href="quasi-experimental.html#cb381-220" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================================</span>           <span class="er">|</span>  <span class="dv">84</span>%</span>
<span id="cb381-221"><a href="quasi-experimental.html#cb381-221" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-222"><a href="quasi-experimental.html#cb381-222" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================================</span>           <span class="er">|</span>  <span class="dv">85</span>%</span>
<span id="cb381-223"><a href="quasi-experimental.html#cb381-223" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-224"><a href="quasi-experimental.html#cb381-224" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb381-225"><a href="quasi-experimental.html#cb381-225" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-226"><a href="quasi-experimental.html#cb381-226" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================================</span>         <span class="er">|</span>  <span class="dv">87</span>%</span>
<span id="cb381-227"><a href="quasi-experimental.html#cb381-227" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-228"><a href="quasi-experimental.html#cb381-228" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================================</span>        <span class="er">|</span>  <span class="dv">88</span>%</span>
<span id="cb381-229"><a href="quasi-experimental.html#cb381-229" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-230"><a href="quasi-experimental.html#cb381-230" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================================</span>        <span class="er">|</span>  <span class="dv">89</span>%</span>
<span id="cb381-231"><a href="quasi-experimental.html#cb381-231" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-232"><a href="quasi-experimental.html#cb381-232" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================================================</span>       <span class="er">|</span>  <span class="dv">90</span>%</span>
<span id="cb381-233"><a href="quasi-experimental.html#cb381-233" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-234"><a href="quasi-experimental.html#cb381-234" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">91</span>%</span>
<span id="cb381-235"><a href="quasi-experimental.html#cb381-235" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-236"><a href="quasi-experimental.html#cb381-236" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">92</span>%</span>
<span id="cb381-237"><a href="quasi-experimental.html#cb381-237" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-238"><a href="quasi-experimental.html#cb381-238" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================================</span>     <span class="er">|</span>  <span class="dv">93</span>%</span>
<span id="cb381-239"><a href="quasi-experimental.html#cb381-239" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-240"><a href="quasi-experimental.html#cb381-240" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================================</span>    <span class="er">|</span>  <span class="dv">94</span>%</span>
<span id="cb381-241"><a href="quasi-experimental.html#cb381-241" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-242"><a href="quasi-experimental.html#cb381-242" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================================</span>    <span class="er">|</span>  <span class="dv">95</span>%</span>
<span id="cb381-243"><a href="quasi-experimental.html#cb381-243" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-244"><a href="quasi-experimental.html#cb381-244" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================================</span>   <span class="er">|</span>  <span class="dv">96</span>%</span>
<span id="cb381-245"><a href="quasi-experimental.html#cb381-245" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-246"><a href="quasi-experimental.html#cb381-246" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================================</span>  <span class="er">|</span>  <span class="dv">97</span>%</span>
<span id="cb381-247"><a href="quasi-experimental.html#cb381-247" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-248"><a href="quasi-experimental.html#cb381-248" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================================</span> <span class="er">|</span>  <span class="dv">98</span>%</span>
<span id="cb381-249"><a href="quasi-experimental.html#cb381-249" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-250"><a href="quasi-experimental.html#cb381-250" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================================</span> <span class="er">|</span>  <span class="dv">99</span>%</span>
<span id="cb381-251"><a href="quasi-experimental.html#cb381-251" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-252"><a href="quasi-experimental.html#cb381-252" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb381-253"><a href="quasi-experimental.html#cb381-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate effects for the L1 frontier</span></span>
<span id="cb381-254"><a href="quasi-experimental.html#cb381-254" aria-hidden="true" tabindex="-1"></a>L1.estimates <span class="ot">&lt;-</span></span>
<span id="cb381-255"><a href="quasi-experimental.html#cb381-255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">estimateEffects</span>(</span>
<span id="cb381-256"><a href="quasi-experimental.html#cb381-256" aria-hidden="true" tabindex="-1"></a>        L1.frontier,</span>
<span id="cb381-257"><a href="quasi-experimental.html#cb381-257" aria-hidden="true" tabindex="-1"></a>        <span class="st">'re78 ~ treat'</span>,</span>
<span id="cb381-258"><a href="quasi-experimental.html#cb381-258" aria-hidden="true" tabindex="-1"></a>        <span class="at">mod.dependence.formula =</span> my.form,</span>
<span id="cb381-259"><a href="quasi-experimental.html#cb381-259" aria-hidden="true" tabindex="-1"></a>        <span class="at">continuous.vars =</span> <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'education'</span>, <span class="st">'re74'</span>, <span class="st">'re75'</span>),</span>
<span id="cb381-260"><a href="quasi-experimental.html#cb381-260" aria-hidden="true" tabindex="-1"></a>        <span class="at">prop.estimated =</span> .<span class="dv">1</span>,</span>
<span id="cb381-261"><a href="quasi-experimental.html#cb381-261" aria-hidden="true" tabindex="-1"></a>        <span class="at">means.as.cutpoints =</span> <span class="cn">TRUE</span></span>
<span id="cb381-262"><a href="quasi-experimental.html#cb381-262" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb381-263"><a href="quasi-experimental.html#cb381-263" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb381-264"><a href="quasi-experimental.html#cb381-264" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-265"><a href="quasi-experimental.html#cb381-265" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb381-266"><a href="quasi-experimental.html#cb381-266" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-267"><a href="quasi-experimental.html#cb381-267" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=</span>                                                                     <span class="er">|</span>   <span class="dv">1</span>%</span>
<span id="cb381-268"><a href="quasi-experimental.html#cb381-268" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-269"><a href="quasi-experimental.html#cb381-269" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=</span>                                                                     <span class="er">|</span>   <span class="dv">2</span>%</span>
<span id="cb381-270"><a href="quasi-experimental.html#cb381-270" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-271"><a href="quasi-experimental.html#cb381-271" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==</span>                                                                    <span class="er">|</span>   <span class="dv">3</span>%</span>
<span id="cb381-272"><a href="quasi-experimental.html#cb381-272" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-273"><a href="quasi-experimental.html#cb381-273" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===</span>                                                                   <span class="er">|</span>   <span class="dv">4</span>%</span>
<span id="cb381-274"><a href="quasi-experimental.html#cb381-274" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-275"><a href="quasi-experimental.html#cb381-275" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====</span>                                                                  <span class="er">|</span>   <span class="dv">5</span>%</span>
<span id="cb381-276"><a href="quasi-experimental.html#cb381-276" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-277"><a href="quasi-experimental.html#cb381-277" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====</span>                                                                  <span class="er">|</span>   <span class="dv">6</span>%</span>
<span id="cb381-278"><a href="quasi-experimental.html#cb381-278" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-279"><a href="quasi-experimental.html#cb381-279" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====</span>                                                                 <span class="er">|</span>   <span class="dv">7</span>%</span>
<span id="cb381-280"><a href="quasi-experimental.html#cb381-280" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-281"><a href="quasi-experimental.html#cb381-281" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">8</span>%</span>
<span id="cb381-282"><a href="quasi-experimental.html#cb381-282" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-283"><a href="quasi-experimental.html#cb381-283" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">9</span>%</span>
<span id="cb381-284"><a href="quasi-experimental.html#cb381-284" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-285"><a href="quasi-experimental.html#cb381-285" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======</span>                                                               <span class="er">|</span>  <span class="dv">10</span>%</span>
<span id="cb381-286"><a href="quasi-experimental.html#cb381-286" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-287"><a href="quasi-experimental.html#cb381-287" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========</span>                                                              <span class="er">|</span>  <span class="dv">11</span>%</span>
<span id="cb381-288"><a href="quasi-experimental.html#cb381-288" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-289"><a href="quasi-experimental.html#cb381-289" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">12</span>%</span>
<span id="cb381-290"><a href="quasi-experimental.html#cb381-290" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-291"><a href="quasi-experimental.html#cb381-291" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">13</span>%</span>
<span id="cb381-292"><a href="quasi-experimental.html#cb381-292" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-293"><a href="quasi-experimental.html#cb381-293" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb381-294"><a href="quasi-experimental.html#cb381-294" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-295"><a href="quasi-experimental.html#cb381-295" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========</span>                                                           <span class="er">|</span>  <span class="dv">15</span>%</span>
<span id="cb381-296"><a href="quasi-experimental.html#cb381-296" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-297"><a href="quasi-experimental.html#cb381-297" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============</span>                                                          <span class="er">|</span>  <span class="dv">16</span>%</span>
<span id="cb381-298"><a href="quasi-experimental.html#cb381-298" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-299"><a href="quasi-experimental.html#cb381-299" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============</span>                                                          <span class="er">|</span>  <span class="dv">18</span>%</span>
<span id="cb381-300"><a href="quasi-experimental.html#cb381-300" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-301"><a href="quasi-experimental.html#cb381-301" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============</span>                                                         <span class="er">|</span>  <span class="dv">19</span>%</span>
<span id="cb381-302"><a href="quasi-experimental.html#cb381-302" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-303"><a href="quasi-experimental.html#cb381-303" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============</span>                                                        <span class="er">|</span>  <span class="dv">20</span>%</span>
<span id="cb381-304"><a href="quasi-experimental.html#cb381-304" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-305"><a href="quasi-experimental.html#cb381-305" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============</span>                                                        <span class="er">|</span>  <span class="dv">21</span>%</span>
<span id="cb381-306"><a href="quasi-experimental.html#cb381-306" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-307"><a href="quasi-experimental.html#cb381-307" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============</span>                                                       <span class="er">|</span>  <span class="dv">22</span>%</span>
<span id="cb381-308"><a href="quasi-experimental.html#cb381-308" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-309"><a href="quasi-experimental.html#cb381-309" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================</span>                                                      <span class="er">|</span>  <span class="dv">23</span>%</span>
<span id="cb381-310"><a href="quasi-experimental.html#cb381-310" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-311"><a href="quasi-experimental.html#cb381-311" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================</span>                                                     <span class="er">|</span>  <span class="dv">24</span>%</span>
<span id="cb381-312"><a href="quasi-experimental.html#cb381-312" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-313"><a href="quasi-experimental.html#cb381-313" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================</span>                                                     <span class="er">|</span>  <span class="dv">25</span>%</span>
<span id="cb381-314"><a href="quasi-experimental.html#cb381-314" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-315"><a href="quasi-experimental.html#cb381-315" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================</span>                                                    <span class="er">|</span>  <span class="dv">26</span>%</span>
<span id="cb381-316"><a href="quasi-experimental.html#cb381-316" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-317"><a href="quasi-experimental.html#cb381-317" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================</span>                                                   <span class="er">|</span>  <span class="dv">27</span>%</span>
<span id="cb381-318"><a href="quasi-experimental.html#cb381-318" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-319"><a href="quasi-experimental.html#cb381-319" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================</span>                                                   <span class="er">|</span>  <span class="dv">28</span>%</span>
<span id="cb381-320"><a href="quasi-experimental.html#cb381-320" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-321"><a href="quasi-experimental.html#cb381-321" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb381-322"><a href="quasi-experimental.html#cb381-322" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-323"><a href="quasi-experimental.html#cb381-323" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb381-324"><a href="quasi-experimental.html#cb381-324" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-325"><a href="quasi-experimental.html#cb381-325" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================</span>                                                <span class="er">|</span>  <span class="dv">31</span>%</span>
<span id="cb381-326"><a href="quasi-experimental.html#cb381-326" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-327"><a href="quasi-experimental.html#cb381-327" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================</span>                                                <span class="er">|</span>  <span class="dv">32</span>%</span>
<span id="cb381-328"><a href="quasi-experimental.html#cb381-328" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-329"><a href="quasi-experimental.html#cb381-329" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================</span>                                               <span class="er">|</span>  <span class="dv">33</span>%</span>
<span id="cb381-330"><a href="quasi-experimental.html#cb381-330" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-331"><a href="quasi-experimental.html#cb381-331" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================</span>                                              <span class="er">|</span>  <span class="dv">34</span>%</span>
<span id="cb381-332"><a href="quasi-experimental.html#cb381-332" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-333"><a href="quasi-experimental.html#cb381-333" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================</span>                                             <span class="er">|</span>  <span class="dv">35</span>%</span>
<span id="cb381-334"><a href="quasi-experimental.html#cb381-334" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-335"><a href="quasi-experimental.html#cb381-335" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================</span>                                             <span class="er">|</span>  <span class="dv">36</span>%</span>
<span id="cb381-336"><a href="quasi-experimental.html#cb381-336" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-337"><a href="quasi-experimental.html#cb381-337" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================</span>                                            <span class="er">|</span>  <span class="dv">37</span>%</span>
<span id="cb381-338"><a href="quasi-experimental.html#cb381-338" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-339"><a href="quasi-experimental.html#cb381-339" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================</span>                                           <span class="er">|</span>  <span class="dv">38</span>%</span>
<span id="cb381-340"><a href="quasi-experimental.html#cb381-340" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-341"><a href="quasi-experimental.html#cb381-341" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================</span>                                           <span class="er">|</span>  <span class="dv">39</span>%</span>
<span id="cb381-342"><a href="quasi-experimental.html#cb381-342" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-343"><a href="quasi-experimental.html#cb381-343" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb381-344"><a href="quasi-experimental.html#cb381-344" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-345"><a href="quasi-experimental.html#cb381-345" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================</span>                                         <span class="er">|</span>  <span class="dv">41</span>%</span>
<span id="cb381-346"><a href="quasi-experimental.html#cb381-346" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-347"><a href="quasi-experimental.html#cb381-347" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">42</span>%</span>
<span id="cb381-348"><a href="quasi-experimental.html#cb381-348" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-349"><a href="quasi-experimental.html#cb381-349" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb381-350"><a href="quasi-experimental.html#cb381-350" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-351"><a href="quasi-experimental.html#cb381-351" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================</span>                                       <span class="er">|</span>  <span class="dv">44</span>%</span>
<span id="cb381-352"><a href="quasi-experimental.html#cb381-352" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-353"><a href="quasi-experimental.html#cb381-353" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================</span>                                      <span class="er">|</span>  <span class="dv">45</span>%</span>
<span id="cb381-354"><a href="quasi-experimental.html#cb381-354" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-355"><a href="quasi-experimental.html#cb381-355" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================</span>                                      <span class="er">|</span>  <span class="dv">46</span>%</span>
<span id="cb381-356"><a href="quasi-experimental.html#cb381-356" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-357"><a href="quasi-experimental.html#cb381-357" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">47</span>%</span>
<span id="cb381-358"><a href="quasi-experimental.html#cb381-358" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-359"><a href="quasi-experimental.html#cb381-359" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================</span>                                    <span class="er">|</span>  <span class="dv">48</span>%</span>
<span id="cb381-360"><a href="quasi-experimental.html#cb381-360" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-361"><a href="quasi-experimental.html#cb381-361" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================</span>                                   <span class="er">|</span>  <span class="dv">49</span>%</span>
<span id="cb381-362"><a href="quasi-experimental.html#cb381-362" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-363"><a href="quasi-experimental.html#cb381-363" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================</span>                                   <span class="er">|</span>  <span class="dv">51</span>%</span>
<span id="cb381-364"><a href="quasi-experimental.html#cb381-364" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-365"><a href="quasi-experimental.html#cb381-365" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================</span>                                  <span class="er">|</span>  <span class="dv">52</span>%</span>
<span id="cb381-366"><a href="quasi-experimental.html#cb381-366" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-367"><a href="quasi-experimental.html#cb381-367" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================</span>                                 <span class="er">|</span>  <span class="dv">53</span>%</span>
<span id="cb381-368"><a href="quasi-experimental.html#cb381-368" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-369"><a href="quasi-experimental.html#cb381-369" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================</span>                                <span class="er">|</span>  <span class="dv">54</span>%</span>
<span id="cb381-370"><a href="quasi-experimental.html#cb381-370" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-371"><a href="quasi-experimental.html#cb381-371" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================</span>                                <span class="er">|</span>  <span class="dv">55</span>%</span>
<span id="cb381-372"><a href="quasi-experimental.html#cb381-372" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-373"><a href="quasi-experimental.html#cb381-373" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================</span>                               <span class="er">|</span>  <span class="dv">56</span>%</span>
<span id="cb381-374"><a href="quasi-experimental.html#cb381-374" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-375"><a href="quasi-experimental.html#cb381-375" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb381-376"><a href="quasi-experimental.html#cb381-376" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-377"><a href="quasi-experimental.html#cb381-377" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">58</span>%</span>
<span id="cb381-378"><a href="quasi-experimental.html#cb381-378" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-379"><a href="quasi-experimental.html#cb381-379" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================</span>                             <span class="er">|</span>  <span class="dv">59</span>%</span>
<span id="cb381-380"><a href="quasi-experimental.html#cb381-380" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-381"><a href="quasi-experimental.html#cb381-381" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================</span>                            <span class="er">|</span>  <span class="dv">60</span>%</span>
<span id="cb381-382"><a href="quasi-experimental.html#cb381-382" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-383"><a href="quasi-experimental.html#cb381-383" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================</span>                           <span class="er">|</span>  <span class="dv">61</span>%</span>
<span id="cb381-384"><a href="quasi-experimental.html#cb381-384" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-385"><a href="quasi-experimental.html#cb381-385" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================</span>                           <span class="er">|</span>  <span class="dv">62</span>%</span>
<span id="cb381-386"><a href="quasi-experimental.html#cb381-386" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-387"><a href="quasi-experimental.html#cb381-387" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================</span>                          <span class="er">|</span>  <span class="dv">63</span>%</span>
<span id="cb381-388"><a href="quasi-experimental.html#cb381-388" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-389"><a href="quasi-experimental.html#cb381-389" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================</span>                         <span class="er">|</span>  <span class="dv">64</span>%</span>
<span id="cb381-390"><a href="quasi-experimental.html#cb381-390" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-391"><a href="quasi-experimental.html#cb381-391" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================</span>                         <span class="er">|</span>  <span class="dv">65</span>%</span>
<span id="cb381-392"><a href="quasi-experimental.html#cb381-392" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-393"><a href="quasi-experimental.html#cb381-393" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================</span>                        <span class="er">|</span>  <span class="dv">66</span>%</span>
<span id="cb381-394"><a href="quasi-experimental.html#cb381-394" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-395"><a href="quasi-experimental.html#cb381-395" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================================</span>                       <span class="er">|</span>  <span class="dv">67</span>%</span>
<span id="cb381-396"><a href="quasi-experimental.html#cb381-396" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-397"><a href="quasi-experimental.html#cb381-397" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================</span>                      <span class="er">|</span>  <span class="dv">68</span>%</span>
<span id="cb381-398"><a href="quasi-experimental.html#cb381-398" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-399"><a href="quasi-experimental.html#cb381-399" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================</span>                      <span class="er">|</span>  <span class="dv">69</span>%</span>
<span id="cb381-400"><a href="quasi-experimental.html#cb381-400" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-401"><a href="quasi-experimental.html#cb381-401" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================</span>                     <span class="er">|</span>  <span class="dv">70</span>%</span>
<span id="cb381-402"><a href="quasi-experimental.html#cb381-402" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-403"><a href="quasi-experimental.html#cb381-403" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb381-404"><a href="quasi-experimental.html#cb381-404" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-405"><a href="quasi-experimental.html#cb381-405" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================</span>                   <span class="er">|</span>  <span class="dv">72</span>%</span>
<span id="cb381-406"><a href="quasi-experimental.html#cb381-406" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-407"><a href="quasi-experimental.html#cb381-407" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================</span>                   <span class="er">|</span>  <span class="dv">73</span>%</span>
<span id="cb381-408"><a href="quasi-experimental.html#cb381-408" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-409"><a href="quasi-experimental.html#cb381-409" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================</span>                  <span class="er">|</span>  <span class="dv">74</span>%</span>
<span id="cb381-410"><a href="quasi-experimental.html#cb381-410" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-411"><a href="quasi-experimental.html#cb381-411" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================</span>                 <span class="er">|</span>  <span class="dv">75</span>%</span>
<span id="cb381-412"><a href="quasi-experimental.html#cb381-412" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-413"><a href="quasi-experimental.html#cb381-413" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================</span>                 <span class="er">|</span>  <span class="dv">76</span>%</span>
<span id="cb381-414"><a href="quasi-experimental.html#cb381-414" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-415"><a href="quasi-experimental.html#cb381-415" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================</span>                <span class="er">|</span>  <span class="dv">77</span>%</span>
<span id="cb381-416"><a href="quasi-experimental.html#cb381-416" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-417"><a href="quasi-experimental.html#cb381-417" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================================</span>               <span class="er">|</span>  <span class="dv">78</span>%</span>
<span id="cb381-418"><a href="quasi-experimental.html#cb381-418" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-419"><a href="quasi-experimental.html#cb381-419" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================================</span>              <span class="er">|</span>  <span class="dv">79</span>%</span>
<span id="cb381-420"><a href="quasi-experimental.html#cb381-420" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-421"><a href="quasi-experimental.html#cb381-421" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================================</span>              <span class="er">|</span>  <span class="dv">80</span>%</span>
<span id="cb381-422"><a href="quasi-experimental.html#cb381-422" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-423"><a href="quasi-experimental.html#cb381-423" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================================</span>             <span class="er">|</span>  <span class="dv">81</span>%</span>
<span id="cb381-424"><a href="quasi-experimental.html#cb381-424" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-425"><a href="quasi-experimental.html#cb381-425" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================================</span>            <span class="er">|</span>  <span class="dv">82</span>%</span>
<span id="cb381-426"><a href="quasi-experimental.html#cb381-426" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-427"><a href="quasi-experimental.html#cb381-427" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================================</span>            <span class="er">|</span>  <span class="dv">84</span>%</span>
<span id="cb381-428"><a href="quasi-experimental.html#cb381-428" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-429"><a href="quasi-experimental.html#cb381-429" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================================</span>           <span class="er">|</span>  <span class="dv">85</span>%</span>
<span id="cb381-430"><a href="quasi-experimental.html#cb381-430" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-431"><a href="quasi-experimental.html#cb381-431" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb381-432"><a href="quasi-experimental.html#cb381-432" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-433"><a href="quasi-experimental.html#cb381-433" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================================</span>         <span class="er">|</span>  <span class="dv">87</span>%</span>
<span id="cb381-434"><a href="quasi-experimental.html#cb381-434" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-435"><a href="quasi-experimental.html#cb381-435" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================================</span>         <span class="er">|</span>  <span class="dv">88</span>%</span>
<span id="cb381-436"><a href="quasi-experimental.html#cb381-436" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-437"><a href="quasi-experimental.html#cb381-437" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================================</span>        <span class="er">|</span>  <span class="dv">89</span>%</span>
<span id="cb381-438"><a href="quasi-experimental.html#cb381-438" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-439"><a href="quasi-experimental.html#cb381-439" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============================================================</span>       <span class="er">|</span>  <span class="dv">90</span>%</span>
<span id="cb381-440"><a href="quasi-experimental.html#cb381-440" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-441"><a href="quasi-experimental.html#cb381-441" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">91</span>%</span>
<span id="cb381-442"><a href="quasi-experimental.html#cb381-442" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-443"><a href="quasi-experimental.html#cb381-443" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">92</span>%</span>
<span id="cb381-444"><a href="quasi-experimental.html#cb381-444" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-445"><a href="quasi-experimental.html#cb381-445" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================================</span>     <span class="er">|</span>  <span class="dv">93</span>%</span>
<span id="cb381-446"><a href="quasi-experimental.html#cb381-446" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-447"><a href="quasi-experimental.html#cb381-447" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================================</span>    <span class="er">|</span>  <span class="dv">94</span>%</span>
<span id="cb381-448"><a href="quasi-experimental.html#cb381-448" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-449"><a href="quasi-experimental.html#cb381-449" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================================</span>    <span class="er">|</span>  <span class="dv">95</span>%</span>
<span id="cb381-450"><a href="quasi-experimental.html#cb381-450" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-451"><a href="quasi-experimental.html#cb381-451" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================================</span>   <span class="er">|</span>  <span class="dv">96</span>%</span>
<span id="cb381-452"><a href="quasi-experimental.html#cb381-452" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-453"><a href="quasi-experimental.html#cb381-453" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================================</span>  <span class="er">|</span>  <span class="dv">97</span>%</span>
<span id="cb381-454"><a href="quasi-experimental.html#cb381-454" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-455"><a href="quasi-experimental.html#cb381-455" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================================</span> <span class="er">|</span>  <span class="dv">98</span>%</span>
<span id="cb381-456"><a href="quasi-experimental.html#cb381-456" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-457"><a href="quasi-experimental.html#cb381-457" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================================================</span> <span class="er">|</span>  <span class="dv">99</span>%</span>
<span id="cb381-458"><a href="quasi-experimental.html#cb381-458" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb381-459"><a href="quasi-experimental.html#cb381-459" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb381-460"><a href="quasi-experimental.html#cb381-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot covariates means </span></span>
<span id="cb381-461"><a href="quasi-experimental.html#cb381-461" aria-hidden="true" tabindex="-1"></a><span class="co"># plotPrunedMeans()</span></span>
<span id="cb381-462"><a href="quasi-experimental.html#cb381-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-463"><a href="quasi-experimental.html#cb381-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-464"><a href="quasi-experimental.html#cb381-464" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot estimates (deprecated)</span></span>
<span id="cb381-465"><a href="quasi-experimental.html#cb381-465" aria-hidden="true" tabindex="-1"></a><span class="co"># plotEstimates(</span></span>
<span id="cb381-466"><a href="quasi-experimental.html#cb381-466" aria-hidden="true" tabindex="-1"></a><span class="co">#     L1.estimates,</span></span>
<span id="cb381-467"><a href="quasi-experimental.html#cb381-467" aria-hidden="true" tabindex="-1"></a><span class="co">#     ylim = c(-10000, 3000),</span></span>
<span id="cb381-468"><a href="quasi-experimental.html#cb381-468" aria-hidden="true" tabindex="-1"></a><span class="co">#     cex.lab = 1.4,</span></span>
<span id="cb381-469"><a href="quasi-experimental.html#cb381-469" aria-hidden="true" tabindex="-1"></a><span class="co">#     cex.axis = 1.4,</span></span>
<span id="cb381-470"><a href="quasi-experimental.html#cb381-470" aria-hidden="true" tabindex="-1"></a><span class="co">#     panel.first = grid(NULL, NULL, lwd = 2,)</span></span>
<span id="cb381-471"><a href="quasi-experimental.html#cb381-471" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb381-472"><a href="quasi-experimental.html#cb381-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-473"><a href="quasi-experimental.html#cb381-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot estimates</span></span>
<span id="cb381-474"><a href="quasi-experimental.html#cb381-474" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMeans</span>(L1.frontier)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-58-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># parallel plot</span>
<span class="fu">parallelPlot</span><span class="op">(</span>
    <span class="va">L1.frontier</span>,
    N <span class="op">=</span> <span class="fl">400</span>,
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'age'</span>, <span class="st">'re74'</span>, <span class="st">'re75'</span>, <span class="st">'black'</span><span class="op">)</span>,
    treated.col <span class="op">=</span> <span class="st">'blue'</span>,
    control.col <span class="op">=</span> <span class="st">'gray'</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="20-quasi-experimental_files/figure-html/unnamed-chunk-58-2.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># export matched dataset</span>
<span class="va">matched.data</span> <span class="op">&lt;-</span> <span class="fu">generateDataset</span><span class="op">(</span><span class="va">L1.frontier</span>, N <span class="op">=</span> <span class="fl">400</span><span class="op">)</span> <span class="co"># take 400 units</span></code></pre></div>
</div>
<div id="propensity-scores" class="section level3" number="20.5.3">
<h3>
<span class="header-section-number">20.5.3</span> Propensity Scores<a class="anchor" aria-label="anchor" href="#propensity-scores"><i class="fas fa-link"></i></a>
</h3>
<p>Even though I mention the propensity scores matching method here, it is no longer recommended to use such method in research and publication <span class="citation">(<a href="references.html#ref-King_2019" role="doc-biblioref">G. King and Nielsen 2019</a>)</span> because it increases</p>
<ul>
<li><p>imbalance</p></li>
<li><p>inefficiency</p></li>
<li><p>model dependence: small changes in the model specification lead to big changes in model results</p></li>
<li><p>bias</p></li>
</ul>
<p>PSM tries to accomplish complete randomization while other methods try to achieve fully blocked. Hence, you probably better off use any other methods.</p>
<p>Propensity is “the probability of receiving the treatment given the observed covariates.” <span class="citation">(<a href="references.html#ref-Rosenbaum_1985" role="doc-biblioref">Rosenbaum and Rubin 1985</a>)</span></p>
<p>Equivalently, it can to understood as the probability of being treated.</p>
<p><span class="math display">\[
e_i (X_i) = P(T_i = 1 | X_i)
\]</span></p>
<p>Estimation using</p>
<ul>
<li><p>logistic regression</p></li>
<li>
<p>Non parametric methods:</p>
<ul>
<li><p>boosted CART</p></li>
<li><p>generalized boosted models (gbm)</p></li>
</ul>
</li>
</ul>
<p>Steps by Gary King’s <a href="https://www.youtube.com/watch?v=rBv39pK1iEs&amp;ab_channel=MethodsColloquium">slides</a></p>
<ul>
<li><p>reduce k elements of X to scalar</p></li>
<li><p><span class="math inline">\(\pi_i \equiv P(T_i = 1|X) = \frac{1}{1+e^{X_i \beta}}\)</span></p></li>
<li><p>Distance (<span class="math inline">\(X_c, X_t\)</span>) = <span class="math inline">\(|\pi_c - \pi_t|\)</span></p></li>
<li><p>match each treated unit to the nearest control unit</p></li>
<li><p>control units: not reused; pruned if unused</p></li>
<li><p>prune matches if distances &gt; caliper</p></li>
</ul>
<p>In the best case scenario, you randomly prune, which increases imbalance</p>
<p>Other methods dominate because they try to match exactly hence</p>
<ul>
<li><p><span class="math inline">\(X_c = X_t \to \pi_c = \pi_t\)</span> (exact match leads to equal propensity scores) but</p></li>
<li><p><span class="math inline">\(\pi_c = \pi_t \nrightarrow X_c = X_t\)</span> (equal propensity scores do not necessarily lead to exact match)</p></li>
</ul>
<p>Do not include/control for irrelevant covariates because it leads your PSM to be more random, hence more imbalance</p>
<p>What you left with after pruning is more important than what you start with then throw out.</p>
<p>Diagnostics:</p>
<ul>
<li><p>balance of the covariates</p></li>
<li><p>no need to concern about collinearity</p></li>
<li><p>can’t use c-stat or stepwise because those model fit stat do not apply</p></li>
</ul>
<p><br></p>
</div>
<div id="mahalanobis-distance" class="section level3" number="20.5.4">
<h3>
<span class="header-section-number">20.5.4</span> Mahalanobis Distance<a class="anchor" aria-label="anchor" href="#mahalanobis-distance"><i class="fas fa-link"></i></a>
</h3>
<p>Approximates fully blocked experiment</p>
<p>Distance <span class="math inline">\((X_c,X_t)\)</span> = <span class="math inline">\(\sqrt{(X_c - X_t)'S^{-1}(X_c - X_t)}\)</span></p>
<p>where <span class="math inline">\(S^{-1}\)</span> standardize the distance</p>
<p>In application we use Euclidean distance.</p>
<p>Prune unused control units, and prune matches if distance &gt; caliper</p>
</div>
<div id="coarsened-exact-matching" class="section level3" number="20.5.5">
<h3>
<span class="header-section-number">20.5.5</span> Coarsened Exact Matching<a class="anchor" aria-label="anchor" href="#coarsened-exact-matching"><i class="fas fa-link"></i></a>
</h3>
<p>Steps from Gray King’s <a href="https://www.youtube.com/watch?v=rBv39pK1iEs&amp;ab_channel=MethodsColloquium">slides</a> International Methods Colloquium talk 2015</p>
<ul>
<li><p>Temporarily coarsen X</p></li>
<li>
<p>Apply exact matching to the coarsened X, C(X)</p>
<ul>
<li><p>sort observation into strata, each with unique values of C(X)</p></li>
<li><p>prune stratum with 0 treated or 0 control units</p></li>
</ul>
</li>
<li><p>Pass on original (uncoarsened) units except those pruned</p></li>
</ul>
<p><br></p>
<p>Properties:</p>
<ul>
<li>
<p>Monotonic imbalance bounding (MIB) matching method</p>
<ul>
<li>maximum imbalance between the treated and control chosen ex ante</li>
</ul>
</li>
<li><p>meets congruence principle</p></li>
<li><p>robust to measurement error</p></li>
<li><p>can be implemented with multiple imputation</p></li>
<li><p>works well for multi-category treatments</p></li>
</ul>
<p>Assumptions:</p>
<ul>
<li>Ignorability (i.e., no omitted variable bias)</li>
</ul>
<p>More detail in <span class="citation">(<a href="references.html#ref-Iacus_2012" role="doc-biblioref">Iacus, King, and Porro 2012</a>)</span></p>
<p>Example by <a href="https://cran.r-project.org/web/packages/cem/vignettes/cem.pdf">package’s authors</a></p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gking.harvard.edu/cem">cem</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">LeLonde</span><span class="op">)</span>

<span class="va">Le</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">LeLonde</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove missing data</span>
<span class="co"># treated and control groups</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">treated</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
<span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">treated</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>
<span class="va">ntr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span>
<span class="va">nct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ct</span><span class="op">)</span>

<span class="co"># unadjusted, biased difference in means</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">re78</span><span class="op">[</span><span class="va">tr</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">re78</span><span class="op">[</span><span class="va">ct</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 759.0479</span>
<span class="co"># pre-treatment covariates</span>
<span class="va">vars</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"age"</span>,
        <span class="st">"education"</span>,
        <span class="st">"black"</span>,
        <span class="st">"married"</span>,
        <span class="st">"nodegree"</span>,
        <span class="st">"re74"</span>,
        <span class="st">"re75"</span>,
        <span class="st">"hispanic"</span>,
        <span class="st">"u74"</span>,
        <span class="st">"u75"</span>,
        <span class="st">"q1"</span>
    <span class="op">)</span>

<span class="co"># overall imbalance statistics</span>
<span class="fu"><a href="https://rdrr.io/pkg/cem/man/imbalance.html">imbalance</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">Le</span><span class="op">$</span><span class="va">treated</span>, data<span class="op">=</span><span class="va">Le</span><span class="op">[</span><span class="va">vars</span><span class="op">]</span><span class="op">)</span> <span class="co"># L1 = 0.902</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate Imbalance Measure: L1=0.902</span>
<span class="co">#&gt; Percentage of local common support: LCS=5.8%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate Imbalance Measures:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               statistic   type           L1 min 25%      50%       75%</span>
<span class="co">#&gt; age        -0.252373042 (diff) 5.102041e-03   0   0   0.0000   -1.0000</span>
<span class="co">#&gt; education   0.153634710 (diff) 8.463851e-02   1   0   1.0000    1.0000</span>
<span class="co">#&gt; black      -0.010322734 (diff) 1.032273e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; married    -0.009551495 (diff) 9.551495e-03   0   0   0.0000    0.0000</span>
<span class="co">#&gt; nodegree   -0.081217371 (diff) 8.121737e-02   0  -1   0.0000    0.0000</span>
<span class="co">#&gt; re74      -18.160446880 (diff) 5.551115e-17   0   0 284.0715  806.3452</span>
<span class="co">#&gt; re75      101.501761679 (diff) 5.551115e-17   0   0 485.6310 1238.4114</span>
<span class="co">#&gt; hispanic   -0.010144756 (diff) 1.014476e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; u74        -0.045582186 (diff) 4.558219e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; u75        -0.065555292 (diff) 6.555529e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; q1          7.494021189 (Chi2) 1.067078e-01  NA  NA       NA        NA</span>
<span class="co">#&gt;                  max</span>
<span class="co">#&gt; age          -6.0000</span>
<span class="co">#&gt; education     1.0000</span>
<span class="co">#&gt; black         0.0000</span>
<span class="co">#&gt; married       0.0000</span>
<span class="co">#&gt; nodegree      0.0000</span>
<span class="co">#&gt; re74      -2139.0195</span>
<span class="co">#&gt; re75        490.3945</span>
<span class="co">#&gt; hispanic      0.0000</span>
<span class="co">#&gt; u74           0.0000</span>
<span class="co">#&gt; u75           0.0000</span>
<span class="co">#&gt; q1                NA</span>
<span class="co"># drop other variables that are not pre-treatmentt matching variables</span>
<span class="va">todrop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"treated"</span>, <span class="st">"re78"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/cem/man/imbalance.html">imbalance</a></span><span class="op">(</span>group<span class="op">=</span><span class="va">Le</span><span class="op">$</span><span class="va">treated</span>, data<span class="op">=</span><span class="va">Le</span>, drop<span class="op">=</span><span class="va">todrop</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multivariate Imbalance Measure: L1=0.902</span>
<span class="co">#&gt; Percentage of local common support: LCS=5.8%</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate Imbalance Measures:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               statistic   type           L1 min 25%      50%       75%</span>
<span class="co">#&gt; age        -0.252373042 (diff) 5.102041e-03   0   0   0.0000   -1.0000</span>
<span class="co">#&gt; education   0.153634710 (diff) 8.463851e-02   1   0   1.0000    1.0000</span>
<span class="co">#&gt; black      -0.010322734 (diff) 1.032273e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; married    -0.009551495 (diff) 9.551495e-03   0   0   0.0000    0.0000</span>
<span class="co">#&gt; nodegree   -0.081217371 (diff) 8.121737e-02   0  -1   0.0000    0.0000</span>
<span class="co">#&gt; re74      -18.160446880 (diff) 5.551115e-17   0   0 284.0715  806.3452</span>
<span class="co">#&gt; re75      101.501761679 (diff) 5.551115e-17   0   0 485.6310 1238.4114</span>
<span class="co">#&gt; hispanic   -0.010144756 (diff) 1.014476e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; u74        -0.045582186 (diff) 4.558219e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; u75        -0.065555292 (diff) 6.555529e-02   0   0   0.0000    0.0000</span>
<span class="co">#&gt; q1          7.494021189 (Chi2) 1.067078e-01  NA  NA       NA        NA</span>
<span class="co">#&gt;                  max</span>
<span class="co">#&gt; age          -6.0000</span>
<span class="co">#&gt; education     1.0000</span>
<span class="co">#&gt; black         0.0000</span>
<span class="co">#&gt; married       0.0000</span>
<span class="co">#&gt; nodegree      0.0000</span>
<span class="co">#&gt; re74      -2139.0195</span>
<span class="co">#&gt; re75        490.3945</span>
<span class="co">#&gt; hispanic      0.0000</span>
<span class="co">#&gt; u74           0.0000</span>
<span class="co">#&gt; u75           0.0000</span>
<span class="co">#&gt; q1                NA</span></code></pre></div>
<p>automated coarsening</p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cem/man/cem.html">cem</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="st">"treated"</span>, data <span class="op">=</span> <span class="va">Le</span>, drop <span class="op">=</span> <span class="st">"re78"</span>,keep.all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 'treated'='1' as baseline group</span>
<span class="va">mat</span>
<span class="co">#&gt;            G0  G1</span>
<span class="co">#&gt; All       392 258</span>
<span class="co">#&gt; Matched    95  84</span>
<span class="co">#&gt; Unmatched 297 174</span>
<span class="co"># mat$w</span></code></pre></div>
<p>coarsening by explicit user choice</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># categorial variables</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">q1</span><span class="op">)</span> <span class="co"># grouping option</span>
<span class="co">#&gt; [1] "agree"             "disagree"          "neutral"          </span>
<span class="co">#&gt; [4] "no opinion"        "strongly agree"    "strongly disagree"</span>
<span class="va">q1.grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"strongly agree"</span>, <span class="st">"agree"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"neutral"</span>, <span class="st">"no opinion"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"strongly disagree"</span>,<span class="st">"disagree"</span><span class="op">)</span><span class="op">)</span> <span class="co"># if you want ordered categories</span>

<span class="co"># continuous variables </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">Le</span><span class="op">$</span><span class="va">education</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   3   4   5   6   7   8   9  10  11  12  13  14  15 </span>
<span class="co">#&gt;   1   5   4   6  12  55 106 146 173 113  19   9   1</span>
<span class="va">educut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">8.5</span>, <span class="fl">12.5</span>, <span class="fl">17</span><span class="op">)</span>  <span class="co"># use cutpoints</span>

<span class="va">mat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cem/man/cem.html">cem</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="st">"treated"</span>, data <span class="op">=</span> <span class="va">Le</span>, drop <span class="op">=</span> <span class="st">"re78"</span>, cutpoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>education<span class="op">=</span><span class="va">educut</span><span class="op">)</span>, grouping<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>q1<span class="op">=</span><span class="va">q1.grp</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 'treated'='1' as baseline group</span>
<span class="va">mat1</span>
<span class="co">#&gt;            G0  G1</span>
<span class="co">#&gt; All       392 258</span>
<span class="co">#&gt; Matched   158 115</span>
<span class="co">#&gt; Unmatched 234 143</span></code></pre></div>
<ul>
<li><p>Can also use progressive coarsening method to control the number of matches.</p></li>
<li><p><code>cem</code> can also handle some missingness.</p></li>
</ul>
</div>
<div id="genetic-matching" class="section level3" number="20.5.6">
<h3>
<span class="header-section-number">20.5.6</span> Genetic Matching<a class="anchor" aria-label="anchor" href="#genetic-matching"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>GM uses iterative checking process of propensity scores, which combines propensity scores and Mahalanobis distance.</li>
</ul>
<!-- --><ul>
<li>GM is arguably “superior” method than nearest neighbor or full matching in imbalanced data</li>
</ul>
<!-- --><ul>
<li><p>Use a genetic search algorithm to find weights for each covariate such that we have optimal balance.</p></li>
<li>
<p>Implementation</p>
<ul>
<li><p>could use <em>with replacement</em></p></li>
<li>
<p>balance can be based on</p>
<ul>
<li><p>paired t-tests (dichotomous variables)</p></li>
<li><p>Kolmogorov-Smirnov (multinomial and continuous)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Packages</p>
<p><code>Matching</code></p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sekhon.berkeley.edu/matching/">Matching</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/attach.html">attach</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span>

<span class="co">#The covariates we want to match on</span>
<span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">educ</span>, <span class="va">black</span>, <span class="va">hisp</span>, <span class="va">married</span>, <span class="va">nodegr</span>, <span class="va">u74</span>, <span class="va">u75</span>, <span class="va">re75</span>, <span class="va">re74</span><span class="op">)</span>

<span class="co">#The covariates we want to obtain balance on</span>
<span class="va">BalanceMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">educ</span>, <span class="va">black</span>, <span class="va">hisp</span>, <span class="va">married</span>, <span class="va">nodegr</span>, <span class="va">u74</span>, <span class="va">u75</span>, <span class="va">re75</span>, <span class="va">re74</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">re74</span><span class="op">*</span><span class="va">re75</span><span class="op">)</span><span class="op">)</span>

<span class="co">#</span>
<span class="co">#Let's call GenMatch() to find the optimal weight to give each</span>
<span class="co">#covariate in 'X' so as we have achieved balance on the covariates in</span>
<span class="co">#'BalanceMat'. This is only an example so we want GenMatch to be quick</span>
<span class="co">#so the population size has been set to be only 16 via the 'pop.size'</span>
<span class="co">#option. This is *WAY* too small for actual problems.</span>
<span class="co">#For details see http://sekhon.berkeley.edu/papers/MatchingJSS.pdf.</span>
<span class="co">#</span>
<span class="va">genout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/GenMatch.html">GenMatch</a></span><span class="op">(</span>Tr<span class="op">=</span><span class="va">treat</span>, X<span class="op">=</span><span class="va">X</span>, BalanceMatrix<span class="op">=</span><span class="va">BalanceMat</span>, estimand<span class="op">=</span><span class="st">"ATE"</span>, M<span class="op">=</span><span class="fl">1</span>,
                   pop.size<span class="op">=</span><span class="fl">16</span>, max.generations<span class="op">=</span><span class="fl">10</span>, wait.generations<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mon Jan 03 21:35:52 2022</span>
<span class="co">#&gt; Domains:</span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X1   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X2   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X3   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X4   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X5   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X6   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X7   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X8   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X9   &lt;=    1.000000e+03 </span>
<span class="co">#&gt;  0.000000e+00   &lt;=  X10  &lt;=    1.000000e+03 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Data Type: Floating Point</span>
<span class="co">#&gt; Operators (code number, name, population) </span>
<span class="co">#&gt;  (1) Cloning...........................  1</span>
<span class="co">#&gt;  (2) Uniform Mutation..................  2</span>
<span class="co">#&gt;  (3) Boundary Mutation.................  2</span>
<span class="co">#&gt;  (4) Non-Uniform Mutation..............  2</span>
<span class="co">#&gt;  (5) Polytope Crossover................  2</span>
<span class="co">#&gt;  (6) Simple Crossover..................  2</span>
<span class="co">#&gt;  (7) Whole Non-Uniform Mutation........  2</span>
<span class="co">#&gt;  (8) Heuristic Crossover...............  2</span>
<span class="co">#&gt;  (9) Local-Minimum Crossover...........  0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SOFT Maximum Number of Generations: 10</span>
<span class="co">#&gt; Maximum Nonchanging Generations: 1</span>
<span class="co">#&gt; Population size       : 16</span>
<span class="co">#&gt; Convergence Tolerance: 1.000000e-03</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Not Using the BFGS Derivative Based Optimizer on the Best Individual Each Generation.</span>
<span class="co">#&gt; Not Checking Gradients before Stopping.</span>
<span class="co">#&gt; Using Out of Bounds Individuals.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximization Problem.</span>
<span class="co">#&gt; GENERATION: 0 (initializing the population)</span>
<span class="co">#&gt; Lexical Fit..... 1.747466e-01  1.795176e-01  1.795176e-01  2.755332e-01  3.173114e-01  3.173114e-01  3.857502e-01  3.937274e-01  7.390086e-01  7.390086e-01  8.024999e-01  8.910491e-01  9.688444e-01  9.917159e-01  9.989079e-01  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  </span>
<span class="co">#&gt; #unique......... 16, #Total UniqueCount: 16</span>
<span class="co">#&gt; var 1:</span>
<span class="co">#&gt; best............ 3.758091e+02</span>
<span class="co">#&gt; mean............ 4.897395e+02</span>
<span class="co">#&gt; variance........ 9.320437e+04</span>
<span class="co">#&gt; var 2:</span>
<span class="co">#&gt; best............ 4.944768e+02</span>
<span class="co">#&gt; mean............ 5.218593e+02</span>
<span class="co">#&gt; variance........ 6.830606e+04</span>
<span class="co">#&gt; var 3:</span>
<span class="co">#&gt; best............ 1.880547e+02</span>
<span class="co">#&gt; mean............ 4.838327e+02</span>
<span class="co">#&gt; variance........ 1.030481e+05</span>
<span class="co">#&gt; var 4:</span>
<span class="co">#&gt; best............ 8.125678e+02</span>
<span class="co">#&gt; mean............ 4.445995e+02</span>
<span class="co">#&gt; variance........ 8.135038e+04</span>
<span class="co">#&gt; var 5:</span>
<span class="co">#&gt; best............ 9.058067e+02</span>
<span class="co">#&gt; mean............ 4.753729e+02</span>
<span class="co">#&gt; variance........ 1.184631e+05</span>
<span class="co">#&gt; var 6:</span>
<span class="co">#&gt; best............ 1.733063e+02</span>
<span class="co">#&gt; mean............ 4.782400e+02</span>
<span class="co">#&gt; variance........ 8.948808e+04</span>
<span class="co">#&gt; var 7:</span>
<span class="co">#&gt; best............ 5.766096e+02</span>
<span class="co">#&gt; mean............ 4.722599e+02</span>
<span class="co">#&gt; variance........ 7.199369e+04</span>
<span class="co">#&gt; var 8:</span>
<span class="co">#&gt; best............ 3.736603e+02</span>
<span class="co">#&gt; mean............ 4.108310e+02</span>
<span class="co">#&gt; variance........ 8.454007e+04</span>
<span class="co">#&gt; var 9:</span>
<span class="co">#&gt; best............ 5.987977e+02</span>
<span class="co">#&gt; mean............ 3.762504e+02</span>
<span class="co">#&gt; variance........ 7.462591e+04</span>
<span class="co">#&gt; var 10:</span>
<span class="co">#&gt; best............ 5.352480e+02</span>
<span class="co">#&gt; mean............ 4.491692e+02</span>
<span class="co">#&gt; variance........ 8.739694e+04</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GENERATION: 1</span>
<span class="co">#&gt; Lexical Fit..... 1.747466e-01  1.795176e-01  1.795176e-01  2.755332e-01  3.173114e-01  3.173114e-01  3.857502e-01  3.937274e-01  7.390086e-01  7.390086e-01  8.024999e-01  8.910491e-01  9.688444e-01  9.917159e-01  9.989079e-01  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  </span>
<span class="co">#&gt; #unique......... 12, #Total UniqueCount: 28</span>
<span class="co">#&gt; var 1:</span>
<span class="co">#&gt; best............ 3.758091e+02</span>
<span class="co">#&gt; mean............ 3.556052e+02</span>
<span class="co">#&gt; variance........ 6.953381e+03</span>
<span class="co">#&gt; var 2:</span>
<span class="co">#&gt; best............ 4.944768e+02</span>
<span class="co">#&gt; mean............ 5.087018e+02</span>
<span class="co">#&gt; variance........ 3.156408e+03</span>
<span class="co">#&gt; var 3:</span>
<span class="co">#&gt; best............ 1.880547e+02</span>
<span class="co">#&gt; mean............ 1.798786e+02</span>
<span class="co">#&gt; variance........ 4.539894e+03</span>
<span class="co">#&gt; var 4:</span>
<span class="co">#&gt; best............ 8.125678e+02</span>
<span class="co">#&gt; mean............ 6.669235e+02</span>
<span class="co">#&gt; variance........ 5.540181e+04</span>
<span class="co">#&gt; var 5:</span>
<span class="co">#&gt; best............ 9.058067e+02</span>
<span class="co">#&gt; mean............ 9.117080e+02</span>
<span class="co">#&gt; variance........ 3.397508e+03</span>
<span class="co">#&gt; var 6:</span>
<span class="co">#&gt; best............ 1.733063e+02</span>
<span class="co">#&gt; mean............ 2.041563e+02</span>
<span class="co">#&gt; variance........ 3.552940e+04</span>
<span class="co">#&gt; var 7:</span>
<span class="co">#&gt; best............ 5.766096e+02</span>
<span class="co">#&gt; mean............ 4.995566e+02</span>
<span class="co">#&gt; variance........ 2.585541e+04</span>
<span class="co">#&gt; var 8:</span>
<span class="co">#&gt; best............ 3.736603e+02</span>
<span class="co">#&gt; mean............ 5.068097e+02</span>
<span class="co">#&gt; variance........ 4.273372e+04</span>
<span class="co">#&gt; var 9:</span>
<span class="co">#&gt; best............ 5.987977e+02</span>
<span class="co">#&gt; mean............ 4.917595e+02</span>
<span class="co">#&gt; variance........ 3.084008e+04</span>
<span class="co">#&gt; var 10:</span>
<span class="co">#&gt; best............ 5.352480e+02</span>
<span class="co">#&gt; mean............ 5.445554e+02</span>
<span class="co">#&gt; variance........ 8.587358e+03</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; GENERATION: 2</span>
<span class="co">#&gt; Lexical Fit..... 1.747466e-01  1.795176e-01  1.795176e-01  2.755332e-01  3.173114e-01  3.173114e-01  3.857502e-01  3.937274e-01  7.390086e-01  7.390086e-01  8.024999e-01  8.910491e-01  9.688444e-01  9.917159e-01  9.989079e-01  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  </span>
<span class="co">#&gt; #unique......... 8, #Total UniqueCount: 36</span>
<span class="co">#&gt; var 1:</span>
<span class="co">#&gt; best............ 3.758091e+02</span>
<span class="co">#&gt; mean............ 3.562379e+02</span>
<span class="co">#&gt; variance........ 2.385358e+03</span>
<span class="co">#&gt; var 2:</span>
<span class="co">#&gt; best............ 4.944768e+02</span>
<span class="co">#&gt; mean............ 4.956205e+02</span>
<span class="co">#&gt; variance........ 1.566415e+02</span>
<span class="co">#&gt; var 3:</span>
<span class="co">#&gt; best............ 1.880547e+02</span>
<span class="co">#&gt; mean............ 2.166244e+02</span>
<span class="co">#&gt; variance........ 6.801191e+03</span>
<span class="co">#&gt; var 4:</span>
<span class="co">#&gt; best............ 8.125678e+02</span>
<span class="co">#&gt; mean............ 8.059555e+02</span>
<span class="co">#&gt; variance........ 6.565662e+02</span>
<span class="co">#&gt; var 5:</span>
<span class="co">#&gt; best............ 9.058067e+02</span>
<span class="co">#&gt; mean............ 8.852994e+02</span>
<span class="co">#&gt; variance........ 3.056774e+03</span>
<span class="co">#&gt; var 6:</span>
<span class="co">#&gt; best............ 1.733063e+02</span>
<span class="co">#&gt; mean............ 2.210856e+02</span>
<span class="co">#&gt; variance........ 2.369334e+04</span>
<span class="co">#&gt; var 7:</span>
<span class="co">#&gt; best............ 5.766096e+02</span>
<span class="co">#&gt; mean............ 5.482967e+02</span>
<span class="co">#&gt; variance........ 4.613957e+03</span>
<span class="co">#&gt; var 8:</span>
<span class="co">#&gt; best............ 3.736603e+02</span>
<span class="co">#&gt; mean............ 3.943396e+02</span>
<span class="co">#&gt; variance........ 1.895797e+03</span>
<span class="co">#&gt; var 9:</span>
<span class="co">#&gt; best............ 5.987977e+02</span>
<span class="co">#&gt; mean............ 6.005851e+02</span>
<span class="co">#&gt; variance........ 3.308459e+02</span>
<span class="co">#&gt; var 10:</span>
<span class="co">#&gt; best............ 5.352480e+02</span>
<span class="co">#&gt; mean............ 5.444285e+02</span>
<span class="co">#&gt; variance........ 4.950778e+02</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 'wait.generations' limit reached.</span>
<span class="co">#&gt; No significant improvement in 1 generations.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Solution Lexical Fitness Value:</span>
<span class="co">#&gt; 1.747466e-01  1.795176e-01  1.795176e-01  2.755332e-01  3.173114e-01  3.173114e-01  3.857502e-01  3.937274e-01  7.390086e-01  7.390086e-01  8.024999e-01  8.910491e-01  9.688444e-01  9.917159e-01  9.989079e-01  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  1.000000e+00  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parameters at the Solution:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  X[ 1] : 3.758091e+02</span>
<span class="co">#&gt;  X[ 2] : 4.944768e+02</span>
<span class="co">#&gt;  X[ 3] : 1.880547e+02</span>
<span class="co">#&gt;  X[ 4] : 8.125678e+02</span>
<span class="co">#&gt;  X[ 5] : 9.058067e+02</span>
<span class="co">#&gt;  X[ 6] : 1.733063e+02</span>
<span class="co">#&gt;  X[ 7] : 5.766096e+02</span>
<span class="co">#&gt;  X[ 8] : 3.736603e+02</span>
<span class="co">#&gt;  X[ 9] : 5.987977e+02</span>
<span class="co">#&gt;  X[10] : 5.352480e+02</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Solution Found Generation 1</span>
<span class="co">#&gt; Number of Generations Run 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mon Jan 03 21:35:53 2022</span>
<span class="co">#&gt; Total run time : 0 hours 0 minutes and 1 seconds</span>
<span class="co">#The outcome variable</span>
<span class="va">Y</span><span class="op">=</span><span class="va">re78</span><span class="op">/</span><span class="fl">1000</span>

<span class="co">#</span>
<span class="co"># Now that GenMatch() has found the optimal weights, let's estimate</span>
<span class="co"># our causal effect of interest using those weights</span>
<span class="co">#</span>
<span class="va">mout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/Match.html">Match</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, Tr<span class="op">=</span><span class="va">treat</span>, X<span class="op">=</span><span class="va">X</span>, estimand<span class="op">=</span><span class="st">"ATE"</span>, Weight.matrix<span class="op">=</span><span class="va">genout</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">mout</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate...  1.9046 </span>
<span class="co">#&gt; AI SE......  0.82198 </span>
<span class="co">#&gt; T-stat.....  2.3171 </span>
<span class="co">#&gt; p.val......  0.020498 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Original number of observations..............  445 </span>
<span class="co">#&gt; Original number of treated obs...............  185 </span>
<span class="co">#&gt; Matched number of observations...............  445 </span>
<span class="co">#&gt; Matched number of observations  (unweighted).  597</span>
<span class="co">#                        </span>
<span class="co">#Let's determine if balance has actually been obtained on the variables of interest</span>
<span class="co">#                        </span>
<span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matching/man/MatchBalance.html">MatchBalance</a></span><span class="op">(</span><span class="va">treat</span><span class="op">~</span><span class="va">age</span> <span class="op">+</span><span class="va">educ</span><span class="op">+</span><span class="va">black</span><span class="op">+</span> <span class="va">hisp</span><span class="op">+</span> <span class="va">married</span><span class="op">+</span> <span class="va">nodegr</span><span class="op">+</span> <span class="va">u74</span><span class="op">+</span> <span class="va">u75</span><span class="op">+</span>
                   <span class="va">re75</span><span class="op">+</span> <span class="va">re74</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">re74</span><span class="op">*</span><span class="va">re75</span><span class="op">)</span>,
                   match.out<span class="op">=</span><span class="va">mout</span>, nboots<span class="op">=</span><span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V1) age *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........     25.816             25.112 </span>
<span class="co">#&gt; mean control..........     25.054             24.902 </span>
<span class="co">#&gt; std mean diff.........     10.655             3.1286 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....    0.94054            0.36181 </span>
<span class="co">#&gt; med  raw eQQ diff.....          1                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          7                  8 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.025364          0.0099025 </span>
<span class="co">#&gt; med  eCDF diff........   0.022193          0.0075377 </span>
<span class="co">#&gt; max  eCDF diff........   0.065177           0.028476 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.0278            0.98286 </span>
<span class="co">#&gt; T-test p-value........    0.26594            0.27553 </span>
<span class="co">#&gt; KS Bootstrap p-value..      0.504              0.842 </span>
<span class="co">#&gt; KS Naive p-value......     0.7481            0.96884 </span>
<span class="co">#&gt; KS Statistic..........   0.065177           0.028476 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V2) educ *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........     10.346             10.189 </span>
<span class="co">#&gt; mean control..........     10.088             10.222 </span>
<span class="co">#&gt; std mean diff.........     12.806            -1.9653 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....    0.40541           0.098827 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          2                  2 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.028698          0.0070591 </span>
<span class="co">#&gt; med  eCDF diff........   0.012682          0.0033501 </span>
<span class="co">#&gt; max  eCDF diff........    0.12651           0.033501 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.5513             1.0458 </span>
<span class="co">#&gt; T-test p-value........    0.15017            0.38575 </span>
<span class="co">#&gt; KS Bootstrap p-value..       0.02              0.454 </span>
<span class="co">#&gt; KS Naive p-value......   0.062873            0.89105 </span>
<span class="co">#&gt; KS Statistic..........    0.12651           0.033501 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V3) black *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........    0.84324             0.8382 </span>
<span class="co">#&gt; mean control..........    0.82692             0.8382 </span>
<span class="co">#&gt; std mean diff.........     4.4767                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....   0.016216                  0 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........  0.0081601                  0 </span>
<span class="co">#&gt; med  eCDF diff........  0.0081601                  0 </span>
<span class="co">#&gt; max  eCDF diff........    0.01632                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....    0.92503                  1 </span>
<span class="co">#&gt; T-test p-value........    0.64736                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V4) hisp *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........   0.059459            0.08764 </span>
<span class="co">#&gt; mean control..........    0.10769            0.08764 </span>
<span class="co">#&gt; std mean diff.........    -20.341                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....   0.048649                  0 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.024116                  0 </span>
<span class="co">#&gt; med  eCDF diff........   0.024116                  0 </span>
<span class="co">#&gt; max  eCDF diff........   0.048233                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....    0.58288                  1 </span>
<span class="co">#&gt; T-test p-value........   0.064043                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V5) married *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........    0.18919            0.16854 </span>
<span class="co">#&gt; mean control..........    0.15385            0.16854 </span>
<span class="co">#&gt; std mean diff.........     8.9995                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....   0.037838                  0 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.017672                  0 </span>
<span class="co">#&gt; med  eCDF diff........   0.017672                  0 </span>
<span class="co">#&gt; max  eCDF diff........   0.035343                  0 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.1802                  1 </span>
<span class="co">#&gt; T-test p-value........    0.33425                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V6) nodegr *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........    0.70811            0.78876 </span>
<span class="co">#&gt; mean control..........    0.83462            0.78652 </span>
<span class="co">#&gt; std mean diff.........    -27.751            0.54991 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....    0.12432           0.001675 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.063254         0.00083752 </span>
<span class="co">#&gt; med  eCDF diff........   0.063254         0.00083752 </span>
<span class="co">#&gt; max  eCDF diff........    0.12651           0.001675 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.4998             0.9923 </span>
<span class="co">#&gt; T-test p-value........  0.0020368            0.73901 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V7) u74 *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........    0.70811            0.73258 </span>
<span class="co">#&gt; mean control..........       0.75            0.73034 </span>
<span class="co">#&gt; std mean diff.........    -9.1895            0.50714 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....   0.037838           0.001675 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.020946         0.00083752 </span>
<span class="co">#&gt; med  eCDF diff........   0.020946         0.00083752 </span>
<span class="co">#&gt; max  eCDF diff........   0.041892           0.001675 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.1041            0.99472 </span>
<span class="co">#&gt; T-test p-value........    0.33033            0.31731 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V8) u75 *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........        0.6            0.64494 </span>
<span class="co">#&gt; mean control..........    0.68462            0.65169 </span>
<span class="co">#&gt; std mean diff.........    -17.225            -1.4072 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....   0.081081          0.0050251 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....          1                  1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.042308          0.0025126 </span>
<span class="co">#&gt; med  eCDF diff........   0.042308          0.0025126 </span>
<span class="co">#&gt; max  eCDF diff........   0.084615          0.0050251 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.1133             1.0088 </span>
<span class="co">#&gt; T-test p-value........   0.068031            0.17952 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V9) re75 *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........     1532.1             1300.3 </span>
<span class="co">#&gt; mean control..........     1266.9             1317.3 </span>
<span class="co">#&gt; std mean diff.........     8.2363            -0.5676 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....     367.61             104.16 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....     2110.2             2510.6 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.050834          0.0080924 </span>
<span class="co">#&gt; med  eCDF diff........   0.061954          0.0067002 </span>
<span class="co">#&gt; max  eCDF diff........    0.10748           0.021776 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     1.0763            0.97978 </span>
<span class="co">#&gt; T-test p-value........    0.38527             0.8025 </span>
<span class="co">#&gt; KS Bootstrap p-value..      0.044              0.824 </span>
<span class="co">#&gt; KS Naive p-value......    0.16449            0.99891 </span>
<span class="co">#&gt; KS Statistic..........    0.10748           0.021776 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V10) re74 *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........     2095.6             2019.8 </span>
<span class="co">#&gt; mean control..........       2107             2106.4 </span>
<span class="co">#&gt; std mean diff.........   -0.23437             -1.768 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....     487.98             243.25 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....       8413             7870.3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.019223          0.0083159 </span>
<span class="co">#&gt; med  eCDF diff........     0.0158          0.0067002 </span>
<span class="co">#&gt; max  eCDF diff........   0.047089           0.025126 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....     0.7381            0.85755 </span>
<span class="co">#&gt; T-test p-value........    0.98186            0.39373 </span>
<span class="co">#&gt; KS Bootstrap p-value..      0.556              0.596 </span>
<span class="co">#&gt; KS Naive p-value......    0.97023            0.99172 </span>
<span class="co">#&gt; KS Statistic..........   0.047089           0.025126 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ***** (V11) I(re74 * re75) *****</span>
<span class="co">#&gt;                        Before Matching        After Matching</span>
<span class="co">#&gt; mean treatment........   13118591           12261673 </span>
<span class="co">#&gt; mean control..........   14530303           14240665 </span>
<span class="co">#&gt; std mean diff.........    -2.7799            -4.2761 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean raw eQQ diff.....    3278733            2602379 </span>
<span class="co">#&gt; med  raw eQQ diff.....          0                  0 </span>
<span class="co">#&gt; max  raw eQQ diff.....  188160151          223801517 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mean eCDF diff........   0.022723          0.0043797 </span>
<span class="co">#&gt; med  eCDF diff........   0.014449          0.0033501 </span>
<span class="co">#&gt; max  eCDF diff........   0.061019           0.011725 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; var ratio (Tr/Co).....    0.69439            0.58474 </span>
<span class="co">#&gt; T-test p-value........    0.79058            0.17475 </span>
<span class="co">#&gt; KS Bootstrap p-value..      0.266              0.994 </span>
<span class="co">#&gt; KS Naive p-value......    0.81575                  1 </span>
<span class="co">#&gt; KS Statistic..........   0.061019           0.011725 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Before Matching Minimum p.value: 0.0020368 </span>
<span class="co">#&gt; Variable Name(s): nodegr  Number(s): 6 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; After Matching Minimum p.value: 0.17475 </span>
<span class="co">#&gt; Variable Name(s): I(re74 * re75)  Number(s): 11</span></code></pre></div>
</div>
<div id="matching-for-time-series-cross-section-data" class="section level3" number="20.5.7">
<h3>
<span class="header-section-number">20.5.7</span> Matching for time series-cross-section data<a class="anchor" aria-label="anchor" href="#matching-for-time-series-cross-section-data"><i class="fas fa-link"></i></a>
</h3>
<p>Examples: <span class="citation">(<a href="references.html#ref-SCHEVE_2012" role="doc-biblioref">SCHEVE and STASAVAGE 2012</a>)</span> and <span class="citation">(<a href="references.html#ref-Acemoglu_2014" role="doc-biblioref">Acemoglu et al. 2014</a>)</span></p>
<p>Materials from Imai et al.’s <a href="https://imai.fas.harvard.edu/talk/files/polmeth18.pdf">slides</a></p>
<p>Identification strategy:</p>
<ul>
<li><p>Within-unit over-time variation</p></li>
<li><p>within-time across-units variation</p></li>
</ul>
</div>
</div>
<div id="interrupted-time-series" class="section level2" number="20.6">
<h2>
<span class="header-section-number">20.6</span> Interrupted Time Series<a class="anchor" aria-label="anchor" href="#interrupted-time-series"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>Control for</p>
<ul>
<li><p>Seasonable trends</p></li>
<li><p>Concurrent events</p></li>
</ul>
</li>
<li>
<p>Pros <span class="citation">(<a href="references.html#ref-Penfold_2013" role="doc-biblioref">Penfold and Zhang 2013</a>)</span></p>
<ul>
<li>control for long-term trends</li>
</ul>
</li>
<li>
<p>Cons</p>
<ul>
<li><p>Min of 8 data points before and 8 after an intervention</p></li>
<li><p>Multiple events hard to distinguish</p></li>
</ul>
</li>
</ul>
<p>Example by <a href="https://towardsdatascience.com/what-is-the-strongest-quasi-experimental-method-interrupted-time-series-period-f59fe5b00b31">Leihua Ye</a></p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data preparation</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">CaseID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">6</span><span class="op">)</span>

<span class="co"># intervention</span>
<span class="va">Intervention</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span>
<span class="va">Outcome_Variable</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">CaseID</span>, <span class="va">Intervention</span>, <span class="va">Outcome_Variable</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span>

<span class="co">#construct a simple OLS model</span>
<span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Outcome_Variable</span> <span class="op">~</span> <span class="va">Intervention</span>, data <span class="op">=</span> <span class="va">mydata</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = Outcome_Variable ~ Intervention, data = mydata)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -3.3050 -1.2315 -0.1734  0.8691 11.9185 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   0.03358    0.11021   0.305    0.761    </span>
<span class="co">#&gt; Intervention  3.28903    0.15586  21.103   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.909 on 598 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.4268, Adjusted R-squared:  0.4259 </span>
<span class="co">#&gt; F-statistic: 445.3 on 1 and 598 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="experimental-design.html"><span class="header-section-number">19</span> Experimental Design</a></div>
<div class="next"><a href="endogeneity.html"><span class="header-section-number">21</span> Endogeneity</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#quasi-experimental"><span class="header-section-number">20</span> Quasi-experimental</a></li>
<li>
<a class="nav-link" href="#regression-discontinuity"><span class="header-section-number">20.1</span> Regression Discontinuity</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#specification-checks"><span class="header-section-number">20.1.1</span> Specification Checks</a></li>
<li><a class="nav-link" href="#steps-for-sharp-rd"><span class="header-section-number">20.1.2</span> Steps for Sharp RD</a></li>
<li><a class="nav-link" href="#steps-for-fuzzy-rd"><span class="header-section-number">20.1.3</span> Steps for Fuzzy RD</a></li>
<li><a class="nav-link" href="#evaluation-of-an-rd"><span class="header-section-number">20.1.4</span> Evaluation of an RD</a></li>
<li><a class="nav-link" href="#examples"><span class="header-section-number">20.1.5</span> Examples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#difference-in-differences"><span class="header-section-number">20.2</span> Difference-In-Differences</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-dif-n-dif"><span class="header-section-number">20.2.1</span> Simple Dif-n-dif</a></li>
<li><a class="nav-link" href="#staggered-dif-n-dif"><span class="header-section-number">20.2.2</span> Staggered Dif-n-dif</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#synthetic-control"><span class="header-section-number">20.3</span> Synthetic Control</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#example-1-2"><span class="header-section-number">20.3.1</span> Example 1</a></li>
<li><a class="nav-link" href="#example-2-1"><span class="header-section-number">20.3.2</span> Example 2</a></li>
<li><a class="nav-link" href="#example-3-1"><span class="header-section-number">20.3.3</span> Example 3</a></li>
<li><a class="nav-link" href="#example-4-1"><span class="header-section-number">20.3.4</span> Example 4</a></li>
</ul>
</li>
<li><a class="nav-link" href="#selection-on-observables"><span class="header-section-number">20.4</span> Selection on observables</a></li>
<li>
<a class="nav-link" href="#matching-methods"><span class="header-section-number">20.5</span> Matching Methods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#matchit"><span class="header-section-number">20.5.1</span> MatchIt</a></li>
<li><a class="nav-link" href="#matchingfrontier"><span class="header-section-number">20.5.2</span> MatchingFrontier</a></li>
<li><a class="nav-link" href="#propensity-scores"><span class="header-section-number">20.5.3</span> Propensity Scores</a></li>
<li><a class="nav-link" href="#mahalanobis-distance"><span class="header-section-number">20.5.4</span> Mahalanobis Distance</a></li>
<li><a class="nav-link" href="#coarsened-exact-matching"><span class="header-section-number">20.5.5</span> Coarsened Exact Matching</a></li>
<li><a class="nav-link" href="#genetic-matching"><span class="header-section-number">20.5.6</span> Genetic Matching</a></li>
<li><a class="nav-link" href="#matching-for-time-series-cross-section-data"><span class="header-section-number">20.5.7</span> Matching for time series-cross-section data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#interrupted-time-series"><span class="header-section-number">20.6</span> Interrupted Time Series</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/20-quasi-experimental.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/20-quasi-experimental.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2022-01-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
