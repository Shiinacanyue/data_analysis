<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 25 Synthetic Control | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="Examples in marketing: (Tirunillai and Tellis 2017): offline TV ad on Online Chatter (Guo, Sriram, and Manchanda 2020): payment disclosure laws effect on physician prescription behavior using...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 25 Synthetic Control | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/synthetic-control.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="Examples in marketing: (Tirunillai and Tellis 2017): offline TV ad on Online Chatter (Guo, Sriram, and Manchanda 2020): payment disclosure laws effect on physician prescription behavior using...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 25 Synthetic Control | A Guide on Data Analysis">
<meta name="twitter:description" content="Examples in marketing: (Tirunillai and Tellis 2017): offline TV ad on Online Chatter (Guo, Sriram, and Manchanda 2020): payment disclosure laws effect on physician prescription behavior using...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-stat.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="model-specification.html"><span class="header-section-number">10</span> Model Specification</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">11</span> Imputation (Missing Data)</a></li>
<li><a class="" href="data.html"><span class="header-section-number">12</span> Data</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">13</span> Hypothesis Testing</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">14</span> Prediction and Estimation</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">15</span> Moderation</a></li>
<li><a class="" href="bootstrap.html"><span class="header-section-number">16</span> Bootstrap</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="causal-inference.html"><span class="header-section-number">17</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="" href="experimental-design.html"><span class="header-section-number">18</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">19</span> Sampling</a></li>
<li><a class="" href="analysis-of-variance-anova.html"><span class="header-section-number">20</span> Analysis of Variance (ANOVA)</a></li>
<li><a class="" href="multivariate-methods.html"><span class="header-section-number">21</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="quasi-experimental.html"><span class="header-section-number">22</span> Quasi-experimental</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">23</span> Regression Discontinuity</a></li>
<li><a class="" href="difference-in-differences.html"><span class="header-section-number">24</span> Difference-in-differences</a></li>
<li><a class="active" href="synthetic-control.html"><span class="header-section-number">25</span> Synthetic Control</a></li>
<li><a class="" href="panel-data-methods.html"><span class="header-section-number">26</span> Panel Data Methods</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">27</span> Event Studies</a></li>
<li><a class="" href="matching-methods.html"><span class="header-section-number">28</span> Matching Methods</a></li>
<li><a class="" href="interrupted-time-series.html"><span class="header-section-number">29</span> Interrupted Time Series</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="doubly-robust-estimator.html"><span class="header-section-number">30</span> Doubly Robust Estimator</a></li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">31</span> Endogeneity</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">32</span> Mediation</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">33</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">34</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">35</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">36</span> Sensitivity Analysis/ Robustness Check</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="synthetic-control" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> Synthetic Control<a class="anchor" aria-label="anchor" href="#synthetic-control"><i class="fas fa-link"></i></a>
</h1>
<p>Examples in marketing:</p>
<ul>
<li>
<span class="citation">(<a href="references.html#ref-tirunillai2017" role="doc-biblioref">Tirunillai and Tellis 2017</a>)</span>: offline TV ad on Online Chatter</li>
<li>
<span class="citation">(<a href="references.html#ref-guo2020" role="doc-biblioref">Guo, Sriram, and Manchanda 2020</a>)</span>: payment disclosure laws effect on physician prescription behavior using Timing of the Massachusetts open payment law as the exogenous shock</li>
<li>
<span class="citation">(<a href="references.html#ref-wang2019" role="doc-biblioref">Wang, Wu, and Zhu 2019</a>)</span>: mobile hailing technology adoption on drivers’ hourly earnings</li>
</ul>
<p>Notes</p>
<ul>
<li><p>Synthetic control method (SCM) is a generalization of the <a href="difference-in-differences.html#difference-in-differences">Difference-in-differences</a> model</p></li>
<li><p>For a review of the method, see <span class="citation">(<a href="references.html#ref-abadie2021a" role="doc-biblioref">Abadie 2021</a>)</span></p></li>
<li><p>SCMs can also be used under the Bayesian framework where we do not have to impose any restrictive priori <span class="citation">(<a href="references.html#ref-kim2020" role="doc-biblioref">S. Kim, Lee, and Gupta 2020</a>)</span></p></li>
<li><p>Different from <a href="matching-methods.html#matching-methods">Matching Methods</a> because SCMs match on the pre-treatment outcomes in each period while <a href="matching-methods.html#matching-methods">Matching Methods</a> match on the number of covariates.</p></li>
<li><p>A data driven procedure to construct more comparable control groups (i.e., black box).</p></li>
<li><p>To do causal inference with control and treatment group using <a href="matching-methods.html#matching-methods">Matching Methods</a>, you typically have to have similar covariates in the control and the treated groups. However, if you don’t methods like <a href="matching-methods.html#propensity-scores">Propensity Scores</a> and DID can perform rather poorly (i.e., large bias).</p></li>
</ul>
<p>Advantages over <a href="difference-in-differences.html#difference-in-differences">Difference-in-differences</a></p>
<ol style="list-style-type: decimal">
<li>Maximization of the observable similarity between control and treatment (maybe also unobservables)</li>
<li>Can also be used in cases where no untreated case with similar on matching dimensions with treated cases</li>
<li>Objective selection of controls.</li>
</ol>
<p>Advantages over linear regression</p>
<ul>
<li><p>Regression weights for the estimator will be outside of [0,1] (because regression allows extrapolation), and it will not be sparse (i.e., can be less than 0).</p></li>
<li><p>No extrapolation under SCMs</p></li>
<li><p>Explicitly state the fit (i.e., the weight)</p></li>
<li><p>Can be estimated without the post-treatment outcomes for the control group (can’t p-hack)</p></li>
</ul>
<p>Advantages:</p>
<ol style="list-style-type: decimal">
<li>From the selection criteria, researchers can understand the relative importance of each candidate</li>
<li>Post-intervention outcomes are not used in synthetic. Hence, you can’t retro-fit.</li>
<li>Observable similarity between control and treatment cases is maximized</li>
</ol>
<p>Disadvantages:</p>
<ol style="list-style-type: decimal">
<li>It’s hard to argue for the weights you use to create the “synthetic control”</li>
<li>Bad with non-stationary data</li>
</ol>
<p>SCM is recommended when</p>
<ol style="list-style-type: decimal">
<li>Social events to evaluate large-scale program or policy</li>
<li>Only one treated case with several control candidates.</li>
</ol>
<p><br></p>
<p><strong>Assumptions</strong></p>
<ul>
<li><p>Donor subject is a good match for the synthetic control (i.e., gap between the dependent of the donor subject and that of the synthetic control should be 0 before treatment)</p></li>
<li><p>Only the treated subject undergoes the treatment and not any of the subjects in the donor pool.</p></li>
<li><p>No other changes to the subjects during the whole window.</p></li>
<li><p>The counterfactual outcome of the treatment group can be imputed in a <strong>linear combination</strong> of control groups.</p></li>
</ul>
<p><strong>Identification</strong>: The exclusion restriction is met conditional on the pre-treatment outcomes.</p>
<p><br></p>
<p><code>Synth</code> provides an algorithm that finds weighted combination of the comparison units where the weights are chosen such that it best resembles the values of predictors of the outcome variable for the affected units before the intervention</p>
<p>Setting (notation followed professor <a href="https://conference.nber.org/confer/2021/SI2021/ML/AbadieSlides.pdf">Alberto Abadie</a>)</p>
<ul>
<li><p><span class="math inline">\(J + 1\)</span> units in periods <span class="math inline">\(1, \dots, T\)</span></p></li>
<li><p>The first unit is the treated one during <span class="math inline">\(T_0 + 1, \dots, T\)</span></p></li>
<li><p><span class="math inline">\(J\)</span> units are called a donor pool</p></li>
<li><p><span class="math inline">\(Y_{it}^I\)</span> is the outcome for unit <span class="math inline">\(i\)</span> if it’s exposed to the treatment during <span class="math inline">\(T_0 + 1 , \dots T\)</span></p></li>
<li><p><span class="math inline">\(Y_{it}^N\)</span> is the outcome for unit <span class="math inline">\(i\)</span> if it’s not exposed to the treatment</p></li>
</ul>
<p>We try to estimate the effect of treatment on the treated unit</p>
<p><span class="math display">\[
\tau_{1t} = Y_{1t}^I - Y_{1t}^N
\]</span></p>
<p>where we observe the first treated unit already <span class="math inline">\(Y_{1t}^I = Y_{1t}\)</span></p>
<p>To construct the synthetic control unit, we have to find appropriate weight for each donor in the donor pool by finding <span class="math inline">\(\mathbf{W} = (w_2, \dots, w_{J=1})'\)</span> where</p>
<ul>
<li><p><span class="math inline">\(w_j \ge 0\)</span> for <span class="math inline">\(j = 2, \dots, J+1\)</span></p></li>
<li><p><span class="math inline">\(w_2 + \dots + w_{J+1} = 1\)</span></p></li>
</ul>
<p>The “appropriate” vector <span class="math inline">\(\mathbf{W}\)</span> here is constrained to</p>
<p><span class="math display">\[
\min||\mathbf{X}_1 - \mathbf{X}_0 \mathbf{W}||
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\mathbf{X}_1\)</span> is the <span class="math inline">\(k \times 1\)</span> vector of pre-treatment characteristics for the treated unit</p></li>
<li><p><span class="math inline">\(\mathbf{X}_0\)</span> is the <span class="math inline">\(k \times J\)</span> matrix of pre-treatment characteristics for the untreated units</p></li>
</ul>
<p>For simplicity, researchers usually use</p>
<p><span class="math display">\[
\min||\mathbf{X}_1 - \mathbf{X}_0 \mathbf{W}|| \\
= (\sum_{h=1}^k v_h(X_{h1}- w_2 X-{h2} - \dots - w_{J+1} X_{hJ +1})^{1/2}
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(v_1, \dots, v_k\)</span> is a vector positive constants that represent the predictive power of the <span class="math inline">\(k\)</span> predictors on <span class="math inline">\(Y_{1t}^N\)</span> (i.e., the potential outcome of the treated without treatment) and it can be chosen either explicitly by the researcher or by data-driven methods</li>
</ul>
<p>For penalized synthetic control <span class="citation">(<a href="references.html#ref-abadie2021" role="doc-biblioref">Abadie and L’Hour 2021</a>)</span>, the minimization problem becomes</p>
<p><span class="math display">\[
\min_{\mathbf{W}} ||\mathbf{X}_1 - \sum_{j=2}^{J + 1}W_j \mathbf{X}_j ||^2 + \lambda \sum_{j=2}^{J+1} W_j ||\mathbf{X}_1 - \mathbf{X}_j||^2
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(W_j \ge 0\)</span> and <span class="math inline">\(\sum_{j=2}^{J+1} W_j = 1\)</span></p></li>
<li>
<p><span class="math inline">\(\lambda &gt;0\)</span> balances over-fitting of the treated and minimize the sum of pairwise distances</p>
<ul>
<li><p><span class="math inline">\(\lambda \to 0\)</span>: pure synthetic control (i.e solution for the unpenalized estimator)</p></li>
<li><p><span class="math inline">\(\lambda \to \infty\)</span>: nearest neighbor matching</p></li>
</ul>
</li>
</ul>
<p>Advantages:</p>
<ul>
<li><p>For <span class="math inline">\(\lambda &gt;0\)</span>, you have unique and sparse solution</p></li>
<li><p>Reduces the interpolation bias when averaging dissimilar units</p></li>
<li><p>Penalized SC never uses dissimilar units</p></li>
</ul>
<p><br></p>
<p>Then the synthetic control estimator is</p>
<p><span class="math display">\[
\hat{\tau}_{1t} = Y_{1t} - \sum_{j=2}^{J+1} w_j^* Y_{jt}
\]</span></p>
<p>where <span class="math inline">\(Y_{jt}\)</span> is the outcome for unit <span class="math inline">\(j\)</span> at time <span class="math inline">\(t\)</span></p>
<p>Consideration</p>
<p>Under the factor model <span class="citation">(<a href="references.html#ref-abadie2010" role="doc-biblioref">Abadie, Diamond, and Hainmueller 2010</a>)</span></p>
<p><span class="math display">\[
Y_{it}^N = \mathbf{\theta}_t \mathbf{Z}_i + \mathbf{\lambda}_t \mathbf{\mu}_i + \epsilon_{it}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Z_i\)</span> = observables</p></li>
<li><p><span class="math inline">\(\mu_i\)</span> = unobservables</p></li>
<li><p><span class="math inline">\(\epsilon_{it}\)</span> = unit-level transitory shock (i.e., random noise)</p></li>
</ul>
<p>with assumptions of <span class="math inline">\(\mathbf{W}^*\)</span> such that</p>
<p><span class="math display">\[
\begin{aligned}
\sum_{j=2}^{J+1} w_j^* \mathbf{Z}_j  &amp;= \mathbf{Z}_1 \\
\dots \\
\sum_{j=2}^{J+1} w_j^* Y_{j1} &amp;= Y_{11} \\
\sum_{j=2}^{J+1} w_j^* Y_{jT_0} &amp;= Y_{1T_0}
\end{aligned}
\]</span></p>
<p>Basically, we assume that the synthetic control is a good counterfactual when the treated unit is not exposed to the treatment.</p>
<p>Then,</p>
<ul>
<li><p>the bias bound depends on close fit, which is controlled by the ratio between <span class="math inline">\(\epsilon_{it}\)</span> (transitory shock) and <span class="math inline">\(T_0\)</span> (the number of pre-treatment periods). In other words, you should have good fit for <span class="math inline">\(Y_{1t}\)</span> for pre-treatment period (i.e., <span class="math inline">\(T_0\)</span> should be large while small variance in <span class="math inline">\(\epsilon_{it}\)</span>)</p></li>
<li><p>When you have poor fit, you have to use bias correction version of the syntehtic control. See [<span class="citation">Arkhangelsky et al. (<a href="references.html#ref-arkhangelsky2019" role="doc-biblioref">2019</a>)</span>; <span class="citation">Abadie and L’Hour (<a href="references.html#ref-abadie2021" role="doc-biblioref">2021</a>)</span>]<span class="citation">(<a href="references.html#ref-ben2020varying" role="doc-biblioref">Ben-Michael, Feller, and Rothstein 2020</a>)</span></p></li>
<li>
<p>Overfitting can be the result of small <span class="math inline">\(T_0\)</span> (the number of pre-treatment periods), large <span class="math inline">\(J\)</span> (the number of units in the donor pool), and large <span class="math inline">\(\epsilon_{it}\)</span> (noise)</p>
<ul>
<li>Mitigation: put only similar units (to the treated one) in the donor pool</li>
</ul>
</li>
</ul>
<p>To make inference, we have to create a permutation distribution (by iteratively reassigning the treatment to the units in the donor pool and estimate the placebo effects in each iteration). We say there is an effect of the treatment when the magnitude of value of the treatment effect on the treated unit is extreme relative to the permutation distribution.</p>
<p>It’s recommended to use one-sided inference. And the permutation distribution is superior to the p-values alone (because sampling-based inference is hard under SCMs either because of undefined sampling mechanism or the sample is the population).</p>
<p>For benchmark (permutation) distribution (e.g., uniform), see <span class="citation">(<a href="references.html#ref-firpo2018" role="doc-biblioref">Firpo and Possebom 2018</a>)</span></p>
<p><br></p>
<div id="applications-2" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> Applications<a class="anchor" aria-label="anchor" href="#applications-2"><i class="fas fa-link"></i></a>
</h2>
<div id="example-1-2" class="section level3" number="25.1.1">
<h3>
<span class="header-section-number">25.1.1</span> Example 1<a class="anchor" aria-label="anchor" href="#example-1-2"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://rpubs.com/danilofreire/synth">Danilo Freire</a></p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("Synth")</span>
<span class="co"># install.packages("gsynth")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.stanford.edu/~jhain">"Synth"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://yiqingxu.org/packages/gsynth/gsynth_examples.html">"gsynth"</a></span><span class="op">)</span></code></pre></div>
<p>simulate data for 10 states and 30 years. State A receives the treatment <code>T = 20</code> after year 15.</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">year</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">state</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">X1</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">X2</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">Y</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">X1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">df</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://amices.org/mice/reference/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X1</span>, <span class="va">X2</span>, <span class="va">state</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">Y</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">X1</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">X2</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X2</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">year</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">state.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">state</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">`T`</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">15</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">Y</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">15</span>, <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">+</span> <span class="fl">20</span>, <span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    300 obs. of  7 variables:</span>
<span class="co">#&gt;  $ Y        : num  2.29 4.51 2.07 8.87 4.37 1.32 8 7.49 6.98 3.72 ...</span>
<span class="co">#&gt;  $ X1       : num  1.37 2.18 1.16 3.6 2.33 1.18 2.49 2.74 2.58 1.69 ...</span>
<span class="co">#&gt;  $ X2       : num  1.96 0.4 -0.75 -0.56 -0.45 1.06 0.51 -2.1 0 0.54 ...</span>
<span class="co">#&gt;  $ state    : chr  "A" "A" "A" "A" ...</span>
<span class="co">#&gt;  $ year     : num  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ state.num: int  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ T        : num  0 0 0 0 0 0 0 0 0 0 ...</span></code></pre></div>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
        <span class="va">df</span>,
        predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span>,
        dependent     <span class="op">=</span> <span class="st">"Y"</span>,
        unit.variable <span class="op">=</span> <span class="st">"state.num"</span>,
        time.variable <span class="op">=</span> <span class="st">"year"</span>,
        unit.names.variable <span class="op">=</span> <span class="st">"state"</span>,
        treatment.identifier  <span class="op">=</span> <span class="fl">1</span>,
        controls.identifier   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,
        time.predictors.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span>,
        time.optimize.ssr     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span>,
        time.plot             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>
    <span class="op">)</span>


<span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span><span class="va">dataprep.out</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 9.831789 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.3888387 0.6111613 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  0.1115941 0.1832781 0.1027237 0.312091 0.06096758 0.03509706 0.05893735 0.05746256 0.07784853</span></code></pre></div>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">print</a></span><span class="op">(</span><span class="va">synth.tables</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>
        dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
        synth.res    <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
      <span class="op">)</span>
<span class="co">#&gt; $tab.pred</span>
<span class="co">#&gt;    Treated Synthetic Sample Mean</span>
<span class="co">#&gt; X1   2.028     2.028       2.017</span>
<span class="co">#&gt; X2   0.513     0.513       0.394</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.v</span>
<span class="co">#&gt;    v.weights</span>
<span class="co">#&gt; X1 0.389    </span>
<span class="co">#&gt; X2 0.611    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.w</span>
<span class="co">#&gt;    w.weights unit.names unit.numbers</span>
<span class="co">#&gt; 2      0.112          B            2</span>
<span class="co">#&gt; 3      0.183          C            3</span>
<span class="co">#&gt; 4      0.103          D            4</span>
<span class="co">#&gt; 5      0.312          E            5</span>
<span class="co">#&gt; 6      0.061          F            6</span>
<span class="co">#&gt; 7      0.035          G            7</span>
<span class="co">#&gt; 8      0.059          H            8</span>
<span class="co">#&gt; 9      0.057          I            9</span>
<span class="co">#&gt; 10     0.078          J           10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tab.loss</span>
<span class="co">#&gt;            Loss W   Loss V</span>
<span class="co">#&gt; [1,] 9.761708e-12 9.831789</span></code></pre></div>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>synth.res    <span class="op">=</span> <span class="va">synth.out</span>,
          dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
          Ylab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span>,
          Xlab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span>,
          Legend       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"State A"</span>,<span class="st">"Synthetic State A"</span><span class="op">)</span>,
          Legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"topleft"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v   <span class="op">=</span> <span class="fl">15</span>,
       lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-6-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Gaps plot:</p>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>synth.res    <span class="op">=</span> <span class="va">synth.out</span>,
          dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
          Ylab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gap"</span><span class="op">)</span>,
          Xlab         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span>,
          Ylim         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span>,
          Main         <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v   <span class="op">=</span> <span class="fl">15</span>,
       lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-7-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Alternatively, <code>gsynth</code> provides options to estimate iterative fixed effects, and handle multiple treated units at tat time.</p>
<p>Here, we use two=way fixed effects and bootstrapped standard errors</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="synthetic-control.html#cb398-1" aria-hidden="true" tabindex="-1"></a>gsynth.out <span class="ot">&lt;-</span> <span class="fu">gsynth</span>(</span>
<span id="cb398-2"><a href="synthetic-control.html#cb398-2" aria-hidden="true" tabindex="-1"></a>  Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb398-3"><a href="synthetic-control.html#cb398-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb398-4"><a href="synthetic-control.html#cb398-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"year"</span>),</span>
<span id="cb398-5"><a href="synthetic-control.html#cb398-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="st">"two-way"</span>,</span>
<span id="cb398-6"><a href="synthetic-control.html#cb398-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> <span class="cn">TRUE</span>,</span>
<span id="cb398-7"><a href="synthetic-control.html#cb398-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb398-8"><a href="synthetic-control.html#cb398-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb398-9"><a href="synthetic-control.html#cb398-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">inference =</span> <span class="st">"parametric"</span>,</span>
<span id="cb398-10"><a href="synthetic-control.html#cb398-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">nboots =</span> <span class="dv">1000</span>,</span>
<span id="cb398-11"><a href="synthetic-control.html#cb398-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel =</span> F <span class="co"># TRUE</span></span>
<span id="cb398-12"><a href="synthetic-control.html#cb398-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb398-13"><a href="synthetic-control.html#cb398-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cross-validating ... </span></span>
<span id="cb398-14"><a href="synthetic-control.html#cb398-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 0; sigma2 = 1.13533; IC = 0.95632; PC = 0.96713; MSPE = 1.65502</span></span>
<span id="cb398-15"><a href="synthetic-control.html#cb398-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 1; sigma2 = 0.96885; IC = 1.54420; PC = 4.30644; MSPE = 1.33375</span></span>
<span id="cb398-16"><a href="synthetic-control.html#cb398-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 2; sigma2 = 0.81855; IC = 2.08062; PC = 6.58556; MSPE = 1.27341*</span></span>
<span id="cb398-17"><a href="synthetic-control.html#cb398-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 3; sigma2 = 0.71670; IC = 2.61125; PC = 8.35187; MSPE = 1.79319</span></span>
<span id="cb398-18"><a href="synthetic-control.html#cb398-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 4; sigma2 = 0.62823; IC = 3.10156; PC = 9.59221; MSPE = 2.02301</span></span>
<span id="cb398-19"><a href="synthetic-control.html#cb398-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r = 5; sigma2 = 0.55497; IC = 3.55814; PC = 10.48406; MSPE = 2.79596</span></span>
<span id="cb398-20"><a href="synthetic-control.html#cb398-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb398-21"><a href="synthetic-control.html#cb398-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  r* = 2</span></span>
<span id="cb398-22"><a href="synthetic-control.html#cb398-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb398-23"><a href="synthetic-control.html#cb398-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb398-24"><a href="synthetic-control.html#cb398-24" aria-hidden="true" tabindex="-1"></a>Simulating errors .............</span>
<span id="cb398-25"><a href="synthetic-control.html#cb398-25" aria-hidden="true" tabindex="-1"></a>Bootstrapping ...</span>
<span id="cb398-26"><a href="synthetic-control.html#cb398-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ..........</span></span></code></pre></div>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-9-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span>, type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-10-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gsynth.out</span>, type <span class="op">=</span> <span class="st">"counterfactual"</span>, raw <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># shows estimations for the control cases</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="example-2-1" class="section level3" number="25.1.2">
<h3>
<span class="header-section-number">25.1.2</span> Example 2<a class="anchor" aria-label="anchor" href="#example-2-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://towardsdatascience.com/causal-inference-using-synthetic-control-the-ultimate-guide-a622ad5cf827">Leihua Ye</a></p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain">Synth</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"basque"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">basque</span><span class="op">)</span> <span class="co">#774*17</span>
<span class="co">#&gt; [1] 774  17</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">basque</span><span class="op">)</span>
<span class="co">#&gt;   regionno     regionname year   gdpcap sec.agriculture sec.energy sec.industry</span>
<span class="co">#&gt; 1        1 Spain (Espana) 1955 2.354542              NA         NA           NA</span>
<span class="co">#&gt; 2        1 Spain (Espana) 1956 2.480149              NA         NA           NA</span>
<span class="co">#&gt; 3        1 Spain (Espana) 1957 2.603613              NA         NA           NA</span>
<span class="co">#&gt; 4        1 Spain (Espana) 1958 2.637104              NA         NA           NA</span>
<span class="co">#&gt; 5        1 Spain (Espana) 1959 2.669880              NA         NA           NA</span>
<span class="co">#&gt; 6        1 Spain (Espana) 1960 2.869966              NA         NA           NA</span>
<span class="co">#&gt;   sec.construction sec.services.venta sec.services.nonventa school.illit</span>
<span class="co">#&gt; 1               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 2               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 3               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 4               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 5               NA                 NA                    NA           NA</span>
<span class="co">#&gt; 6               NA                 NA                    NA           NA</span>
<span class="co">#&gt;   school.prim school.med school.high school.post.high popdens invest</span>
<span class="co">#&gt; 1          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 2          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 3          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 4          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 5          NA         NA          NA               NA      NA     NA</span>
<span class="co">#&gt; 6          NA         NA          NA               NA      NA     NA</span></code></pre></div>
<p>transform data to be used in <code><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth()</a></code></p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
    foo <span class="op">=</span> <span class="va">basque</span>,
    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"school.illit"</span>,
        <span class="st">"school.prim"</span>,
        <span class="st">"school.med"</span>,
        <span class="st">"school.high"</span>,
        <span class="st">"school.post.high"</span>,
        <span class="st">"invest"</span>
    <span class="op">)</span>,
    predictors.op <span class="op">=</span>  <span class="st">"mean"</span>,
    <span class="co"># the operator</span>
    time.predictors.prior <span class="op">=</span> <span class="fl">1964</span><span class="op">:</span><span class="fl">1969</span>,
    <span class="co">#the entire time frame from the #beginning to the end</span>
    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"gdpcap"</span>, <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,  <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.agriculture"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.energy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.industry"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.construction"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.venta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.nonventa"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"popdens"</span>, <span class="fl">1969</span>,  <span class="st">"mean"</span><span class="op">)</span>
    <span class="op">)</span>,
    dependent <span class="op">=</span>  <span class="st">"gdpcap"</span>,
    <span class="co"># dv</span>
    unit.variable <span class="op">=</span>  <span class="st">"regionno"</span>,
    <span class="co">#identifying unit numbers</span>
    unit.names.variable <span class="op">=</span>  <span class="st">"regionname"</span>,
    <span class="co">#identifying unit names</span>
    time.variable <span class="op">=</span>  <span class="st">"year"</span>,
    <span class="co">#time-periods</span>
    treatment.identifier <span class="op">=</span> <span class="fl">17</span>,
    <span class="co">#the treated case</span>
    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span>,
    <span class="co">#the control cases; all others #except number 17</span>
    time.optimize.ssr <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,
    <span class="co">#the time-period over which to optimize</span>
    time.plot <span class="op">=</span> <span class="fl">1955</span><span class="op">:</span><span class="fl">1997</span>
<span class="op">)</span><span class="co">#the entire time period before/after the treatment</span></code></pre></div>
<p>where</p>
<ul>
<li><p>X1 = the control case before the treatment</p></li>
<li><p>X0 = the control cases after the treatment</p></li>
<li><p>Z1: the treatment case before the treatment</p></li>
<li><p>Z0: the treatment case after the treatment</p></li>
</ul>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span>data.prep.obj <span class="op">=</span> <span class="va">dataprep.out</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.008864606 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.02773094 1.194e-07 1.60609e-05 0.0007163836 1.486e-07 0.002423908 0.0587055 0.2651997 0.02851006 0.291276 0.007994382 0.004053188 0.009398579 0.303975 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  2.53e-08 4.63e-08 6.44e-08 2.81e-08 3.37e-08 4.844e-07 4.2e-08 4.69e-08 0.8508145 9.75e-08 3.2e-08 5.54e-08 0.1491843 4.86e-08 9.89e-08 1.162e-07</span></code></pre></div>
<p>Calculate the difference between the real basque region and the synthetic control</p>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gaps</span> <span class="op">=</span> <span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y1plot</span> <span class="op">-</span> <span class="op">(</span><span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y0plot</span> 
                                     <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">%*%</a></span> <span class="va">synth.out</span><span class="op">$</span><span class="va">solution.w</span><span class="op">)</span>
<span class="va">gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;       1955       1956       1957 </span>
<span class="co">#&gt; 0.15023473 0.09168035 0.03716475</span></code></pre></div>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
                         synth.res <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">synth.tables</span><span class="op">)</span>
<span class="co">#&gt; [1] "tab.pred" "tab.v"    "tab.w"    "tab.loss"</span>
<span class="va">synth.tables</span><span class="op">$</span><span class="va">tab.pred</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,<span class="op">]</span>
<span class="co">#&gt;                                          Treated Synthetic Sample Mean</span>
<span class="co">#&gt; school.illit                              39.888   256.337     170.786</span>
<span class="co">#&gt; school.prim                             1031.742  2730.104    1127.186</span>
<span class="co">#&gt; school.med                                90.359   223.340      76.260</span>
<span class="co">#&gt; school.high                               25.728    63.437      24.235</span>
<span class="co">#&gt; school.post.high                          13.480    36.153      13.478</span>
<span class="co">#&gt; invest                                    24.647    21.583      21.424</span>
<span class="co">#&gt; special.gdpcap.1960.1969                   5.285     5.271       3.581</span>
<span class="co">#&gt; special.sec.agriculture.1961.1969          6.844     6.179      21.353</span>
<span class="co">#&gt; special.sec.energy.1961.1969               4.106     2.760       5.310</span>
<span class="co">#&gt; special.sec.industry.1961.1969            45.082    37.636      22.425</span>
<span class="co">#&gt; special.sec.construction.1961.1969         6.150     6.952       7.276</span>
<span class="co">#&gt; special.sec.services.venta.1961.1969      33.754    41.104      36.528</span>
<span class="co">#&gt; special.sec.services.nonventa.1961.1969    4.072     5.371       7.111</span></code></pre></div>
<p>Relative importance of each unit</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span><span class="op">$</span><span class="va">tab.w</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">14</span>, <span class="op">]</span>
<span class="co">#&gt;    w.weights            unit.names unit.numbers</span>
<span class="co">#&gt; 9      0.000    Castilla-La Mancha            9</span>
<span class="co">#&gt; 10     0.851              Cataluna           10</span>
<span class="co">#&gt; 11     0.000  Comunidad Valenciana           11</span>
<span class="co">#&gt; 12     0.000           Extremadura           12</span>
<span class="co">#&gt; 13     0.000               Galicia           13</span>
<span class="co">#&gt; 14     0.149 Madrid (Comunidad De)           14</span>
<span class="co">#&gt; 15     0.000    Murcia (Region de)           15</span></code></pre></div>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the changes before and after the treatment </span>
<span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"real per-capita gdp (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,
    Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Basque country"</span>,
               <span class="st">"synthetic Basque country"</span><span class="op">)</span>,
    Legend.position <span class="op">=</span> <span class="st">"bottomright"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-18-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span>  <span class="st">"gap in real per - capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span>  <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>,
    Main <span class="op">=</span> <span class="cn">NA</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-19-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Doubly Robust Difference-in-Differences</p>
<p>Example from <code>DRDID</code> package</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pedrohcgs.github.io/DRDID/">DRDID</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">nsw_long</span><span class="op">)</span>
<span class="co"># Form the Lalonde sample with CPS comparison group</span>
<span class="va">eval_lalonde_cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">nsw_long</span>, <span class="va">nsw_long</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">nsw_long</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Estimate Average Treatment Effect on Treated using Improved Locally Efficient Doubly Robust DID estimator</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://psantanna.com/DRDID/reference/drdid.html">drdid</a></span><span class="op">(</span>
        yname <span class="op">=</span> <span class="st">"re"</span>,
        tname <span class="op">=</span> <span class="st">"year"</span>,
        idname <span class="op">=</span> <span class="st">"id"</span>,
        dname <span class="op">=</span> <span class="st">"experimental"</span>,
        xformla <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> <span class="va">hisp</span> <span class="op">+</span> <span class="va">re74</span>,
        data <span class="op">=</span> <span class="va">eval_lalonde_cps</span>,
        panel <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="co">#&gt;  Call:</span>
<span class="co">#&gt; drdid(yname = "re", tname = "year", idname = "id", dname = "experimental", </span>
<span class="co">#&gt;     xformla = ~age + educ + black + married + nodegree + hisp + </span>
<span class="co">#&gt;         re74, data = eval_lalonde_cps, panel = TRUE)</span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  Further improved locally efficient DR DID estimator for the ATT:</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;    ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] </span>
<span class="co">#&gt; -901.2703   393.6247   -2.2897     0.022    -1672.7747  -129.766 </span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  Estimator based on panel data.</span>
<span class="co">#&gt;  Outcome regression est. method: weighted least squares.</span>
<span class="co">#&gt;  Propensity score est. method: inverse prob. tilting.</span>
<span class="co">#&gt;  Analytical standard error.</span>
<span class="co">#&gt; ------------------------------------------------------------------</span>
<span class="co">#&gt;  See Sant'Anna and Zhao (2020) for details.</span></code></pre></div>
</div>
<div id="example-3-1" class="section level3" number="25.1.3">
<h3>
<span class="header-section-number">25.1.3</span> Example 3<a class="anchor" aria-label="anchor" href="#example-3-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <code>Synth</code> package’s authors</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain">Synth</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"basque"</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth()</a></code> requires</p>
<ul>
<li><p><span class="math inline">\(X_1\)</span> vector of treatment predictors</p></li>
<li><p><span class="math inline">\(X_0\)</span> matrix of same variables for control group</p></li>
<li><p><span class="math inline">\(Z_1\)</span> vector of outcome variable for treatment group</p></li>
<li><p><span class="math inline">\(Z_0\)</span> matrix of outcome variable for control group</p></li>
</ul>
<p>use <code><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep()</a></code> to prepare data in the format that can be used throughout the <code>Synth</code> package</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataprep.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html">dataprep</a></span><span class="op">(</span>
    foo <span class="op">=</span> <span class="va">basque</span>,
    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"school.illit"</span>,
        <span class="st">"school.prim"</span>,
        <span class="st">"school.med"</span>,
        <span class="st">"school.high"</span>,
        <span class="st">"school.post.high"</span>,
        <span class="st">"invest"</span>
    <span class="op">)</span>,
    predictors.op <span class="op">=</span> <span class="st">"mean"</span>,
    time.predictors.prior <span class="op">=</span> <span class="fl">1964</span><span class="op">:</span><span class="fl">1969</span>,
    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"gdpcap"</span>, <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span> , <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.agriculture"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.energy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.industry"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.construction"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.venta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"sec.services.nonventa"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1961</span>, <span class="fl">1969</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/gsubfn/man/list.html">list</a></span><span class="op">(</span><span class="st">"popdens"</span>, <span class="fl">1969</span>, <span class="st">"mean"</span><span class="op">)</span>
    <span class="op">)</span>,
    dependent <span class="op">=</span> <span class="st">"gdpcap"</span>,
    unit.variable <span class="op">=</span> <span class="st">"regionno"</span>,
    unit.names.variable <span class="op">=</span> <span class="st">"regionname"</span>,
    time.variable <span class="op">=</span> <span class="st">"year"</span>,
    treatment.identifier <span class="op">=</span> <span class="fl">17</span>,
    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span>,
    time.optimize.ssr <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">1969</span>,
    time.plot <span class="op">=</span> <span class="fl">1955</span><span class="op">:</span><span class="fl">1997</span>
<span class="op">)</span></code></pre></div>
<p>find optimal weights that identifies the synthetic control for the treatment group</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html">synth</a></span><span class="op">(</span>data.prep.obj <span class="op">=</span> <span class="va">dataprep.out</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.008864606 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.02773094 1.194e-07 1.60609e-05 0.0007163836 1.486e-07 0.002423908 0.0587055 0.2651997 0.02851006 0.291276 0.007994382 0.004053188 0.009398579 0.303975 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  2.53e-08 4.63e-08 6.44e-08 2.81e-08 3.37e-08 4.844e-07 4.2e-08 4.69e-08 0.8508145 9.75e-08 3.2e-08 5.54e-08 0.1491843 4.86e-08 9.89e-08 1.162e-07</span></code></pre></div>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gaps</span> <span class="op">&lt;-</span> <span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y1plot</span> <span class="op">-</span> <span class="op">(</span><span class="va">dataprep.out</span><span class="op">$</span><span class="va">Y0plot</span> <span class="op"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">%*%</a></span> <span class="va">synth.out</span><span class="op">$</span><span class="va">solution.w</span><span class="op">)</span>
<span class="va">gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;       1955       1956       1957 </span>
<span class="co">#&gt; 0.15023473 0.09168035 0.03716475</span></code></pre></div>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synth.tables</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.tab.html">synth.tab</a></span><span class="op">(</span>dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>, synth.res <span class="op">=</span> <span class="va">synth.out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">synth.tables</span><span class="op">)</span> <span class="co"># you can pick tables to see </span>
<span class="co">#&gt; [1] "tab.pred" "tab.v"    "tab.w"    "tab.loss"</span></code></pre></div>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/path.plot.html">path.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"real per-capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span>,
    Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Basque country"</span>,
               <span class="st">"synthetic Basque country"</span><span class="op">)</span>,
    Legend.position <span class="op">=</span> <span class="st">"bottomright"</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-27-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Synth/man/gaps.plot.html">gaps.plot</a></span><span class="op">(</span>
    synth.res <span class="op">=</span> <span class="va">synth.out</span>,
    dataprep.res <span class="op">=</span> <span class="va">dataprep.out</span>,
    Ylab <span class="op">=</span> <span class="st">"gap in real per-capita GDP (1986 USD, thousand)"</span>,
    Xlab <span class="op">=</span> <span class="st">"year"</span>,
    Ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>,
    Main <span class="op">=</span> <span class="cn">NA</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-28-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>You could also run placebo tests</p>
<p><br></p>
</div>
<div id="example-4-1" class="section level3" number="25.1.4">
<h3>
<span class="header-section-number">25.1.4</span> Example 4<a class="anchor" aria-label="anchor" href="#example-4-1"><i class="fas fa-link"></i></a>
</h3>
<p>by <a href="https://cran.r-project.org/web/packages/microsynth/vignettes/introduction.html">Michael Robbins and Steven Davenport</a> who are authors of <code>MicroSynth</code> with the following improvements:</p>
<ul>
<li><p>Standardization <code>use.survey = TRUE</code> and permutation ( <code>perm = 250</code> and <code>jack = TRUE</code> ) for placebo tests</p></li>
<li><p>Omnibus statistic (set to <code>omnibus.var</code> ) for multiple outcome variables</p></li>
<li><p>incorporate multiple follow-up periods <code>end.post</code></p></li>
</ul>
<p>Notes:</p>
<ul>
<li>
<p>Both predictors and outcome will be used to match units before intervention</p>
<ul>
<li><p>Outcome variable has to be <strong>time-variant</strong></p></li>
<li><p>Predictors are <strong>time-invariant</strong></p></li>
</ul>
</li>
<li>
</ul>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">microsynth</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"seattledmi"</span><span class="op">)</span>

<span class="va">cov.var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TotalPop"</span>, <span class="st">"BLACK"</span>, <span class="st">"HISPANIC"</span>, <span class="st">"Males_1521"</span>, <span class="st">"HOUSEHOLDS"</span>, 
             <span class="st">"FAMILYHOUS"</span>, <span class="st">"FEMALE_HOU"</span>, <span class="st">"RENTER_HOU"</span>, <span class="st">"VACANT_HOU"</span><span class="op">)</span>
<span class="va">match.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"i_felony"</span>, <span class="st">"i_misdemea"</span>, <span class="st">"i_drugs"</span>, <span class="st">"any_crime"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sea1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/microsynth.html">microsynth</a></span><span class="op">(</span>
    <span class="va">seattledmi</span>,
    idvar <span class="op">=</span> <span class="st">"ID"</span>,
    timevar <span class="op">=</span> <span class="st">"time"</span>,
    intvar <span class="op">=</span> <span class="st">"Intervention"</span>,
    start.pre <span class="op">=</span> <span class="fl">1</span>,
    end.pre <span class="op">=</span> <span class="fl">12</span>,
    end.post <span class="op">=</span> <span class="fl">16</span>,
    match.out <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># outcome variable will be matched on exactly</span>
    match.covar <span class="op">=</span> <span class="va">cov.var</span>, <span class="co"># specify covariates will be matched on exactly</span>
    result.var <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># used to report results</span>
    omnibus.var <span class="op">=</span> <span class="va">match.out</span>, <span class="co"># feature in the omnibus p-value</span>
    test <span class="op">=</span> <span class="st">"lower"</span>,
    n.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">sea1</span>
<span class="co">#&gt;  microsynth object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scope:</span>
<span class="co">#&gt;  Units:          Total: 9642 Treated: 39 Untreated: 9603</span>
<span class="co">#&gt;  Study Period(s):    Pre-period: 1 - 12  Post-period: 13 - 16</span>
<span class="co">#&gt;  Constraints:        Exact Match: 58     Minimized Distance: 0</span>
<span class="co">#&gt; Time-variant outcomes:</span>
<span class="co">#&gt;  Exact Match: i_felony, i_misdemea, i_drugs, any_crime (4)</span>
<span class="co">#&gt;  Minimized Distance: (0)</span>
<span class="co">#&gt; Time-invariant covariates:</span>
<span class="co">#&gt;  Exact Match: TotalPop, BLACK, HISPANIC, Males_1521, HOUSEHOLDS, FAMILYHOUS, FEMALE_HOU, RENTER_HOU, VACANT_HOU (9)</span>
<span class="co">#&gt;  Minimized Distance: (0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; end.post = 16</span>
<span class="co">#&gt;            Trt    Con Pct.Chng Linear.pVal Linear.Lower Linear.Upper</span>
<span class="co">#&gt; i_felony    46  68.22   -32.6%      0.0109       -50.3%        -8.4%</span>
<span class="co">#&gt; i_misdemea  45  71.80   -37.3%      0.0019       -52.8%       -16.7%</span>
<span class="co">#&gt; i_drugs     20  23.76   -15.8%      0.2559       -46.4%        32.1%</span>
<span class="co">#&gt; any_crime  788 986.44   -20.1%      0.0146       -32.9%        -4.9%</span>
<span class="co">#&gt; Omnibus     --     --       --      0.0006           --           --</span>
<span class="fu"><a href="https://rdrr.io/pkg/spaMM/man/summary.HL.html">summary</a></span><span class="op">(</span><span class="va">sea1</span><span class="op">)</span>
<span class="co">#&gt; Weight Balance Table: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Targets Weighted.Control   All.scaled</span>
<span class="co">#&gt; Intercept          39        39.000239   39.0000000</span>
<span class="co">#&gt; TotalPop         2994      2994.051921 2384.7476665</span>
<span class="co">#&gt; BLACK             173       173.000957  190.5224020</span>
<span class="co">#&gt; HISPANIC          149       149.002632  159.2682016</span>
<span class="co">#&gt; Males_1521         49        49.000000   97.3746111</span>
<span class="co">#&gt; HOUSEHOLDS       1968      1968.033976 1113.5588052</span>
<span class="co">#&gt; FAMILYHOUS        519       519.010767  475.1876167</span>
<span class="co">#&gt; FEMALE_HOU        101       101.000957   81.1549471</span>
<span class="co">#&gt; RENTER_HOU       1868      1868.020338  581.9340386</span>
<span class="co">#&gt; VACANT_HOU        160       160.011485   98.4222153</span>
<span class="co">#&gt; i_felony.12        14        14.000000    4.9023024</span>
<span class="co">#&gt; i_felony.11        11        11.000239    4.6313006</span>
<span class="co">#&gt; i_felony.10         9         9.000000    3.0740510</span>
<span class="co">#&gt; i_felony.9          5         5.000000    3.2641568</span>
<span class="co">#&gt; i_felony.8         20        20.000000    4.4331052</span>
<span class="co">#&gt; i_felony.7          8         8.000000    3.7616677</span>
<span class="co">#&gt; i_felony.6         13        13.000000    3.0012446</span>
<span class="co">#&gt; i_felony.5         20        20.000718    3.1549471</span>
<span class="co">#&gt; i_felony.4         10        10.000000    4.0245800</span>
<span class="co">#&gt; i_felony.3          7         7.000000    3.3693217</span>
<span class="co">#&gt; i_felony.2         13        13.000239    3.2803360</span>
<span class="co">#&gt; i_felony.1         12        12.000000    3.4380834</span>
<span class="co">#&gt; i_misdemea.12      15        15.000239    4.2470442</span>
<span class="co">#&gt; i_misdemea.11      12        12.000000    4.6070317</span>
<span class="co">#&gt; i_misdemea.10      12        12.000000    4.0771624</span>
<span class="co">#&gt; i_misdemea.9       14        14.000000    3.7414437</span>
<span class="co">#&gt; i_misdemea.8       12        12.000000    3.9679527</span>
<span class="co">#&gt; i_misdemea.7       20        20.000000    4.2551338</span>
<span class="co">#&gt; i_misdemea.6       16        16.000479    3.5594275</span>
<span class="co">#&gt; i_misdemea.5       24        24.000000    3.5634723</span>
<span class="co">#&gt; i_misdemea.4       21        21.000239    4.3360299</span>
<span class="co">#&gt; i_misdemea.3       21        21.000000    4.3845675</span>
<span class="co">#&gt; i_misdemea.2       14        14.000000    3.5351587</span>
<span class="co">#&gt; i_misdemea.1       16        16.000000    4.1540137</span>
<span class="co">#&gt; i_drugs.12         13        13.000000    1.6543248</span>
<span class="co">#&gt; i_drugs.11          8         8.000000    1.5127567</span>
<span class="co">#&gt; i_drugs.10          3         3.000000    1.3226509</span>
<span class="co">#&gt; i_drugs.9           4         4.000000    0.9788426</span>
<span class="co">#&gt; i_drugs.8           4         4.000000    1.1123211</span>
<span class="co">#&gt; i_drugs.7          10        10.000000    1.0516490</span>
<span class="co">#&gt; i_drugs.6           4         4.000000    1.2377100</span>
<span class="co">#&gt; i_drugs.5           2         2.000000    1.2296204</span>
<span class="co">#&gt; i_drugs.4           1         1.000000    1.1244555</span>
<span class="co">#&gt; i_drugs.3           5         5.000000    1.3550093</span>
<span class="co">#&gt; i_drugs.2          12        12.000000    1.1365899</span>
<span class="co">#&gt; i_drugs.1           8         8.000239    1.3590541</span>
<span class="co">#&gt; any_crime.12      272       272.001196   65.3397635</span>
<span class="co">#&gt; any_crime.11      227       227.001675   64.2395769</span>
<span class="co">#&gt; any_crime.10      183       183.000957   55.6929060</span>
<span class="co">#&gt; any_crime.9       176       176.000479   53.2377100</span>
<span class="co">#&gt; any_crime.8       228       228.000479   55.8142502</span>
<span class="co">#&gt; any_crime.7       246       246.002393   55.8061605</span>
<span class="co">#&gt; any_crime.6       200       200.000957   52.8291848</span>
<span class="co">#&gt; any_crime.5       270       270.001436   50.6530803</span>
<span class="co">#&gt; any_crime.4       250       250.000957   57.2946484</span>
<span class="co">#&gt; any_crime.3       236       236.000957   58.8680772</span>
<span class="co">#&gt; any_crime.2       250       250.001196   51.5429371</span>
<span class="co">#&gt; any_crime.1       242       242.000957   55.1144991</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; end.post = 16</span>
<span class="co">#&gt;            Trt    Con Pct.Chng Linear.pVal Linear.Lower Linear.Upper</span>
<span class="co">#&gt; i_felony    46  68.22   -32.6%      0.0109       -50.3%        -8.4%</span>
<span class="co">#&gt; i_misdemea  45  71.80   -37.3%      0.0019       -52.8%       -16.7%</span>
<span class="co">#&gt; i_drugs     20  23.76   -15.8%      0.2559       -46.4%        32.1%</span>
<span class="co">#&gt; any_crime  788 986.44   -20.1%      0.0146       -32.9%        -4.9%</span>
<span class="co">#&gt; Omnibus     --     --       --      0.0006           --           --</span></code></pre></div>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/plot_microsynth.html">plot_microsynth</a></span><span class="op">(</span><span class="va">sea1</span><span class="op">)</span></code></pre></div>
<p><img src="25-synthetic-control_files/figure-html/unnamed-chunk-31-1.png" width="90%" style="display: block; margin: auto;"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-31-2.png" width="90%" style="display: block; margin: auto;"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-31-3.png" width="90%" style="display: block; margin: auto;"><img src="25-synthetic-control_files/figure-html/unnamed-chunk-31-4.png" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sea2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microsynth/man/microsynth.html">microsynth</a></span><span class="op">(</span><span class="va">seattledmi</span>, 
                   idvar<span class="op">=</span><span class="st">"ID"</span>, timevar<span class="op">=</span><span class="st">"time"</span>, intvar<span class="op">=</span><span class="st">"Intervention"</span>, 
                   start.pre<span class="op">=</span><span class="fl">1</span>, end.pre<span class="op">=</span><span class="fl">12</span>, end.post<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">16</span><span class="op">)</span>,
                   match.out<span class="op">=</span><span class="va">match.out</span>, match.covar<span class="op">=</span><span class="va">cov.var</span>, 
                   result.var<span class="op">=</span><span class="va">match.out</span>, omnibus.var<span class="op">=</span><span class="va">match.out</span>, 
                   test<span class="op">=</span><span class="st">"lower"</span>, 
                   perm<span class="op">=</span><span class="fl">250</span>, jack<span class="op">=</span><span class="cn">TRUE</span>,
                   n.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="synthetic-difference-in-differences" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> Synthetic Difference-in-differences<a class="anchor" aria-label="anchor" href="#synthetic-difference-in-differences"><i class="fas fa-link"></i></a>
</h2>
<p>reference: <span class="citation">(<a href="references.html#ref-arkhangelsky2021a" role="doc-biblioref">Arkhangelsky et al. 2021</a>)</span></p>
</div>
<div id="modified-synthetic-control" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Modified Synthetic Control<a class="anchor" aria-label="anchor" href="#modified-synthetic-control"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Proposed by <span class="citation">(<a href="references.html#ref-doudchenko2016" role="doc-biblioref">Doudchenko and Imbens 2016</a>)</span></p></li>
<li>
<p>Different from the traditional synthetic control method, MSC does not have the following restrictions:</p>
<ul>
<li><p>no intercepts in the minimization function</p></li>
<li><p>sum of the slope coefficients sum to 1</p></li>
</ul>
</li>
<li><p>But MSC still needs all slope coefficients to be non-negative</p></li>
<li><p>Can’t use when the number of control units is much larger than the number of pre-treatment time periods.</p></li>
</ul>
</div>
<div id="generalized-synthetic-control" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> Generalized Synthetic Control<a class="anchor" aria-label="anchor" href="#generalized-synthetic-control"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>Utilizing data from the control group and a linear interactive fixed effects model with unit-specific intercepts interacting with time-varying coefficients, generalized synthetic control (GSC) imputes counterfactuals for each treated unit.</p></li>
<li><p>Essentially, GSC combines fixed effects model (<a href="difference-in-differences.html#difference-in-differences">DID</a>) and the synthetic control model</p></li>
<li><p>Do not need the parallel trends assumption required by <a href="difference-in-differences.html#difference-in-differences">DID</a></p></li>
</ul>
<p>Since unobserved time-varying confounders can violate the parallel trends assumption, researchers typically do</p>
<ol style="list-style-type: decimal">
<li>Condition on pre-treatment observables (e.g., matching methods) before DID estimation. But this method only fix problems of confounders that correlate with the observables, not those that uncorrelated with the observables. Synthetic control operates on a similar premise that creates counterfactual for the treated unit based on reweighted control units, but it typically applies to cases with one treated unit and the SE of the estimate is hard to derive</li>
<li>Model the unobserved time-varying heterogeneity by adding unit-specific time trends (either linear or quadratic) to the two-fway fixed effects model. With the addtional assumption of treatment assignemnt is ignorable conditonal on the fixed effects and the imposed trends , the treatment estimate can be unbiased. However, we cannot be sure if we have the right underlying trends.</li>
<li>Model the unobserved time-varying confounders semi-parametrically by using interactive fixed effects models <span class="citation">(<a href="references.html#ref-panelda2009" role="doc-biblioref"><span>“Panel Data Models With Interactive Fixed Effects”</span> 2009</a>)</span> (i.e., interacting unit-specific intercepts with time-vayring coefficients), where
<ol style="list-style-type: decimal">
<li><p>Time-varying coefficients = latent factors</p></li>
<li><p>Unit-specific intecepts = factor loadings.</p></li>
</ol>
</li>
<li>use the generalized synthetic control (GSC) that combines the above approaches.</li>
</ol>
<p>Steps:</p>
<ol style="list-style-type: decimal">
<li>Using control group data, the first model estimates an interactive fixed-effect model to get <span class="math inline">\(k\)</span> number of latent factors</li>
<li>Estimate factor loadings for each treated unit</li>
<li>Impute treated counterfactuals and standard errors based on the estimated factor loadings.</li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="difference-in-differences.html"><span class="header-section-number">24</span> Difference-in-differences</a></div>
<div class="next"><a href="panel-data-methods.html"><span class="header-section-number">26</span> Panel Data Methods</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#synthetic-control"><span class="header-section-number">25</span> Synthetic Control</a></li>
<li>
<a class="nav-link" href="#applications-2"><span class="header-section-number">25.1</span> Applications</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#example-1-2"><span class="header-section-number">25.1.1</span> Example 1</a></li>
<li><a class="nav-link" href="#example-2-1"><span class="header-section-number">25.1.2</span> Example 2</a></li>
<li><a class="nav-link" href="#example-3-1"><span class="header-section-number">25.1.3</span> Example 3</a></li>
<li><a class="nav-link" href="#example-4-1"><span class="header-section-number">25.1.4</span> Example 4</a></li>
</ul>
</li>
<li><a class="nav-link" href="#synthetic-difference-in-differences"><span class="header-section-number">25.2</span> Synthetic Difference-in-differences</a></li>
<li><a class="nav-link" href="#modified-synthetic-control"><span class="header-section-number">25.3</span> Modified Synthetic Control</a></li>
<li><a class="nav-link" href="#generalized-synthetic-control"><span class="header-section-number">25.4</span> Generalized Synthetic Control</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/25-synthetic-control.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/25-synthetic-control.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2022-09-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
