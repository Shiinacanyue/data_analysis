<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>26.3 Two-way Fixed-effects | A Guide on Data Analysis</title>
  <meta name="description" content="This is a guide on how to conduct data analysis in the field of data science, statistics, or machine learning." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="26.3 Two-way Fixed-effects | A Guide on Data Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg" />
  <meta property="og:description" content="This is a guide on how to conduct data analysis in the field of data science, statistics, or machine learning." />
  <meta name="github-repo" content="mikenguyen13/data_analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="26.3 Two-way Fixed-effects | A Guide on Data Analysis" />
  
  <meta name="twitter:description" content="This is a guide on how to conduct data analysis in the field of data science, statistics, or machine learning." />
  <meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg" />

<meta name="author" content="Mike Nguyen" />


<meta name="date" content="2024-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="logo.png" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="one-difference.html"/>
<link rel="next" href="assumption-violation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DMNX2X65HQ');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Guide on Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="how-to-cite-this-book.html"><a href="how-to-cite-this-book.html"><i class="fa fa-check"></i>How to cite this book</a></li>
<li class="chapter" data-level="" data-path="more-books.html"><a href="more-books.html"><i class="fa fa-check"></i>More books</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>2</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="2.1" data-path="matrix-theory.html"><a href="matrix-theory.html"><i class="fa fa-check"></i><b>2.1</b> Matrix Theory</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="matrix-theory.html"><a href="matrix-theory.html#rank"><i class="fa fa-check"></i><b>2.1.1</b> Rank</a></li>
<li class="chapter" data-level="2.1.2" data-path="matrix-theory.html"><a href="matrix-theory.html#inverse"><i class="fa fa-check"></i><b>2.1.2</b> Inverse</a></li>
<li class="chapter" data-level="2.1.3" data-path="matrix-theory.html"><a href="matrix-theory.html#definiteness"><i class="fa fa-check"></i><b>2.1.3</b> Definiteness</a></li>
<li class="chapter" data-level="2.1.4" data-path="matrix-theory.html"><a href="matrix-theory.html#matrix-calculus"><i class="fa fa-check"></i><b>2.1.4</b> Matrix Calculus</a></li>
<li class="chapter" data-level="2.1.5" data-path="matrix-theory.html"><a href="matrix-theory.html#optimization"><i class="fa fa-check"></i><b>2.1.5</b> Optimization</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability-theory.html"><a href="probability-theory.html"><i class="fa fa-check"></i><b>2.2</b> Probability Theory</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="probability-theory.html"><a href="probability-theory.html#axiom-and-theorems-of-probability"><i class="fa fa-check"></i><b>2.2.1</b> Axiom and Theorems of Probability</a></li>
<li class="chapter" data-level="2.2.2" data-path="probability-theory.html"><a href="probability-theory.html#central-limit-theorem"><i class="fa fa-check"></i><b>2.2.2</b> Central Limit Theorem</a></li>
<li class="chapter" data-level="2.2.3" data-path="probability-theory.html"><a href="probability-theory.html#random-variable"><i class="fa fa-check"></i><b>2.2.3</b> Random variable</a></li>
<li class="chapter" data-level="2.2.4" data-path="probability-theory.html"><a href="probability-theory.html#moment-generating-function"><i class="fa fa-check"></i><b>2.2.4</b> Moment generating function</a></li>
<li class="chapter" data-level="2.2.5" data-path="probability-theory.html"><a href="probability-theory.html#moment"><i class="fa fa-check"></i><b>2.2.5</b> Moment</a></li>
<li class="chapter" data-level="2.2.6" data-path="probability-theory.html"><a href="probability-theory.html#distributions"><i class="fa fa-check"></i><b>2.2.6</b> Distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="general-math.html"><a href="general-math.html"><i class="fa fa-check"></i><b>2.3</b> General Math</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="general-math.html"><a href="general-math.html#number-sets"><i class="fa fa-check"></i><b>2.3.1</b> Number Sets</a></li>
<li class="chapter" data-level="2.3.2" data-path="general-math.html"><a href="general-math.html#summation-notation-and-series"><i class="fa fa-check"></i><b>2.3.2</b> Summation Notation and Series</a></li>
<li class="chapter" data-level="2.3.3" data-path="general-math.html"><a href="general-math.html#taylor-expansion"><i class="fa fa-check"></i><b>2.3.3</b> Taylor Expansion</a></li>
<li class="chapter" data-level="2.3.4" data-path="general-math.html"><a href="general-math.html#law-of-large-numbers"><i class="fa fa-check"></i><b>2.3.4</b> Law of large numbers</a></li>
<li class="chapter" data-level="2.3.5" data-path="general-math.html"><a href="general-math.html#law-of-iterated-expectation"><i class="fa fa-check"></i><b>2.3.5</b> Law of Iterated Expectation</a></li>
<li class="chapter" data-level="2.3.6" data-path="general-math.html"><a href="general-math.html#convergence"><i class="fa fa-check"></i><b>2.3.6</b> Convergence</a></li>
<li class="chapter" data-level="2.3.7" data-path="general-math.html"><a href="general-math.html#sufficient-statistics"><i class="fa fa-check"></i><b>2.3.7</b> Sufficient Statistics</a></li>
<li class="chapter" data-level="2.3.8" data-path="general-math.html"><a href="general-math.html#parameter-transformations"><i class="fa fa-check"></i><b>2.3.8</b> Parameter transformations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-importexport.html"><a href="data-importexport.html"><i class="fa fa-check"></i><b>2.4</b> Data Import/Export</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-importexport.html"><a href="data-importexport.html#medium-size"><i class="fa fa-check"></i><b>2.4.1</b> Medium size</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-importexport.html"><a href="data-importexport.html#large-size"><i class="fa fa-check"></i><b>2.4.2</b> Large size</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>2.5</b> Data Manipulation</a></li>
</ul></li>
<li class="part"><span><b>I. BASIC</b></span></li>
<li class="chapter" data-level="3" data-path="descriptive-stat.html"><a href="descriptive-stat.html"><i class="fa fa-check"></i><b>3</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="numerical-measures.html"><a href="numerical-measures.html"><i class="fa fa-check"></i><b>3.1</b> Numerical Measures</a></li>
<li class="chapter" data-level="3.2" data-path="graphical-measures.html"><a href="graphical-measures.html"><i class="fa fa-check"></i><b>3.2</b> Graphical Measures</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="graphical-measures.html"><a href="graphical-measures.html#shape"><i class="fa fa-check"></i><b>3.2.1</b> Shape</a></li>
<li class="chapter" data-level="3.2.2" data-path="graphical-measures.html"><a href="graphical-measures.html#scatterplot"><i class="fa fa-check"></i><b>3.2.2</b> Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="normality-assessment.html"><a href="normality-assessment.html"><i class="fa fa-check"></i><b>3.3</b> Normality Assessment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="normality-assessment.html"><a href="normality-assessment.html#graphical-assessment"><i class="fa fa-check"></i><b>3.3.1</b> Graphical Assessment</a></li>
<li class="chapter" data-level="3.3.2" data-path="normality-assessment.html"><a href="normality-assessment.html#summary-statistics"><i class="fa fa-check"></i><b>3.3.2</b> Summary Statistics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="bivariate-statistics.html"><a href="bivariate-statistics.html"><i class="fa fa-check"></i><b>3.4</b> Bivariate Statistics</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="bivariate-statistics.html"><a href="bivariate-statistics.html#two-continuous"><i class="fa fa-check"></i><b>3.4.1</b> Two Continuous</a></li>
<li class="chapter" data-level="3.4.2" data-path="bivariate-statistics.html"><a href="bivariate-statistics.html#categorical-and-continuous"><i class="fa fa-check"></i><b>3.4.2</b> Categorical and Continuous</a></li>
<li class="chapter" data-level="3.4.3" data-path="bivariate-statistics.html"><a href="bivariate-statistics.html#two-discrete"><i class="fa fa-check"></i><b>3.4.3</b> Two Discrete</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>3.5</b> Summary</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="summary-1.html"><a href="summary-1.html#visualization"><i class="fa fa-check"></i><b>3.5.1</b> Visualization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="basic-statistical-inference.html"><a href="basic-statistical-inference.html"><i class="fa fa-check"></i><b>4</b> Basic Statistical Inference</a>
<ul>
<li class="chapter" data-level="4.1" data-path="one-sample-inference.html"><a href="one-sample-inference.html"><i class="fa fa-check"></i><b>4.1</b> One Sample Inference</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="one-sample-inference.html"><a href="one-sample-inference.html#the-mean"><i class="fa fa-check"></i><b>4.1.1</b> The Mean</a></li>
<li class="chapter" data-level="4.1.2" data-path="one-sample-inference.html"><a href="one-sample-inference.html#single-variance"><i class="fa fa-check"></i><b>4.1.2</b> Single Variance</a></li>
<li class="chapter" data-level="4.1.3" data-path="one-sample-inference.html"><a href="one-sample-inference.html#single-proportion-p"><i class="fa fa-check"></i><b>4.1.3</b> Single Proportion (p)</a></li>
<li class="chapter" data-level="4.1.4" data-path="one-sample-inference.html"><a href="one-sample-inference.html#power"><i class="fa fa-check"></i><b>4.1.4</b> Power</a></li>
<li class="chapter" data-level="4.1.5" data-path="one-sample-inference.html"><a href="one-sample-inference.html#sample-size"><i class="fa fa-check"></i><b>4.1.5</b> Sample Size</a></li>
<li class="chapter" data-level="4.1.6" data-path="one-sample-inference.html"><a href="one-sample-inference.html#note"><i class="fa fa-check"></i><b>4.1.6</b> Note</a></li>
<li class="chapter" data-level="4.1.7" data-path="one-sample-inference.html"><a href="one-sample-inference.html#one-sample-non-parametric-methods"><i class="fa fa-check"></i><b>4.1.7</b> One-sample Non-parametric Methods</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="two-sample-inference.html"><a href="two-sample-inference.html"><i class="fa fa-check"></i><b>4.2</b> Two Sample Inference</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="two-sample-inference.html"><a href="two-sample-inference.html#means"><i class="fa fa-check"></i><b>4.2.1</b> Means</a></li>
<li class="chapter" data-level="4.2.2" data-path="two-sample-inference.html"><a href="two-sample-inference.html#variances"><i class="fa fa-check"></i><b>4.2.2</b> Variances</a></li>
<li class="chapter" data-level="4.2.3" data-path="two-sample-inference.html"><a href="two-sample-inference.html#power-1"><i class="fa fa-check"></i><b>4.2.3</b> Power</a></li>
<li class="chapter" data-level="4.2.4" data-path="two-sample-inference.html"><a href="two-sample-inference.html#sample-size-1"><i class="fa fa-check"></i><b>4.2.4</b> Sample Size</a></li>
<li class="chapter" data-level="4.2.5" data-path="two-sample-inference.html"><a href="two-sample-inference.html#matched-pair-designs"><i class="fa fa-check"></i><b>4.2.5</b> Matched Pair Designs</a></li>
<li class="chapter" data-level="4.2.6" data-path="two-sample-inference.html"><a href="two-sample-inference.html#nonparametric-tests-for-two-samples"><i class="fa fa-check"></i><b>4.2.6</b> Nonparametric Tests for Two Samples</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="categorical-data-analysis.html"><a href="categorical-data-analysis.html"><i class="fa fa-check"></i><b>4.3</b> Categorical Data Analysis</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="categorical-data-analysis.html"><a href="categorical-data-analysis.html#inferences-for-small-samples"><i class="fa fa-check"></i><b>4.3.1</b> Inferences for Small Samples</a></li>
<li class="chapter" data-level="4.3.2" data-path="categorical-data-analysis.html"><a href="categorical-data-analysis.html#test-of-association"><i class="fa fa-check"></i><b>4.3.2</b> Test of Association</a></li>
<li class="chapter" data-level="4.3.3" data-path="categorical-data-analysis.html"><a href="categorical-data-analysis.html#ordinal-association"><i class="fa fa-check"></i><b>4.3.3</b> Ordinal Association</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="divergence-metrics-and-test-for-comparing-distributions.html"><a href="divergence-metrics-and-test-for-comparing-distributions.html"><i class="fa fa-check"></i><b>4.4</b> Divergence Metrics and Test for Comparing Distributions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="divergence-metrics-and-test-for-comparing-distributions.html"><a href="divergence-metrics-and-test-for-comparing-distributions.html#kullback-leibler-divergence"><i class="fa fa-check"></i><b>4.4.1</b> Kullback-Leibler Divergence</a></li>
<li class="chapter" data-level="4.4.2" data-path="divergence-metrics-and-test-for-comparing-distributions.html"><a href="divergence-metrics-and-test-for-comparing-distributions.html#jensen-shannon-divergence"><i class="fa fa-check"></i><b>4.4.2</b> Jensen-Shannon Divergence</a></li>
<li class="chapter" data-level="4.4.3" data-path="divergence-metrics-and-test-for-comparing-distributions.html"><a href="divergence-metrics-and-test-for-comparing-distributions.html#wasserstein-distance"><i class="fa fa-check"></i><b>4.4.3</b> Wasserstein Distance</a></li>
<li class="chapter" data-level="4.4.4" data-path="divergence-metrics-and-test-for-comparing-distributions.html"><a href="divergence-metrics-and-test-for-comparing-distributions.html#kolmogorov-smirnov-test-1"><i class="fa fa-check"></i><b>4.4.4</b> Kolmogorov-Smirnov Test</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II. REGRESSION</b></span></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html"><i class="fa fa-check"></i><b>5.1</b> Ordinary Least Squares</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#simple-regression-basic-model"><i class="fa fa-check"></i><b>5.1.1</b> Simple Regression (Basic Model)</a></li>
<li class="chapter" data-level="5.1.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#multiple-linear-regression"><i class="fa fa-check"></i><b>5.1.2</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="5.1.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#ols-assumptions"><i class="fa fa-check"></i><b>5.1.3</b> OLS Assumptions</a></li>
<li class="chapter" data-level="5.1.4" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#theorems"><i class="fa fa-check"></i><b>5.1.4</b> Theorems</a></li>
<li class="chapter" data-level="5.1.5" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#variable-selection"><i class="fa fa-check"></i><b>5.1.5</b> Variable Selection</a></li>
<li class="chapter" data-level="5.1.6" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#diagnostics-1"><i class="fa fa-check"></i><b>5.1.6</b> Diagnostics</a></li>
<li class="chapter" data-level="5.1.7" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#model-validation"><i class="fa fa-check"></i><b>5.1.7</b> Model Validation</a></li>
<li class="chapter" data-level="5.1.8" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#finite-sample-properties"><i class="fa fa-check"></i><b>5.1.8</b> Finite Sample Properties</a></li>
<li class="chapter" data-level="5.1.9" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#large-sample-properties"><i class="fa fa-check"></i><b>5.1.9</b> Large Sample Properties</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="feasible-generalized-least-squares.html"><a href="feasible-generalized-least-squares.html"><i class="fa fa-check"></i><b>5.2</b> Feasible Generalized Least Squares</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="feasible-generalized-least-squares.html"><a href="feasible-generalized-least-squares.html#heteroskedasticity"><i class="fa fa-check"></i><b>5.2.1</b> Heteroskedasticity</a></li>
<li class="chapter" data-level="5.2.2" data-path="feasible-generalized-least-squares.html"><a href="feasible-generalized-least-squares.html#serial-correlation"><i class="fa fa-check"></i><b>5.2.2</b> Serial Correlation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="weighted-least-squares.html"><a href="weighted-least-squares.html"><i class="fa fa-check"></i><b>5.3</b> Weighted Least Squares</a></li>
<li class="chapter" data-level="5.4" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html"><i class="fa fa-check"></i><b>5.4</b> Generalized Least Squares</a></li>
<li class="chapter" data-level="5.5" data-path="feasiable-prais-winsten.html"><a href="feasiable-prais-winsten.html"><i class="fa fa-check"></i><b>5.5</b> Feasible Prais Winsten</a></li>
<li class="chapter" data-level="5.6" data-path="feasible-group-level-random-effects.html"><a href="feasible-group-level-random-effects.html"><i class="fa fa-check"></i><b>5.6</b> Feasible group level Random Effects</a></li>
<li class="chapter" data-level="5.7" data-path="ridge-regression.html"><a href="ridge-regression.html"><i class="fa fa-check"></i><b>5.7</b> Ridge Regression</a></li>
<li class="chapter" data-level="5.8" data-path="principal-component-regression.html"><a href="principal-component-regression.html"><i class="fa fa-check"></i><b>5.8</b> Principal Component Regression</a></li>
<li class="chapter" data-level="5.9" data-path="robust-regression.html"><a href="robust-regression.html"><i class="fa fa-check"></i><b>5.9</b> Robust Regression</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="robust-regression.html"><a href="robust-regression.html#least-absolute-residuals-lar-regression"><i class="fa fa-check"></i><b>5.9.1</b> Least Absolute Residuals (LAR) Regression</a></li>
<li class="chapter" data-level="5.9.2" data-path="robust-regression.html"><a href="robust-regression.html#least-median-of-squares-lms-regression"><i class="fa fa-check"></i><b>5.9.2</b> Least Median of Squares (LMS) Regression</a></li>
<li class="chapter" data-level="5.9.3" data-path="robust-regression.html"><a href="robust-regression.html#iteratively-reweighted-least-squares-irls-robust-regression"><i class="fa fa-check"></i><b>5.9.3</b> Iteratively Reweighted Least Squares (IRLS) Robust Regression</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html"><i class="fa fa-check"></i><b>5.10</b> Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html#motivation-for-mle"><i class="fa fa-check"></i><b>5.10.1</b> Motivation for MLE</a></li>
<li class="chapter" data-level="5.10.2" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html#assumption"><i class="fa fa-check"></i><b>5.10.2</b> Assumption</a></li>
<li class="chapter" data-level="5.10.3" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html#properties"><i class="fa fa-check"></i><b>5.10.3</b> Properties</a></li>
<li class="chapter" data-level="5.10.4" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html#compare-to-ols"><i class="fa fa-check"></i><b>5.10.4</b> Compare to OLS</a></li>
<li class="chapter" data-level="5.10.5" data-path="maximum-likelihood-regression.html"><a href="maximum-likelihood-regression.html#application"><i class="fa fa-check"></i><b>5.10.5</b> Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="non-linear-regression.html"><a href="non-linear-regression.html"><i class="fa fa-check"></i><b>6</b> Non-linear Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="inference-1.html"><a href="inference-1.html"><i class="fa fa-check"></i><b>6.1</b> Inference</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="inference-1.html"><a href="inference-1.html#linear-function-of-the-parameters"><i class="fa fa-check"></i><b>6.1.1</b> Linear Function of the Parameters</a></li>
<li class="chapter" data-level="6.1.2" data-path="inference-1.html"><a href="inference-1.html#nonlinear"><i class="fa fa-check"></i><b>6.1.2</b> Nonlinear</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="non-linear-least-squares.html"><a href="non-linear-least-squares.html"><i class="fa fa-check"></i><b>6.2</b> Non-linear Least Squares</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="non-linear-least-squares.html"><a href="non-linear-least-squares.html#alternative-of-gauss-newton-algorithm"><i class="fa fa-check"></i><b>6.2.1</b> Alternative of Gauss-Newton Algorithm</a></li>
<li class="chapter" data-level="6.2.2" data-path="non-linear-least-squares.html"><a href="non-linear-least-squares.html#practical-considerations"><i class="fa fa-check"></i><b>6.2.2</b> Practical Considerations</a></li>
<li class="chapter" data-level="6.2.3" data-path="non-linear-least-squares.html"><a href="non-linear-least-squares.html#modelestimation-adequacy"><i class="fa fa-check"></i><b>6.2.3</b> Model/Estimation Adequacy</a></li>
<li class="chapter" data-level="6.2.4" data-path="non-linear-least-squares.html"><a href="non-linear-least-squares.html#application-1"><i class="fa fa-check"></i><b>6.2.4</b> Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>7</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="logistic-regression-1.html"><a href="logistic-regression-1.html"><i class="fa fa-check"></i><b>7.1</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="logistic-regression-1.html"><a href="logistic-regression-1.html#application-2"><i class="fa fa-check"></i><b>7.1.1</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="probit-regression.html"><a href="probit-regression.html"><i class="fa fa-check"></i><b>7.2</b> Probit Regression</a></li>
<li class="chapter" data-level="7.3" data-path="binomial-regression.html"><a href="binomial-regression.html"><i class="fa fa-check"></i><b>7.3</b> Binomial Regression</a></li>
<li class="chapter" data-level="7.4" data-path="poisson-regression.html"><a href="poisson-regression.html"><i class="fa fa-check"></i><b>7.4</b> Poisson Regression</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="poisson-regression.html"><a href="poisson-regression.html#application-3"><i class="fa fa-check"></i><b>7.4.1</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="negative-binomial-regression.html"><a href="negative-binomial-regression.html"><i class="fa fa-check"></i><b>7.5</b> Negative Binomial Regression</a></li>
<li class="chapter" data-level="7.6" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i><b>7.6</b> Multinomial</a></li>
<li class="chapter" data-level="7.7" data-path="generalization.html"><a href="generalization.html"><i class="fa fa-check"></i><b>7.7</b> Generalization</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="generalization.html"><a href="generalization.html#estimation-1"><i class="fa fa-check"></i><b>7.7.1</b> Estimation</a></li>
<li class="chapter" data-level="7.7.2" data-path="generalization.html"><a href="generalization.html#inference-2"><i class="fa fa-check"></i><b>7.7.2</b> Inference</a></li>
<li class="chapter" data-level="7.7.3" data-path="generalization.html"><a href="generalization.html#deviance"><i class="fa fa-check"></i><b>7.7.3</b> Deviance</a></li>
<li class="chapter" data-level="7.7.4" data-path="generalization.html"><a href="generalization.html#diagnostic-plots"><i class="fa fa-check"></i><b>7.7.4</b> Diagnostic Plots</a></li>
<li class="chapter" data-level="7.7.5" data-path="generalization.html"><a href="generalization.html#goodness-of-fit"><i class="fa fa-check"></i><b>7.7.5</b> Goodness of Fit</a></li>
<li class="chapter" data-level="7.7.6" data-path="generalization.html"><a href="generalization.html#over-dispersion"><i class="fa fa-check"></i><b>7.7.6</b> Over-Dispersion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Linear Mixed Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="dependent-data.html"><a href="dependent-data.html"><i class="fa fa-check"></i><b>8.1</b> Dependent Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="dependent-data.html"><a href="dependent-data.html#random-intercepts-model"><i class="fa fa-check"></i><b>8.1.1</b> Random-Intercepts Model</a></li>
<li class="chapter" data-level="8.1.2" data-path="dependent-data.html"><a href="dependent-data.html#covariance-models"><i class="fa fa-check"></i><b>8.1.2</b> Covariance Models</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="estimation-2.html"><a href="estimation-2.html"><i class="fa fa-check"></i><b>8.2</b> Estimation</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="estimation-2.html"><a href="estimation-2.html#estimating-mathbfv"><i class="fa fa-check"></i><b>8.2.1</b> Estimating <span class="math inline">\(\mathbf{V}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="inference-3.html"><a href="inference-3.html"><i class="fa fa-check"></i><b>8.3</b> Inference</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="inference-3.html"><a href="inference-3.html#parameters-beta"><i class="fa fa-check"></i><b>8.3.1</b> Parameters <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="8.3.2" data-path="inference-3.html"><a href="inference-3.html#variance-components"><i class="fa fa-check"></i><b>8.3.2</b> Variance Components</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="information-criteria.html"><a href="information-criteria.html"><i class="fa fa-check"></i><b>8.4</b> Information Criteria</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="information-criteria.html"><a href="information-criteria.html#akaikes-information-criteria-aic"><i class="fa fa-check"></i><b>8.4.1</b> Akaike’s Information Criteria (AIC)</a></li>
<li class="chapter" data-level="8.4.2" data-path="information-criteria.html"><a href="information-criteria.html#corrected-aic-aicc"><i class="fa fa-check"></i><b>8.4.2</b> Corrected AIC (AICC)</a></li>
<li class="chapter" data-level="8.4.3" data-path="information-criteria.html"><a href="information-criteria.html#bayesian-information-criteria-bic"><i class="fa fa-check"></i><b>8.4.3</b> Bayesian Information Criteria (BIC)</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="split-plot-designs.html"><a href="split-plot-designs.html"><i class="fa fa-check"></i><b>8.5</b> Split-Plot Designs</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="split-plot-designs.html"><a href="split-plot-designs.html#application-4"><i class="fa fa-check"></i><b>8.5.1</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="repeated-measures-in-mixed-models.html"><a href="repeated-measures-in-mixed-models.html"><i class="fa fa-check"></i><b>8.6</b> Repeated Measures in Mixed Models</a></li>
<li class="chapter" data-level="8.7" data-path="unbalanced-or-unequally-spaced-data.html"><a href="unbalanced-or-unequally-spaced-data.html"><i class="fa fa-check"></i><b>8.7</b> Unbalanced or Unequally Spaced Data</a></li>
<li class="chapter" data-level="8.8" data-path="application-5.html"><a href="application-5.html"><i class="fa fa-check"></i><b>8.8</b> Application</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="application-5.html"><a href="application-5.html#example-1-pulps"><i class="fa fa-check"></i><b>8.8.1</b> Example 1 (Pulps)</a></li>
<li class="chapter" data-level="8.8.2" data-path="application-5.html"><a href="application-5.html#example-2-rats"><i class="fa fa-check"></i><b>8.8.2</b> Example 2 (Rats)</a></li>
<li class="chapter" data-level="8.8.3" data-path="application-5.html"><a href="application-5.html#example-3-agridat"><i class="fa fa-check"></i><b>8.8.3</b> Example 3 (Agridat)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="nonlinear-and-generalized-linear-mixed-models.html"><a href="nonlinear-and-generalized-linear-mixed-models.html"><i class="fa fa-check"></i><b>9</b> Nonlinear and Generalized Linear Mixed Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="estimation-3.html"><a href="estimation-3.html"><i class="fa fa-check"></i><b>9.1</b> Estimation</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="estimation-3.html"><a href="estimation-3.html#estimation-by-numerical-integration"><i class="fa fa-check"></i><b>9.1.1</b> Estimation by Numerical Integration</a></li>
<li class="chapter" data-level="9.1.2" data-path="estimation-3.html"><a href="estimation-3.html#estimation-by-linearization"><i class="fa fa-check"></i><b>9.1.2</b> Estimation by Linearization</a></li>
<li class="chapter" data-level="9.1.3" data-path="estimation-3.html"><a href="estimation-3.html#estimation-by-bayesian-hierarchical-models"><i class="fa fa-check"></i><b>9.1.3</b> Estimation by Bayesian Hierarchical Models</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="application-6.html"><a href="application-6.html"><i class="fa fa-check"></i><b>9.2</b> Application</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="application-6.html"><a href="application-6.html#binomial-cbpp-data"><i class="fa fa-check"></i><b>9.2.1</b> Binomial (CBPP Data)</a></li>
<li class="chapter" data-level="9.2.2" data-path="application-6.html"><a href="application-6.html#count-owl-data"><i class="fa fa-check"></i><b>9.2.2</b> Count (Owl Data)</a></li>
<li class="chapter" data-level="9.2.3" data-path="application-6.html"><a href="application-6.html#binomial-1"><i class="fa fa-check"></i><b>9.2.3</b> Binomial</a></li>
<li class="chapter" data-level="9.2.4" data-path="application-6.html"><a href="application-6.html#example-from-schabenberger_2001-section-8.4.1"><i class="fa fa-check"></i><b>9.2.4</b> Example from <span class="citation">(Schabenberger and Pierce 2001)</span> section 8.4.1</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="summary-2.html"><a href="summary-2.html"><i class="fa fa-check"></i><b>9.3</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III. RAMIFICATIONS</b></span></li>
<li class="chapter" data-level="10" data-path="model-specification.html"><a href="model-specification.html"><i class="fa fa-check"></i><b>10</b> Model Specification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="nested-model.html"><a href="nested-model.html"><i class="fa fa-check"></i><b>10.1</b> Nested Model</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="nested-model.html"><a href="nested-model.html#chow-test"><i class="fa fa-check"></i><b>10.1.1</b> Chow test</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="non-nested-model.html"><a href="non-nested-model.html"><i class="fa fa-check"></i><b>10.2</b> Non-Nested Model</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="non-nested-model.html"><a href="non-nested-model.html#davidson-mackinnon-test"><i class="fa fa-check"></i><b>10.2.1</b> Davidson-Mackinnon test</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="heteroskedasticity-1.html"><a href="heteroskedasticity-1.html"><i class="fa fa-check"></i><b>10.3</b> Heteroskedasticity</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="heteroskedasticity-1.html"><a href="heteroskedasticity-1.html#breusch-pagan-test"><i class="fa fa-check"></i><b>10.3.1</b> Breusch-Pagan test</a></li>
<li class="chapter" data-level="10.3.2" data-path="heteroskedasticity-1.html"><a href="heteroskedasticity-1.html#white-test"><i class="fa fa-check"></i><b>10.3.2</b> White test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="imputation-missing-data.html"><a href="imputation-missing-data.html"><i class="fa fa-check"></i><b>11</b> Imputation (Missing Data)</a>
<ul>
<li class="chapter" data-level="11.1" data-path="assumptions-1.html"><a href="assumptions-1.html"><i class="fa fa-check"></i><b>11.1</b> Assumptions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="assumptions-1.html"><a href="assumptions-1.html#missing-completely-at-random-mcar"><i class="fa fa-check"></i><b>11.1.1</b> Missing Completely at Random (MCAR)</a></li>
<li class="chapter" data-level="11.1.2" data-path="assumptions-1.html"><a href="assumptions-1.html#missing-at-random-mar"><i class="fa fa-check"></i><b>11.1.2</b> Missing at Random (MAR)</a></li>
<li class="chapter" data-level="11.1.3" data-path="assumptions-1.html"><a href="assumptions-1.html#ignorable"><i class="fa fa-check"></i><b>11.1.3</b> Ignorable</a></li>
<li class="chapter" data-level="11.1.4" data-path="assumptions-1.html"><a href="assumptions-1.html#nonignorable"><i class="fa fa-check"></i><b>11.1.4</b> Nonignorable</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html"><i class="fa fa-check"></i><b>11.2</b> Solutions to Missing data</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html#listwise-deletion"><i class="fa fa-check"></i><b>11.2.1</b> Listwise Deletion</a></li>
<li class="chapter" data-level="11.2.2" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html#pairwise-deletion"><i class="fa fa-check"></i><b>11.2.2</b> Pairwise Deletion</a></li>
<li class="chapter" data-level="11.2.3" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html#dummy-variable-adjustment"><i class="fa fa-check"></i><b>11.2.3</b> Dummy Variable Adjustment</a></li>
<li class="chapter" data-level="11.2.4" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html#imputation"><i class="fa fa-check"></i><b>11.2.4</b> Imputation</a></li>
<li class="chapter" data-level="11.2.5" data-path="solutions-to-missing-data.html"><a href="solutions-to-missing-data.html#other-methods"><i class="fa fa-check"></i><b>11.2.5</b> Other methods</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="criteria-for-choosing-an-effective-approach.html"><a href="criteria-for-choosing-an-effective-approach.html"><i class="fa fa-check"></i><b>11.3</b> Criteria for Choosing an Effective Approach</a></li>
<li class="chapter" data-level="11.4" data-path="another-perspective.html"><a href="another-perspective.html"><i class="fa fa-check"></i><b>11.4</b> Another Perspective</a></li>
<li class="chapter" data-level="11.5" data-path="diagnosing-the-mechanism.html"><a href="diagnosing-the-mechanism.html"><i class="fa fa-check"></i><b>11.5</b> Diagnosing the Mechanism</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="diagnosing-the-mechanism.html"><a href="diagnosing-the-mechanism.html#mar-vs.-mnar"><i class="fa fa-check"></i><b>11.5.1</b> MAR vs. MNAR</a></li>
<li class="chapter" data-level="11.5.2" data-path="diagnosing-the-mechanism.html"><a href="diagnosing-the-mechanism.html#mcar-vs.-mar"><i class="fa fa-check"></i><b>11.5.2</b> MCAR vs. MAR</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="application-7.html"><a href="application-7.html"><i class="fa fa-check"></i><b>11.6</b> Application</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="application-7.html"><a href="application-7.html#imputation-with-mean-median-mode"><i class="fa fa-check"></i><b>11.6.1</b> Imputation with mean / median / mode</a></li>
<li class="chapter" data-level="11.6.2" data-path="application-7.html"><a href="application-7.html#knn"><i class="fa fa-check"></i><b>11.6.2</b> KNN</a></li>
<li class="chapter" data-level="11.6.3" data-path="application-7.html"><a href="application-7.html#rpart"><i class="fa fa-check"></i><b>11.6.3</b> rpart</a></li>
<li class="chapter" data-level="11.6.4" data-path="application-7.html"><a href="application-7.html#mice-multivariate-imputation-via-chained-equations"><i class="fa fa-check"></i><b>11.6.4</b> MICE (Multivariate Imputation via Chained Equations)</a></li>
<li class="chapter" data-level="11.6.5" data-path="application-7.html"><a href="application-7.html#amelia"><i class="fa fa-check"></i><b>11.6.5</b> Amelia</a></li>
<li class="chapter" data-level="11.6.6" data-path="application-7.html"><a href="application-7.html#missforest"><i class="fa fa-check"></i><b>11.6.6</b> missForest</a></li>
<li class="chapter" data-level="11.6.7" data-path="application-7.html"><a href="application-7.html#hmisc"><i class="fa fa-check"></i><b>11.6.7</b> Hmisc</a></li>
<li class="chapter" data-level="11.6.8" data-path="application-7.html"><a href="application-7.html#mi"><i class="fa fa-check"></i><b>11.6.8</b> mi</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>12</b> Data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cross-sectional.html"><a href="cross-sectional.html"><i class="fa fa-check"></i><b>12.1</b> Cross-Sectional</a></li>
<li class="chapter" data-level="12.2" data-path="time-series-1.html"><a href="time-series-1.html"><i class="fa fa-check"></i><b>12.2</b> Time Series</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="time-series-1.html"><a href="time-series-1.html#deterministic-time-trend"><i class="fa fa-check"></i><b>12.2.1</b> Deterministic Time trend</a></li>
<li class="chapter" data-level="12.2.2" data-path="time-series-1.html"><a href="time-series-1.html#feedback-effect"><i class="fa fa-check"></i><b>12.2.2</b> Feedback Effect</a></li>
<li class="chapter" data-level="12.2.3" data-path="time-series-1.html"><a href="time-series-1.html#dynamic-specification"><i class="fa fa-check"></i><b>12.2.3</b> Dynamic Specification</a></li>
<li class="chapter" data-level="12.2.4" data-path="time-series-1.html"><a href="time-series-1.html#dynamically-complete"><i class="fa fa-check"></i><b>12.2.4</b> Dynamically Complete</a></li>
<li class="chapter" data-level="12.2.5" data-path="time-series-1.html"><a href="time-series-1.html#highly-persistent-data"><i class="fa fa-check"></i><b>12.2.5</b> Highly Persistent Data</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="repeated-cross-sections.html"><a href="repeated-cross-sections.html"><i class="fa fa-check"></i><b>12.3</b> Repeated Cross Sections</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="repeated-cross-sections.html"><a href="repeated-cross-sections.html#pooled-cross-section"><i class="fa fa-check"></i><b>12.3.1</b> Pooled Cross Section</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="panel-data.html"><a href="panel-data.html"><i class="fa fa-check"></i><b>12.4</b> Panel Data</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="panel-data.html"><a href="panel-data.html#pooled-ols-estimator"><i class="fa fa-check"></i><b>12.4.1</b> Pooled OLS Estimator</a></li>
<li class="chapter" data-level="12.4.2" data-path="panel-data.html"><a href="panel-data.html#individual-specific-effects-model"><i class="fa fa-check"></i><b>12.4.2</b> Individual-specific effects model</a></li>
<li class="chapter" data-level="12.4.3" data-path="panel-data.html"><a href="panel-data.html#tests-for-assumptions"><i class="fa fa-check"></i><b>12.4.3</b> Tests for Assumptions</a></li>
<li class="chapter" data-level="12.4.4" data-path="panel-data.html"><a href="panel-data.html#model-selection"><i class="fa fa-check"></i><b>12.4.4</b> Model Selection</a></li>
<li class="chapter" data-level="12.4.5" data-path="panel-data.html"><a href="panel-data.html#summary-3"><i class="fa fa-check"></i><b>12.4.5</b> Summary</a></li>
<li class="chapter" data-level="12.4.6" data-path="panel-data.html"><a href="panel-data.html#application-8"><i class="fa fa-check"></i><b>12.4.6</b> Application</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="variable-transformation.html"><a href="variable-transformation.html"><i class="fa fa-check"></i><b>13</b> Variable Transformation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="continuous-variables.html"><a href="continuous-variables.html"><i class="fa fa-check"></i><b>13.1</b> Continuous Variables</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="continuous-variables.html"><a href="continuous-variables.html#standardization"><i class="fa fa-check"></i><b>13.1.1</b> Standardization</a></li>
<li class="chapter" data-level="13.1.2" data-path="continuous-variables.html"><a href="continuous-variables.html#min-max-scaling"><i class="fa fa-check"></i><b>13.1.2</b> Min-max scaling</a></li>
<li class="chapter" data-level="13.1.3" data-path="continuous-variables.html"><a href="continuous-variables.html#square-rootcube-root"><i class="fa fa-check"></i><b>13.1.3</b> Square Root/Cube Root</a></li>
<li class="chapter" data-level="13.1.4" data-path="continuous-variables.html"><a href="continuous-variables.html#logarithmic"><i class="fa fa-check"></i><b>13.1.4</b> Logarithmic</a></li>
<li class="chapter" data-level="13.1.5" data-path="continuous-variables.html"><a href="continuous-variables.html#exponential-1"><i class="fa fa-check"></i><b>13.1.5</b> Exponential</a></li>
<li class="chapter" data-level="13.1.6" data-path="continuous-variables.html"><a href="continuous-variables.html#power-2"><i class="fa fa-check"></i><b>13.1.6</b> Power</a></li>
<li class="chapter" data-level="13.1.7" data-path="continuous-variables.html"><a href="continuous-variables.html#inversereciprocal"><i class="fa fa-check"></i><b>13.1.7</b> Inverse/Reciprocal</a></li>
<li class="chapter" data-level="13.1.8" data-path="continuous-variables.html"><a href="continuous-variables.html#hyperbolic-arcsine"><i class="fa fa-check"></i><b>13.1.8</b> Hyperbolic arcsine</a></li>
<li class="chapter" data-level="13.1.9" data-path="continuous-variables.html"><a href="continuous-variables.html#ordered-quantile-norm"><i class="fa fa-check"></i><b>13.1.9</b> Ordered Quantile Norm</a></li>
<li class="chapter" data-level="13.1.10" data-path="continuous-variables.html"><a href="continuous-variables.html#arcsinh"><i class="fa fa-check"></i><b>13.1.10</b> Arcsinh</a></li>
<li class="chapter" data-level="13.1.11" data-path="continuous-variables.html"><a href="continuous-variables.html#lambert-w-x-f-transformation"><i class="fa fa-check"></i><b>13.1.11</b> Lambert W x F Transformation</a></li>
<li class="chapter" data-level="13.1.12" data-path="continuous-variables.html"><a href="continuous-variables.html#inverse-hyperbolic-sine-ihs-transformation"><i class="fa fa-check"></i><b>13.1.12</b> Inverse Hyperbolic Sine (IHS) transformation</a></li>
<li class="chapter" data-level="13.1.13" data-path="continuous-variables.html"><a href="continuous-variables.html#box-cox-transformation"><i class="fa fa-check"></i><b>13.1.13</b> Box-Cox Transformation</a></li>
<li class="chapter" data-level="13.1.14" data-path="continuous-variables.html"><a href="continuous-variables.html#yeo-johnson-transformation"><i class="fa fa-check"></i><b>13.1.14</b> Yeo-Johnson Transformation</a></li>
<li class="chapter" data-level="13.1.15" data-path="continuous-variables.html"><a href="continuous-variables.html#rankgauss"><i class="fa fa-check"></i><b>13.1.15</b> RankGauss</a></li>
<li class="chapter" data-level="13.1.16" data-path="continuous-variables.html"><a href="continuous-variables.html#summary-4"><i class="fa fa-check"></i><b>13.1.16</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="categorical-variables.html"><a href="categorical-variables.html"><i class="fa fa-check"></i><b>13.2</b> Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html"><i class="fa fa-check"></i><b>14</b> Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="14.1" data-path="types-of-hypothesis-testing.html"><a href="types-of-hypothesis-testing.html"><i class="fa fa-check"></i><b>14.1</b> Types of hypothesis testing</a></li>
<li class="chapter" data-level="14.2" data-path="wald-test.html"><a href="wald-test.html"><i class="fa fa-check"></i><b>14.2</b> Wald test</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="wald-test.html"><a href="wald-test.html#multiple-hypothesis"><i class="fa fa-check"></i><b>14.2.1</b> Multiple Hypothesis</a></li>
<li class="chapter" data-level="14.2.2" data-path="wald-test.html"><a href="wald-test.html#linear-combination"><i class="fa fa-check"></i><b>14.2.2</b> Linear Combination</a></li>
<li class="chapter" data-level="14.2.3" data-path="wald-test.html"><a href="wald-test.html#estimate-difference-in-coefficients"><i class="fa fa-check"></i><b>14.2.3</b> Estimate Difference in Coefficients</a></li>
<li class="chapter" data-level="14.2.4" data-path="wald-test.html"><a href="wald-test.html#application-9"><i class="fa fa-check"></i><b>14.2.4</b> Application</a></li>
<li class="chapter" data-level="14.2.5" data-path="wald-test.html"><a href="wald-test.html#nonlinear-1"><i class="fa fa-check"></i><b>14.2.5</b> Nonlinear</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="the-likelihood-ratio-test.html"><a href="the-likelihood-ratio-test.html"><i class="fa fa-check"></i><b>14.3</b> The likelihood ratio test</a></li>
<li class="chapter" data-level="14.4" data-path="lagrange-multiplier-score.html"><a href="lagrange-multiplier-score.html"><i class="fa fa-check"></i><b>14.4</b> Lagrange Multiplier (Score)</a></li>
<li class="chapter" data-level="14.5" data-path="two-one-sided-tests-tost-equivalence-testing.html"><a href="two-one-sided-tests-tost-equivalence-testing.html"><i class="fa fa-check"></i><b>14.5</b> Two One-Sided Tests (TOST) Equivalence Testing</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="marginal-effects.html"><a href="marginal-effects.html"><i class="fa fa-check"></i><b>15</b> Marginal Effects</a>
<ul>
<li class="chapter" data-level="15.1" data-path="delta-method.html"><a href="delta-method.html"><i class="fa fa-check"></i><b>15.1</b> Delta Method</a></li>
<li class="chapter" data-level="15.2" data-path="average-marginal-effect-algorithm.html"><a href="average-marginal-effect-algorithm.html"><i class="fa fa-check"></i><b>15.2</b> Average Marginal Effect Algorithm</a></li>
<li class="chapter" data-level="15.3" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>15.3</b> Packages</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="packages.html"><a href="packages.html#marginaleffects"><i class="fa fa-check"></i><b>15.3.1</b> MarginalEffects</a></li>
<li class="chapter" data-level="15.3.2" data-path="packages.html"><a href="packages.html#margins"><i class="fa fa-check"></i><b>15.3.2</b> margins</a></li>
<li class="chapter" data-level="15.3.3" data-path="packages.html"><a href="packages.html#mfx"><i class="fa fa-check"></i><b>15.3.3</b> mfx</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="prediction-and-estimation.html"><a href="prediction-and-estimation.html"><i class="fa fa-check"></i><b>16</b> Prediction and Estimation</a></li>
<li class="chapter" data-level="17" data-path="moderation.html"><a href="moderation.html"><i class="fa fa-check"></i><b>17</b> Moderation</a>
<ul>
<li class="chapter" data-level="17.1" data-path="emmeans-package.html"><a href="emmeans-package.html"><i class="fa fa-check"></i><b>17.1</b> emmeans package</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="emmeans-package.html"><a href="emmeans-package.html#continuous-by-continuous"><i class="fa fa-check"></i><b>17.1.1</b> Continuous by continuous</a></li>
<li class="chapter" data-level="17.1.2" data-path="emmeans-package.html"><a href="emmeans-package.html#continuous-by-categorical"><i class="fa fa-check"></i><b>17.1.2</b> Continuous by categorical</a></li>
<li class="chapter" data-level="17.1.3" data-path="emmeans-package.html"><a href="emmeans-package.html#categorical-by-categorical"><i class="fa fa-check"></i><b>17.1.3</b> Categorical by categorical</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="probmod-package.html"><a href="probmod-package.html"><i class="fa fa-check"></i><b>17.2</b> probmod package</a></li>
<li class="chapter" data-level="17.3" data-path="interactions-package.html"><a href="interactions-package.html"><i class="fa fa-check"></i><b>17.3</b> interactions package</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="interactions-package.html"><a href="interactions-package.html#continuous-interaction"><i class="fa fa-check"></i><b>17.3.1</b> Continuous interaction</a></li>
<li class="chapter" data-level="17.3.2" data-path="interactions-package.html"><a href="interactions-package.html#categorical-interaction"><i class="fa fa-check"></i><b>17.3.2</b> Categorical interaction</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="interactionr-package.html"><a href="interactionr-package.html"><i class="fa fa-check"></i><b>17.4</b> interactionR package</a></li>
<li class="chapter" data-level="17.5" data-path="sjplot-package.html"><a href="sjplot-package.html"><i class="fa fa-check"></i><b>17.5</b> sjPlot package</a></li>
</ul></li>
<li class="part"><span><b>IV. CAUSAL INFERENCE</b></span></li>
<li class="chapter" data-level="18" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>18</b> Causal Inference</a>
<ul>
<li class="chapter" data-level="18.1" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html"><i class="fa fa-check"></i><b>18.1</b> Treatment effect types</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#average-treatment-effects"><i class="fa fa-check"></i><b>18.1.1</b> Average Treatment Effects</a></li>
<li class="chapter" data-level="18.1.2" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#conditional-average-treatment-effects"><i class="fa fa-check"></i><b>18.1.2</b> Conditional Average Treatment Effects</a></li>
<li class="chapter" data-level="18.1.3" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#intent-to-treat-effects"><i class="fa fa-check"></i><b>18.1.3</b> Intent-to-treat Effects</a></li>
<li class="chapter" data-level="18.1.4" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#local-average-treatment-effects"><i class="fa fa-check"></i><b>18.1.4</b> Local Average Treatment Effects</a></li>
<li class="chapter" data-level="18.1.5" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#population-vs.-sample-average-treatment-effects"><i class="fa fa-check"></i><b>18.1.5</b> Population vs. Sample Average Treatment Effects</a></li>
<li class="chapter" data-level="18.1.6" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#average-treatment-effects-on-the-treated-and-control"><i class="fa fa-check"></i><b>18.1.6</b> Average Treatment Effects on the Treated and Control</a></li>
<li class="chapter" data-level="18.1.7" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#quantile-average-treatment-effects"><i class="fa fa-check"></i><b>18.1.7</b> Quantile Average Treatment Effects</a></li>
<li class="chapter" data-level="18.1.8" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#mediation-effects"><i class="fa fa-check"></i><b>18.1.8</b> Mediation Effects</a></li>
<li class="chapter" data-level="18.1.9" data-path="treatment-effect-types.html"><a href="treatment-effect-types.html#log-odds-treatment-effects"><i class="fa fa-check"></i><b>18.1.9</b> Log-odds Treatment Effects</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>A. EXPERIMENTAL DESIGN</b></span></li>
<li class="chapter" data-level="19" data-path="experimental-design.html"><a href="experimental-design.html"><i class="fa fa-check"></i><b>19</b> Experimental Design</a>
<ul>
<li class="chapter" data-level="19.1" data-path="semi-random-experiment.html"><a href="semi-random-experiment.html"><i class="fa fa-check"></i><b>19.1</b> Semi-random Experiment</a></li>
<li class="chapter" data-level="19.2" data-path="rerandomization.html"><a href="rerandomization.html"><i class="fa fa-check"></i><b>19.2</b> Rerandomization</a></li>
<li class="chapter" data-level="19.3" data-path="two-stage-randomized-experiments-with-interference-and-noncompliance.html"><a href="two-stage-randomized-experiments-with-interference-and-noncompliance.html"><i class="fa fa-check"></i><b>19.3</b> Two-Stage Randomized Experiments with Interference and Noncompliance</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>20</b> Sampling</a>
<ul>
<li class="chapter" data-level="20.1" data-path="simple-sampling.html"><a href="simple-sampling.html"><i class="fa fa-check"></i><b>20.1</b> Simple Sampling</a></li>
<li class="chapter" data-level="20.2" data-path="stratified-sampling.html"><a href="stratified-sampling.html"><i class="fa fa-check"></i><b>20.2</b> Stratified Sampling</a></li>
<li class="chapter" data-level="20.3" data-path="unequal-probability-sampling.html"><a href="unequal-probability-sampling.html"><i class="fa fa-check"></i><b>20.3</b> Unequal Probability Sampling</a></li>
<li class="chapter" data-level="20.4" data-path="balanced-sampling.html"><a href="balanced-sampling.html"><i class="fa fa-check"></i><b>20.4</b> Balanced Sampling</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="balanced-sampling.html"><a href="balanced-sampling.html#cube"><i class="fa fa-check"></i><b>20.4.1</b> Cube</a></li>
<li class="chapter" data-level="20.4.2" data-path="balanced-sampling.html"><a href="balanced-sampling.html#stratification"><i class="fa fa-check"></i><b>20.4.2</b> Stratification</a></li>
<li class="chapter" data-level="20.4.3" data-path="balanced-sampling.html"><a href="balanced-sampling.html#cluster-1"><i class="fa fa-check"></i><b>20.4.3</b> Cluster</a></li>
<li class="chapter" data-level="20.4.4" data-path="balanced-sampling.html"><a href="balanced-sampling.html#two-stage"><i class="fa fa-check"></i><b>20.4.4</b> Two-stage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="analysis-of-variance-anova.html"><a href="analysis-of-variance-anova.html"><i class="fa fa-check"></i><b>21</b> Analysis of Variance (ANOVA)</a>
<ul>
<li class="chapter" data-level="21.1" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html"><i class="fa fa-check"></i><b>21.1</b> Completely Randomized Design (CRD)</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html#single-factor-fixed-effects-model"><i class="fa fa-check"></i><b>21.1.1</b> Single Factor Fixed Effects Model</a></li>
<li class="chapter" data-level="21.1.2" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html#single-factor-random-effects-model"><i class="fa fa-check"></i><b>21.1.2</b> Single Factor Random Effects Model</a></li>
<li class="chapter" data-level="21.1.3" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html#two-factor-fixed-effect-anova"><i class="fa fa-check"></i><b>21.1.3</b> Two Factor Fixed Effect ANOVA</a></li>
<li class="chapter" data-level="21.1.4" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html#two-way-random-effects-anova"><i class="fa fa-check"></i><b>21.1.4</b> Two-Way Random Effects ANOVA</a></li>
<li class="chapter" data-level="21.1.5" data-path="completely-randomized-design-crd.html"><a href="completely-randomized-design-crd.html#two-way-mixed-effects-anova"><i class="fa fa-check"></i><b>21.1.5</b> Two-Way Mixed Effects ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="nonparametric-anova.html"><a href="nonparametric-anova.html"><i class="fa fa-check"></i><b>21.2</b> Nonparametric ANOVA</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="nonparametric-anova.html"><a href="nonparametric-anova.html#kruskal-wallis"><i class="fa fa-check"></i><b>21.2.1</b> Kruskal-Wallis</a></li>
<li class="chapter" data-level="21.2.2" data-path="nonparametric-anova.html"><a href="nonparametric-anova.html#friedman-test"><i class="fa fa-check"></i><b>21.2.2</b> Friedman Test</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="sample-size-planning-for-anova.html"><a href="sample-size-planning-for-anova.html"><i class="fa fa-check"></i><b>21.3</b> Sample Size Planning for ANOVA</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="sample-size-planning-for-anova.html"><a href="sample-size-planning-for-anova.html#balanced-designs"><i class="fa fa-check"></i><b>21.3.1</b> Balanced Designs</a></li>
<li class="chapter" data-level="21.3.2" data-path="sample-size-planning-for-anova.html"><a href="sample-size-planning-for-anova.html#randomized-block-experiments"><i class="fa fa-check"></i><b>21.3.2</b> Randomized Block Experiments</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="randomized-block-designs.html"><a href="randomized-block-designs.html"><i class="fa fa-check"></i><b>21.4</b> Randomized Block Designs</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="randomized-block-designs.html"><a href="randomized-block-designs.html#tukey-test-of-additivity"><i class="fa fa-check"></i><b>21.4.1</b> Tukey Test of Additivity</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="nested-designs.html"><a href="nested-designs.html"><i class="fa fa-check"></i><b>21.5</b> Nested Designs</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="nested-designs.html"><a href="nested-designs.html#two-factor-nested-designs"><i class="fa fa-check"></i><b>21.5.1</b> Two-Factor Nested Designs</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="single-factor-covariance-model.html"><a href="single-factor-covariance-model.html"><i class="fa fa-check"></i><b>21.6</b> Single Factor Covariance Model</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="multivariate-methods.html"><a href="multivariate-methods.html"><i class="fa fa-check"></i><b>22</b> Multivariate Methods</a>
<ul>
<li class="chapter" data-level="22.0.1" data-path="multivariate-methods.html"><a href="multivariate-methods.html#properties-of-mvn"><i class="fa fa-check"></i><b>22.0.1</b> Properties of MVN</a></li>
<li class="chapter" data-level="22.0.2" data-path="multivariate-methods.html"><a href="multivariate-methods.html#mean-vector-inference"><i class="fa fa-check"></i><b>22.0.2</b> Mean Vector Inference</a></li>
<li class="chapter" data-level="22.0.3" data-path="multivariate-methods.html"><a href="multivariate-methods.html#general-hypothesis-testing"><i class="fa fa-check"></i><b>22.0.3</b> General Hypothesis Testing</a></li>
<li class="chapter" data-level="22.1" data-path="manova.html"><a href="manova.html"><i class="fa fa-check"></i><b>22.1</b> MANOVA</a>
<ul>
<li class="chapter" data-level="22.1.1" data-path="manova.html"><a href="manova.html#testing-general-hypotheses"><i class="fa fa-check"></i><b>22.1.1</b> Testing General Hypotheses</a></li>
<li class="chapter" data-level="22.1.2" data-path="manova.html"><a href="manova.html#profile-analysis"><i class="fa fa-check"></i><b>22.1.2</b> Profile Analysis</a></li>
<li class="chapter" data-level="22.1.3" data-path="manova.html"><a href="manova.html#summary-6"><i class="fa fa-check"></i><b>22.1.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="principal-components.html"><a href="principal-components.html"><i class="fa fa-check"></i><b>22.2</b> Principal Components</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="principal-components.html"><a href="principal-components.html#population-principal-components"><i class="fa fa-check"></i><b>22.2.1</b> Population Principal Components</a></li>
<li class="chapter" data-level="22.2.2" data-path="principal-components.html"><a href="principal-components.html#sample-principal-components"><i class="fa fa-check"></i><b>22.2.2</b> Sample Principal Components</a></li>
<li class="chapter" data-level="22.2.3" data-path="principal-components.html"><a href="principal-components.html#application-10"><i class="fa fa-check"></i><b>22.2.3</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="factor-analysis.html"><a href="factor-analysis.html"><i class="fa fa-check"></i><b>22.3</b> Factor Analysis</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="factor-analysis.html"><a href="factor-analysis.html#methods-of-estimation"><i class="fa fa-check"></i><b>22.3.1</b> Methods of Estimation</a></li>
<li class="chapter" data-level="22.3.2" data-path="factor-analysis.html"><a href="factor-analysis.html#factor-rotation"><i class="fa fa-check"></i><b>22.3.2</b> Factor Rotation</a></li>
<li class="chapter" data-level="22.3.3" data-path="factor-analysis.html"><a href="factor-analysis.html#estimation-of-factor-scores"><i class="fa fa-check"></i><b>22.3.3</b> Estimation of Factor Scores</a></li>
<li class="chapter" data-level="22.3.4" data-path="factor-analysis.html"><a href="factor-analysis.html#model-diagnostic"><i class="fa fa-check"></i><b>22.3.4</b> Model Diagnostic</a></li>
<li class="chapter" data-level="22.3.5" data-path="factor-analysis.html"><a href="factor-analysis.html#application-11"><i class="fa fa-check"></i><b>22.3.5</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>22.4</b> Discriminant Analysis</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#known-populations"><i class="fa fa-check"></i><b>22.4.1</b> Known Populations</a></li>
<li class="chapter" data-level="22.4.2" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#probabilities-of-misclassification"><i class="fa fa-check"></i><b>22.4.2</b> Probabilities of Misclassification</a></li>
<li class="chapter" data-level="22.4.3" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#unknown-populations-nonparametric-discrimination"><i class="fa fa-check"></i><b>22.4.3</b> Unknown Populations/ Nonparametric Discrimination</a></li>
<li class="chapter" data-level="22.4.4" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#application-12"><i class="fa fa-check"></i><b>22.4.4</b> Application</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>B. QUASI-EXPERIMENTAL DESIGN</b></span></li>
<li class="chapter" data-level="23" data-path="quasi-experimental.html"><a href="quasi-experimental.html"><i class="fa fa-check"></i><b>23</b> Quasi-experimental</a></li>
<li class="chapter" data-level="24" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html"><i class="fa fa-check"></i><b>24</b> Regression Discontinuity</a>
<ul>
<li class="chapter" data-level="24.1" data-path="estimation-and-inference.html"><a href="estimation-and-inference.html"><i class="fa fa-check"></i><b>24.1</b> Estimation and Inference</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="estimation-and-inference.html"><a href="estimation-and-inference.html#local-randomization-based"><i class="fa fa-check"></i><b>24.1.1</b> Local Randomization-based</a></li>
<li class="chapter" data-level="24.1.2" data-path="estimation-and-inference.html"><a href="estimation-and-inference.html#continuity-based"><i class="fa fa-check"></i><b>24.1.2</b> Continuity-based</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="specification-checks.html"><a href="specification-checks.html"><i class="fa fa-check"></i><b>24.2</b> Specification Checks</a>
<ul>
<li class="chapter" data-level="24.2.1" data-path="specification-checks.html"><a href="specification-checks.html#balance-checks"><i class="fa fa-check"></i><b>24.2.1</b> Balance Checks</a></li>
<li class="chapter" data-level="24.2.2" data-path="specification-checks.html"><a href="specification-checks.html#sortingbunchingmanipulation"><i class="fa fa-check"></i><b>24.2.2</b> Sorting/Bunching/Manipulation</a></li>
<li class="chapter" data-level="24.2.3" data-path="specification-checks.html"><a href="specification-checks.html#placebo-tests"><i class="fa fa-check"></i><b>24.2.3</b> Placebo Tests</a></li>
<li class="chapter" data-level="24.2.4" data-path="specification-checks.html"><a href="specification-checks.html#sensitivity-to-bandwidth-choice"><i class="fa fa-check"></i><b>24.2.4</b> Sensitivity to Bandwidth Choice</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="fuzzy-rd-design.html"><a href="fuzzy-rd-design.html"><i class="fa fa-check"></i><b>24.3</b> Fuzzy RD Design</a></li>
<li class="chapter" data-level="24.4" data-path="regression-kink-design.html"><a href="regression-kink-design.html"><i class="fa fa-check"></i><b>24.4</b> Regression Kink Design</a></li>
<li class="chapter" data-level="24.5" data-path="multi-cutoff.html"><a href="multi-cutoff.html"><i class="fa fa-check"></i><b>24.5</b> Multi-cutoff</a></li>
<li class="chapter" data-level="24.6" data-path="multi-score.html"><a href="multi-score.html"><i class="fa fa-check"></i><b>24.6</b> Multi-score</a></li>
<li class="chapter" data-level="24.7" data-path="steps-for-sharp-rd.html"><a href="steps-for-sharp-rd.html"><i class="fa fa-check"></i><b>24.7</b> Steps for Sharp RD</a></li>
<li class="chapter" data-level="24.8" data-path="steps-for-fuzzy-rd.html"><a href="steps-for-fuzzy-rd.html"><i class="fa fa-check"></i><b>24.8</b> Steps for Fuzzy RD</a></li>
<li class="chapter" data-level="24.9" data-path="steps-for-rdit-regression-discontinuity-in-time.html"><a href="steps-for-rdit-regression-discontinuity-in-time.html"><i class="fa fa-check"></i><b>24.9</b> Steps for RDiT (Regression Discontinuity in Time)</a></li>
<li class="chapter" data-level="24.10" data-path="evaluation-of-an-rd.html"><a href="evaluation-of-an-rd.html"><i class="fa fa-check"></i><b>24.10</b> Evaluation of an RD</a></li>
<li class="chapter" data-level="24.11" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>24.11</b> Applications</a>
<ul>
<li class="chapter" data-level="24.11.1" data-path="applications.html"><a href="applications.html#example-1-1"><i class="fa fa-check"></i><b>24.11.1</b> Example 1</a></li>
<li class="chapter" data-level="24.11.2" data-path="applications.html"><a href="applications.html#example-2"><i class="fa fa-check"></i><b>24.11.2</b> Example 2</a></li>
<li class="chapter" data-level="24.11.3" data-path="applications.html"><a href="applications.html#example-3"><i class="fa fa-check"></i><b>24.11.3</b> Example 3</a></li>
<li class="chapter" data-level="24.11.4" data-path="applications.html"><a href="applications.html#example-4"><i class="fa fa-check"></i><b>24.11.4</b> Example 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="synthetic-difference-in-differences.html"><a href="synthetic-difference-in-differences.html"><i class="fa fa-check"></i><b>25</b> Synthetic Difference-in-Differences</a>
<ul>
<li class="chapter" data-level="25.1" data-path="understanding.html"><a href="understanding.html"><i class="fa fa-check"></i><b>25.1</b> Understanding</a></li>
<li class="chapter" data-level="25.2" data-path="application-13.html"><a href="application-13.html"><i class="fa fa-check"></i><b>25.2</b> Application</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="application-13.html"><a href="application-13.html#block-treatment"><i class="fa fa-check"></i><b>25.2.1</b> Block Treatment</a></li>
<li class="chapter" data-level="25.2.2" data-path="application-13.html"><a href="application-13.html#staggered-adoption"><i class="fa fa-check"></i><b>25.2.2</b> Staggered Adoption</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>26</b> Difference-in-differences</a>
<ul>
<li class="chapter" data-level="26.1" data-path="simple-dif-n-dif.html"><a href="simple-dif-n-dif.html"><i class="fa fa-check"></i><b>26.1</b> Simple Dif-n-dif</a>
<ul>
<li class="chapter" data-level="26.1.1" data-path="simple-dif-n-dif.html"><a href="simple-dif-n-dif.html#examples"><i class="fa fa-check"></i><b>26.1.1</b> Examples</a></li>
<li class="chapter" data-level="26.1.2" data-path="simple-dif-n-dif.html"><a href="simple-dif-n-dif.html#doubly-robust-did"><i class="fa fa-check"></i><b>26.1.2</b> Doubly Robust DiD</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="one-difference.html"><a href="one-difference.html"><i class="fa fa-check"></i><b>26.2</b> One Difference</a></li>
<li class="chapter" data-level="26.3" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html"><i class="fa fa-check"></i><b>26.3</b> Two-way Fixed-effects</a>
<ul>
<li class="chapter" data-level="26.3.1" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html#multiple-periods-and-variation-in-treatment-timing"><i class="fa fa-check"></i><b>26.3.1</b> Multiple periods and variation in treatment timing</a></li>
<li class="chapter" data-level="26.3.2" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html#staggered-dif-n-dif"><i class="fa fa-check"></i><b>26.3.2</b> Staggered Dif-n-dif</a></li>
<li class="chapter" data-level="26.3.3" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html#two-stage-did"><i class="fa fa-check"></i><b>26.3.3</b> Two-stage DiD</a></li>
<li class="chapter" data-level="26.3.4" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html#multiple-treatment-groups"><i class="fa fa-check"></i><b>26.3.4</b> Multiple Treatment groups</a></li>
<li class="chapter" data-level="26.3.5" data-path="two-way-fixed-effects.html"><a href="two-way-fixed-effects.html#multiple-treatments"><i class="fa fa-check"></i><b>26.3.5</b> Multiple Treatments</a></li>
</ul></li>
<li class="chapter" data-level="26.4" data-path="assumption-violation.html"><a href="assumption-violation.html"><i class="fa fa-check"></i><b>26.4</b> Assumption Violation</a>
<ul>
<li class="chapter" data-level="26.4.1" data-path="assumption-violation.html"><a href="assumption-violation.html#endogenous-timing"><i class="fa fa-check"></i><b>26.4.1</b> Endogenous Timing</a></li>
<li class="chapter" data-level="26.4.2" data-path="assumption-violation.html"><a href="assumption-violation.html#questionable-counterfactuals"><i class="fa fa-check"></i><b>26.4.2</b> Questionable Counterfactuals</a></li>
</ul></li>
<li class="chapter" data-level="26.5" data-path="mediation-under-did.html"><a href="mediation-under-did.html"><i class="fa fa-check"></i><b>26.5</b> Mediation Under DiD</a></li>
<li class="chapter" data-level="26.6" data-path="assumptions-2.html"><a href="assumptions-2.html"><i class="fa fa-check"></i><b>26.6</b> Assumptions</a>
<ul>
<li class="chapter" data-level="26.6.1" data-path="assumptions-2.html"><a href="assumptions-2.html#prior-parallel-trends-test"><i class="fa fa-check"></i><b>26.6.1</b> Prior Parallel Trends Test</a></li>
<li class="chapter" data-level="26.6.2" data-path="assumptions-2.html"><a href="assumptions-2.html#placebo-test"><i class="fa fa-check"></i><b>26.6.2</b> Placebo Test</a></li>
<li class="chapter" data-level="26.6.3" data-path="assumptions-2.html"><a href="assumptions-2.html#rosenbaum-bounds"><i class="fa fa-check"></i><b>26.6.3</b> Rosenbaum Bounds</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="synthetic-control.html"><a href="synthetic-control.html"><i class="fa fa-check"></i><b>27</b> Synthetic Control</a>
<ul>
<li class="chapter" data-level="27.1" data-path="applications-1.html"><a href="applications-1.html"><i class="fa fa-check"></i><b>27.1</b> Applications</a>
<ul>
<li class="chapter" data-level="27.1.1" data-path="applications-1.html"><a href="applications-1.html#example-1-2"><i class="fa fa-check"></i><b>27.1.1</b> Example 1</a></li>
<li class="chapter" data-level="27.1.2" data-path="applications-1.html"><a href="applications-1.html#example-2-1"><i class="fa fa-check"></i><b>27.1.2</b> Example 2</a></li>
<li class="chapter" data-level="27.1.3" data-path="applications-1.html"><a href="applications-1.html#example-3-1"><i class="fa fa-check"></i><b>27.1.3</b> Example 3</a></li>
<li class="chapter" data-level="27.1.4" data-path="applications-1.html"><a href="applications-1.html#example-4-1"><i class="fa fa-check"></i><b>27.1.4</b> Example 4</a></li>
</ul></li>
<li class="chapter" data-level="27.2" data-path="synthetic-difference-in-differences-1.html"><a href="synthetic-difference-in-differences-1.html"><i class="fa fa-check"></i><b>27.2</b> Synthetic Difference-in-differences</a></li>
<li class="chapter" data-level="27.3" data-path="augmented-synthetic-control-method.html"><a href="augmented-synthetic-control-method.html"><i class="fa fa-check"></i><b>27.3</b> Augmented Synthetic Control Method</a></li>
<li class="chapter" data-level="27.4" data-path="synthetic-controls-with-staggered-adoption.html"><a href="synthetic-controls-with-staggered-adoption.html"><i class="fa fa-check"></i><b>27.4</b> Synthetic Controls with Staggered Adoption</a></li>
<li class="chapter" data-level="27.5" data-path="generalized-synthetic-control.html"><a href="generalized-synthetic-control.html"><i class="fa fa-check"></i><b>27.5</b> Generalized Synthetic Control</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="event-studies.html"><a href="event-studies.html"><i class="fa fa-check"></i><b>28</b> Event Studies</a>
<ul>
<li class="chapter" data-level="28.1" data-path="other-issues.html"><a href="other-issues.html"><i class="fa fa-check"></i><b>28.1</b> Other Issues</a>
<ul>
<li class="chapter" data-level="28.1.1" data-path="other-issues.html"><a href="other-issues.html#event-studies-in-marketing"><i class="fa fa-check"></i><b>28.1.1</b> Event Studies in marketing</a></li>
<li class="chapter" data-level="28.1.2" data-path="other-issues.html"><a href="other-issues.html#economic-significance"><i class="fa fa-check"></i><b>28.1.2</b> Economic significance</a></li>
<li class="chapter" data-level="28.1.3" data-path="other-issues.html"><a href="other-issues.html#statistical-power"><i class="fa fa-check"></i><b>28.1.3</b> Statistical Power</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>28.2</b> Testing</a>
<ul>
<li class="chapter" data-level="28.2.1" data-path="testing.html"><a href="testing.html#parametric-test"><i class="fa fa-check"></i><b>28.2.1</b> Parametric Test</a></li>
<li class="chapter" data-level="28.2.2" data-path="testing.html"><a href="testing.html#non-parametric-test"><i class="fa fa-check"></i><b>28.2.2</b> Non-parametric Test</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="sample.html"><a href="sample.html"><i class="fa fa-check"></i><b>28.3</b> Sample</a>
<ul>
<li class="chapter" data-level="28.3.1" data-path="sample.html"><a href="sample.html#confounders"><i class="fa fa-check"></i><b>28.3.1</b> Confounders</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="biases.html"><a href="biases.html"><i class="fa fa-check"></i><b>28.4</b> Biases</a></li>
<li class="chapter" data-level="28.5" data-path="long-run-event-studies.html"><a href="long-run-event-studies.html"><i class="fa fa-check"></i><b>28.5</b> Long-run event studies</a>
<ul>
<li class="chapter" data-level="28.5.1" data-path="long-run-event-studies.html"><a href="long-run-event-studies.html#buy-and-hold-abnormal-returns-bhar"><i class="fa fa-check"></i><b>28.5.1</b> Buy and Hold Abnormal Returns (BHAR)</a></li>
<li class="chapter" data-level="28.5.2" data-path="long-run-event-studies.html"><a href="long-run-event-studies.html#long-term-cumulative-abnormal-returns-lcars"><i class="fa fa-check"></i><b>28.5.2</b> Long-term Cumulative Abnormal Returns (LCARs)</a></li>
<li class="chapter" data-level="28.5.3" data-path="long-run-event-studies.html"><a href="long-run-event-studies.html#calendar-time-portfolio-abnormal-returns-ctars"><i class="fa fa-check"></i><b>28.5.3</b> Calendar-time Portfolio Abnormal Returns (CTARs)</a></li>
</ul></li>
<li class="chapter" data-level="28.6" data-path="aggregation.html"><a href="aggregation.html"><i class="fa fa-check"></i><b>28.6</b> Aggregation</a>
<ul>
<li class="chapter" data-level="28.6.1" data-path="aggregation.html"><a href="aggregation.html#over-time"><i class="fa fa-check"></i><b>28.6.1</b> Over Time</a></li>
<li class="chapter" data-level="28.6.2" data-path="aggregation.html"><a href="aggregation.html#across-firms-over-time"><i class="fa fa-check"></i><b>28.6.2</b> Across Firms + Over Time</a></li>
</ul></li>
<li class="chapter" data-level="28.7" data-path="heterogeneity-in-the-event-effect.html"><a href="heterogeneity-in-the-event-effect.html"><i class="fa fa-check"></i><b>28.7</b> Heterogeneity in the event effect</a>
<ul>
<li class="chapter" data-level="28.7.1" data-path="heterogeneity-in-the-event-effect.html"><a href="heterogeneity-in-the-event-effect.html#common-variables-in-marketing"><i class="fa fa-check"></i><b>28.7.1</b> Common variables in marketing</a></li>
</ul></li>
<li class="chapter" data-level="28.8" data-path="expected-return-calculation.html"><a href="expected-return-calculation.html"><i class="fa fa-check"></i><b>28.8</b> Expected Return Calculation</a>
<ul>
<li class="chapter" data-level="28.8.1" data-path="expected-return-calculation.html"><a href="expected-return-calculation.html#statistical-models"><i class="fa fa-check"></i><b>28.8.1</b> Statistical Models</a></li>
<li class="chapter" data-level="28.8.2" data-path="expected-return-calculation.html"><a href="expected-return-calculation.html#economic-model"><i class="fa fa-check"></i><b>28.8.2</b> Economic Model</a></li>
</ul></li>
<li class="chapter" data-level="28.9" data-path="application-14.html"><a href="application-14.html"><i class="fa fa-check"></i><b>28.9</b> Application</a>
<ul>
<li class="chapter" data-level="28.9.1" data-path="application-14.html"><a href="application-14.html#eventus"><i class="fa fa-check"></i><b>28.9.1</b> Eventus</a></li>
<li class="chapter" data-level="28.9.2" data-path="application-14.html"><a href="application-14.html#evenstudies"><i class="fa fa-check"></i><b>28.9.2</b> Evenstudies</a></li>
<li class="chapter" data-level="28.9.3" data-path="application-14.html"><a href="application-14.html#eventstudy"><i class="fa fa-check"></i><b>28.9.3</b> EventStudy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="matching-methods.html"><a href="matching-methods.html"><i class="fa fa-check"></i><b>29</b> Matching Methods</a>
<ul>
<li class="chapter" data-level="29.1" data-path="matchit.html"><a href="matchit.html"><i class="fa fa-check"></i><b>29.1</b> MatchIt</a></li>
<li class="chapter" data-level="29.2" data-path="designmatch.html"><a href="designmatch.html"><i class="fa fa-check"></i><b>29.2</b> designmatch</a></li>
<li class="chapter" data-level="29.3" data-path="matchingfrontier.html"><a href="matchingfrontier.html"><i class="fa fa-check"></i><b>29.3</b> MatchingFrontier</a></li>
<li class="chapter" data-level="29.4" data-path="propensity-scores.html"><a href="propensity-scores.html"><i class="fa fa-check"></i><b>29.4</b> Propensity Scores</a></li>
<li class="chapter" data-level="29.5" data-path="mahalanobis-distance.html"><a href="mahalanobis-distance.html"><i class="fa fa-check"></i><b>29.5</b> Mahalanobis Distance</a></li>
<li class="chapter" data-level="29.6" data-path="coarsened-exact-matching.html"><a href="coarsened-exact-matching.html"><i class="fa fa-check"></i><b>29.6</b> Coarsened Exact Matching</a></li>
<li class="chapter" data-level="29.7" data-path="genetic-matching.html"><a href="genetic-matching.html"><i class="fa fa-check"></i><b>29.7</b> Genetic Matching</a></li>
<li class="chapter" data-level="29.8" data-path="matching-for-time-series-cross-section-data.html"><a href="matching-for-time-series-cross-section-data.html"><i class="fa fa-check"></i><b>29.8</b> Matching for time series-cross-section data</a></li>
<li class="chapter" data-level="29.9" data-path="matching-for-multiple-treatments.html"><a href="matching-for-multiple-treatments.html"><i class="fa fa-check"></i><b>29.9</b> Matching for multiple treatments</a></li>
<li class="chapter" data-level="29.10" data-path="matching-for-multi-level-treatments.html"><a href="matching-for-multi-level-treatments.html"><i class="fa fa-check"></i><b>29.10</b> Matching for multi-level treatments</a></li>
<li class="chapter" data-level="29.11" data-path="matching-for-repeated-treatments.html"><a href="matching-for-repeated-treatments.html"><i class="fa fa-check"></i><b>29.11</b> Matching for repeated treatments</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="interrupted-time-series.html"><a href="interrupted-time-series.html"><i class="fa fa-check"></i><b>30</b> Interrupted Time Series</a>
<ul>
<li class="chapter" data-level="30.1" data-path="autocorrelation.html"><a href="autocorrelation.html"><i class="fa fa-check"></i><b>30.1</b> Autocorrelation</a></li>
<li class="chapter" data-level="30.2" data-path="multiple-groups.html"><a href="multiple-groups.html"><i class="fa fa-check"></i><b>30.2</b> Multiple Groups</a></li>
</ul></li>
<li class="part"><span><b>C. OTHER CONCERNS</b></span></li>
<li class="chapter" data-level="31" data-path="endogeneity.html"><a href="endogeneity.html"><i class="fa fa-check"></i><b>31</b> Endogeneity</a>
<ul>
<li class="chapter" data-level="31.1" data-path="endogenous-treatment.html"><a href="endogenous-treatment.html"><i class="fa fa-check"></i><b>31.1</b> Endogenous Treatment</a>
<ul>
<li class="chapter" data-level="31.1.1" data-path="endogenous-treatment.html"><a href="endogenous-treatment.html#measurement-error"><i class="fa fa-check"></i><b>31.1.1</b> Measurement Error</a></li>
<li class="chapter" data-level="31.1.2" data-path="endogenous-treatment.html"><a href="endogenous-treatment.html#simultaneity"><i class="fa fa-check"></i><b>31.1.2</b> Simultaneity</a></li>
<li class="chapter" data-level="31.1.3" data-path="endogenous-treatment.html"><a href="endogenous-treatment.html#endogenous-treatment-solutions"><i class="fa fa-check"></i><b>31.1.3</b> Endogenous Treatment Solutions</a></li>
</ul></li>
<li class="chapter" data-level="31.2" data-path="endogenous-sample-selection.html"><a href="endogenous-sample-selection.html"><i class="fa fa-check"></i><b>31.2</b> Endogenous Sample Selection</a>
<ul>
<li class="chapter" data-level="31.2.1" data-path="endogenous-sample-selection.html"><a href="endogenous-sample-selection.html#tobit-2"><i class="fa fa-check"></i><b>31.2.1</b> Tobit-2</a></li>
<li class="chapter" data-level="31.2.2" data-path="endogenous-sample-selection.html"><a href="endogenous-sample-selection.html#tobit-5"><i class="fa fa-check"></i><b>31.2.2</b> Tobit-5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="other-biases.html"><a href="other-biases.html"><i class="fa fa-check"></i><b>32</b> Other Biases</a>
<ul>
<li class="chapter" data-level="32.1" data-path="aggregation-bias.html"><a href="aggregation-bias.html"><i class="fa fa-check"></i><b>32.1</b> Aggregation Bias</a>
<ul>
<li class="chapter" data-level="32.1.1" data-path="aggregation-bias.html"><a href="aggregation-bias.html#simpsons-paradox"><i class="fa fa-check"></i><b>32.1.1</b> Simpson’s Paradox</a></li>
</ul></li>
<li class="chapter" data-level="32.2" data-path="survivorship-bias.html"><a href="survivorship-bias.html"><i class="fa fa-check"></i><b>32.2</b> Survivorship Bias</a></li>
<li class="chapter" data-level="32.3" data-path="publication-bias.html"><a href="publication-bias.html"><i class="fa fa-check"></i><b>32.3</b> Publication Bias</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="controls.html"><a href="controls.html"><i class="fa fa-check"></i><b>33</b> Controls</a>
<ul>
<li class="chapter" data-level="33.1" data-path="bad-controls.html"><a href="bad-controls.html"><i class="fa fa-check"></i><b>33.1</b> Bad Controls</a>
<ul>
<li class="chapter" data-level="33.1.1" data-path="bad-controls.html"><a href="bad-controls.html#m-bias"><i class="fa fa-check"></i><b>33.1.1</b> M-bias</a></li>
<li class="chapter" data-level="33.1.2" data-path="bad-controls.html"><a href="bad-controls.html#bias-amplification"><i class="fa fa-check"></i><b>33.1.2</b> Bias Amplification</a></li>
<li class="chapter" data-level="33.1.3" data-path="bad-controls.html"><a href="bad-controls.html#overcontrol-bias"><i class="fa fa-check"></i><b>33.1.3</b> Overcontrol bias</a></li>
<li class="chapter" data-level="33.1.4" data-path="bad-controls.html"><a href="bad-controls.html#selection-bias"><i class="fa fa-check"></i><b>33.1.4</b> Selection Bias</a></li>
<li class="chapter" data-level="33.1.5" data-path="bad-controls.html"><a href="bad-controls.html#case-control-bias"><i class="fa fa-check"></i><b>33.1.5</b> Case-control Bias</a></li>
</ul></li>
<li class="chapter" data-level="33.2" data-path="good-controls.html"><a href="good-controls.html"><i class="fa fa-check"></i><b>33.2</b> Good Controls</a>
<ul>
<li class="chapter" data-level="33.2.1" data-path="good-controls.html"><a href="good-controls.html#omitted-variable-bias-correction"><i class="fa fa-check"></i><b>33.2.1</b> Omitted Variable Bias Correction</a></li>
<li class="chapter" data-level="33.2.2" data-path="good-controls.html"><a href="good-controls.html#omitted-variable-bias-in-mediation-correction"><i class="fa fa-check"></i><b>33.2.2</b> Omitted Variable Bias in Mediation Correction</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="neutral-controls.html"><a href="neutral-controls.html"><i class="fa fa-check"></i><b>33.3</b> Neutral Controls</a>
<ul>
<li class="chapter" data-level="33.3.1" data-path="neutral-controls.html"><a href="neutral-controls.html#good-predictive-controls"><i class="fa fa-check"></i><b>33.3.1</b> Good Predictive Controls</a></li>
<li class="chapter" data-level="33.3.2" data-path="neutral-controls.html"><a href="neutral-controls.html#good-selection-bias"><i class="fa fa-check"></i><b>33.3.2</b> Good Selection Bias</a></li>
<li class="chapter" data-level="33.3.3" data-path="neutral-controls.html"><a href="neutral-controls.html#bad-predictive-controls"><i class="fa fa-check"></i><b>33.3.3</b> Bad Predictive Controls</a></li>
<li class="chapter" data-level="33.3.4" data-path="neutral-controls.html"><a href="neutral-controls.html#bad-selection-bias"><i class="fa fa-check"></i><b>33.3.4</b> Bad Selection Bias</a></li>
</ul></li>
<li class="chapter" data-level="33.4" data-path="choosing-controls.html"><a href="choosing-controls.html"><i class="fa fa-check"></i><b>33.4</b> Choosing Controls</a></li>
</ul></li>
<li class="part"><span><b>V. MISCELLANEOUS</b></span></li>
<li class="chapter" data-level="34" data-path="mediation.html"><a href="mediation.html"><i class="fa fa-check"></i><b>34</b> Mediation</a>
<ul>
<li class="chapter" data-level="34.1" data-path="traditional.html"><a href="traditional.html"><i class="fa fa-check"></i><b>34.1</b> Traditional</a>
<ul>
<li class="chapter" data-level="34.1.1" data-path="traditional.html"><a href="traditional.html#example-1-mediation-traditional"><i class="fa fa-check"></i><b>34.1.1</b> Example 1</a></li>
</ul></li>
<li class="chapter" data-level="34.2" data-path="model-based-causal-mediation-analysis.html"><a href="model-based-causal-mediation-analysis.html"><i class="fa fa-check"></i><b>34.2</b> Model-based causal mediation analysis</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="directed-acyclic-graph.html"><a href="directed-acyclic-graph.html"><i class="fa fa-check"></i><b>35</b> Directed Acyclic Graph</a>
<ul>
<li class="chapter" data-level="35.1" data-path="basic-notations.html"><a href="basic-notations.html"><i class="fa fa-check"></i><b>35.1</b> Basic Notations</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>36</b> Report</a>
<ul>
<li class="chapter" data-level="36.1" data-path="one-summary-table.html"><a href="one-summary-table.html"><i class="fa fa-check"></i><b>36.1</b> One summary table</a></li>
<li class="chapter" data-level="36.2" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>36.2</b> Model Comparison</a></li>
<li class="chapter" data-level="36.3" data-path="changes-in-an-estimate.html"><a href="changes-in-an-estimate.html"><i class="fa fa-check"></i><b>36.3</b> Changes in an estimate</a></li>
<li class="chapter" data-level="36.4" data-path="standard-errors-2.html"><a href="standard-errors-2.html"><i class="fa fa-check"></i><b>36.4</b> Standard Errors</a></li>
<li class="chapter" data-level="36.5" data-path="coefficient-uncertainty-and-distribution.html"><a href="coefficient-uncertainty-and-distribution.html"><i class="fa fa-check"></i><b>36.5</b> Coefficient Uncertainty and Distribution</a></li>
<li class="chapter" data-level="36.6" data-path="descriptive-tables.html"><a href="descriptive-tables.html"><i class="fa fa-check"></i><b>36.6</b> Descriptive Tables</a></li>
<li class="chapter" data-level="36.7" data-path="visualizations-and-plots.html"><a href="visualizations-and-plots.html"><i class="fa fa-check"></i><b>36.7</b> Visualizations and Plots</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>37</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="38" data-path="sensitivity-analysis-robustness-check.html"><a href="sensitivity-analysis-robustness-check.html"><i class="fa fa-check"></i><b>38</b> Sensitivity Analysis/ Robustness Check</a>
<ul>
<li class="chapter" data-level="38.1" data-path="specification-curve.html"><a href="specification-curve.html"><i class="fa fa-check"></i><b>38.1</b> Specification curve</a>
<ul>
<li class="chapter" data-level="38.1.1" data-path="specification-curve.html"><a href="specification-curve.html#starbility"><i class="fa fa-check"></i><b>38.1.1</b> starbility</a></li>
<li class="chapter" data-level="38.1.2" data-path="specification-curve.html"><a href="specification-curve.html#rdfanalysis"><i class="fa fa-check"></i><b>38.1.2</b> rdfanalysis</a></li>
</ul></li>
<li class="chapter" data-level="38.2" data-path="coefficient-stability.html"><a href="coefficient-stability.html"><i class="fa fa-check"></i><b>38.2</b> Coefficient stability</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="replication-and-synthetic-data.html"><a href="replication-and-synthetic-data.html"><i class="fa fa-check"></i><b>39</b> Replication and Synthetic Data</a>
<ul>
<li class="chapter" data-level="39.1" data-path="the-replication-standard.html"><a href="the-replication-standard.html"><i class="fa fa-check"></i><b>39.1</b> The Replication Standard</a>
<ul>
<li class="chapter" data-level="39.1.1" data-path="the-replication-standard.html"><a href="the-replication-standard.html#solutions-for-empirical-replication"><i class="fa fa-check"></i><b>39.1.1</b> Solutions for Empirical Replication</a></li>
<li class="chapter" data-level="39.1.2" data-path="the-replication-standard.html"><a href="the-replication-standard.html#free-data-repositories"><i class="fa fa-check"></i><b>39.1.2</b> Free Data Repositories</a></li>
<li class="chapter" data-level="39.1.3" data-path="the-replication-standard.html"><a href="the-replication-standard.html#exceptions-to-replication"><i class="fa fa-check"></i><b>39.1.3</b> Exceptions to Replication</a></li>
</ul></li>
<li class="chapter" data-level="39.2" data-path="synthetic-data-an-overview.html"><a href="synthetic-data-an-overview.html"><i class="fa fa-check"></i><b>39.2</b> Synthetic Data: An Overview</a>
<ul>
<li class="chapter" data-level="39.2.1" data-path="synthetic-data-an-overview.html"><a href="synthetic-data-an-overview.html#benefits"><i class="fa fa-check"></i><b>39.2.1</b> Benefits</a></li>
<li class="chapter" data-level="39.2.2" data-path="synthetic-data-an-overview.html"><a href="synthetic-data-an-overview.html#concerns"><i class="fa fa-check"></i><b>39.2.2</b> Concerns</a></li>
<li class="chapter" data-level="39.2.3" data-path="synthetic-data-an-overview.html"><a href="synthetic-data-an-overview.html#further-insights-on-synthetic-data"><i class="fa fa-check"></i><b>39.2.3</b> Further Insights on Synthetic Data</a></li>
</ul></li>
<li class="chapter" data-level="39.3" data-path="application-15.html"><a href="application-15.html"><i class="fa fa-check"></i><b>39.3</b> Application</a></li>
</ul></li>
<li class="appendix"><span><b>APPENDIX</b></span></li>
<li class="chapter" data-level="A" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>A</b> Appendix</a>
<ul>
<li class="chapter" data-level="A.1" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>A.1</b> Git</a></li>
<li class="chapter" data-level="A.2" data-path="short-cut.html"><a href="short-cut.html"><i class="fa fa-check"></i><b>A.2</b> Short-cut</a></li>
<li class="chapter" data-level="A.3" data-path="function-short-cut.html"><a href="function-short-cut.html"><i class="fa fa-check"></i><b>A.3</b> Function short-cut</a></li>
<li class="chapter" data-level="A.4" data-path="citation.html"><a href="citation.html"><i class="fa fa-check"></i><b>A.4</b> Citation</a></li>
<li class="chapter" data-level="A.5" data-path="install-all-necessary-packageslibaries-on-your-local-machine.html"><a href="install-all-necessary-packageslibaries-on-your-local-machine.html"><i class="fa fa-check"></i><b>A.5</b> Install all necessary packages/libaries on your local machine</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="bookdown-cheat-sheet.html"><a href="bookdown-cheat-sheet.html"><i class="fa fa-check"></i><b>B</b> Bookdown cheat sheet</a>
<ul>
<li class="chapter" data-level="B.1" data-path="operation.html"><a href="operation.html"><i class="fa fa-check"></i><b>B.1</b> Operation</a></li>
<li class="chapter" data-level="B.2" data-path="math-expression-syntax.html"><a href="math-expression-syntax.html"><i class="fa fa-check"></i><b>B.2</b> Math Expression/ Syntax</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="math-expression-syntax.html"><a href="math-expression-syntax.html#statistics-notation"><i class="fa fa-check"></i><b>B.2.1</b> Statistics Notation</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="table.html"><a href="table.html"><i class="fa fa-check"></i><b>B.3</b> Table</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Guide on Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="two-way-fixed-effects" class="section level2 hasAnchor" number="26.3">
<h2><span class="header-section-number">26.3</span> Two-way Fixed-effects<a href="two-way-fixed-effects.html#two-way-fixed-effects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A generalization of the dif-n-dif model is the two-way fixed-effects models where you have multiple groups and time effects. But this is not a designed-based, non-parametric causal estimator <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span></p>
<p>When applying TWFE to multiple groups and multiple periods, the supposedly causal coefficient is the weighted average of all two-group/two-period DiD estimators in the data where some of the weights can be negative. More specifically, the weights are proportional to group sizes and treatment indicator’s variation in each pair, where units in the middle of the panel have the highest weight.</p>
<p>The canonical/standard TWFE only works when</p>
<ul>
<li><p>Effects are homogeneous across units and across time periods (i.e., no dynamic changes in the effects of treatment). See <span class="citation">(<a href="#ref-goodman2021difference">Goodman-Bacon 2021</a>; <a href="#ref-de2020two">De Chaisemartin and d’Haultfoeuille 2020</a>; <a href="#ref-sun2021estimating">L. Sun and Abraham 2021</a>; <a href="#ref-borusyak2021revisiting">Borusyak, Jaravel, and Spiess 2021</a>)</span> for details. Similarly, it relies on the assumption of <strong>linear additive effects</strong> <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span></p>
<ul>
<li><p>Have to argue why treatment heterogeneity is not a problem (e.g., plot treatment timing and decompose treatment coefficient using <a href="two-way-fixed-effects.html#goodman-bacon-decomposition">Goodman-Bacon Decomposition</a>) know the percentage of observation are never treated (because as the never-treated group increases, the bias of TWFE decreases, with 80% sample to be never-treated, bias is negligible). The problem is worsen when you have long-run effects.</p></li>
<li><p>Need to manually drop two relative time periods if everyone is eventually treated (to avoid multicollinearity). Programs might do this randomly and if it chooses to drop a post-treatment period, it will create biases. The choice usually -1, and -2 periods.</p></li>
<li><p>Treatment heterogeneity can come in because (1) it might take some time for a treatment to have measurable changes in outcomes or (2) for each period after treatment, the effect can be different (phase in or increasing effects).</p></li>
</ul></li>
<li><p>2 time periods.</p></li>
</ul>
<p>Within this setting, TWFE works because, using the baseline (e.g., control units where their treatment status is unchanged across time periods), the comparison can be</p>
<ul>
<li><p>Good for</p>
<ul>
<li><p>Newly treated units vs. control</p></li>
<li><p>Newly treated units vs not-yet treated</p></li>
</ul></li>
<li><p>Bad for</p>
<ul>
<li>Newly treated vs. already treated (because already treated cannot serve as the potential outcome for the newly treated).</li>
</ul></li>
</ul>
<p>Note: Notation for this section is consistent with <span class="citation">(<a href="#ref-arkhangelsky2021double">2020</a>)</span></p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \lambda_t + \tau W_{it} + \beta X_{it} + \epsilon_{it}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Y_{it}\)</span> is the outcome</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> is the unit FE</p></li>
<li><p><span class="math inline">\(\lambda_t\)</span> is the time FE</p></li>
<li><p><span class="math inline">\(\tau\)</span> is the causal effect of treatment</p></li>
<li><p><span class="math inline">\(W_{it}\)</span> is the treatment indicator</p></li>
<li><p><span class="math inline">\(X_{it}\)</span> are covariates</p></li>
</ul>
<p>When <span class="math inline">\(T = 2\)</span>, the TWFE is the traditional DiD model</p>
<p>Under the following assumption, <span class="math inline">\(\hat{\tau}_{OLS}\)</span> is unbiased:</p>
<ol style="list-style-type: decimal">
<li>homogeneous treatment effect</li>
<li>parallel trends assumptions</li>
<li>linear additive effects <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span></li>
</ol>
<p><strong>Remedies for TWFE’s shortcomings</strong></p>
<ul>
<li><p><span class="citation">(<a href="#ref-goodman2021difference">Goodman-Bacon 2021</a>)</span>: diagnostic robustness tests of the TWFE DiD and identify influential observations to the DiD estimate (<a href="two-way-fixed-effects.html#goodman-bacon-decomposition">Goodman-Bacon Decomposition</a>)</p></li>
<li><p><span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span>: 2-step estimation with a bootstrap procedure that can account for autocorrelation and clustering,</p>
<ul>
<li><p>the parameters of interest are the group-time average treatment effects, where each group is defined by when it was first treated (<a href="two-way-fixed-effects.html#multiple-periods-and-variation-in-treatment-timing">Multiple periods and variation in treatment timing</a>)</p></li>
<li><p>Comparing post-treatment outcomes fo groups treated in a period against a similar group that is never treated (using matching).</p></li>
<li><p>Treatment status cannot switch (once treated, stay treated for the rest of the panel)</p></li>
<li><p>Package: <code>did</code></p></li>
</ul></li>
<li><p><span class="citation">(<a href="#ref-sun2021estimating">L. Sun and Abraham 2021</a>)</span>: a specialization of <span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span> in the event-study context.</p>
<ul>
<li><p>They include lags and leads in their design</p></li>
<li><p>have cohort-specific estimates (similar to group-time estimates in <span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span></p></li>
<li><p>They propose the “interaction-weighted” estimator.</p></li>
<li><p>Package: <code>fixest</code></p></li>
</ul></li>
<li><p><span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span></p>
<ul>
<li><p>Different from <span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span> because they allow units to switch in and out of treatment.</p></li>
<li><p>Based on matching methods, to have weighted TWFE</p></li>
<li><p>Package: <code>wfe</code> and <code>PanelMatch</code></p></li>
</ul></li>
<li><p><span class="citation">(<a href="#ref-gardner2022two">Gardner 2022</a>)</span>: two-stage DiD</p>
<ul>
<li><code>did2s</code></li>
</ul></li>
<li><p><span class="citation">(<a href="#ref-arkhangelsky2021double">2020</a>)</span>: see below</p></li>
</ul>
<p>To be robust against</p>
<ol style="list-style-type: decimal">
<li>time- and unit-varying effects</li>
</ol>
<p>We can use the reshaped inverse probability weighting (RIPW)- TWFE estimator</p>
<p>With the following assumptions:</p>
<ul>
<li><p>SUTVA</p></li>
<li><p>Binary treatment: <span class="math inline">\(\mathbf{W}_i = (W_{i1}, \dots, W_{it})\)</span> where <span class="math inline">\(\mathbf{W}_i \sim \mathbf{\pi}_i\)</span> generalized propensity score (i.e., each person treatment likelihood follow <span class="math inline">\(\pi\)</span> regardless of the period)</p></li>
</ul>
<p>Then, the unit-time specific effect is <span class="math inline">\(\tau_{it} = Y_{it}(1) - Y_{it}(0)\)</span></p>
<p>Then the Doubly Average Treatment Effect (DATE) is</p>
<p><span class="math display">\[
\tau(\xi) = \sum_{T=1}^T \xi_t \left(\frac{1}{n} \sum_{i = 1}^n \tau_{it} \right)
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\frac{1}{n} \sum_{i = 1}^n \tau_{it}\)</span> is the unweighted effect of treatment across units (i.e., time-specific ATE).</p></li>
<li><p><span class="math inline">\(\xi = (\xi_1, \dots, \xi_t)\)</span> are user-specific weights for each time period.</p></li>
<li><p>This estimand is called DATE because it’s weighted (averaged) across both time and units.</p></li>
</ul>
<p>A special case of DATE is when both time and unit-weights are equal</p>
<p><span class="math display">\[
\tau_{eq} = \frac{1}{nT} \sum_{t=1}^T \sum_{i = 1}^n \tau_{it}
\]</span></p>
<p>Borrowing the idea of inverse propensity-weighted least squares estimator in the cross-sectional case that we reweight the objective function via the treatment assignment mechanism:</p>
<p><span class="math display">\[
\hat{\tau} \triangleq \arg \min_{\tau} \sum_{i = 1}^n (Y_i -\mu - W_i \tau)^2 \frac{1}{\pi_i (W_i)}
\]</span></p>
<p>where</p>
<ul>
<li><p>the first term is the least squares objective</p></li>
<li><p>the second term is the propensity score</p></li>
</ul>
<p>In the panel data case, the IPW estimator will be</p>
<p><span class="math display">\[
\hat{\tau}_{IPW} \triangleq \arg \min_{\tau} \sum_{i = 1}^n \sum_{t =1}^T (Y_{i t}-\alpha_i - \lambda_t - W_{it} \tau)^2 \frac{1}{\pi_i (W_i)}
\]</span></p>
<p>Then, to have DATE that users can specify the structure of time weight, we use reshaped IPW estimator <span class="citation">(<a href="#ref-arkhangelsky2021double">2020</a>)</span></p>
<p><span class="math display">\[
\hat{\tau}_{RIPW} (\Pi) \triangleq \arg \min_{\tau} \sum_{i = 1}^n \sum_{t =1}^T (Y_{i t}-\alpha_i - \lambda_t - W_{it} \tau)^2 \frac{\Pi(W_i)}{\pi_i (W_i)}
\]</span></p>
<p>where it’s a function of a data-independent distribution <span class="math inline">\(\Pi\)</span> that depends on the support of the treatment path <span class="math inline">\(\mathbb{S} = \cup_i Supp(W_i)\)</span></p>
<p>This generalization can transform to</p>
<ul>
<li><p>IPW-TWFE estimator when <span class="math inline">\(\Pi \sim Unif(\mathbb{S})\)</span></p></li>
<li><p>randomized experiment when <span class="math inline">\(\Pi = \pi_i\)</span></p></li>
</ul>
<p>To choose <span class="math inline">\(\Pi\)</span>, we don’t need to data, we just need possible assignments in your setting.</p>
<ul>
<li><p>For most practical problems (DiD, staggered, transient), we have closed form solutions</p></li>
<li><p>For generic solver, we can use nonlinear programming (e..g, BFGS algorithm)</p></li>
</ul>
<p>As argued in <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span> that TWFE is not a non-parametric approach, it can be subjected to incorrect model assumption (i.e., model dependence).</p>
<ul>
<li><p>Hence, they advocate for matching methods for time-series cross-sectional data <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021</a>)</span></p></li>
<li><p>Use <code>wfe</code> and <code>PanelMatch</code> to apply their paper.</p></li>
</ul>
<p>This package is based on <span class="citation">(<a href="#ref-somaini2016algorithm">Somaini and Wolak 2016</a>)</span></p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="two-way-fixed-effects.html#cb420-1" tabindex="-1"></a><span class="co"># dataset</span></span>
<span id="cb420-2"><a href="two-way-fixed-effects.html#cb420-2" tabindex="-1"></a><span class="fu">library</span>(bacondecomp)</span>
<span id="cb420-3"><a href="two-way-fixed-effects.html#cb420-3" tabindex="-1"></a>df <span class="ot">&lt;-</span> bacondecomp<span class="sc">::</span>castle</span></code></pre></div>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="two-way-fixed-effects.html#cb421-1" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;paulosomaini/xtreg2way&quot;)</span></span>
<span id="cb421-2"><a href="two-way-fixed-effects.html#cb421-2" tabindex="-1"></a></span>
<span id="cb421-3"><a href="two-way-fixed-effects.html#cb421-3" tabindex="-1"></a><span class="fu">library</span>(xtreg2way)</span>
<span id="cb421-4"><a href="two-way-fixed-effects.html#cb421-4" tabindex="-1"></a><span class="co"># output &lt;- xtreg2way(y,</span></span>
<span id="cb421-5"><a href="two-way-fixed-effects.html#cb421-5" tabindex="-1"></a><span class="co">#                     data.frame(x1, x2),</span></span>
<span id="cb421-6"><a href="two-way-fixed-effects.html#cb421-6" tabindex="-1"></a><span class="co">#                     iid,</span></span>
<span id="cb421-7"><a href="two-way-fixed-effects.html#cb421-7" tabindex="-1"></a><span class="co">#                     tid,</span></span>
<span id="cb421-8"><a href="two-way-fixed-effects.html#cb421-8" tabindex="-1"></a><span class="co">#                     w,</span></span>
<span id="cb421-9"><a href="two-way-fixed-effects.html#cb421-9" tabindex="-1"></a><span class="co">#                     noise = &quot;1&quot;,</span></span>
<span id="cb421-10"><a href="two-way-fixed-effects.html#cb421-10" tabindex="-1"></a><span class="co">#                     se = &quot;1&quot;)</span></span>
<span id="cb421-11"><a href="two-way-fixed-effects.html#cb421-11" tabindex="-1"></a></span>
<span id="cb421-12"><a href="two-way-fixed-effects.html#cb421-12" tabindex="-1"></a><span class="co"># equilvalently</span></span>
<span id="cb421-13"><a href="two-way-fixed-effects.html#cb421-13" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">xtreg2way</span>(l_homicide <span class="sc">~</span> post,</span>
<span id="cb421-14"><a href="two-way-fixed-effects.html#cb421-14" tabindex="-1"></a>                    df,</span>
<span id="cb421-15"><a href="two-way-fixed-effects.html#cb421-15" tabindex="-1"></a>                    <span class="at">iid =</span> df<span class="sc">$</span>state, <span class="co"># group id</span></span>
<span id="cb421-16"><a href="two-way-fixed-effects.html#cb421-16" tabindex="-1"></a>                    <span class="at">tid =</span> df<span class="sc">$</span>year, <span class="co"># time id</span></span>
<span id="cb421-17"><a href="two-way-fixed-effects.html#cb421-17" tabindex="-1"></a>                    <span class="co"># w, # vector of weight</span></span>
<span id="cb421-18"><a href="two-way-fixed-effects.html#cb421-18" tabindex="-1"></a>                    <span class="at">se =</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb421-19"><a href="two-way-fixed-effects.html#cb421-19" tabindex="-1"></a>output<span class="sc">$</span>betaHat</span>
<span id="cb421-20"><a href="two-way-fixed-effects.html#cb421-20" tabindex="-1"></a><span class="co">#&gt;                  [,1]</span></span>
<span id="cb421-21"><a href="two-way-fixed-effects.html#cb421-21" tabindex="-1"></a><span class="co">#&gt; l_homicide 0.08181162</span></span>
<span id="cb421-22"><a href="two-way-fixed-effects.html#cb421-22" tabindex="-1"></a>output<span class="sc">$</span>aVarHat</span>
<span id="cb421-23"><a href="two-way-fixed-effects.html#cb421-23" tabindex="-1"></a><span class="co">#&gt;             [,1]</span></span>
<span id="cb421-24"><a href="two-way-fixed-effects.html#cb421-24" tabindex="-1"></a><span class="co">#&gt; [1,] 0.003396724</span></span>
<span id="cb421-25"><a href="two-way-fixed-effects.html#cb421-25" tabindex="-1"></a></span>
<span id="cb421-26"><a href="two-way-fixed-effects.html#cb421-26" tabindex="-1"></a><span class="co"># to save time, you can use your structure in the </span></span>
<span id="cb421-27"><a href="two-way-fixed-effects.html#cb421-27" tabindex="-1"></a><span class="co"># last output for a new set of variables</span></span>
<span id="cb421-28"><a href="two-way-fixed-effects.html#cb421-28" tabindex="-1"></a><span class="co"># output2 &lt;- xtreg2way(y, x1, struc=output$struc)</span></span></code></pre></div>
<p>Standard errors estimation options</p>
<table>
<colgroup>
<col width="19%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th>Set</th>
<th>Estimation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>se = "0"</code></td>
<td>Assume homoskedasticity and no within group correlation or serial correlation</td>
</tr>
<tr class="even">
<td><code>se = "1"</code> (default)</td>
<td>robust to heteroskadasticity and serial correlation <span class="citation">(<a href="#ref-arellano1987computing">Arellano 1987</a>)</span></td>
</tr>
<tr class="odd">
<td><code>se = "2"</code></td>
<td>robust to heteroskedasticity, but assumes no correlation within group or serial correlation</td>
</tr>
<tr class="even">
<td><code>se = "11"</code></td>
<td>Aerllano SE with df correction performed by Stata xtreg <span class="citation">(<a href="#ref-somaini2021twfem">Somaini and Wolak 2021</a>)</span></td>
</tr>
</tbody>
</table>
<p>Alternatively, you can also do it manually or with the <code>plm</code> package, but you have to be careful with how the SEs are estimated</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="two-way-fixed-effects.html#cb422-1" tabindex="-1"></a><span class="fu">library</span>(multiwayvcov) <span class="co"># get vcov matrix </span></span>
<span id="cb422-2"><a href="two-way-fixed-effects.html#cb422-2" tabindex="-1"></a><span class="fu">library</span>(lmtest) <span class="co"># robust SEs estimation</span></span>
<span id="cb422-3"><a href="two-way-fixed-effects.html#cb422-3" tabindex="-1"></a></span>
<span id="cb422-4"><a href="two-way-fixed-effects.html#cb422-4" tabindex="-1"></a><span class="co"># manual</span></span>
<span id="cb422-5"><a href="two-way-fixed-effects.html#cb422-5" tabindex="-1"></a>output3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(l_homicide <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(state) <span class="sc">+</span> <span class="fu">factor</span>(year),</span>
<span id="cb422-6"><a href="two-way-fixed-effects.html#cb422-6" tabindex="-1"></a>              <span class="at">data =</span> df)</span>
<span id="cb422-7"><a href="two-way-fixed-effects.html#cb422-7" tabindex="-1"></a></span>
<span id="cb422-8"><a href="two-way-fixed-effects.html#cb422-8" tabindex="-1"></a><span class="co"># get variance-covariance matrix</span></span>
<span id="cb422-9"><a href="two-way-fixed-effects.html#cb422-9" tabindex="-1"></a>vcov_tw <span class="ot">&lt;-</span> multiwayvcov<span class="sc">::</span><span class="fu">cluster.vcov</span>(output3,</span>
<span id="cb422-10"><a href="two-way-fixed-effects.html#cb422-10" tabindex="-1"></a>                        <span class="fu">cbind</span>(df<span class="sc">$</span>state, df<span class="sc">$</span>year),</span>
<span id="cb422-11"><a href="two-way-fixed-effects.html#cb422-11" tabindex="-1"></a>                        <span class="at">use_white =</span> F,</span>
<span id="cb422-12"><a href="two-way-fixed-effects.html#cb422-12" tabindex="-1"></a>                        <span class="at">df_correction =</span> F)</span>
<span id="cb422-13"><a href="two-way-fixed-effects.html#cb422-13" tabindex="-1"></a></span>
<span id="cb422-14"><a href="two-way-fixed-effects.html#cb422-14" tabindex="-1"></a><span class="co"># get coefficients</span></span>
<span id="cb422-15"><a href="two-way-fixed-effects.html#cb422-15" tabindex="-1"></a><span class="fu">coeftest</span>(output3, vcov_tw)[<span class="dv">2</span>,] </span>
<span id="cb422-16"><a href="two-way-fixed-effects.html#cb422-16" tabindex="-1"></a><span class="co">#&gt;   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span id="cb422-17"><a href="two-way-fixed-effects.html#cb422-17" tabindex="-1"></a><span class="co">#&gt; 0.08181162 0.05671410 1.44252696 0.14979397</span></span></code></pre></div>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="two-way-fixed-effects.html#cb423-1" tabindex="-1"></a><span class="co"># using the plm package</span></span>
<span id="cb423-2"><a href="two-way-fixed-effects.html#cb423-2" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb423-3"><a href="two-way-fixed-effects.html#cb423-3" tabindex="-1"></a></span>
<span id="cb423-4"><a href="two-way-fixed-effects.html#cb423-4" tabindex="-1"></a>output4 <span class="ot">&lt;-</span> <span class="fu">plm</span>(l_homicide <span class="sc">~</span> post, </span>
<span id="cb423-5"><a href="two-way-fixed-effects.html#cb423-5" tabindex="-1"></a>               <span class="at">data =</span> df, </span>
<span id="cb423-6"><a href="two-way-fixed-effects.html#cb423-6" tabindex="-1"></a>               <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;year&quot;</span>), </span>
<span id="cb423-7"><a href="two-way-fixed-effects.html#cb423-7" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;within&quot;</span>, </span>
<span id="cb423-8"><a href="two-way-fixed-effects.html#cb423-8" tabindex="-1"></a>               <span class="at">effect =</span> <span class="st">&quot;twoways&quot;</span>)</span>
<span id="cb423-9"><a href="two-way-fixed-effects.html#cb423-9" tabindex="-1"></a></span>
<span id="cb423-10"><a href="two-way-fixed-effects.html#cb423-10" tabindex="-1"></a><span class="co"># get coefficients</span></span>
<span id="cb423-11"><a href="two-way-fixed-effects.html#cb423-11" tabindex="-1"></a><span class="fu">coeftest</span>(output4, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>)</span>
<span id="cb423-12"><a href="two-way-fixed-effects.html#cb423-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb423-13"><a href="two-way-fixed-effects.html#cb423-13" tabindex="-1"></a><span class="co">#&gt; t test of coefficients:</span></span>
<span id="cb423-14"><a href="two-way-fixed-effects.html#cb423-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb423-15"><a href="two-way-fixed-effects.html#cb423-15" tabindex="-1"></a><span class="co">#&gt;      Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb423-16"><a href="two-way-fixed-effects.html#cb423-16" tabindex="-1"></a><span class="co">#&gt; post 0.081812   0.057748  1.4167   0.1572</span></span></code></pre></div>
<p>As you can see, differences stem from SE estimation, not the coefficient estimate.</p>
<div id="multiple-periods-and-variation-in-treatment-timing" class="section level3 hasAnchor" number="26.3.1">
<h3><span class="header-section-number">26.3.1</span> Multiple periods and variation in treatment timing<a href="two-way-fixed-effects.html#multiple-periods-and-variation-in-treatment-timing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is an extension of the DiD framework to settings where you have</p>
<ul>
<li><p>more than 2 time periods</p></li>
<li><p>different treatment timing</p></li>
</ul>
<p>When treatment effects are heterogeneous across time or units, the standard <a href="two-way-fixed-effects.html#two-way-fixed-effects">Two-way Fixed-effects</a> is inappropriate.</p>
<p>Notation is consistent with <code>did</code> <a href="https://cran.r-project.org/web/packages/did/vignettes/multi-period-did.html">package</a> <span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span></p>
<ul>
<li><p><span class="math inline">\(Y_{it}(0)\)</span> is the potential outcome for unit <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(Y_{it}(g)\)</span> is the potential outcome for unit <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span> if it’s treated in period <span class="math inline">\(g\)</span></p></li>
<li><p><span class="math inline">\(Y_{it}\)</span> is the observed outcome for unit <span class="math inline">\(i\)</span> in time period <span class="math inline">\(t\)</span></p></li>
</ul>
<p><span class="math display">\[
Y_{it} =
\begin{cases}
Y_{it} = Y_{it}(0) &amp; \forall i \in \text{never-treated group} \\
Y_{it} = 1\{G_i &gt; t\} Y_{it}(0) +  1\{G_i \le t \}Y_{it}(G_i) &amp; \forall i \in \text{other groups}
\end{cases}
\]</span></p>
<ul>
<li><p><span class="math inline">\(G_i\)</span> is the time period when <span class="math inline">\(i\)</span> is treated</p></li>
<li><p><span class="math inline">\(C_i\)</span> is a dummy when <span class="math inline">\(i\)</span> belongs to the <strong>never-treated</strong> group</p></li>
<li><p><span class="math inline">\(D_{it}\)</span> is a dummy for whether <span class="math inline">\(i\)</span> is treated in period <span class="math inline">\(t\)</span></p></li>
</ul>
<p><strong>Assumptions</strong>:</p>
<ul>
<li><p>Staggered treatment adoption: once treated, a unit cannot be untreated (revert)</p></li>
<li><p>Parallel trends assumptions (conditional on covariates):</p>
<ul>
<li><p>Based on never-treated units: <span class="math inline">\(E[Y_t(0)- Y_{t-1}(0)|G= g] = E[Y_t(0) - Y_{t-1}(0)|C=1]\)</span></p>
<ul>
<li>Without treatment, the average potential outcomes for group <span class="math inline">\(g\)</span> equals the average potential outcomes for the never-treated group (i.e., control group), which means that we have (1) enough data on the never-treated group (2) the control group is similar to the eventually treated group.</li>
</ul></li>
<li><p>Based on not-yet treated units: <span class="math inline">\(E[Y_t(0) - Y_{t-1}(0)|G = g] = E[Y_t(0) - Y_{t-1}(0)|D_s = 0, G \neq g]\)</span></p>
<ul>
<li><p>Not-yet treated units by time <span class="math inline">\(s\)</span> ( <span class="math inline">\(s \ge t\)</span>) can be used as comparison groups to calculate the average treatment effects for the group first treated in time <span class="math inline">\(g\)</span></p></li>
<li><p>Additional assumption: pre-treatment trends across groups <span class="citation">(<a href="#ref-marcus2021role">Marcus and Sant’Anna 2021</a>)</span></p></li>
</ul></li>
</ul></li>
<li><p>Random sampling</p></li>
<li><p>Irreversibility of treatment (once treated, cannot be untreated)</p></li>
<li><p>Overlap (the treatment propensity <span class="math inline">\(e \in [0,1]\)</span>)</p></li>
</ul>
<p>Group-Time ATE</p>
<ul>
<li>This is the equivalent of the average treatment effect in the standard case (2 groups, 2 periods) under multiple time periods.</li>
</ul>
<p><span class="math display">\[
ATT(g,t) = E[Y_t(g) - Y_t(0) |G = g]
\]</span></p>
<p>which is the average treatment effect for group <span class="math inline">\(g\)</span> in period <span class="math inline">\(t\)</span></p>
<ul>
<li><p>Identification: When the parallel trends assumption based on</p>
<ul>
<li><p>Never-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1} |G = g] - E[Y_t - Y_{g-1}|C=1] \forall t \ge g\)</span></p></li>
<li><p>Not-yet-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1}|G= g] - E[Y_t - Y_{g-1}|D_t = 0, G \neq g] \forall t \ge g\)</span></p></li>
</ul></li>
<li><p>Identification: when the parallel trends assumption only holds conditional on covariates and based on</p>
<ul>
<li><p>Never-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1} |X, G = g] - E[Y_t - Y_{g-1}|X, C=1] \forall t \ge g\)</span></p></li>
<li><p>Not-yet-treated units: <span class="math inline">\(ATT(g,t) = E[Y_t - Y_{g-1}|X, G= g] - E[Y_t - Y_{g-1}|X, D_t = 0, G \neq g] \forall t \ge g\)</span></p></li>
<li><p>This is plausible when you have suspected selection bias that can be corrected by using covariates (i.e., very much similar to matching methods to have plausible parallel trends).</p></li>
</ul></li>
</ul>
<p>Possible parameters of interest are:</p>
<ol style="list-style-type: decimal">
<li>Average treatment effect per group</li>
</ol>
<p><span class="math display">\[
\theta_S(g) = \frac{1}{\tau - g + 1} \sum_{t = 2}^\tau \mathbb{1} \{ \le t \} ATT(g,t)
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Average treatment effect across groups (that were treated) (similar to average treatment effect on the treated in the canonical case)</li>
</ol>
<p><span class="math display">\[
\theta_S^O := \sum_{g=2}^\tau \theta_S(g) P(G=g)
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Average treatment effect dynamics (i.e., average treatment effect for groups that have been exposed to the treatment for <span class="math inline">\(e\)</span> time periods):</li>
</ol>
<p><span class="math display">\[
\theta_D(e) := \sum_{g=2}^\tau \mathbb{1} \{g + e \le \tau \}ATT(g,g + e) P(G = g|G + e \le \tau)
\]</span></p>
<ol start="4" style="list-style-type: decimal">
<li>Average treatment effect in period <span class="math inline">\(t\)</span> for all groups that have treated by period <span class="math inline">\(t\)</span>)</li>
</ol>
<p><span class="math display">\[
\theta_C(t) = \sum_{g=2}^\tau \mathbb{1}\{g \le t\} ATT(g,t) P(G = g|g \le t)
\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>Average treatment effect by calendar time</li>
</ol>
<p><span class="math display">\[
\theta_C = \frac{1}{\tau-1}\sum_{t=2}^\tau \theta_C(t)
\]</span></p>
</div>
<div id="staggered-dif-n-dif" class="section level3 hasAnchor" number="26.3.2">
<h3><span class="header-section-number">26.3.2</span> Staggered Dif-n-dif<a href="two-way-fixed-effects.html#staggered-dif-n-dif" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>When subjects are treated at different point in time (variation in treatment timing across units), we have to use staggered DiD (also known as DiD event study or dynamic DiD).</li>
<li>For design where a treatment is applied and units are exposed to this treatment at all time afterward, see <span class="citation">(<a href="#ref-athey2022design">Athey and Imbens 2022</a>)</span></li>
</ul>
<p>Basic design <span class="citation">(<a href="#ref-stevenson2006bargaining">Stevenson and Wolfers 2006</a>)</span></p>
<p><span class="math display">\[
\begin{aligned}
Y_{it} &amp;= \sum_k \beta_k Treatment_{it}^k + \sum_i \eta_i  State_i \\
&amp;+ \sum_t \lambda_t Year_t + Controls_{it} + \epsilon_{it}
\end{aligned}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(Treatment_{it}^k\)</span> is a series of dummy variables equal to 1 if state <span class="math inline">\(i\)</span> is treated <span class="math inline">\(k\)</span> years ago in period <span class="math inline">\(t\)</span></p></li>
<li><p>SE is usually clustered at the group level (occasionally time level).</p></li>
<li><p>To avoid collinearity, the period right before treatment is usually chosen to drop.</p></li>
</ul>
<p>In this setting, we try to show that the treatment and control groups are not statistically different (i.e., the coefficient estimates before treatment are not different from 0) to show pre-treatment parallel trends.</p>
<p>However, this two-way fixed effects design has been criticized by <span class="citation">(<a href="#ref-sun2021estimating">L. Sun and Abraham 2021</a>; <a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>; <a href="#ref-goodman2021difference">Goodman-Bacon 2021</a>)</span>. When researchers include leads and lags of the treatment to see the long-term effects of the treatment, these leads and lags can be biased by effects from other periods, and pre-trends can falsely arise due to treatment effects heterogeneity.</p>
<p>Applying the new proposed method, finance and accounting researchers find that in many cases, the causal estimates turn out to be null <span class="citation">(<a href="#ref-baker2022much">Baker, Larcker, and Wang 2022</a>)</span>.</p>
<p>Robustness Check</p>
<ul>
<li>The <strong>triple-difference strategy</strong> involves examining the interaction between the <strong>treatment variable</strong> and <strong>the probability of being affected by the program</strong>, and the group-level participation rate. The identification assumption is that there are no differential trends between high and low participation groups in early versus late implementing countries.</li>
</ul>
<p><strong>Assumptions</strong></p>
<ul>
<li><p><strong>Rollout Exogeneity</strong> (i.e., exogeneity of treatment adoption): if the treatment is randomly implemented over time (i.e., unrelated to variables that could also affect our dependent variables)</p>
<ul>
<li>Evidence: Regress adoption on pre-treatment variables. And if you find evidence of correlation, include linear trends interacted with pre-treatment variables <span class="citation">(<a href="#ref-hoynes2009consumption">Hoynes and Schanzenbach 2009</a>)</span></li>
</ul></li>
<li><p><strong>No confounding events</strong></p></li>
<li><p><strong>Exclusion restrictions</strong></p>
<ul>
<li><p><strong><em>No-anticipation assumption</em></strong>: future treatment time do not affect current outcomes</p></li>
<li><p><strong><em>Invariance-to-history assumption</em></strong>: the time a unit under treatment does not affect the outcome (i.e., the time exposed does not matter, just whether exposed or not). This presents causal effect of early or late adoption on the outcome.</p></li>
</ul></li>
<li><p>And all the assumptions in listed in the <a href="two-way-fixed-effects.html#multiple-periods-and-variation-in-treatment-timing">Multiple periods and variation in treatment timing</a></p></li>
<li><p>Auxiliary assumptions:</p>
<ul>
<li><p>Constant treatment effects across units</p></li>
<li><p>Constant treatment effect over time</p></li>
<li><p>Random sampling</p></li>
<li><p>Effect Additivity</p></li>
</ul></li>
</ul>
<p>Remedies for staggered DiD:</p>
<ul>
<li><p>Each treated cohort is compared to appropriate controls (not-yet-treated, never-treated)</p>
<ul>
<li><p><span class="citation">(<a href="#ref-goodman2021difference">Goodman-Bacon 2021</a>)</span></p></li>
<li><p><span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span> consistent for average ATT. more complicated but also more flexible than <span class="citation">(<a href="#ref-sun2021estimating">L. Sun and Abraham 2021</a>)</span></p>
<ul>
<li><span class="citation">(<a href="#ref-sun2021estimating">L. Sun and Abraham 2021</a>)</span> (a special case of <span class="citation">(<a href="#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span>)</li>
</ul></li>
<li><p><span class="citation">(<a href="#ref-de2020two">De Chaisemartin and d’Haultfoeuille 2020</a>)</span></p></li>
<li><p><span class="citation">(<a href="#ref-borusyak2017revisiting">Borusyak and Jaravel 2017</a>)</span></p></li>
</ul></li>
<li><p>Stacked Regression (biased but simple):</p>
<ul>
<li><p><span class="citation">(<a href="#ref-gormley2011growing">Gormley and Matsa 2011</a>)</span></p></li>
<li><p><span class="citation">(<a href="#ref-cengiz2019effect">Cengiz et al. 2019</a>)</span></p></li>
<li><p><span class="citation">(<a href="#ref-deshpande2019screened">Deshpande and Li 2019</a>)</span></p></li>
</ul></li>
</ul>
<div id="stacked-did" class="section level4 hasAnchor" number="26.3.2.1">
<h4><span class="header-section-number">26.3.2.1</span> Stacked DID<a href="two-way-fixed-effects.html#stacked-did" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Notations following <a href="https://scholarworks.iu.edu/dspace/bitstream/handle/2022/26875/2021-10-22_wim_wing_did_slides.pdf?sequence=1&amp;isAllowed=y">these slides</a></p>
<p><span class="math display">\[
Y_{it} = \beta_{FE} D_{it} + A_i + B_t + \epsilon_{it}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(A_i\)</span> is the group fixed effects</p></li>
<li><p><span class="math inline">\(B_t\)</span> is the period fixed effects</p></li>
</ul>
<p>Steps</p>
<ol style="list-style-type: decimal">
<li>Choose Event Window</li>
<li>Enumerate Sub-experiments</li>
<li>Define Inclusion Criteria</li>
<li>Stack Data</li>
<li>Specify Estimating Equation</li>
</ol>
<p><strong>Event Window</strong></p>
<p>Let</p>
<ul>
<li><p><span class="math inline">\(\kappa_a\)</span> be the length of the pre-event window</p></li>
<li><p><span class="math inline">\(\kappa_b\)</span> be the length of the post-event window</p></li>
</ul>
<p>By setting a common event window for the analysis, we essentially exclude all those events that do not meet this criteria.</p>
<p><strong>Sub-experiments</strong></p>
<p>Let <span class="math inline">\(T_1\)</span> be the earliest period in the dataset</p>
<p><span class="math inline">\(T_T\)</span> be the last period in the dataset</p>
<p>Then, the collection of all policy adoption periods that are under our event window is</p>
<p><span class="math display">\[
\Omega_A = \{ A_i |T_1 + \kappa_a \le A_i \le T_T - \kappa_b\}
\]</span></p>
<p>where these events exist</p>
<ul>
<li><p>at least <span class="math inline">\(\kappa_a\)</span> periods after the earliest period</p></li>
<li><p>at least <span class="math inline">\(\kappa_b\)</span> periods before the last period</p></li>
</ul>
<p>Let <span class="math inline">\(d = 1, \dots, D\)</span> be the index column of the sub-experiments in <span class="math inline">\(\Omega_A\)</span></p>
<p>and <span class="math inline">\(\omega_d\)</span> be the event date of the d-th sub-experiment (e.g., <span class="math inline">\(\omega_1\)</span> = adoption date of the 1st experiment)</p>
<p><strong>Inclusion Criteria</strong></p>
<ol style="list-style-type: decimal">
<li>Valid treated Units
<ul>
<li><p>Within sub-experiment <span class="math inline">\(d\)</span>, all treated units have the same adoption date</p></li>
<li><p>This makes sure a unit can only serve as a treated unit in only 1 sub-experiment</p></li>
</ul></li>
<li>Clean controls
<ul>
<li><p>Only units satisfying <span class="math inline">\(A_i &gt;\omega_d + \kappa_b\)</span> are included as controls in sub-experiment d</p></li>
<li><p>This ensures controls are only</p>
<ul>
<li><p>never treated units</p></li>
<li><p>units that are treated in far future</p></li>
</ul></li>
<li><p>But a unit can be control unit in multiple sub-experiments (need to correct SE)</p></li>
</ul></li>
<li>Valid Time Periods
<ul>
<li><p>All observations within sub-experiment d are from time periods within the sub-experiment’s event window</p></li>
<li><p>This ensures in sub-experiment d, only observations satisfying <span class="math inline">\(\omega_d - \kappa_a \le t \le \omega_d + \kappa_b\)</span> are included</p></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="two-way-fixed-effects.html#cb424-1" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb424-2"><a href="two-way-fixed-effects.html#cb424-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb424-3"><a href="two-way-fixed-effects.html#cb424-3" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb424-4"><a href="two-way-fixed-effects.html#cb424-4" tabindex="-1"></a></span>
<span id="cb424-5"><a href="two-way-fixed-effects.html#cb424-5" tabindex="-1"></a><span class="fu">data</span>(base_stagg)</span>
<span id="cb424-6"><a href="two-way-fixed-effects.html#cb424-6" tabindex="-1"></a></span>
<span id="cb424-7"><a href="two-way-fixed-effects.html#cb424-7" tabindex="-1"></a></span>
<span id="cb424-8"><a href="two-way-fixed-effects.html#cb424-8" tabindex="-1"></a></span>
<span id="cb424-9"><a href="two-way-fixed-effects.html#cb424-9" tabindex="-1"></a><span class="co"># first make the stacked datasets</span></span>
<span id="cb424-10"><a href="two-way-fixed-effects.html#cb424-10" tabindex="-1"></a><span class="co"># get the treatment cohorts</span></span>
<span id="cb424-11"><a href="two-way-fixed-effects.html#cb424-11" tabindex="-1"></a>cohorts <span class="ot">&lt;-</span> base_stagg <span class="sc">%&gt;%</span></span>
<span id="cb424-12"><a href="two-way-fixed-effects.html#cb424-12" tabindex="-1"></a>    <span class="fu">select</span>(year_treated) <span class="sc">%&gt;%</span></span>
<span id="cb424-13"><a href="two-way-fixed-effects.html#cb424-13" tabindex="-1"></a>    <span class="co"># exclude never-treated group</span></span>
<span id="cb424-14"><a href="two-way-fixed-effects.html#cb424-14" tabindex="-1"></a>    <span class="fu">filter</span>(year_treated <span class="sc">!=</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb424-15"><a href="two-way-fixed-effects.html#cb424-15" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb424-16"><a href="two-way-fixed-effects.html#cb424-16" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb424-17"><a href="two-way-fixed-effects.html#cb424-17" tabindex="-1"></a></span>
<span id="cb424-18"><a href="two-way-fixed-effects.html#cb424-18" tabindex="-1"></a><span class="co"># make formula to create the sub-datasets</span></span>
<span id="cb424-19"><a href="two-way-fixed-effects.html#cb424-19" tabindex="-1"></a>getdata <span class="ot">&lt;-</span> <span class="cf">function</span>(j, window) {</span>
<span id="cb424-20"><a href="two-way-fixed-effects.html#cb424-20" tabindex="-1"></a>    <span class="co">#keep what we need</span></span>
<span id="cb424-21"><a href="two-way-fixed-effects.html#cb424-21" tabindex="-1"></a>    base_stagg <span class="sc">%&gt;%</span></span>
<span id="cb424-22"><a href="two-way-fixed-effects.html#cb424-22" tabindex="-1"></a>        <span class="co"># keep treated units and all units not treated within -5 to 5</span></span>
<span id="cb424-23"><a href="two-way-fixed-effects.html#cb424-23" tabindex="-1"></a>        <span class="co"># keep treated units and all units not treated within -window to window</span></span>
<span id="cb424-24"><a href="two-way-fixed-effects.html#cb424-24" tabindex="-1"></a>        <span class="fu">filter</span>(year_treated <span class="sc">==</span> j <span class="sc">|</span> year_treated <span class="sc">&gt;</span> j <span class="sc">+</span> window) <span class="sc">%&gt;%</span></span>
<span id="cb424-25"><a href="two-way-fixed-effects.html#cb424-25" tabindex="-1"></a>        <span class="co"># keep just year -window to window</span></span>
<span id="cb424-26"><a href="two-way-fixed-effects.html#cb424-26" tabindex="-1"></a>        <span class="fu">filter</span>(year <span class="sc">&gt;=</span> j <span class="sc">-</span> window <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> j <span class="sc">+</span> window) <span class="sc">%&gt;%</span></span>
<span id="cb424-27"><a href="two-way-fixed-effects.html#cb424-27" tabindex="-1"></a>        <span class="co"># create an indicator for the dataset</span></span>
<span id="cb424-28"><a href="two-way-fixed-effects.html#cb424-28" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">df =</span> j)</span>
<span id="cb424-29"><a href="two-way-fixed-effects.html#cb424-29" tabindex="-1"></a>}</span>
<span id="cb424-30"><a href="two-way-fixed-effects.html#cb424-30" tabindex="-1"></a></span>
<span id="cb424-31"><a href="two-way-fixed-effects.html#cb424-31" tabindex="-1"></a><span class="co"># get data stacked</span></span>
<span id="cb424-32"><a href="two-way-fixed-effects.html#cb424-32" tabindex="-1"></a>stacked_data <span class="ot">&lt;-</span> <span class="fu">map_df</span>(cohorts, <span class="sc">~</span> <span class="fu">getdata</span>(., <span class="at">window =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb424-33"><a href="two-way-fixed-effects.html#cb424-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_year =</span> <span class="fu">if_else</span>(df <span class="sc">==</span> year_treated, time_to_treatment, <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb424-34"><a href="two-way-fixed-effects.html#cb424-34" tabindex="-1"></a>    fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="st">&quot;rel_year&quot;</span>, <span class="at">ignore_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb424-35"><a href="two-way-fixed-effects.html#cb424-35" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;rel_year_&quot;</span>), <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)))</span>
<span id="cb424-36"><a href="two-way-fixed-effects.html#cb424-36" tabindex="-1"></a></span>
<span id="cb424-37"><a href="two-way-fixed-effects.html#cb424-37" tabindex="-1"></a><span class="co"># get stacked value</span></span>
<span id="cb424-38"><a href="two-way-fixed-effects.html#cb424-38" tabindex="-1"></a>stacked <span class="ot">&lt;-</span></span>
<span id="cb424-39"><a href="two-way-fixed-effects.html#cb424-39" tabindex="-1"></a>    <span class="fu">feols</span>(</span>
<span id="cb424-40"><a href="two-way-fixed-effects.html#cb424-40" tabindex="-1"></a>        y <span class="sc">~</span> <span class="st">`</span><span class="at">rel_year_-5</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rel_year_-4</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rel_year_-3</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb424-41"><a href="two-way-fixed-effects.html#cb424-41" tabindex="-1"></a>            <span class="st">`</span><span class="at">rel_year_-2</span><span class="st">`</span> <span class="sc">+</span> rel_year_0 <span class="sc">+</span> rel_year_1 <span class="sc">+</span> rel_year_2 <span class="sc">+</span> rel_year_3 <span class="sc">+</span></span>
<span id="cb424-42"><a href="two-way-fixed-effects.html#cb424-42" tabindex="-1"></a>            rel_year_4 <span class="sc">+</span> rel_year_5 <span class="sc">|</span></span>
<span id="cb424-43"><a href="two-way-fixed-effects.html#cb424-43" tabindex="-1"></a>            id <span class="sc">^</span> df <span class="sc">+</span> year <span class="sc">^</span> df,</span>
<span id="cb424-44"><a href="two-way-fixed-effects.html#cb424-44" tabindex="-1"></a>        <span class="at">data =</span> stacked_data</span>
<span id="cb424-45"><a href="two-way-fixed-effects.html#cb424-45" tabindex="-1"></a>    )<span class="sc">$</span>coefficients</span>
<span id="cb424-46"><a href="two-way-fixed-effects.html#cb424-46" tabindex="-1"></a></span>
<span id="cb424-47"><a href="two-way-fixed-effects.html#cb424-47" tabindex="-1"></a>stacked_se <span class="ot">=</span> <span class="fu">feols</span>(</span>
<span id="cb424-48"><a href="two-way-fixed-effects.html#cb424-48" tabindex="-1"></a>    y <span class="sc">~</span> <span class="st">`</span><span class="at">rel_year_-5</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rel_year_-4</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">rel_year_-3</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb424-49"><a href="two-way-fixed-effects.html#cb424-49" tabindex="-1"></a>        <span class="st">`</span><span class="at">rel_year_-2</span><span class="st">`</span> <span class="sc">+</span> rel_year_0 <span class="sc">+</span> rel_year_1 <span class="sc">+</span> rel_year_2 <span class="sc">+</span> rel_year_3 <span class="sc">+</span></span>
<span id="cb424-50"><a href="two-way-fixed-effects.html#cb424-50" tabindex="-1"></a>        rel_year_4 <span class="sc">+</span> rel_year_5 <span class="sc">|</span></span>
<span id="cb424-51"><a href="two-way-fixed-effects.html#cb424-51" tabindex="-1"></a>        id <span class="sc">^</span> df <span class="sc">+</span> year <span class="sc">^</span> df,</span>
<span id="cb424-52"><a href="two-way-fixed-effects.html#cb424-52" tabindex="-1"></a>    <span class="at">data =</span> stacked_data</span>
<span id="cb424-53"><a href="two-way-fixed-effects.html#cb424-53" tabindex="-1"></a>)<span class="sc">$</span>se</span>
<span id="cb424-54"><a href="two-way-fixed-effects.html#cb424-54" tabindex="-1"></a></span>
<span id="cb424-55"><a href="two-way-fixed-effects.html#cb424-55" tabindex="-1"></a><span class="co"># add in 0 for omitted -1</span></span>
<span id="cb424-56"><a href="two-way-fixed-effects.html#cb424-56" tabindex="-1"></a>stacked <span class="ot">&lt;-</span> <span class="fu">c</span>(stacked[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">0</span>, stacked[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb424-57"><a href="two-way-fixed-effects.html#cb424-57" tabindex="-1"></a>stacked_se <span class="ot">&lt;-</span> <span class="fu">c</span>(stacked_se[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">0</span>, stacked_se[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb424-58"><a href="two-way-fixed-effects.html#cb424-58" tabindex="-1"></a></span>
<span id="cb424-59"><a href="two-way-fixed-effects.html#cb424-59" tabindex="-1"></a></span>
<span id="cb424-60"><a href="two-way-fixed-effects.html#cb424-60" tabindex="-1"></a>cs_out <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(</span>
<span id="cb424-61"><a href="two-way-fixed-effects.html#cb424-61" tabindex="-1"></a>    <span class="at">yname =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb424-62"><a href="two-way-fixed-effects.html#cb424-62" tabindex="-1"></a>    <span class="at">data =</span> base_stagg,</span>
<span id="cb424-63"><a href="two-way-fixed-effects.html#cb424-63" tabindex="-1"></a>    <span class="at">gname =</span> <span class="st">&quot;year_treated&quot;</span>,</span>
<span id="cb424-64"><a href="two-way-fixed-effects.html#cb424-64" tabindex="-1"></a>    <span class="at">idname =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb424-65"><a href="two-way-fixed-effects.html#cb424-65" tabindex="-1"></a>    <span class="co"># xformla = &quot;~x1&quot;,</span></span>
<span id="cb424-66"><a href="two-way-fixed-effects.html#cb424-66" tabindex="-1"></a>    <span class="at">tname =</span> <span class="st">&quot;year&quot;</span></span>
<span id="cb424-67"><a href="two-way-fixed-effects.html#cb424-67" tabindex="-1"></a>)</span>
<span id="cb424-68"><a href="two-way-fixed-effects.html#cb424-68" tabindex="-1"></a>cs <span class="ot">&lt;-</span></span>
<span id="cb424-69"><a href="two-way-fixed-effects.html#cb424-69" tabindex="-1"></a>    <span class="fu">aggte</span>(</span>
<span id="cb424-70"><a href="two-way-fixed-effects.html#cb424-70" tabindex="-1"></a>        cs_out,</span>
<span id="cb424-71"><a href="two-way-fixed-effects.html#cb424-71" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;dynamic&quot;</span>,</span>
<span id="cb424-72"><a href="two-way-fixed-effects.html#cb424-72" tabindex="-1"></a>        <span class="at">min_e =</span> <span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb424-73"><a href="two-way-fixed-effects.html#cb424-73" tabindex="-1"></a>        <span class="at">max_e =</span> <span class="dv">5</span>,</span>
<span id="cb424-74"><a href="two-way-fixed-effects.html#cb424-74" tabindex="-1"></a>        <span class="at">bstrap =</span> <span class="cn">FALSE</span>,</span>
<span id="cb424-75"><a href="two-way-fixed-effects.html#cb424-75" tabindex="-1"></a>        <span class="at">cband =</span> <span class="cn">FALSE</span></span>
<span id="cb424-76"><a href="two-way-fixed-effects.html#cb424-76" tabindex="-1"></a>    )</span>
<span id="cb424-77"><a href="two-way-fixed-effects.html#cb424-77" tabindex="-1"></a></span>
<span id="cb424-78"><a href="two-way-fixed-effects.html#cb424-78" tabindex="-1"></a></span>
<span id="cb424-79"><a href="two-way-fixed-effects.html#cb424-79" tabindex="-1"></a></span>
<span id="cb424-80"><a href="two-way-fixed-effects.html#cb424-80" tabindex="-1"></a>res_sa20 <span class="ot">=</span> <span class="fu">feols</span>(y <span class="sc">~</span> <span class="fu">sunab</span>(year_treated, year) <span class="sc">|</span></span>
<span id="cb424-81"><a href="two-way-fixed-effects.html#cb424-81" tabindex="-1"></a>                     id <span class="sc">+</span> year, base_stagg)</span>
<span id="cb424-82"><a href="two-way-fixed-effects.html#cb424-82" tabindex="-1"></a>sa <span class="ot">=</span> <span class="fu">tidy</span>(res_sa20)[<span class="dv">5</span><span class="sc">:</span><span class="dv">14</span>, ] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb424-83"><a href="two-way-fixed-effects.html#cb424-83" tabindex="-1"></a>sa <span class="ot">=</span> <span class="fu">c</span>(sa[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">0</span>, sa[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb424-84"><a href="two-way-fixed-effects.html#cb424-84" tabindex="-1"></a></span>
<span id="cb424-85"><a href="two-way-fixed-effects.html#cb424-85" tabindex="-1"></a>sa_se <span class="ot">=</span> <span class="fu">tidy</span>(res_sa20)[<span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>, ] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(std.error)</span>
<span id="cb424-86"><a href="two-way-fixed-effects.html#cb424-86" tabindex="-1"></a>sa_se <span class="ot">=</span> <span class="fu">c</span>(sa_se[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">0</span>, sa_se[<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb424-87"><a href="two-way-fixed-effects.html#cb424-87" tabindex="-1"></a></span>
<span id="cb424-88"><a href="two-way-fixed-effects.html#cb424-88" tabindex="-1"></a>compare_df_est <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb424-89"><a href="two-way-fixed-effects.html#cb424-89" tabindex="-1"></a>    <span class="at">period =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb424-90"><a href="two-way-fixed-effects.html#cb424-90" tabindex="-1"></a>    <span class="at">cs =</span> cs<span class="sc">$</span>att.egt,</span>
<span id="cb424-91"><a href="two-way-fixed-effects.html#cb424-91" tabindex="-1"></a>    <span class="at">sa =</span> sa,</span>
<span id="cb424-92"><a href="two-way-fixed-effects.html#cb424-92" tabindex="-1"></a>    <span class="at">stacked =</span> stacked</span>
<span id="cb424-93"><a href="two-way-fixed-effects.html#cb424-93" tabindex="-1"></a>)</span>
<span id="cb424-94"><a href="two-way-fixed-effects.html#cb424-94" tabindex="-1"></a></span>
<span id="cb424-95"><a href="two-way-fixed-effects.html#cb424-95" tabindex="-1"></a>compare_df_se <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb424-96"><a href="two-way-fixed-effects.html#cb424-96" tabindex="-1"></a>    <span class="at">period =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb424-97"><a href="two-way-fixed-effects.html#cb424-97" tabindex="-1"></a>    <span class="at">cs =</span> cs<span class="sc">$</span>se.egt,</span>
<span id="cb424-98"><a href="two-way-fixed-effects.html#cb424-98" tabindex="-1"></a>    <span class="at">sa =</span> sa_se,</span>
<span id="cb424-99"><a href="two-way-fixed-effects.html#cb424-99" tabindex="-1"></a>    <span class="at">stacked =</span> stacked_se</span>
<span id="cb424-100"><a href="two-way-fixed-effects.html#cb424-100" tabindex="-1"></a>)</span>
<span id="cb424-101"><a href="two-way-fixed-effects.html#cb424-101" tabindex="-1"></a></span>
<span id="cb424-102"><a href="two-way-fixed-effects.html#cb424-102" tabindex="-1"></a>compare_df_longer <span class="ot">&lt;-</span> compare_df_est <span class="sc">%&gt;%</span></span>
<span id="cb424-103"><a href="two-way-fixed-effects.html#cb424-103" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span>period, <span class="at">names_to =</span> <span class="st">&quot;estimator&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;est&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb424-104"><a href="two-way-fixed-effects.html#cb424-104" tabindex="-1"></a>    </span>
<span id="cb424-105"><a href="two-way-fixed-effects.html#cb424-105" tabindex="-1"></a>    <span class="fu">full_join</span>(compare_df_se <span class="sc">%&gt;%</span> </span>
<span id="cb424-106"><a href="two-way-fixed-effects.html#cb424-106" tabindex="-1"></a>                  <span class="fu">pivot_longer</span>(<span class="sc">!</span>period, <span class="at">names_to =</span> <span class="st">&quot;estimator&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;se&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb424-107"><a href="two-way-fixed-effects.html#cb424-107" tabindex="-1"></a>    </span>
<span id="cb424-108"><a href="two-way-fixed-effects.html#cb424-108" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">upper =</span> est <span class="sc">+</span>  <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb424-109"><a href="two-way-fixed-effects.html#cb424-109" tabindex="-1"></a>           <span class="at">lower =</span> est <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb424-110"><a href="two-way-fixed-effects.html#cb424-110" tabindex="-1"></a></span>
<span id="cb424-111"><a href="two-way-fixed-effects.html#cb424-111" tabindex="-1"></a></span>
<span id="cb424-112"><a href="two-way-fixed-effects.html#cb424-112" tabindex="-1"></a><span class="fu">ggplot</span>(compare_df_longer) <span class="sc">+</span></span>
<span id="cb424-113"><a href="two-way-fixed-effects.html#cb424-113" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(</span>
<span id="cb424-114"><a href="two-way-fixed-effects.html#cb424-114" tabindex="-1"></a>        <span class="at">x =</span> period,</span>
<span id="cb424-115"><a href="two-way-fixed-effects.html#cb424-115" tabindex="-1"></a>        <span class="at">ymin =</span> lower,</span>
<span id="cb424-116"><a href="two-way-fixed-effects.html#cb424-116" tabindex="-1"></a>        <span class="at">ymax =</span> upper,</span>
<span id="cb424-117"><a href="two-way-fixed-effects.html#cb424-117" tabindex="-1"></a>        <span class="at">group =</span> estimator</span>
<span id="cb424-118"><a href="two-way-fixed-effects.html#cb424-118" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb424-119"><a href="two-way-fixed-effects.html#cb424-119" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(</span>
<span id="cb424-120"><a href="two-way-fixed-effects.html#cb424-120" tabindex="-1"></a>        <span class="at">x =</span> period,</span>
<span id="cb424-121"><a href="two-way-fixed-effects.html#cb424-121" tabindex="-1"></a>        <span class="at">y =</span> est,</span>
<span id="cb424-122"><a href="two-way-fixed-effects.html#cb424-122" tabindex="-1"></a>        <span class="at">group =</span> estimator,</span>
<span id="cb424-123"><a href="two-way-fixed-effects.html#cb424-123" tabindex="-1"></a>        <span class="at">col =</span> estimator</span>
<span id="cb424-124"><a href="two-way-fixed-effects.html#cb424-124" tabindex="-1"></a>    ),</span>
<span id="cb424-125"><a href="two-way-fixed-effects.html#cb424-125" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-9-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong>Stack Data</strong></p>
<p>Estimating Equation</p>
<p><span class="math display">\[
Y_{itd} = \beta_0 + \beta_1 + T_{id} + \beta_2 + P_{td} + \beta_3 (T_{id} \times P_{td}) + \epsilon_{itd}
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(T_{id}\)</span> = 1 if unit <span class="math inline">\(i\)</span> is treated in sub-experiment d, 0 if control</p></li>
<li><p><span class="math inline">\(P_{td}\)</span> = 1 if it’s the period after the treatment in sub-experiment d</p></li>
</ul>
<p>Equivalently,</p>
<p><span class="math display">\[
Y_{itd} = \beta_3 (T_{id} \times P_{td}) + \theta_{id} + \gamma_{td} + \epsilon_{itd}
\]</span></p>
<p><span class="math inline">\(\beta_3\)</span> averages all the time-varying effects into a single number (can’t see the time-varying effects)</p>
<p><strong>Stacked Event Study</strong></p>
<p>Let <span class="math inline">\(YSE_{td} = t - \omega_d\)</span> be the “time since event” variable in sub-experiment <span class="math inline">\(d\)</span></p>
<p>Then, <span class="math inline">\(YSE_{td} = -\kappa_a, \dots, 0, \dots, \kappa_b\)</span> in every sub-experiment</p>
<p>In each sub-experiment, we can fit</p>
<p><span class="math display">\[
Y_{it}^d = \sum_{j = -\kappa_a}^{\kappa_b} \beta_j^d \times 1(TSE_{td} = j) + \sum_{m = -\kappa_a}^{\kappa_b} \delta_j^d (T_{id} \times 1 (TSE_{td} = j)) + \theta_i^d + \epsilon_{it}^d
\]</span></p>
<ul>
<li>Different set of event study coefficients in each sub-experiment</li>
</ul>
<p><span class="math display">\[
Y_{itd} = \sum_{j = -\kappa_a}^{\kappa_b} \beta_j \times 1(TSE_{td} = j) + \sum_{m = -\kappa_a}^{\kappa_b} \delta_j (T_{id} \times 1 (TSE_{td} = j)) + \theta_{id} + \epsilon_{itd}
\]</span></p>
<p><strong>Clustering</strong></p>
<ul>
<li><p>Clustered at the unit x sub-experiment level <span class="citation">(<a href="#ref-cengiz2019effect">Cengiz et al. 2019</a>)</span></p></li>
<li><p>Clustered at the unit level <span class="citation">(<a href="#ref-deshpande2019screened">Deshpande and Li 2019</a>)</span></p></li>
</ul>
</div>
<div id="goodman-bacon-decomposition" class="section level4 hasAnchor" number="26.3.2.2">
<h4><span class="header-section-number">26.3.2.2</span> Goodman-Bacon Decomposition<a href="two-way-fixed-effects.html#goodman-bacon-decomposition" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Paper: <span class="citation">(<a href="#ref-goodman2021difference">Goodman-Bacon 2021</a>)</span></p>
<p>For an excellent explanation slides by the author, <a href="https://www.stata.com/meeting/chicago19/slides/chicago19_Goodman-Bacon.pdf">see</a></p>
<p>Takeaways:</p>
<ul>
<li><p>A pairwise DID (<span class="math inline">\(\tau\)</span>) gets more weight if the change is close to the middle of the study window</p></li>
<li><p>A pairwise DID (<span class="math inline">\(\tau\)</span>) gets more weight if it includes more observations.</p></li>
</ul>
<p>Code from <code>bacondecomp</code> vignette</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="two-way-fixed-effects.html#cb425-1" tabindex="-1"></a><span class="fu">library</span>(bacondecomp)</span>
<span id="cb425-2"><a href="two-way-fixed-effects.html#cb425-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb425-3"><a href="two-way-fixed-effects.html#cb425-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;castle&quot;</span>)</span>
<span id="cb425-4"><a href="two-way-fixed-effects.html#cb425-4" tabindex="-1"></a>castle <span class="ot">&lt;-</span> castle <span class="sc">%&gt;%</span> </span>
<span id="cb425-5"><a href="two-way-fixed-effects.html#cb425-5" tabindex="-1"></a>    <span class="fu">select</span>(l_homicide, post, state, year)</span>
<span id="cb425-6"><a href="two-way-fixed-effects.html#cb425-6" tabindex="-1"></a><span class="fu">head</span>(castle)</span>
<span id="cb425-7"><a href="two-way-fixed-effects.html#cb425-7" tabindex="-1"></a><span class="co">#&gt;   l_homicide post   state year</span></span>
<span id="cb425-8"><a href="two-way-fixed-effects.html#cb425-8" tabindex="-1"></a><span class="co">#&gt; 1   2.027356    0 Alabama 2000</span></span>
<span id="cb425-9"><a href="two-way-fixed-effects.html#cb425-9" tabindex="-1"></a><span class="co">#&gt; 2   2.164867    0 Alabama 2001</span></span>
<span id="cb425-10"><a href="two-way-fixed-effects.html#cb425-10" tabindex="-1"></a><span class="co">#&gt; 3   1.936334    0 Alabama 2002</span></span>
<span id="cb425-11"><a href="two-way-fixed-effects.html#cb425-11" tabindex="-1"></a><span class="co">#&gt; 4   1.919567    0 Alabama 2003</span></span>
<span id="cb425-12"><a href="two-way-fixed-effects.html#cb425-12" tabindex="-1"></a><span class="co">#&gt; 5   1.749841    0 Alabama 2004</span></span>
<span id="cb425-13"><a href="two-way-fixed-effects.html#cb425-13" tabindex="-1"></a><span class="co">#&gt; 6   2.130440    0 Alabama 2005</span></span>
<span id="cb425-14"><a href="two-way-fixed-effects.html#cb425-14" tabindex="-1"></a></span>
<span id="cb425-15"><a href="two-way-fixed-effects.html#cb425-15" tabindex="-1"></a></span>
<span id="cb425-16"><a href="two-way-fixed-effects.html#cb425-16" tabindex="-1"></a>df_bacon <span class="ot">&lt;-</span> <span class="fu">bacon</span>(</span>
<span id="cb425-17"><a href="two-way-fixed-effects.html#cb425-17" tabindex="-1"></a>    l_homicide <span class="sc">~</span> post,</span>
<span id="cb425-18"><a href="two-way-fixed-effects.html#cb425-18" tabindex="-1"></a>    <span class="at">data =</span> castle,</span>
<span id="cb425-19"><a href="two-way-fixed-effects.html#cb425-19" tabindex="-1"></a>    <span class="at">id_var =</span> <span class="st">&quot;state&quot;</span>,</span>
<span id="cb425-20"><a href="two-way-fixed-effects.html#cb425-20" tabindex="-1"></a>    <span class="at">time_var =</span> <span class="st">&quot;year&quot;</span></span>
<span id="cb425-21"><a href="two-way-fixed-effects.html#cb425-21" tabindex="-1"></a>)</span>
<span id="cb425-22"><a href="two-way-fixed-effects.html#cb425-22" tabindex="-1"></a><span class="co">#&gt;                       type  weight  avg_est</span></span>
<span id="cb425-23"><a href="two-way-fixed-effects.html#cb425-23" tabindex="-1"></a><span class="co">#&gt; 1 Earlier vs Later Treated 0.05976 -0.00554</span></span>
<span id="cb425-24"><a href="two-way-fixed-effects.html#cb425-24" tabindex="-1"></a><span class="co">#&gt; 2 Later vs Earlier Treated 0.03190  0.07032</span></span>
<span id="cb425-25"><a href="two-way-fixed-effects.html#cb425-25" tabindex="-1"></a><span class="co">#&gt; 3     Treated vs Untreated 0.90834  0.08796</span></span>
<span id="cb425-26"><a href="two-way-fixed-effects.html#cb425-26" tabindex="-1"></a></span>
<span id="cb425-27"><a href="two-way-fixed-effects.html#cb425-27" tabindex="-1"></a><span class="co"># weighted average of the decomposition</span></span>
<span id="cb425-28"><a href="two-way-fixed-effects.html#cb425-28" tabindex="-1"></a><span class="fu">sum</span>(df_bacon<span class="sc">$</span>estimate <span class="sc">*</span> df_bacon<span class="sc">$</span>weight)</span>
<span id="cb425-29"><a href="two-way-fixed-effects.html#cb425-29" tabindex="-1"></a><span class="co">#&gt; [1] 0.08181162</span></span></code></pre></div>
<p>Two-way Fixed effect estimate</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="two-way-fixed-effects.html#cb426-1" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb426-2"><a href="two-way-fixed-effects.html#cb426-2" tabindex="-1"></a>fit_tw <span class="ot">&lt;-</span> <span class="fu">lm</span>(l_homicide <span class="sc">~</span> post <span class="sc">+</span> <span class="fu">factor</span>(state) <span class="sc">+</span> <span class="fu">factor</span>(year), </span>
<span id="cb426-3"><a href="two-way-fixed-effects.html#cb426-3" tabindex="-1"></a>             <span class="at">data =</span> bacondecomp<span class="sc">::</span>castle)</span>
<span id="cb426-4"><a href="two-way-fixed-effects.html#cb426-4" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tidy</span>(fit_tw))</span>
<span id="cb426-5"><a href="two-way-fixed-effects.html#cb426-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span id="cb426-6"><a href="two-way-fixed-effects.html#cb426-6" tabindex="-1"></a><span class="co">#&gt;   term                    estimate std.error statistic   p.value</span></span>
<span id="cb426-7"><a href="two-way-fixed-effects.html#cb426-7" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb426-8"><a href="two-way-fixed-effects.html#cb426-8" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)               1.95      0.0624    31.2   2.84e-118</span></span>
<span id="cb426-9"><a href="two-way-fixed-effects.html#cb426-9" tabindex="-1"></a><span class="co">#&gt; 2 post                      0.0818    0.0317     2.58  1.02e-  2</span></span>
<span id="cb426-10"><a href="two-way-fixed-effects.html#cb426-10" tabindex="-1"></a><span class="co">#&gt; 3 factor(state)Alaska      -0.373     0.0797    -4.68  3.77e-  6</span></span>
<span id="cb426-11"><a href="two-way-fixed-effects.html#cb426-11" tabindex="-1"></a><span class="co">#&gt; 4 factor(state)Arizona      0.0158    0.0797     0.198 8.43e-  1</span></span>
<span id="cb426-12"><a href="two-way-fixed-effects.html#cb426-12" tabindex="-1"></a><span class="co">#&gt; 5 factor(state)Arkansas    -0.118     0.0810    -1.46  1.44e-  1</span></span>
<span id="cb426-13"><a href="two-way-fixed-effects.html#cb426-13" tabindex="-1"></a><span class="co">#&gt; 6 factor(state)California  -0.108     0.0810    -1.34  1.82e-  1</span></span></code></pre></div>
<p>Hence, naive TWFE fixed effect equals the weighted average of the Bacon decomposition (= 0.08).</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="two-way-fixed-effects.html#cb427-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb427-2"><a href="two-way-fixed-effects.html#cb427-2" tabindex="-1"></a></span>
<span id="cb427-3"><a href="two-way-fixed-effects.html#cb427-3" tabindex="-1"></a><span class="fu">ggplot</span>(df_bacon) <span class="sc">+</span></span>
<span id="cb427-4"><a href="two-way-fixed-effects.html#cb427-4" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb427-5"><a href="two-way-fixed-effects.html#cb427-5" tabindex="-1"></a>        <span class="at">x =</span> weight,</span>
<span id="cb427-6"><a href="two-way-fixed-effects.html#cb427-6" tabindex="-1"></a>        <span class="at">y =</span> estimate,</span>
<span id="cb427-7"><a href="two-way-fixed-effects.html#cb427-7" tabindex="-1"></a>        <span class="co"># shape = factor(type),</span></span>
<span id="cb427-8"><a href="two-way-fixed-effects.html#cb427-8" tabindex="-1"></a>        <span class="at">color =</span> type</span>
<span id="cb427-9"><a href="two-way-fixed-effects.html#cb427-9" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb427-10"><a href="two-way-fixed-effects.html#cb427-10" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Weight&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">shape =</span> <span class="st">&quot;Type&quot;</span>) <span class="sc">+</span></span>
<span id="cb427-11"><a href="two-way-fixed-effects.html#cb427-11" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb427-12"><a href="two-way-fixed-effects.html#cb427-12" tabindex="-1"></a>    causalverse<span class="sc">::</span><span class="fu">ama_theme</span>()</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-12-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>With time-varying controls that can identify variation within-treatment timing group, the”early vs. late” and “late vs. early” estimates collapse to just one estimate (i.e., both treated).</p>
</div>
<div id="did-with-in-and-out-treatment-condition" class="section level4 hasAnchor" number="26.3.2.3">
<h4><span class="header-section-number">26.3.2.3</span> DID with in and out treatment condition<a href="two-way-fixed-effects.html#did-with-in-and-out-treatment-condition" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="citation">Imai and Kim (<a href="#ref-imai2021use">2021</a>)</span></p>
<p>This case generalizes the staggered adoption setting, allowing units to vary in treatment over time. For <span class="math inline">\(N\)</span> units across <span class="math inline">\(T\)</span> time periods (with potentially unbalanced panels), let <span class="math inline">\(X_{it}\)</span> represent treatment and <span class="math inline">\(Y_{it}\)</span> the outcome for unit <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span>. We use the two-way linear fixed effects model:</p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \gamma_t + \beta X_{it} + \epsilon_{it}
\]</span></p>
<p>for <span class="math inline">\(i = 1, \dots, N\)</span> and <span class="math inline">\(t = 1, \dots, T\)</span>. Here, <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\gamma_t\)</span> are unit and time fixed effects. They capture time-invariant unit-specific and unit-invariant time-specific unobserved confounders, respectively. We can express these as <span class="math inline">\(\alpha_i = h(\mathbf{U}_i)\)</span> and <span class="math inline">\(\gamma_t = f(\mathbf{V}_t)\)</span>, with <span class="math inline">\(\mathbf{U}_i\)</span> and <span class="math inline">\(\mathbf{V}_t\)</span> being the confounders. The model doesn’t assume a specific form for <span class="math inline">\(h(.)\)</span> and <span class="math inline">\(f(.)\)</span>, but that they’re additive and separable given binary treatment.</p>
<p>The least squares estimate of <span class="math inline">\(\beta\)</span> leverages the covariance in outcome and treatment <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021, 406</a>)</span>. Specifically, it uses the within-unit and within-time variations. Many researchers prefer the two fixed effects (2FE) estimator because it adjusts for both types of unobserved confounders without specific functional-form assumptions, but this is wrong <span class="citation">(<a href="#ref-imai2019should">Imai and Kim 2019</a>)</span>. We do need functional-form assumption (i.e., linearity assumption) for the 2FE to work <span class="citation">(<a href="#ref-imai2021use">Imai and Kim 2021, 406</a>)</span></p>
<ul>
<li><p><strong>Two-Way Matching Estimator</strong>:</p>
<ul>
<li><p>It can lead to mismatches; units with the same treatment status get matched when estimating counterfactual outcomes.</p></li>
<li><p>Observations need to be matched with opposite treatment status for correct causal effects estimation.</p></li>
<li><p>Mismatches can cause attenuation bias.</p></li>
<li><p>The 2FE estimator adjusts for this bias using the factor <span class="math inline">\(K\)</span>, which represents the net proportion of proper matches between observations with opposite treatment status.</p></li>
</ul></li>
<li><p><strong>Weighting in 2FE</strong>:</p>
<ul>
<li><p>Observation <span class="math inline">\((i,t)\)</span> is weighted based on how often it acts as a control unit.</p></li>
<li><p>The weighted 2FE estimator still has mismatches, but fewer than the standard 2FE estimator.</p></li>
<li><p>Adjustments are made based on observations that neither belong to the same unit nor the same time period as the matched observation.</p></li>
<li><p>This means there are challenges in adjusting for unit-specific and time-specific unobserved confounders under the two-way fixed effect framework.</p></li>
</ul></li>
<li><p><strong>Equivalence &amp; Assumptions</strong>:</p>
<ul>
<li><p>Equivalence between the 2FE estimator and the DID estimator is dependent on the linearity assumption.</p></li>
<li><p>The multi-period DiD estimator is described as an average of two-time-period, two-group DiD estimators applied during changes from control to treatment.</p></li>
</ul></li>
<li><p><strong>Comparison with DiD</strong>:</p>
<ul>
<li><p>In simple settings (two time periods, treatment given to one group in the second period), the standard nonparametric DiD estimator equals the 2FE estimator.</p></li>
<li><p>This doesn’t hold in multi-period DiD designs where units change treatment status multiple times at different intervals.</p></li>
<li><p>Contrary to popular belief, the unweighted 2FE estimator isn’t generally equivalent to the multi-period DiD estimator.</p></li>
<li><p>While the multi-period DiD can be equivalent to the weighted 2FE, some control observations may have negative regression weights.</p></li>
</ul></li>
<li><p><strong>Conclusion</strong>:</p>
<ul>
<li>Justifying the 2FE estimator as the DID estimator isn’t warranted without imposing the linearity assumption.</li>
</ul></li>
</ul>
<p><strong>Application <span class="citation">(<a href="#ref-imai2021matching">Imai, Kim, and Wang 2021</a>)</span></strong></p>
<ul>
<li><p><strong>Matching Methods</strong>:</p>
<ul>
<li><p>Enhance the validity of causal inference.</p></li>
<li><p>Reduce model dependence and provide intuitive diagnostics <span class="citation">(<a href="#ref-ho2007matching">Ho et al. 2007</a>)</span></p></li>
<li><p>Rarely utilized in analyzing time series cross-sectional data.</p></li>
<li><p>The proposed matching estimators are more robust than the standard two-way fixed effects estimator, which can be biased if mis-specified</p></li>
<li><p>Better than synthetic controls (e.g., <span class="citation">(<a href="#ref-xu2017generalized">Xu 2017</a>)</span>) because it needs less data to achieve good performance and and adapt the the context of unit switching treatment status multiple times.</p></li>
</ul></li>
<li><p>Notes:</p>
<ul>
<li>Potential carryover effects (treatment may have a long-term effect), leading to post-treatment bias.</li>
</ul></li>
<li><p><strong>Proposed Approach</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Treated observations are matched with control observations from other units in the same time period with the same treatment history up to a specified number of lags.</p></li>
<li><p>Standard matching and weighting techniques are employed to further refine the matched set.</p></li>
<li><p>Apply a DiD estimator to adjust for time trend.</p></li>
<li><p>The goal is to have treated and matched control observations with similar covariate values.</p></li>
</ol></li>
<li><p><strong>Assessment</strong>:</p>
<ul>
<li>The quality of matches is evaluated through covariate balancing.</li>
</ul></li>
<li><p><strong>Estimation</strong>:</p>
<ul>
<li>Both short-term and long-term average treatment effects on the treated (ATT) are estimated.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="two-way-fixed-effects.html#cb428-1" tabindex="-1"></a><span class="fu">library</span>(PanelMatch)</span></code></pre></div>
<p><strong>Treatment Variation plot</strong></p>
<ul>
<li><p>Visualize the variation of the treatment across space and time</p></li>
<li><p>Aids in discerning whether the treatment fluctuates adequately over time and units or if the variation is primarily clustered in a subset of data.</p></li>
</ul>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="two-way-fixed-effects.html#cb429-1" tabindex="-1"></a><span class="fu">DisplayTreatment</span>(</span>
<span id="cb429-2"><a href="two-way-fixed-effects.html#cb429-2" tabindex="-1"></a>    <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb429-3"><a href="two-way-fixed-effects.html#cb429-3" tabindex="-1"></a>    <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb429-4"><a href="two-way-fixed-effects.html#cb429-4" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb429-5"><a href="two-way-fixed-effects.html#cb429-5" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb429-6"><a href="two-way-fixed-effects.html#cb429-6" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Country Code&quot;</span>,</span>
<span id="cb429-7"><a href="two-way-fixed-effects.html#cb429-7" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb429-8"><a href="two-way-fixed-effects.html#cb429-8" tabindex="-1"></a>    </span>
<span id="cb429-9"><a href="two-way-fixed-effects.html#cb429-9" tabindex="-1"></a>    <span class="at">hide.x.tick.label =</span> <span class="cn">TRUE</span>, <span class="at">hide.y.tick.label =</span> <span class="cn">TRUE</span>, </span>
<span id="cb429-10"><a href="two-way-fixed-effects.html#cb429-10" tabindex="-1"></a>    <span class="co"># dense.plot = TRUE,</span></span>
<span id="cb429-11"><a href="two-way-fixed-effects.html#cb429-11" tabindex="-1"></a>    <span class="at">data =</span> dem</span>
<span id="cb429-12"><a href="two-way-fixed-effects.html#cb429-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-14-1.png" width="90%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>Select <span class="math inline">\(F\)</span> (i.e., the number of leads - time periods after treatment). Driven by what authors are interested in estimating:</li>
</ol>
<ul>
<li><p><span class="math inline">\(F = 0\)</span> is the contemporaneous effect (short-term effect)</p></li>
<li><p><span class="math inline">\(F = n\)</span> is the the treatment effect on the outcome two time periods after the treatment. (cumulative or long-term effect)</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Select <span class="math inline">\(L\)</span> (number of lags to adjust).</li>
</ol>
<ul>
<li><p>Driven by the identification assumption.</p></li>
<li><p>Balances bias-variance tradeoff.</p></li>
<li><p>Higher <span class="math inline">\(L\)</span> values increase credibility but reduce efficiency by limiting potential matches.</p></li>
</ul>
<p><strong>Model assumption</strong>:</p>
<ul>
<li><p>No spillover effect assumed.</p></li>
<li><p>Carryover effect allowed up to <span class="math inline">\(L\)</span> periods.</p></li>
<li><p>Potential outcome for a unit depends neither on others’ treatment status nor on its past treatment after <span class="math inline">\(L\)</span> periods.</p></li>
</ul>
<p>After defining causal quantity with parameters <span class="math inline">\(L\)</span> and <span class="math inline">\(F\)</span>.</p>
<ul>
<li>Focus on the average treatment effect of treatment status change.</li>
<li><span class="math inline">\(\delta(F,L)\)</span> is the average causal effect of treatment change (ATT), <span class="math inline">\(F\)</span> periods post-treatment, considering treatment history up to <span class="math inline">\(L\)</span> periods.</li>
<li>Causal quantity considers potential future treatment reversals, meaning treatment could revert to control before outcome measurement.</li>
</ul>
<p>Also possible to estimate the average treatment effect of treatment reversal on the reversed (ART).</p>
<p>Choose <span class="math inline">\(L,F\)</span> based on specific needs.</p>
<ul>
<li><p>A large <span class="math inline">\(L\)</span> value:</p>
<ul>
<li><p>Increases the credibility of the limited carryover effect assumption.</p></li>
<li><p>Allows more past treatments (up to <span class="math inline">\(t−L\)</span>) to influence the outcome <span class="math inline">\(Y_{i,t+F}\)</span>.</p></li>
<li><p>Might reduce the number of matches and lead to less precise estimates.</p></li>
</ul></li>
<li><p>Selecting an appropriate number of lags</p>
<ul>
<li><p>Researchers should base this choice on substantive knowledge.</p></li>
<li><p>Sensitivity of empirical results to this choice should be examined.</p></li>
</ul></li>
<li><p>The choice of <span class="math inline">\(F\)</span> should be:</p>
<ul>
<li><p>Substantively motivated.</p></li>
<li><p>Decides whether the interest lies in short-term or long-term causal effects.</p></li>
<li><p>A large <span class="math inline">\(F\)</span> value can complicate causal effect interpretation, especially if many units switch treatment status during the <span class="math inline">\(F\)</span> lead time period.</p></li>
</ul></li>
</ul>
<p><strong>Identification Assumption</strong></p>
<ul>
<li><p>Parallel trend assumption conditioned on treatment, outcome (excluding immediate lag), and covariate histories.</p></li>
<li><p>Doesn’t require strong unconfoundedness assumption.</p></li>
<li><p>Cannot account for unobserved time-varying confounders.</p></li>
<li><p>Essential to examine outcome time trends.</p>
<ul>
<li>Check if they’re parallel between treated and matched control units using pre-treatment data</li>
</ul></li>
<li><p><strong>Constructing the Matched Sets</strong>:</p>
<ul>
<li><p>For each treated observation, create matched control units with identical treatment history from <span class="math inline">\(t−L\)</span> to <span class="math inline">\(t−1\)</span>.</p></li>
<li><p>Matching based on treatment history helps control for carryover effects.</p></li>
<li><p>Past treatments often act as major confounders, but this method can correct for it.</p></li>
<li><p>Exact matching on time period adjusts for time-specific unobserved confounders.</p></li>
<li><p>Unlike staggered adoption methods, units can change treatment status multiple times.</p></li>
<li><p>Matched set allows treatment switching in and out of treatment</p></li>
</ul></li>
<li><p><strong>Refining the Matched Sets</strong>:</p>
<ul>
<li><p>Initially, matched sets adjust only for treatment history.</p></li>
<li><p>Parallel trend assumption requires adjustments for other confounders like past outcomes and covariates.</p></li>
<li><p>Matching methods:</p>
<ul>
<li><p>Match each treated observation with up to <span class="math inline">\(J\)</span> control units.</p></li>
<li><p>Distance measures like Mahalanobis distance or propensity score can be used.</p></li>
<li><p>Match based on estimated propensity score, considering pretreatment covariates.</p></li>
<li><p>Refined matched set selects most similar control units based on observed confounders.</p></li>
</ul></li>
<li><p>Weighting methods:</p>
<ul>
<li><p>Assign weight to each control unit in a matched set.</p></li>
<li><p>Weights prioritize more similar units.</p></li>
<li><p>Inverse propensity score weighting method can be applied.</p></li>
<li><p>Weighting is a more generalized method than matching.</p></li>
</ul></li>
</ul></li>
</ul>
<p><strong>The Difference-in-Differences Estimator</strong>:</p>
<ul>
<li><p>Using refined matched sets, the ATT (Average Treatment Effect on the Treated) of policy change is estimated.</p></li>
<li><p>For each treated observation, estimate the counterfactual outcome using the weighted average of control units in the refined set.</p></li>
<li><p>The DiD estimate of the ATT is computed for each treated observation, then averaged across all such observations.</p></li>
<li><p>For noncontemporaneous treatment effects where <span class="math inline">\(F &gt; 0\)</span>:</p>
<ul>
<li><p>The ATT doesn’t specify future treatment sequence.</p></li>
<li><p>Matched control units might have units receiving treatment between time <span class="math inline">\(t\)</span> and <span class="math inline">\(t + F\)</span>.</p></li>
<li><p>Some treated units could return to control conditions between these times.</p></li>
</ul></li>
</ul>
<p><strong>Checking Covariate Balance</strong>:</p>
<ul>
<li><p>The proposed methodology offers the advantage of checking covariate balance between treated and matched control observations.</p></li>
<li><p>This check helps to see if treated and matched control observations are comparable with respect to observed confounders.</p></li>
<li><p>Once matched sets are refined, covariate balance examination becomes straightforward.</p></li>
<li><p>Examine the mean difference of each covariate between a treated observation and its matched controls for each pretreatment time period.</p></li>
<li><p>Standardize this difference using the standard deviation of each covariate across all treated observations in the dataset.</p></li>
<li><p>Aggregate this covariate balance measure across all treated observations for each covariate and pretreatment time period.</p></li>
<li><p>Examine balance for lagged outcome variables over multiple pretreatment periods and time-varying covariates.</p>
<ul>
<li>This helps evaluate the validity of the parallel trend assumption underlying the proposed DiD estimator.</li>
</ul></li>
</ul>
<p><strong>Relations with Linear Fixed Effects Regression Estimators</strong>:</p>
<ul>
<li><p>The standard DiD estimator is equivalent to the linear two-way fixed effects regression estimator when:</p>
<ul>
<li><p>Only two time periods exist.</p></li>
<li><p>Treatment is given to some units exclusively in the second period.</p></li>
</ul></li>
<li><p>This equivalence doesn’t extend to multiperiod DiD designs, where:</p>
<ul>
<li><p>More than two time periods are considered.</p></li>
<li><p>Units might receive treatment multiple times.</p></li>
</ul></li>
<li><p>Despite this, many researchers relate the use of the two-way fixed effects estimator to the DiD design.</p></li>
</ul>
<p><strong>Standard Error Calculation</strong>:</p>
<ul>
<li><p>Approach:</p>
<ul>
<li><p>Condition on the weights implied by the matching process.</p></li>
<li><p>These weights denote how often an observation is utilized in matching <span class="citation">(<a href="#ref-imbens2015causal">G. W. Imbens and Rubin 2015</a>)</span></p></li>
</ul></li>
<li><p>Context:</p>
<ul>
<li><p>Analogous to the conditional variance seen in regression models.</p></li>
<li><p>Resulting standard errors don’t factor in uncertainties around the matching procedure.</p></li>
<li><p>They can be viewed as a measure of uncertainty conditional upon the matching process <span class="citation">(<a href="#ref-ho2007matching">Ho et al. 2007</a>)</span>.</p></li>
</ul></li>
</ul>
<p><strong>Key Findings</strong>:</p>
<ul>
<li><p>Even in conditions favoring OLS, the proposed matching estimator displayed higher robustness to omitted relevant lags than the linear regression model with fixed effects.</p></li>
<li><p>The robustness offered by matching came at a cost - reduced statistical power.</p></li>
<li><p>This emphasizes the classic statistical tradeoff between bias (where matching has an advantage) and variance (where regression models might be more efficient).</p></li>
</ul>
<p><strong>Data Requirements</strong></p>
<ul>
<li><p>The treatment variable is binary:</p>
<ul>
<li><p>0 signifies “assignment” to control.</p></li>
<li><p>1 signifies assignment to treatment.</p></li>
</ul></li>
<li><p>Variables identifying units in the data must be: Numeric or integer.</p></li>
<li><p>Variables identifying time periods should be: Consecutive numeric/integer data.</p></li>
<li><p>Data format requirement: Must be provided as a standard <code>data.frame</code> object.</p></li>
</ul>
<p>Basic functions:</p>
<ol style="list-style-type: decimal">
<li><p>Utilize treatment histories to create matching sets of treated and control units.</p></li>
<li><p>Refine these matched sets by determining weights for each control unit in the set.</p>
<ul>
<li>Units with higher weights have a larger influence during estimations.</li>
</ul></li>
</ol>
<p><strong>Matching on Treatment History</strong>:</p>
<ul>
<li><p>Goal is to match units transitioning from untreated to treated status with control units that have similar past treatment histories.</p></li>
<li><p>Setting the Quantity of Interest (<code>qoi =</code>)</p>
<ul>
<li><p><code>att</code> average treatment effect on treated units</p></li>
<li><p><code>atc</code> average treatment effect of treatment on the control units</p></li>
<li><p><code>art</code> average effect of treatment reversal for units that experience treatment reversal</p></li>
<li><p><code>ate</code> average treatment effect</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="two-way-fixed-effects.html#cb430-1" tabindex="-1"></a><span class="co"># All examples follow the package&#39;s vignette</span></span>
<span id="cb430-2"><a href="two-way-fixed-effects.html#cb430-2" tabindex="-1"></a><span class="co"># Create the matched sets</span></span>
<span id="cb430-3"><a href="two-way-fixed-effects.html#cb430-3" tabindex="-1"></a>PM.results.none <span class="ot">&lt;-</span></span>
<span id="cb430-4"><a href="two-way-fixed-effects.html#cb430-4" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb430-5"><a href="two-way-fixed-effects.html#cb430-5" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb430-6"><a href="two-way-fixed-effects.html#cb430-6" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb430-7"><a href="two-way-fixed-effects.html#cb430-7" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb430-8"><a href="two-way-fixed-effects.html#cb430-8" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb430-9"><a href="two-way-fixed-effects.html#cb430-9" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb430-10"><a href="two-way-fixed-effects.html#cb430-10" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb430-11"><a href="two-way-fixed-effects.html#cb430-11" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">TRUE</span>,</span>
<span id="cb430-12"><a href="two-way-fixed-effects.html#cb430-12" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb430-13"><a href="two-way-fixed-effects.html#cb430-13" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb430-14"><a href="two-way-fixed-effects.html#cb430-14" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb430-15"><a href="two-way-fixed-effects.html#cb430-15" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb430-16"><a href="two-way-fixed-effects.html#cb430-16" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb430-17"><a href="two-way-fixed-effects.html#cb430-17" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb430-18"><a href="two-way-fixed-effects.html#cb430-18" tabindex="-1"></a>    )</span>
<span id="cb430-19"><a href="two-way-fixed-effects.html#cb430-19" tabindex="-1"></a></span>
<span id="cb430-20"><a href="two-way-fixed-effects.html#cb430-20" tabindex="-1"></a><span class="co"># visualize the treated unit and matched controls</span></span>
<span id="cb430-21"><a href="two-way-fixed-effects.html#cb430-21" tabindex="-1"></a><span class="fu">DisplayTreatment</span>(</span>
<span id="cb430-22"><a href="two-way-fixed-effects.html#cb430-22" tabindex="-1"></a>    <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb430-23"><a href="two-way-fixed-effects.html#cb430-23" tabindex="-1"></a>    <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb430-24"><a href="two-way-fixed-effects.html#cb430-24" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb430-25"><a href="two-way-fixed-effects.html#cb430-25" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb430-26"><a href="two-way-fixed-effects.html#cb430-26" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Country Code&quot;</span>,</span>
<span id="cb430-27"><a href="two-way-fixed-effects.html#cb430-27" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb430-28"><a href="two-way-fixed-effects.html#cb430-28" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb430-29"><a href="two-way-fixed-effects.html#cb430-29" tabindex="-1"></a>    <span class="at">matched.set =</span> PM.results.none<span class="sc">$</span>att[<span class="dv">1</span>],</span>
<span id="cb430-30"><a href="two-way-fixed-effects.html#cb430-30" tabindex="-1"></a>    <span class="co"># highlight the particular set</span></span>
<span id="cb430-31"><a href="two-way-fixed-effects.html#cb430-31" tabindex="-1"></a>    <span class="at">show.set.only =</span> <span class="cn">TRUE</span></span>
<span id="cb430-32"><a href="two-way-fixed-effects.html#cb430-32" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-15-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Control units and the treated unit have identical treatment histories over the lag window (1988-1991)</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="two-way-fixed-effects.html#cb431-1" tabindex="-1"></a><span class="fu">DisplayTreatment</span>(</span>
<span id="cb431-2"><a href="two-way-fixed-effects.html#cb431-2" tabindex="-1"></a>    <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb431-3"><a href="two-way-fixed-effects.html#cb431-3" tabindex="-1"></a>    <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb431-4"><a href="two-way-fixed-effects.html#cb431-4" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb431-5"><a href="two-way-fixed-effects.html#cb431-5" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb431-6"><a href="two-way-fixed-effects.html#cb431-6" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Country Code&quot;</span>,</span>
<span id="cb431-7"><a href="two-way-fixed-effects.html#cb431-7" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb431-8"><a href="two-way-fixed-effects.html#cb431-8" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb431-9"><a href="two-way-fixed-effects.html#cb431-9" tabindex="-1"></a>    <span class="at">matched.set =</span> PM.results.none<span class="sc">$</span>att[<span class="dv">2</span>],</span>
<span id="cb431-10"><a href="two-way-fixed-effects.html#cb431-10" tabindex="-1"></a>    <span class="co"># highlight the particular set</span></span>
<span id="cb431-11"><a href="two-way-fixed-effects.html#cb431-11" tabindex="-1"></a>    <span class="at">show.set.only =</span> <span class="cn">TRUE</span></span>
<span id="cb431-12"><a href="two-way-fixed-effects.html#cb431-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-16-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>This set is more limited than the first one, but we can still see that we have exact past histories.</p>
<ul>
<li><p><strong>Refining Matched Sets</strong></p>
<ul>
<li><p>Refinement involves assigning weights to control units.</p></li>
<li><p>Users must:</p>
<ol style="list-style-type: decimal">
<li><p>Specify a method for calculating unit similarity/distance.</p></li>
<li><p>Choose variables for similarity/distance calculations.</p></li>
</ol></li>
</ul></li>
<li><p><strong>Select a Refinement Method</strong></p>
<ul>
<li><p>Users determine the refinement method via the <strong><code>refinement.method</code></strong> argument.</p></li>
<li><p>Options include:</p>
<ul>
<li><p><code>mahalanobis</code></p></li>
<li><p><code>ps.match</code></p></li>
<li><p><code>CBPS.match</code></p></li>
<li><p><code>ps.weight</code></p></li>
<li><p><code>CBPS.weight</code></p></li>
<li><p><code>ps.msm.weight</code></p></li>
<li><p><code>CBPS.msm.weight</code></p></li>
<li><p><code>none</code></p></li>
</ul></li>
<li><p>Methods with “match” in the name and Mahalanobis will assign equal weights to similar control units.</p></li>
<li><p>“Weighting” methods give higher weights to control units more similar to treated units.</p></li>
</ul></li>
<li><p><strong>Variable Selection</strong></p>
<ul>
<li><p>Users need to define which covariates will be used through the <strong><code>covs.formula</code></strong> argument, a one-sided formula object.</p></li>
<li><p>Variables on the right side of the formula are used for calculations.</p></li>
<li><p>“Lagged” versions of variables can be included using the format: <strong><code>I(lag(name.of.var, 0:n))</code></strong>.</p></li>
</ul></li>
<li><p><strong>Understanding <code>PanelMatch</code> and <code>matched.set</code> objects</strong></p>
<ul>
<li><p>The <strong><code>PanelMatch</code> function</strong> returns a <strong><code>PanelMatch</code> object</strong>.</p></li>
<li><p>The most crucial element within the <code>PanelMatch</code> object is the <strong>matched.set object</strong>.</p></li>
<li><p>Within the <code>PanelMatch</code> object, the matched.set object will have names like att, art, or atc.</p></li>
<li><p>If <strong><code>qoi = ate</code></strong>, there will be two matched.set objects: att and atc.</p></li>
</ul></li>
<li><p><strong>Matched.set Object Details</strong></p>
<ul>
<li><p>matched.set is a named list with added attributes.</p></li>
<li><p>Attributes include:</p>
<ul>
<li><p>Lag</p></li>
<li><p>Names of treatment</p></li>
<li><p>Unit and time variables</p></li>
</ul></li>
<li><p>Each list entry represents a matched set of treated and control units.</p></li>
<li><p>Naming follows a structure: <strong><code>[id variable].[time variable]</code></strong>.</p></li>
<li><p>Each list element is a vector of control unit ids that match the treated unit mentioned in the element name.</p></li>
<li><p>Since it’s a matching method, weights are only given to the <strong><code>size.match</code></strong> most similar control units based on distance calculations.</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="two-way-fixed-effects.html#cb432-1" tabindex="-1"></a><span class="co"># PanelMatch without any refinement</span></span>
<span id="cb432-2"><a href="two-way-fixed-effects.html#cb432-2" tabindex="-1"></a>PM.results.none <span class="ot">&lt;-</span></span>
<span id="cb432-3"><a href="two-way-fixed-effects.html#cb432-3" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb432-4"><a href="two-way-fixed-effects.html#cb432-4" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb432-5"><a href="two-way-fixed-effects.html#cb432-5" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb432-6"><a href="two-way-fixed-effects.html#cb432-6" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb432-7"><a href="two-way-fixed-effects.html#cb432-7" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb432-8"><a href="two-way-fixed-effects.html#cb432-8" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb432-9"><a href="two-way-fixed-effects.html#cb432-9" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb432-10"><a href="two-way-fixed-effects.html#cb432-10" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">TRUE</span>,</span>
<span id="cb432-11"><a href="two-way-fixed-effects.html#cb432-11" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb432-12"><a href="two-way-fixed-effects.html#cb432-12" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb432-13"><a href="two-way-fixed-effects.html#cb432-13" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb432-14"><a href="two-way-fixed-effects.html#cb432-14" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb432-15"><a href="two-way-fixed-effects.html#cb432-15" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb432-16"><a href="two-way-fixed-effects.html#cb432-16" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb432-17"><a href="two-way-fixed-effects.html#cb432-17" tabindex="-1"></a>    )</span>
<span id="cb432-18"><a href="two-way-fixed-effects.html#cb432-18" tabindex="-1"></a></span>
<span id="cb432-19"><a href="two-way-fixed-effects.html#cb432-19" tabindex="-1"></a><span class="co"># Extract the matched.set object</span></span>
<span id="cb432-20"><a href="two-way-fixed-effects.html#cb432-20" tabindex="-1"></a>msets.none <span class="ot">&lt;-</span> PM.results.none<span class="sc">$</span>att</span>
<span id="cb432-21"><a href="two-way-fixed-effects.html#cb432-21" tabindex="-1"></a></span>
<span id="cb432-22"><a href="two-way-fixed-effects.html#cb432-22" tabindex="-1"></a><span class="co"># PanelMatch with refinement</span></span>
<span id="cb432-23"><a href="two-way-fixed-effects.html#cb432-23" tabindex="-1"></a>PM.results.maha <span class="ot">&lt;-</span></span>
<span id="cb432-24"><a href="two-way-fixed-effects.html#cb432-24" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb432-25"><a href="two-way-fixed-effects.html#cb432-25" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb432-26"><a href="two-way-fixed-effects.html#cb432-26" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb432-27"><a href="two-way-fixed-effects.html#cb432-27" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb432-28"><a href="two-way-fixed-effects.html#cb432-28" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb432-29"><a href="two-way-fixed-effects.html#cb432-29" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;mahalanobis&quot;</span>, <span class="co"># use Mahalanobis distance</span></span>
<span id="cb432-30"><a href="two-way-fixed-effects.html#cb432-30" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb432-31"><a href="two-way-fixed-effects.html#cb432-31" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">TRUE</span>,</span>
<span id="cb432-32"><a href="two-way-fixed-effects.html#cb432-32" tabindex="-1"></a>        <span class="at">covs.formula =</span> <span class="sc">~</span> tradewb,</span>
<span id="cb432-33"><a href="two-way-fixed-effects.html#cb432-33" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb432-34"><a href="two-way-fixed-effects.html#cb432-34" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span> ,</span>
<span id="cb432-35"><a href="two-way-fixed-effects.html#cb432-35" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb432-36"><a href="two-way-fixed-effects.html#cb432-36" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb432-37"><a href="two-way-fixed-effects.html#cb432-37" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb432-38"><a href="two-way-fixed-effects.html#cb432-38" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb432-39"><a href="two-way-fixed-effects.html#cb432-39" tabindex="-1"></a>    )</span>
<span id="cb432-40"><a href="two-way-fixed-effects.html#cb432-40" tabindex="-1"></a>msets.maha <span class="ot">&lt;-</span> PM.results.maha<span class="sc">$</span>att</span></code></pre></div>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="two-way-fixed-effects.html#cb433-1" tabindex="-1"></a><span class="co"># these 2 should be identical because weights are not shown</span></span>
<span id="cb433-2"><a href="two-way-fixed-effects.html#cb433-2" tabindex="-1"></a>msets.none <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb433-3"><a href="two-way-fixed-effects.html#cb433-3" tabindex="-1"></a><span class="co">#&gt;   wbcode2 year matched.set.size</span></span>
<span id="cb433-4"><a href="two-way-fixed-effects.html#cb433-4" tabindex="-1"></a><span class="co">#&gt; 1       4 1992               74</span></span>
<span id="cb433-5"><a href="two-way-fixed-effects.html#cb433-5" tabindex="-1"></a><span class="co">#&gt; 2       4 1997                2</span></span>
<span id="cb433-6"><a href="two-way-fixed-effects.html#cb433-6" tabindex="-1"></a><span class="co">#&gt; 3       6 1973               63</span></span>
<span id="cb433-7"><a href="two-way-fixed-effects.html#cb433-7" tabindex="-1"></a><span class="co">#&gt; 4       6 1983               73</span></span>
<span id="cb433-8"><a href="two-way-fixed-effects.html#cb433-8" tabindex="-1"></a><span class="co">#&gt; 5       7 1991               81</span></span>
<span id="cb433-9"><a href="two-way-fixed-effects.html#cb433-9" tabindex="-1"></a><span class="co">#&gt; 6       7 1998                1</span></span>
<span id="cb433-10"><a href="two-way-fixed-effects.html#cb433-10" tabindex="-1"></a>msets.maha <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb433-11"><a href="two-way-fixed-effects.html#cb433-11" tabindex="-1"></a><span class="co">#&gt;   wbcode2 year matched.set.size</span></span>
<span id="cb433-12"><a href="two-way-fixed-effects.html#cb433-12" tabindex="-1"></a><span class="co">#&gt; 1       4 1992               74</span></span>
<span id="cb433-13"><a href="two-way-fixed-effects.html#cb433-13" tabindex="-1"></a><span class="co">#&gt; 2       4 1997                2</span></span>
<span id="cb433-14"><a href="two-way-fixed-effects.html#cb433-14" tabindex="-1"></a><span class="co">#&gt; 3       6 1973               63</span></span>
<span id="cb433-15"><a href="two-way-fixed-effects.html#cb433-15" tabindex="-1"></a><span class="co">#&gt; 4       6 1983               73</span></span>
<span id="cb433-16"><a href="two-way-fixed-effects.html#cb433-16" tabindex="-1"></a><span class="co">#&gt; 5       7 1991               81</span></span>
<span id="cb433-17"><a href="two-way-fixed-effects.html#cb433-17" tabindex="-1"></a><span class="co">#&gt; 6       7 1998                1</span></span>
<span id="cb433-18"><a href="two-way-fixed-effects.html#cb433-18" tabindex="-1"></a><span class="co"># summary(msets.none)</span></span>
<span id="cb433-19"><a href="two-way-fixed-effects.html#cb433-19" tabindex="-1"></a><span class="co"># summary(msets.maha)</span></span></code></pre></div>
<p><strong>Visualizing Matched Sets with the plot method</strong></p>
<ul>
<li><p>Users can visualize the distribution of the matched set sizes.</p></li>
<li><p>A red line, by default, indicates the count of matched sets where treated units had no matching control units (i.e., empty matched sets).</p></li>
<li><p>Plot adjustments can be made using <strong><code>graphics::plot</code></strong>.</p></li>
</ul>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="two-way-fixed-effects.html#cb434-1" tabindex="-1"></a><span class="fu">plot</span>(msets.none)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-19-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong>Comparing Methods of Refinement</strong></p>
<ul>
<li><p>Users are encouraged to:</p>
<ul>
<li><p>Use substantive knowledge for experimentation and evaluation.</p></li>
<li><p>Consider the following when configuring <code>PanelMatch</code>:</p>
<ol style="list-style-type: decimal">
<li><p>The number of matched sets.</p></li>
<li><p>The number of controls matched to each treated unit.</p></li>
<li><p>Achieving covariate balance.</p></li>
</ol></li>
<li><p><strong>Note</strong>: Large numbers of small matched sets can lead to larger standard errors during the estimation stage.</p></li>
<li><p>Covariates that aren’t well balanced can lead to undesirable comparisons between treated and control units.</p></li>
<li><p>Aspects to consider include:</p>
<ul>
<li><p>Refinement method.</p></li>
<li><p>Variables for weight calculation.</p></li>
<li><p>Size of the lag window.</p></li>
<li><p>Procedures for addressing missing data (refer to <strong><code>match.missing</code></strong> and <strong><code>listwise.delete</code></strong> arguments).</p></li>
<li><p>Maximum size of matched sets (for matching methods).</p></li>
</ul></li>
</ul></li>
<li><p><strong>Supportive Features:</strong></p>
<ul>
<li><p><strong><code>print</code></strong>, <strong><code>plot</code></strong>, and <strong><code>summary</code></strong> methods assist in understanding matched sets and their sizes.</p></li>
<li><p><strong><code>get_covariate_balance</code></strong> helps evaluate covariate balance:</p>
<ul>
<li>Lower values in the covariate balance calculations are preferred.</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="two-way-fixed-effects.html#cb435-1" tabindex="-1"></a>PM.results.none <span class="ot">&lt;-</span></span>
<span id="cb435-2"><a href="two-way-fixed-effects.html#cb435-2" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb435-3"><a href="two-way-fixed-effects.html#cb435-3" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb435-4"><a href="two-way-fixed-effects.html#cb435-4" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb435-5"><a href="two-way-fixed-effects.html#cb435-5" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb435-6"><a href="two-way-fixed-effects.html#cb435-6" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb435-7"><a href="two-way-fixed-effects.html#cb435-7" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb435-8"><a href="two-way-fixed-effects.html#cb435-8" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb435-9"><a href="two-way-fixed-effects.html#cb435-9" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">TRUE</span>,</span>
<span id="cb435-10"><a href="two-way-fixed-effects.html#cb435-10" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb435-11"><a href="two-way-fixed-effects.html#cb435-11" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb435-12"><a href="two-way-fixed-effects.html#cb435-12" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb435-13"><a href="two-way-fixed-effects.html#cb435-13" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb435-14"><a href="two-way-fixed-effects.html#cb435-14" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb435-15"><a href="two-way-fixed-effects.html#cb435-15" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb435-16"><a href="two-way-fixed-effects.html#cb435-16" tabindex="-1"></a>    )</span>
<span id="cb435-17"><a href="two-way-fixed-effects.html#cb435-17" tabindex="-1"></a>PM.results.maha <span class="ot">&lt;-</span></span>
<span id="cb435-18"><a href="two-way-fixed-effects.html#cb435-18" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb435-19"><a href="two-way-fixed-effects.html#cb435-19" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb435-20"><a href="two-way-fixed-effects.html#cb435-20" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb435-21"><a href="two-way-fixed-effects.html#cb435-21" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb435-22"><a href="two-way-fixed-effects.html#cb435-22" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb435-23"><a href="two-way-fixed-effects.html#cb435-23" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;mahalanobis&quot;</span>,</span>
<span id="cb435-24"><a href="two-way-fixed-effects.html#cb435-24" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb435-25"><a href="two-way-fixed-effects.html#cb435-25" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">TRUE</span>,</span>
<span id="cb435-26"><a href="two-way-fixed-effects.html#cb435-26" tabindex="-1"></a>        <span class="at">covs.formula =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb435-27"><a href="two-way-fixed-effects.html#cb435-27" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb435-28"><a href="two-way-fixed-effects.html#cb435-28" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb435-29"><a href="two-way-fixed-effects.html#cb435-29" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb435-30"><a href="two-way-fixed-effects.html#cb435-30" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb435-31"><a href="two-way-fixed-effects.html#cb435-31" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb435-32"><a href="two-way-fixed-effects.html#cb435-32" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb435-33"><a href="two-way-fixed-effects.html#cb435-33" tabindex="-1"></a>    )</span>
<span id="cb435-34"><a href="two-way-fixed-effects.html#cb435-34" tabindex="-1"></a></span>
<span id="cb435-35"><a href="two-way-fixed-effects.html#cb435-35" tabindex="-1"></a><span class="co"># listwise deletion used for missing data</span></span>
<span id="cb435-36"><a href="two-way-fixed-effects.html#cb435-36" tabindex="-1"></a>PM.results.listwise <span class="ot">&lt;-</span></span>
<span id="cb435-37"><a href="two-way-fixed-effects.html#cb435-37" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb435-38"><a href="two-way-fixed-effects.html#cb435-38" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb435-39"><a href="two-way-fixed-effects.html#cb435-39" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb435-40"><a href="two-way-fixed-effects.html#cb435-40" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb435-41"><a href="two-way-fixed-effects.html#cb435-41" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb435-42"><a href="two-way-fixed-effects.html#cb435-42" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;mahalanobis&quot;</span>,</span>
<span id="cb435-43"><a href="two-way-fixed-effects.html#cb435-43" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb435-44"><a href="two-way-fixed-effects.html#cb435-44" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">FALSE</span>,</span>
<span id="cb435-45"><a href="two-way-fixed-effects.html#cb435-45" tabindex="-1"></a>        <span class="at">listwise.delete =</span> <span class="cn">TRUE</span>,</span>
<span id="cb435-46"><a href="two-way-fixed-effects.html#cb435-46" tabindex="-1"></a>        <span class="at">covs.formula =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb435-47"><a href="two-way-fixed-effects.html#cb435-47" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb435-48"><a href="two-way-fixed-effects.html#cb435-48" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb435-49"><a href="two-way-fixed-effects.html#cb435-49" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb435-50"><a href="two-way-fixed-effects.html#cb435-50" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb435-51"><a href="two-way-fixed-effects.html#cb435-51" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb435-52"><a href="two-way-fixed-effects.html#cb435-52" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb435-53"><a href="two-way-fixed-effects.html#cb435-53" tabindex="-1"></a>    )</span>
<span id="cb435-54"><a href="two-way-fixed-effects.html#cb435-54" tabindex="-1"></a></span>
<span id="cb435-55"><a href="two-way-fixed-effects.html#cb435-55" tabindex="-1"></a><span class="co"># propensity score based weighting method</span></span>
<span id="cb435-56"><a href="two-way-fixed-effects.html#cb435-56" tabindex="-1"></a>PM.results.ps.weight <span class="ot">&lt;-</span></span>
<span id="cb435-57"><a href="two-way-fixed-effects.html#cb435-57" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb435-58"><a href="two-way-fixed-effects.html#cb435-58" tabindex="-1"></a>        <span class="at">lag =</span> <span class="dv">4</span>,</span>
<span id="cb435-59"><a href="two-way-fixed-effects.html#cb435-59" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb435-60"><a href="two-way-fixed-effects.html#cb435-60" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb435-61"><a href="two-way-fixed-effects.html#cb435-61" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb435-62"><a href="two-way-fixed-effects.html#cb435-62" tabindex="-1"></a>        <span class="at">refinement.method =</span> <span class="st">&quot;ps.weight&quot;</span>,</span>
<span id="cb435-63"><a href="two-way-fixed-effects.html#cb435-63" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb435-64"><a href="two-way-fixed-effects.html#cb435-64" tabindex="-1"></a>        <span class="at">match.missing =</span> <span class="cn">FALSE</span>,</span>
<span id="cb435-65"><a href="two-way-fixed-effects.html#cb435-65" tabindex="-1"></a>        <span class="at">listwise.delete =</span> <span class="cn">TRUE</span>,</span>
<span id="cb435-66"><a href="two-way-fixed-effects.html#cb435-66" tabindex="-1"></a>        <span class="at">covs.formula =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb435-67"><a href="two-way-fixed-effects.html#cb435-67" tabindex="-1"></a>        <span class="at">size.match =</span> <span class="dv">5</span>,</span>
<span id="cb435-68"><a href="two-way-fixed-effects.html#cb435-68" tabindex="-1"></a>        <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb435-69"><a href="two-way-fixed-effects.html#cb435-69" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb435-70"><a href="two-way-fixed-effects.html#cb435-70" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb435-71"><a href="two-way-fixed-effects.html#cb435-71" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span></span>
<span id="cb435-72"><a href="two-way-fixed-effects.html#cb435-72" tabindex="-1"></a>    )</span>
<span id="cb435-73"><a href="two-way-fixed-effects.html#cb435-73" tabindex="-1"></a></span>
<span id="cb435-74"><a href="two-way-fixed-effects.html#cb435-74" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb435-75"><a href="two-way-fixed-effects.html#cb435-75" tabindex="-1"></a>    PM.results.none<span class="sc">$</span>att,</span>
<span id="cb435-76"><a href="two-way-fixed-effects.html#cb435-76" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb435-77"><a href="two-way-fixed-effects.html#cb435-77" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb435-78"><a href="two-way-fixed-effects.html#cb435-78" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb435-79"><a href="two-way-fixed-effects.html#cb435-79" tabindex="-1"></a>)</span>
<span id="cb435-80"><a href="two-way-fixed-effects.html#cb435-80" tabindex="-1"></a><span class="co">#&gt;         tradewb            y</span></span>
<span id="cb435-81"><a href="two-way-fixed-effects.html#cb435-81" tabindex="-1"></a><span class="co">#&gt; t_4 -0.07245466  0.291871990</span></span>
<span id="cb435-82"><a href="two-way-fixed-effects.html#cb435-82" tabindex="-1"></a><span class="co">#&gt; t_3 -0.20930129  0.208654876</span></span>
<span id="cb435-83"><a href="two-way-fixed-effects.html#cb435-83" tabindex="-1"></a><span class="co">#&gt; t_2 -0.24425207  0.107736647</span></span>
<span id="cb435-84"><a href="two-way-fixed-effects.html#cb435-84" tabindex="-1"></a><span class="co">#&gt; t_1 -0.10806125 -0.004950238</span></span>
<span id="cb435-85"><a href="two-way-fixed-effects.html#cb435-85" tabindex="-1"></a></span>
<span id="cb435-86"><a href="two-way-fixed-effects.html#cb435-86" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb435-87"><a href="two-way-fixed-effects.html#cb435-87" tabindex="-1"></a>    PM.results.maha<span class="sc">$</span>att,</span>
<span id="cb435-88"><a href="two-way-fixed-effects.html#cb435-88" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb435-89"><a href="two-way-fixed-effects.html#cb435-89" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb435-90"><a href="two-way-fixed-effects.html#cb435-90" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb435-91"><a href="two-way-fixed-effects.html#cb435-91" tabindex="-1"></a>)</span>
<span id="cb435-92"><a href="two-way-fixed-effects.html#cb435-92" tabindex="-1"></a><span class="co">#&gt;         tradewb          y</span></span>
<span id="cb435-93"><a href="two-way-fixed-effects.html#cb435-93" tabindex="-1"></a><span class="co">#&gt; t_4  0.04558637 0.09701606</span></span>
<span id="cb435-94"><a href="two-way-fixed-effects.html#cb435-94" tabindex="-1"></a><span class="co">#&gt; t_3 -0.03312750 0.10844046</span></span>
<span id="cb435-95"><a href="two-way-fixed-effects.html#cb435-95" tabindex="-1"></a><span class="co">#&gt; t_2 -0.01396793 0.08890753</span></span>
<span id="cb435-96"><a href="two-way-fixed-effects.html#cb435-96" tabindex="-1"></a><span class="co">#&gt; t_1  0.10474894 0.06618865</span></span>
<span id="cb435-97"><a href="two-way-fixed-effects.html#cb435-97" tabindex="-1"></a></span>
<span id="cb435-98"><a href="two-way-fixed-effects.html#cb435-98" tabindex="-1"></a></span>
<span id="cb435-99"><a href="two-way-fixed-effects.html#cb435-99" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb435-100"><a href="two-way-fixed-effects.html#cb435-100" tabindex="-1"></a>    PM.results.listwise<span class="sc">$</span>att,</span>
<span id="cb435-101"><a href="two-way-fixed-effects.html#cb435-101" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb435-102"><a href="two-way-fixed-effects.html#cb435-102" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb435-103"><a href="two-way-fixed-effects.html#cb435-103" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb435-104"><a href="two-way-fixed-effects.html#cb435-104" tabindex="-1"></a>)</span>
<span id="cb435-105"><a href="two-way-fixed-effects.html#cb435-105" tabindex="-1"></a><span class="co">#&gt;         tradewb          y</span></span>
<span id="cb435-106"><a href="two-way-fixed-effects.html#cb435-106" tabindex="-1"></a><span class="co">#&gt; t_4  0.05634922 0.05223623</span></span>
<span id="cb435-107"><a href="two-way-fixed-effects.html#cb435-107" tabindex="-1"></a><span class="co">#&gt; t_3 -0.01104797 0.05217896</span></span>
<span id="cb435-108"><a href="two-way-fixed-effects.html#cb435-108" tabindex="-1"></a><span class="co">#&gt; t_2  0.01411473 0.03094133</span></span>
<span id="cb435-109"><a href="two-way-fixed-effects.html#cb435-109" tabindex="-1"></a><span class="co">#&gt; t_1  0.06850180 0.02092209</span></span>
<span id="cb435-110"><a href="two-way-fixed-effects.html#cb435-110" tabindex="-1"></a></span>
<span id="cb435-111"><a href="two-way-fixed-effects.html#cb435-111" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb435-112"><a href="two-way-fixed-effects.html#cb435-112" tabindex="-1"></a>    PM.results.ps.weight<span class="sc">$</span>att,</span>
<span id="cb435-113"><a href="two-way-fixed-effects.html#cb435-113" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb435-114"><a href="two-way-fixed-effects.html#cb435-114" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb435-115"><a href="two-way-fixed-effects.html#cb435-115" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb435-116"><a href="two-way-fixed-effects.html#cb435-116" tabindex="-1"></a>)</span>
<span id="cb435-117"><a href="two-way-fixed-effects.html#cb435-117" tabindex="-1"></a><span class="co">#&gt;         tradewb          y</span></span>
<span id="cb435-118"><a href="two-way-fixed-effects.html#cb435-118" tabindex="-1"></a><span class="co">#&gt; t_4 0.014362590 0.04035905</span></span>
<span id="cb435-119"><a href="two-way-fixed-effects.html#cb435-119" tabindex="-1"></a><span class="co">#&gt; t_3 0.005529734 0.04188731</span></span>
<span id="cb435-120"><a href="two-way-fixed-effects.html#cb435-120" tabindex="-1"></a><span class="co">#&gt; t_2 0.009410044 0.04195008</span></span>
<span id="cb435-121"><a href="two-way-fixed-effects.html#cb435-121" tabindex="-1"></a><span class="co">#&gt; t_1 0.027907540 0.03975173</span></span></code></pre></div>
<p><strong>get_covariate_balance Function Options:</strong></p>
<ul>
<li><p>Allows for the generation of plots displaying covariate balance using <strong><code>plot = TRUE</code></strong>.</p></li>
<li><p>Plots can be customized using arguments typically used with the base R <strong><code>plot</code></strong> method.</p></li>
<li><p>Option to set <strong><code>use.equal.weights = TRUE</code></strong> for:</p>
<ul>
<li><p>Obtaining the balance of unrefined sets.</p></li>
<li><p>Facilitating understanding of the refinement’s impact.</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="two-way-fixed-effects.html#cb436-1" tabindex="-1"></a><span class="co"># Use equal weights</span></span>
<span id="cb436-2"><a href="two-way-fixed-effects.html#cb436-2" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb436-3"><a href="two-way-fixed-effects.html#cb436-3" tabindex="-1"></a>    PM.results.ps.weight<span class="sc">$</span>att,</span>
<span id="cb436-4"><a href="two-way-fixed-effects.html#cb436-4" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb436-5"><a href="two-way-fixed-effects.html#cb436-5" tabindex="-1"></a>    <span class="at">use.equal.weights =</span> <span class="cn">TRUE</span>,</span>
<span id="cb436-6"><a href="two-way-fixed-effects.html#cb436-6" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb436-7"><a href="two-way-fixed-effects.html#cb436-7" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb436-8"><a href="two-way-fixed-effects.html#cb436-8" tabindex="-1"></a>    <span class="co"># visualize by setting plot to TRUE</span></span>
<span id="cb436-9"><a href="two-way-fixed-effects.html#cb436-9" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb436-10"><a href="two-way-fixed-effects.html#cb436-10" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-21-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="two-way-fixed-effects.html#cb437-1" tabindex="-1"></a></span>
<span id="cb437-2"><a href="two-way-fixed-effects.html#cb437-2" tabindex="-1"></a><span class="co"># Compare covariate balance to refined sets</span></span>
<span id="cb437-3"><a href="two-way-fixed-effects.html#cb437-3" tabindex="-1"></a><span class="co"># See large improvement in balance</span></span>
<span id="cb437-4"><a href="two-way-fixed-effects.html#cb437-4" tabindex="-1"></a><span class="fu">get_covariate_balance</span>(</span>
<span id="cb437-5"><a href="two-way-fixed-effects.html#cb437-5" tabindex="-1"></a>    PM.results.ps.weight<span class="sc">$</span>att,</span>
<span id="cb437-6"><a href="two-way-fixed-effects.html#cb437-6" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb437-7"><a href="two-way-fixed-effects.html#cb437-7" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb437-8"><a href="two-way-fixed-effects.html#cb437-8" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb437-9"><a href="two-way-fixed-effects.html#cb437-9" tabindex="-1"></a>    <span class="co"># visualize by setting plot to TRUE</span></span>
<span id="cb437-10"><a href="two-way-fixed-effects.html#cb437-10" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb437-11"><a href="two-way-fixed-effects.html#cb437-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-21-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="two-way-fixed-effects.html#cb438-1" tabindex="-1"></a></span>
<span id="cb438-2"><a href="two-way-fixed-effects.html#cb438-2" tabindex="-1"></a></span>
<span id="cb438-3"><a href="two-way-fixed-effects.html#cb438-3" tabindex="-1"></a><span class="fu">balance_scatter</span>(</span>
<span id="cb438-4"><a href="two-way-fixed-effects.html#cb438-4" tabindex="-1"></a>    <span class="at">matched_set_list =</span> <span class="fu">list</span>(PM.results.maha<span class="sc">$</span>att,</span>
<span id="cb438-5"><a href="two-way-fixed-effects.html#cb438-5" tabindex="-1"></a>                            PM.results.ps.weight<span class="sc">$</span>att),</span>
<span id="cb438-6"><a href="two-way-fixed-effects.html#cb438-6" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb438-7"><a href="two-way-fixed-effects.html#cb438-7" tabindex="-1"></a>    <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;tradewb&quot;</span>)</span>
<span id="cb438-8"><a href="two-way-fixed-effects.html#cb438-8" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-21-3.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong><code>PanelEstimate</code></strong></p>
<ul>
<li><p><strong>Standard Error Calculation Methods</strong></p>
<ul>
<li><p>There are different methods available:</p>
<ul>
<li><p><strong>Bootstrap</strong> (default method with 1000 iterations).</p></li>
<li><p><strong>Conditional</strong>: Assumes independence across units, but not time.</p></li>
<li><p><strong>Unconditional</strong>: Doesn’t make assumptions of independence across units or time.</p></li>
</ul></li>
<li><p>For <strong><code>qoi</code></strong> values set to <code>att</code>, <code>art</code>, or <code>atc</code> <span class="citation">(<a href="#ref-imai2021matching">Imai, Kim, and Wang 2021</a>)</span>:</p>
<ul>
<li>You can use analytical methods for calculating standard errors, which include both “conditional” and “unconditional” methods.</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="two-way-fixed-effects.html#cb439-1" tabindex="-1"></a>PE.results <span class="ot">&lt;-</span> <span class="fu">PanelEstimate</span>(</span>
<span id="cb439-2"><a href="two-way-fixed-effects.html#cb439-2" tabindex="-1"></a>    <span class="at">sets              =</span> PM.results.ps.weight,</span>
<span id="cb439-3"><a href="two-way-fixed-effects.html#cb439-3" tabindex="-1"></a>    <span class="at">data              =</span> dem,</span>
<span id="cb439-4"><a href="two-way-fixed-effects.html#cb439-4" tabindex="-1"></a>    <span class="at">se.method         =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb439-5"><a href="two-way-fixed-effects.html#cb439-5" tabindex="-1"></a>    <span class="at">number.iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb439-6"><a href="two-way-fixed-effects.html#cb439-6" tabindex="-1"></a>    <span class="at">confidence.level  =</span> .<span class="dv">95</span></span>
<span id="cb439-7"><a href="two-way-fixed-effects.html#cb439-7" tabindex="-1"></a>)</span>
<span id="cb439-8"><a href="two-way-fixed-effects.html#cb439-8" tabindex="-1"></a></span>
<span id="cb439-9"><a href="two-way-fixed-effects.html#cb439-9" tabindex="-1"></a><span class="co"># point estimates</span></span>
<span id="cb439-10"><a href="two-way-fixed-effects.html#cb439-10" tabindex="-1"></a>PE.results[[<span class="st">&quot;estimates&quot;</span>]]</span>
<span id="cb439-11"><a href="two-way-fixed-effects.html#cb439-11" tabindex="-1"></a><span class="co">#&gt;       t+0       t+1       t+2       t+3       t+4 </span></span>
<span id="cb439-12"><a href="two-way-fixed-effects.html#cb439-12" tabindex="-1"></a><span class="co">#&gt; 0.2609565 0.9630847 1.2851017 1.7370930 1.4871846</span></span>
<span id="cb439-13"><a href="two-way-fixed-effects.html#cb439-13" tabindex="-1"></a></span>
<span id="cb439-14"><a href="two-way-fixed-effects.html#cb439-14" tabindex="-1"></a><span class="co"># standard errors</span></span>
<span id="cb439-15"><a href="two-way-fixed-effects.html#cb439-15" tabindex="-1"></a>PE.results[[<span class="st">&quot;standard.error&quot;</span>]]</span>
<span id="cb439-16"><a href="two-way-fixed-effects.html#cb439-16" tabindex="-1"></a><span class="co">#&gt;       t+0       t+1       t+2       t+3       t+4 </span></span>
<span id="cb439-17"><a href="two-way-fixed-effects.html#cb439-17" tabindex="-1"></a><span class="co">#&gt; 0.6089145 1.0465362 1.4004193 1.7646397 2.2089610</span></span>
<span id="cb439-18"><a href="two-way-fixed-effects.html#cb439-18" tabindex="-1"></a></span>
<span id="cb439-19"><a href="two-way-fixed-effects.html#cb439-19" tabindex="-1"></a></span>
<span id="cb439-20"><a href="two-way-fixed-effects.html#cb439-20" tabindex="-1"></a><span class="co"># use conditional method</span></span>
<span id="cb439-21"><a href="two-way-fixed-effects.html#cb439-21" tabindex="-1"></a>PE.results <span class="ot">&lt;-</span> <span class="fu">PanelEstimate</span>(</span>
<span id="cb439-22"><a href="two-way-fixed-effects.html#cb439-22" tabindex="-1"></a>    <span class="at">sets             =</span> PM.results.ps.weight,</span>
<span id="cb439-23"><a href="two-way-fixed-effects.html#cb439-23" tabindex="-1"></a>    <span class="at">data             =</span> dem,</span>
<span id="cb439-24"><a href="two-way-fixed-effects.html#cb439-24" tabindex="-1"></a>    <span class="at">se.method        =</span> <span class="st">&quot;conditional&quot;</span>,</span>
<span id="cb439-25"><a href="two-way-fixed-effects.html#cb439-25" tabindex="-1"></a>    <span class="at">confidence.level =</span> .<span class="dv">95</span></span>
<span id="cb439-26"><a href="two-way-fixed-effects.html#cb439-26" tabindex="-1"></a>)</span>
<span id="cb439-27"><a href="two-way-fixed-effects.html#cb439-27" tabindex="-1"></a></span>
<span id="cb439-28"><a href="two-way-fixed-effects.html#cb439-28" tabindex="-1"></a><span class="co"># point estimates</span></span>
<span id="cb439-29"><a href="two-way-fixed-effects.html#cb439-29" tabindex="-1"></a>PE.results[[<span class="st">&quot;estimates&quot;</span>]]</span>
<span id="cb439-30"><a href="two-way-fixed-effects.html#cb439-30" tabindex="-1"></a><span class="co">#&gt;       t+0       t+1       t+2       t+3       t+4 </span></span>
<span id="cb439-31"><a href="two-way-fixed-effects.html#cb439-31" tabindex="-1"></a><span class="co">#&gt; 0.2609565 0.9630847 1.2851017 1.7370930 1.4871846</span></span>
<span id="cb439-32"><a href="two-way-fixed-effects.html#cb439-32" tabindex="-1"></a></span>
<span id="cb439-33"><a href="two-way-fixed-effects.html#cb439-33" tabindex="-1"></a><span class="co"># standard errors</span></span>
<span id="cb439-34"><a href="two-way-fixed-effects.html#cb439-34" tabindex="-1"></a>PE.results[[<span class="st">&quot;standard.error&quot;</span>]]</span>
<span id="cb439-35"><a href="two-way-fixed-effects.html#cb439-35" tabindex="-1"></a><span class="co">#&gt;       t+0       t+1       t+2       t+3       t+4 </span></span>
<span id="cb439-36"><a href="two-way-fixed-effects.html#cb439-36" tabindex="-1"></a><span class="co">#&gt; 0.4844805 0.8170604 1.1171942 1.4116879 1.7172143</span></span>
<span id="cb439-37"><a href="two-way-fixed-effects.html#cb439-37" tabindex="-1"></a></span>
<span id="cb439-38"><a href="two-way-fixed-effects.html#cb439-38" tabindex="-1"></a><span class="fu">summary</span>(PE.results)</span>
<span id="cb439-39"><a href="two-way-fixed-effects.html#cb439-39" tabindex="-1"></a><span class="co">#&gt; Weighted Difference-in-Differences with Propensity Score</span></span>
<span id="cb439-40"><a href="two-way-fixed-effects.html#cb439-40" tabindex="-1"></a><span class="co">#&gt; Matches created with 4 lags</span></span>
<span id="cb439-41"><a href="two-way-fixed-effects.html#cb439-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb439-42"><a href="two-way-fixed-effects.html#cb439-42" tabindex="-1"></a><span class="co">#&gt; Standard errors computed with conditional  method</span></span>
<span id="cb439-43"><a href="two-way-fixed-effects.html#cb439-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb439-44"><a href="two-way-fixed-effects.html#cb439-44" tabindex="-1"></a><span class="co">#&gt; Estimate of Average Treatment Effect on the Treated (ATT) by Period:</span></span>
<span id="cb439-45"><a href="two-way-fixed-effects.html#cb439-45" tabindex="-1"></a><span class="co">#&gt; $summary</span></span>
<span id="cb439-46"><a href="two-way-fixed-effects.html#cb439-46" tabindex="-1"></a><span class="co">#&gt;      estimate std.error       2.5%    97.5%</span></span>
<span id="cb439-47"><a href="two-way-fixed-effects.html#cb439-47" tabindex="-1"></a><span class="co">#&gt; t+0 0.2609565 0.4844805 -0.6886078 1.210521</span></span>
<span id="cb439-48"><a href="two-way-fixed-effects.html#cb439-48" tabindex="-1"></a><span class="co">#&gt; t+1 0.9630847 0.8170604 -0.6383243 2.564494</span></span>
<span id="cb439-49"><a href="two-way-fixed-effects.html#cb439-49" tabindex="-1"></a><span class="co">#&gt; t+2 1.2851017 1.1171942 -0.9045586 3.474762</span></span>
<span id="cb439-50"><a href="two-way-fixed-effects.html#cb439-50" tabindex="-1"></a><span class="co">#&gt; t+3 1.7370930 1.4116879 -1.0297644 4.503950</span></span>
<span id="cb439-51"><a href="two-way-fixed-effects.html#cb439-51" tabindex="-1"></a><span class="co">#&gt; t+4 1.4871846 1.7172143 -1.8784937 4.852863</span></span>
<span id="cb439-52"><a href="two-way-fixed-effects.html#cb439-52" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb439-53"><a href="two-way-fixed-effects.html#cb439-53" tabindex="-1"></a><span class="co">#&gt; $lag</span></span>
<span id="cb439-54"><a href="two-way-fixed-effects.html#cb439-54" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb439-55"><a href="two-way-fixed-effects.html#cb439-55" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb439-56"><a href="two-way-fixed-effects.html#cb439-56" tabindex="-1"></a><span class="co">#&gt; $qoi</span></span>
<span id="cb439-57"><a href="two-way-fixed-effects.html#cb439-57" tabindex="-1"></a><span class="co">#&gt; [1] &quot;att&quot;</span></span>
<span id="cb439-58"><a href="two-way-fixed-effects.html#cb439-58" tabindex="-1"></a></span>
<span id="cb439-59"><a href="two-way-fixed-effects.html#cb439-59" tabindex="-1"></a><span class="fu">plot</span>(PE.results)</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p><strong>Moderating Variables</strong></p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="two-way-fixed-effects.html#cb440-1" tabindex="-1"></a><span class="co"># moderating variable</span></span>
<span id="cb440-2"><a href="two-way-fixed-effects.html#cb440-2" tabindex="-1"></a>dem<span class="sc">$</span>moderator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb440-3"><a href="two-way-fixed-effects.html#cb440-3" tabindex="-1"></a>dem<span class="sc">$</span>moderator <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dem<span class="sc">$</span>wbcode2 <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb440-4"><a href="two-way-fixed-effects.html#cb440-4" tabindex="-1"></a></span>
<span id="cb440-5"><a href="two-way-fixed-effects.html#cb440-5" tabindex="-1"></a>PM.results <span class="ot">&lt;-</span></span>
<span id="cb440-6"><a href="two-way-fixed-effects.html#cb440-6" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb440-7"><a href="two-way-fixed-effects.html#cb440-7" tabindex="-1"></a>        <span class="at">lag                          =</span> <span class="dv">4</span>,</span>
<span id="cb440-8"><a href="two-way-fixed-effects.html#cb440-8" tabindex="-1"></a>        <span class="at">time.id                      =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb440-9"><a href="two-way-fixed-effects.html#cb440-9" tabindex="-1"></a>        <span class="at">unit.id                      =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb440-10"><a href="two-way-fixed-effects.html#cb440-10" tabindex="-1"></a>        <span class="at">treatment                    =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb440-11"><a href="two-way-fixed-effects.html#cb440-11" tabindex="-1"></a>        <span class="at">refinement.method            =</span> <span class="st">&quot;mahalanobis&quot;</span>,</span>
<span id="cb440-12"><a href="two-way-fixed-effects.html#cb440-12" tabindex="-1"></a>        <span class="at">data                         =</span> dem,</span>
<span id="cb440-13"><a href="two-way-fixed-effects.html#cb440-13" tabindex="-1"></a>        <span class="at">match.missing                =</span> <span class="cn">TRUE</span>,</span>
<span id="cb440-14"><a href="two-way-fixed-effects.html#cb440-14" tabindex="-1"></a>        <span class="at">covs.formula                 =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb440-15"><a href="two-way-fixed-effects.html#cb440-15" tabindex="-1"></a>        <span class="at">size.match                   =</span> <span class="dv">5</span>,</span>
<span id="cb440-16"><a href="two-way-fixed-effects.html#cb440-16" tabindex="-1"></a>        <span class="at">qoi                          =</span> <span class="st">&quot;att&quot;</span>,</span>
<span id="cb440-17"><a href="two-way-fixed-effects.html#cb440-17" tabindex="-1"></a>        <span class="at">outcome.var                  =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb440-18"><a href="two-way-fixed-effects.html#cb440-18" tabindex="-1"></a>        <span class="at">lead                         =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb440-19"><a href="two-way-fixed-effects.html#cb440-19" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal    =</span> <span class="cn">FALSE</span>,</span>
<span id="cb440-20"><a href="two-way-fixed-effects.html#cb440-20" tabindex="-1"></a>        <span class="at">use.diagonal.variance.matrix =</span> <span class="cn">TRUE</span></span>
<span id="cb440-21"><a href="two-way-fixed-effects.html#cb440-21" tabindex="-1"></a>    )</span>
<span id="cb440-22"><a href="two-way-fixed-effects.html#cb440-22" tabindex="-1"></a>PE.results <span class="ot">&lt;-</span></span>
<span id="cb440-23"><a href="two-way-fixed-effects.html#cb440-23" tabindex="-1"></a>    <span class="fu">PanelEstimate</span>(<span class="at">sets      =</span> PM.results,</span>
<span id="cb440-24"><a href="two-way-fixed-effects.html#cb440-24" tabindex="-1"></a>                  <span class="at">data      =</span> dem,</span>
<span id="cb440-25"><a href="two-way-fixed-effects.html#cb440-25" tabindex="-1"></a>                  <span class="at">moderator =</span> <span class="st">&quot;moderator&quot;</span>)</span>
<span id="cb440-26"><a href="two-way-fixed-effects.html#cb440-26" tabindex="-1"></a></span>
<span id="cb440-27"><a href="two-way-fixed-effects.html#cb440-27" tabindex="-1"></a><span class="co"># Each element in the list corresponds to a level in the moderator</span></span>
<span id="cb440-28"><a href="two-way-fixed-effects.html#cb440-28" tabindex="-1"></a><span class="fu">plot</span>(PE.results[[<span class="dv">1</span>]])</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-23-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="two-way-fixed-effects.html#cb441-1" tabindex="-1"></a></span>
<span id="cb441-2"><a href="two-way-fixed-effects.html#cb441-2" tabindex="-1"></a><span class="fu">plot</span>(PE.results[[<span class="dv">2</span>]])</span></code></pre></div>
<p><img src="26-dif-in-dif_files/figure-html/unnamed-chunk-23-2.png" width="90%" style="display: block; margin: auto;" /></p>
<p>To write up for journal submission, you can follow the following report:</p>
<p>In this study, closely aligned with the research by <span class="citation">(<a href="#ref-acemoglu2019democracy">Acemoglu et al. 2019</a>)</span>, two key effects of democracy on economic growth are estimated: the impact of democratization and that of authoritarian reversal. The treatment variable, <span class="math inline">\(X_{it}\)</span>, is defined to be one if country <span class="math inline">\(i\)</span> is democratic in year <span class="math inline">\(t\)</span>, and zero otherwise.</p>
<p>The Average Treatment Effect for the Treated (ATT) under democratization is formulated as follows:</p>
<p><span class="math display">\[
\begin{aligned}
\delta(F, L) &amp;= \mathbb{E} \left\{ Y_{i, t + F} (X_{it} = 1, X_{i, t - 1} = 0, \{X_{i,t-l}\}_{l=2}^L) \right. \\
&amp;\left. - Y_{i, t + F} (X_{it} = 0, X_{i, t - 1} = 0, \{X_{i,t-l}\}_{l=2}^L) | X_{it} = 1, X_{i, t - 1} = 0 \right\}
\end{aligned}
\]</span></p>
<p>In this framework, the treated observations are countries that transition from an authoritarian regime <span class="math inline">\(X_{it-1} = 0\)</span> to a democratic one <span class="math inline">\(X_{it} = 1\)</span>. The variable <span class="math inline">\(F\)</span> represents the number of leads, denoting the time periods following the treatment, and <span class="math inline">\(L\)</span> signifies the number of lags, indicating the time periods preceding the treatment.</p>
<p>The ATT under authoritarian reversal is given by:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{E} \left[ Y_{i, t + F} (X_{it} = 0, X_{i, t - 1} = 1, \{ X_{i, t - l}\}_{l=2}^L ) \right. \\
&amp;\left. - Y_{i, t + F} (X_{it} = 1, X_{it-1} = 1, \{X_{i, t - l} \}_{l=2}^L ) | X_{it} = 0, X_{i, t - 1} = 1 \right]
\end{aligned}
\]</span></p>
<p>The ATT is calculated conditioning on 4 years of lags (<span class="math inline">\(L = 4\)</span>) and up to 4 years following the policy change <span class="math inline">\(F = 1, 2, 3, 4\)</span>. Matched sets for each treated observation are constructed based on its treatment history, with the number of matched control units generally decreasing when considering a 4-year treatment history as compared to a 1-year history.</p>
<p>To enhance the quality of matched sets, methods such as Mahalanobis distance matching, propensity score matching, and propensity score weighting are utilized. These approaches enable us to evaluate the effectiveness of each refinement method. In the process of matching, we employ both up-to-five and up-to-ten matching to investigate how sensitive our empirical results are to the maximum number of allowed matches. For more information on the refinement process, please see the Web Appendix</p>
<blockquote>
<p>The Mahalanobis distance is expressed through a specific formula. We aim to pair each treated unit with a maximum of <span class="math inline">\(J\)</span> control units, permitting replacement, denoted as <span class="math inline">\(| \mathcal{M}_{it} \le J|\)</span>. The average Mahalanobis distance between a treated and each control unit over time is computed as:</p>
<p><span class="math display">\[ S_{it} (i&#39;) = \frac{1}{L} \sum_{l = 1}^L \sqrt{(\mathbf{V}_{i, t - l} - \mathbf{V}_{i&#39;, t -l})^T \mathbf{\Sigma}_{i, t - l}^{-1} (\mathbf{V}_{i, t - l} - \mathbf{V}_{i&#39;, t -l})} \]</span></p>
<p>For a matched control unit <span class="math inline">\(i&#39; \in \mathcal{M}_{it}\)</span>, <span class="math inline">\(\mathbf{V}_{it&#39;}\)</span> represents the time-varying covariates to adjust for, and <span class="math inline">\(\mathbf{\Sigma}_{it&#39;}\)</span> is the sample covariance matrix for <span class="math inline">\(\mathbf{V}_{it&#39;}\)</span>. Essentially, we calculate a standardized distance using time-varying covariates and average this across different time intervals.</p>
<p>In the context of propensity score matching, we employ a logistic regression model with balanced covariates to derive the propensity score. Defined as the conditional likelihood of treatment given pre-treatment covariates <span class="citation">(<a href="#ref-rosenbaum1983central">Rosenbaum and Rubin 1983</a>)</span>, the propensity score is estimated by first creating a data subset comprised of all treated and their matched control units from the same year. This logistic regression model is then fitted as follows:</p>
<p><span class="math display">\[ \begin{aligned} &amp; e_{it} (\{\mathbf{U}_{i, t - l} \}^L_{l = 1}) \\ &amp;= Pr(X_{it} = 1| \mathbf{U}_{i, t -1}, \ldots, \mathbf{U}_{i, t - L}) \\ &amp;= \frac{1}{1 = \exp(- \sum_{l = 1}^L \beta_l^T \mathbf{U}_{i, t - l})} \end{aligned} \]</span></p>
<p>where <span class="math inline">\(\mathbf{U}_{it&#39;} = (X_{it&#39;}, \mathbf{V}_{it&#39;}^T)^T\)</span>. Given this model, the estimated propensity score for all treated and matched control units is then computed. This enables the adjustment for lagged covariates via matching on the calculated propensity score, resulting in the following distance measure:</p>
<p><span class="math display">\[ S_{it} (i&#39;) = | \text{logit} \{ \hat{e}_{it} (\{ \mathbf{U}_{i, t - l}\}^L_{l = 1})\} - \text{logit} \{ \hat{e}_{i&#39;t}( \{ \mathbf{U}_{i&#39;, t - l} \}^L_{l = 1})\} | \]</span></p>
<p>Here, <span class="math inline">\(\hat{e}_{i&#39;t} (\{ \mathbf{U}_{i, t - l}\}^L_{l = 1})\)</span> represents the estimated propensity score for each matched control unit <span class="math inline">\(i&#39; \in \mathcal{M}_{it}\)</span>.</p>
<p>Once the distance measure <span class="math inline">\(S_{it} (i&#39;)\)</span> has been determined for all control units in the original matched set, we fine-tune this set by selecting up to <span class="math inline">\(J\)</span> closest control units, which meet a researcher-defined caliper constraint <span class="math inline">\(C\)</span>. All other control units receive zero weight. This results in a refined matched set for each treated unit <span class="math inline">\((i, t)\)</span>:</p>
<p><span class="math display">\[ \mathcal{M}_{it}^* = \{i&#39; : i&#39; \in \mathcal{M}_{it}, S_{it} (i&#39;) &lt; C, S_{it} \le S_{it}^{(J)}\} \]</span></p>
<p><span class="math inline">\(S_{it}^{(J)}\)</span> is the <span class="math inline">\(J\)</span>th smallest distance among the control units in the original set <span class="math inline">\(\mathcal{M}_{it}\)</span>.</p>
<p>For further refinement using weighting, a weight is assigned to each control unit <span class="math inline">\(i&#39;\)</span> in a matched set corresponding to a treated unit <span class="math inline">\((i, t)\)</span>, with greater weight accorded to more similar units. We utilize inverse propensity score weighting, based on the propensity score model mentioned earlier:</p>
<p><span class="math display">\[ w_{it}^{i&#39;} \propto \frac{\hat{e}_{i&#39;t} (\{ \mathbf{U}_{i, t-l} \}^L_{l = 1} )}{1 - \hat{e}_{i&#39;t} (\{ \mathbf{U}_{i, t-l} \}^L_{l = 1} )} \]</span></p>
<p>In this model, <span class="math inline">\(\sum_{i&#39; \in \mathcal{M}_{it}} w_{it}^{i&#39;} = 1\)</span> and <span class="math inline">\(w_{it}^{i&#39;} = 0\)</span> for <span class="math inline">\(i&#39; \notin \mathcal{M}_{it}\)</span>. The model is fitted to the complete sample of treated and matched control units.</p>
</blockquote>
<blockquote>
<p>Checking Covariate Balance A distinct advantage of the proposed methodology over regression methods is the ability it offers researchers to inspect the covariate balance between treated and matched control observations. This facilitates the evaluation of whether treated and matched control observations are comparable regarding observed confounders. To investigate the mean difference of each covariate (e.g., <span class="math inline">\(V_{it&#39;j}\)</span>, representing the <span class="math inline">\(j\)</span>-th variable in <span class="math inline">\(\mathbf{V}_{it&#39;}\)</span>) between the treated observation and its matched control observation at each pre-treatment time period (i.e., <span class="math inline">\(t&#39; &lt; t\)</span>), we further standardize this difference. For any given pretreatment time period, we adjust by the standard deviation of each covariate across all treated observations in the dataset. Thus, the mean difference is quantified in terms of standard deviation units. Formally, for each treated observation <span class="math inline">\((i,t)\)</span> where <span class="math inline">\(D_{it} = 1\)</span>, we define the covariate balance for variable <span class="math inline">\(j\)</span> at the pretreatment time period <span class="math inline">\(t - l\)</span> as: <span class="math display">\[\begin{equation}
B_{it}(j, l) = \frac{V_{i, t- l,j}- \sum_{i&#39; \in \mathcal{M}_{it}}w_{it}^{i&#39;}V_{i&#39;, t-l,j}}{\sqrt{\frac{1}{N_1 - 1} \sum_{i&#39;=1}^N \sum_{t&#39; = L+1}^{T-F}D_{i&#39;t&#39;}(V_{i&#39;, t&#39;-l, j} - \bar{V}_{t&#39; - l, j})^2}}
\label{eq:covbalance}
\end{equation}\]</span> where <span class="math inline">\(N_1 = \sum_{i&#39;= 1}^N \sum_{t&#39; = L+1}^{T-F} D_{i&#39;t&#39;}\)</span> denotes the total number of treated observations and <span class="math inline">\(\bar{V}_{t-l,j} = \sum_{i=1}^N D_{i,t-l,j}/N\)</span>. We then aggregate this covariate balance measure across all treated observations for each covariate and pre-treatment time period: <span class="math display">\[\begin{equation}
\bar{B}(j, l) = \frac{1}{N_1} \sum_{i=1}^N \sum_{t = L+ 1}^{T-F}D_{it} B_{it}(j,l)
\label{eq:aggbalance}
\end{equation}\]</span> Lastly, we evaluate the balance of lagged outcome variables over several pre-treatment periods and that of time-varying covariates. This examination aids in assessing the validity of the parallel trend assumption integral to the DiD estimator justification.</p>
</blockquote>
<p>In Figure <a href="#fig:balancescatter"><strong>??</strong></a>, we demonstrate the enhancement of covariate balance thank to the refinement of matched sets. Each scatter plot contrasts the absolute standardized mean difference, as detailed in Equation <a href="#eq:aggbalance">(<strong>??</strong>)</a>, before (horizontal axis) and after (vertical axis) this refinement. Points below the 45-degree line indicate an improved standardized mean balance for certain time-varying covariates post-refinement. The majority of variables benefit from this refinement process. Notably, the propensity score weighting (bottom panel) shows the most significant improvement, whereas Mahalanobis matching (top panel) yields a more modest improvement.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="two-way-fixed-effects.html#cb442-1" tabindex="-1"></a><span class="fu">library</span>(PanelMatch)</span>
<span id="cb442-2"><a href="two-way-fixed-effects.html#cb442-2" tabindex="-1"></a><span class="fu">library</span>(causalverse)</span>
<span id="cb442-3"><a href="two-way-fixed-effects.html#cb442-3" tabindex="-1"></a></span>
<span id="cb442-4"><a href="two-way-fixed-effects.html#cb442-4" tabindex="-1"></a>runPanelMatch <span class="ot">&lt;-</span> <span class="cf">function</span>(method, lag, <span class="at">size.match=</span><span class="cn">NULL</span>, <span class="at">qoi=</span><span class="st">&quot;att&quot;</span>) {</span>
<span id="cb442-5"><a href="two-way-fixed-effects.html#cb442-5" tabindex="-1"></a>    </span>
<span id="cb442-6"><a href="two-way-fixed-effects.html#cb442-6" tabindex="-1"></a>    <span class="co"># Default parameters for PanelMatch</span></span>
<span id="cb442-7"><a href="two-way-fixed-effects.html#cb442-7" tabindex="-1"></a>    common.args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb442-8"><a href="two-way-fixed-effects.html#cb442-8" tabindex="-1"></a>        <span class="at">lag =</span> lag,</span>
<span id="cb442-9"><a href="two-way-fixed-effects.html#cb442-9" tabindex="-1"></a>        <span class="at">time.id =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb442-10"><a href="two-way-fixed-effects.html#cb442-10" tabindex="-1"></a>        <span class="at">unit.id =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb442-11"><a href="two-way-fixed-effects.html#cb442-11" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb442-12"><a href="two-way-fixed-effects.html#cb442-12" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb442-13"><a href="two-way-fixed-effects.html#cb442-13" tabindex="-1"></a>        <span class="at">covs.formula =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb442-14"><a href="two-way-fixed-effects.html#cb442-14" tabindex="-1"></a>        <span class="at">qoi =</span> qoi,</span>
<span id="cb442-15"><a href="two-way-fixed-effects.html#cb442-15" tabindex="-1"></a>        <span class="at">outcome.var =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb442-16"><a href="two-way-fixed-effects.html#cb442-16" tabindex="-1"></a>        <span class="at">lead =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb442-17"><a href="two-way-fixed-effects.html#cb442-17" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb442-18"><a href="two-way-fixed-effects.html#cb442-18" tabindex="-1"></a>        <span class="at">size.match =</span> size.match  <span class="co"># setting size.match here for all methods</span></span>
<span id="cb442-19"><a href="two-way-fixed-effects.html#cb442-19" tabindex="-1"></a>    )</span>
<span id="cb442-20"><a href="two-way-fixed-effects.html#cb442-20" tabindex="-1"></a>    </span>
<span id="cb442-21"><a href="two-way-fixed-effects.html#cb442-21" tabindex="-1"></a>    <span class="cf">if</span>(method <span class="sc">==</span> <span class="st">&quot;mahalanobis&quot;</span>) {</span>
<span id="cb442-22"><a href="two-way-fixed-effects.html#cb442-22" tabindex="-1"></a>        common.args<span class="sc">$</span>refinement.method <span class="ot">&lt;-</span> <span class="st">&quot;mahalanobis&quot;</span></span>
<span id="cb442-23"><a href="two-way-fixed-effects.html#cb442-23" tabindex="-1"></a>        common.args<span class="sc">$</span>match.missing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb442-24"><a href="two-way-fixed-effects.html#cb442-24" tabindex="-1"></a>        common.args<span class="sc">$</span>use.diagonal.variance.matrix <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb442-25"><a href="two-way-fixed-effects.html#cb442-25" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(method <span class="sc">==</span> <span class="st">&quot;ps.match&quot;</span>) {</span>
<span id="cb442-26"><a href="two-way-fixed-effects.html#cb442-26" tabindex="-1"></a>        common.args<span class="sc">$</span>refinement.method <span class="ot">&lt;-</span> <span class="st">&quot;ps.match&quot;</span></span>
<span id="cb442-27"><a href="two-way-fixed-effects.html#cb442-27" tabindex="-1"></a>        common.args<span class="sc">$</span>match.missing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb442-28"><a href="two-way-fixed-effects.html#cb442-28" tabindex="-1"></a>        common.args<span class="sc">$</span>listwise.delete <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb442-29"><a href="two-way-fixed-effects.html#cb442-29" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(method <span class="sc">==</span> <span class="st">&quot;ps.weight&quot;</span>) {</span>
<span id="cb442-30"><a href="two-way-fixed-effects.html#cb442-30" tabindex="-1"></a>        common.args<span class="sc">$</span>refinement.method <span class="ot">&lt;-</span> <span class="st">&quot;ps.weight&quot;</span></span>
<span id="cb442-31"><a href="two-way-fixed-effects.html#cb442-31" tabindex="-1"></a>        common.args<span class="sc">$</span>match.missing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb442-32"><a href="two-way-fixed-effects.html#cb442-32" tabindex="-1"></a>        common.args<span class="sc">$</span>listwise.delete <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb442-33"><a href="two-way-fixed-effects.html#cb442-33" tabindex="-1"></a>    }</span>
<span id="cb442-34"><a href="two-way-fixed-effects.html#cb442-34" tabindex="-1"></a>    </span>
<span id="cb442-35"><a href="two-way-fixed-effects.html#cb442-35" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">do.call</span>(PanelMatch, common.args))</span>
<span id="cb442-36"><a href="two-way-fixed-effects.html#cb442-36" tabindex="-1"></a>}</span>
<span id="cb442-37"><a href="two-way-fixed-effects.html#cb442-37" tabindex="-1"></a></span>
<span id="cb442-38"><a href="two-way-fixed-effects.html#cb442-38" tabindex="-1"></a>methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mahalanobis&quot;</span>, <span class="st">&quot;ps.match&quot;</span>, <span class="st">&quot;ps.weight&quot;</span>)</span>
<span id="cb442-39"><a href="two-way-fixed-effects.html#cb442-39" tabindex="-1"></a>lags <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb442-40"><a href="two-way-fixed-effects.html#cb442-40" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>You can either do it sequentailly</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="two-way-fixed-effects.html#cb443-1" tabindex="-1"></a>res_pm <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb443-2"><a href="two-way-fixed-effects.html#cb443-2" tabindex="-1"></a></span>
<span id="cb443-3"><a href="two-way-fixed-effects.html#cb443-3" tabindex="-1"></a><span class="cf">for</span>(method <span class="cf">in</span> methods) {</span>
<span id="cb443-4"><a href="two-way-fixed-effects.html#cb443-4" tabindex="-1"></a>    <span class="cf">for</span>(lag <span class="cf">in</span> lags) {</span>
<span id="cb443-5"><a href="two-way-fixed-effects.html#cb443-5" tabindex="-1"></a>        <span class="cf">for</span>(size <span class="cf">in</span> sizes) {</span>
<span id="cb443-6"><a href="two-way-fixed-effects.html#cb443-6" tabindex="-1"></a>            name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag.&quot;</span>, size, <span class="st">&quot;m&quot;</span>)</span>
<span id="cb443-7"><a href="two-way-fixed-effects.html#cb443-7" tabindex="-1"></a>            res_pm[[name]] <span class="ot">&lt;-</span> <span class="fu">runPanelMatch</span>(method, lag, size)</span>
<span id="cb443-8"><a href="two-way-fixed-effects.html#cb443-8" tabindex="-1"></a>        }</span>
<span id="cb443-9"><a href="two-way-fixed-effects.html#cb443-9" tabindex="-1"></a>    }</span>
<span id="cb443-10"><a href="two-way-fixed-effects.html#cb443-10" tabindex="-1"></a>}</span>
<span id="cb443-11"><a href="two-way-fixed-effects.html#cb443-11" tabindex="-1"></a></span>
<span id="cb443-12"><a href="two-way-fixed-effects.html#cb443-12" tabindex="-1"></a><span class="co"># Now, you can access res_pm using res_pm[[&quot;mahalanobis.1lag.5m&quot;]] etc.</span></span>
<span id="cb443-13"><a href="two-way-fixed-effects.html#cb443-13" tabindex="-1"></a></span>
<span id="cb443-14"><a href="two-way-fixed-effects.html#cb443-14" tabindex="-1"></a><span class="co"># for treatment reversal</span></span>
<span id="cb443-15"><a href="two-way-fixed-effects.html#cb443-15" tabindex="-1"></a>res_pm_rev <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb443-16"><a href="two-way-fixed-effects.html#cb443-16" tabindex="-1"></a></span>
<span id="cb443-17"><a href="two-way-fixed-effects.html#cb443-17" tabindex="-1"></a><span class="cf">for</span>(method <span class="cf">in</span> methods) {</span>
<span id="cb443-18"><a href="two-way-fixed-effects.html#cb443-18" tabindex="-1"></a>    <span class="cf">for</span>(lag <span class="cf">in</span> lags) {</span>
<span id="cb443-19"><a href="two-way-fixed-effects.html#cb443-19" tabindex="-1"></a>        <span class="cf">for</span>(size <span class="cf">in</span> sizes) {</span>
<span id="cb443-20"><a href="two-way-fixed-effects.html#cb443-20" tabindex="-1"></a>            name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag.&quot;</span>, size, <span class="st">&quot;m&quot;</span>)</span>
<span id="cb443-21"><a href="two-way-fixed-effects.html#cb443-21" tabindex="-1"></a>            res_pm_rev[[name]] <span class="ot">&lt;-</span> <span class="fu">runPanelMatch</span>(method, lag, size, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>)</span>
<span id="cb443-22"><a href="two-way-fixed-effects.html#cb443-22" tabindex="-1"></a>        }</span>
<span id="cb443-23"><a href="two-way-fixed-effects.html#cb443-23" tabindex="-1"></a>    }</span>
<span id="cb443-24"><a href="two-way-fixed-effects.html#cb443-24" tabindex="-1"></a>}</span></code></pre></div>
<p>or in parallel</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="two-way-fixed-effects.html#cb444-1" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb444-2"><a href="two-way-fixed-effects.html#cb444-2" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb444-3"><a href="two-way-fixed-effects.html#cb444-3" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb444-4"><a href="two-way-fixed-effects.html#cb444-4" tabindex="-1"></a><span class="co"># Initialize an empty list to store results</span></span>
<span id="cb444-5"><a href="two-way-fixed-effects.html#cb444-5" tabindex="-1"></a>res_pm <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb444-6"><a href="two-way-fixed-effects.html#cb444-6" tabindex="-1"></a></span>
<span id="cb444-7"><a href="two-way-fixed-effects.html#cb444-7" tabindex="-1"></a><span class="co"># Replace nested for-loops with foreach</span></span>
<span id="cb444-8"><a href="two-way-fixed-effects.html#cb444-8" tabindex="-1"></a>results <span class="ot">&lt;-</span></span>
<span id="cb444-9"><a href="two-way-fixed-effects.html#cb444-9" tabindex="-1"></a>  <span class="fu">foreach</span>(</span>
<span id="cb444-10"><a href="two-way-fixed-effects.html#cb444-10" tabindex="-1"></a>    <span class="at">method =</span> methods,</span>
<span id="cb444-11"><a href="two-way-fixed-effects.html#cb444-11" tabindex="-1"></a>    <span class="at">.combine =</span> <span class="st">&#39;c&#39;</span>,</span>
<span id="cb444-12"><a href="two-way-fixed-effects.html#cb444-12" tabindex="-1"></a>    <span class="at">.multicombine =</span> <span class="cn">TRUE</span>,</span>
<span id="cb444-13"><a href="two-way-fixed-effects.html#cb444-13" tabindex="-1"></a>    <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;PanelMatch&quot;</span>, <span class="st">&quot;causalverse&quot;</span>)</span>
<span id="cb444-14"><a href="two-way-fixed-effects.html#cb444-14" tabindex="-1"></a>  ) <span class="sc">%dopar%</span> {</span>
<span id="cb444-15"><a href="two-way-fixed-effects.html#cb444-15" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb444-16"><a href="two-way-fixed-effects.html#cb444-16" tabindex="-1"></a>    <span class="cf">for</span> (lag <span class="cf">in</span> lags) {</span>
<span id="cb444-17"><a href="two-way-fixed-effects.html#cb444-17" tabindex="-1"></a>      <span class="cf">for</span> (size <span class="cf">in</span> sizes) {</span>
<span id="cb444-18"><a href="two-way-fixed-effects.html#cb444-18" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag.&quot;</span>, size, <span class="st">&quot;m&quot;</span>)</span>
<span id="cb444-19"><a href="two-way-fixed-effects.html#cb444-19" tabindex="-1"></a>        tmp[[name]] <span class="ot">&lt;-</span> <span class="fu">runPanelMatch</span>(method, lag, size)</span>
<span id="cb444-20"><a href="two-way-fixed-effects.html#cb444-20" tabindex="-1"></a>      }</span>
<span id="cb444-21"><a href="two-way-fixed-effects.html#cb444-21" tabindex="-1"></a>    }</span>
<span id="cb444-22"><a href="two-way-fixed-effects.html#cb444-22" tabindex="-1"></a>    tmp</span>
<span id="cb444-23"><a href="two-way-fixed-effects.html#cb444-23" tabindex="-1"></a>  }</span>
<span id="cb444-24"><a href="two-way-fixed-effects.html#cb444-24" tabindex="-1"></a></span>
<span id="cb444-25"><a href="two-way-fixed-effects.html#cb444-25" tabindex="-1"></a><span class="co"># Collate results</span></span>
<span id="cb444-26"><a href="two-way-fixed-effects.html#cb444-26" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(results)) {</span>
<span id="cb444-27"><a href="two-way-fixed-effects.html#cb444-27" tabindex="-1"></a>  res_pm[[name]] <span class="ot">&lt;-</span> results[[name]]</span>
<span id="cb444-28"><a href="two-way-fixed-effects.html#cb444-28" tabindex="-1"></a>}</span>
<span id="cb444-29"><a href="two-way-fixed-effects.html#cb444-29" tabindex="-1"></a></span>
<span id="cb444-30"><a href="two-way-fixed-effects.html#cb444-30" tabindex="-1"></a><span class="co"># Treatment reversal</span></span>
<span id="cb444-31"><a href="two-way-fixed-effects.html#cb444-31" tabindex="-1"></a><span class="co"># Initialize an empty list to store results</span></span>
<span id="cb444-32"><a href="two-way-fixed-effects.html#cb444-32" tabindex="-1"></a>res_pm_rev <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb444-33"><a href="two-way-fixed-effects.html#cb444-33" tabindex="-1"></a></span>
<span id="cb444-34"><a href="two-way-fixed-effects.html#cb444-34" tabindex="-1"></a><span class="co"># Replace nested for-loops with foreach</span></span>
<span id="cb444-35"><a href="two-way-fixed-effects.html#cb444-35" tabindex="-1"></a>results_rev <span class="ot">&lt;-</span></span>
<span id="cb444-36"><a href="two-way-fixed-effects.html#cb444-36" tabindex="-1"></a>  <span class="fu">foreach</span>(</span>
<span id="cb444-37"><a href="two-way-fixed-effects.html#cb444-37" tabindex="-1"></a>    <span class="at">method =</span> methods,</span>
<span id="cb444-38"><a href="two-way-fixed-effects.html#cb444-38" tabindex="-1"></a>    <span class="at">.combine =</span> <span class="st">&#39;c&#39;</span>,</span>
<span id="cb444-39"><a href="two-way-fixed-effects.html#cb444-39" tabindex="-1"></a>    <span class="at">.multicombine =</span> <span class="cn">TRUE</span>,</span>
<span id="cb444-40"><a href="two-way-fixed-effects.html#cb444-40" tabindex="-1"></a>    <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;PanelMatch&quot;</span>, <span class="st">&quot;causalverse&quot;</span>)</span>
<span id="cb444-41"><a href="two-way-fixed-effects.html#cb444-41" tabindex="-1"></a>  ) <span class="sc">%dopar%</span> {</span>
<span id="cb444-42"><a href="two-way-fixed-effects.html#cb444-42" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb444-43"><a href="two-way-fixed-effects.html#cb444-43" tabindex="-1"></a>    <span class="cf">for</span> (lag <span class="cf">in</span> lags) {</span>
<span id="cb444-44"><a href="two-way-fixed-effects.html#cb444-44" tabindex="-1"></a>      <span class="cf">for</span> (size <span class="cf">in</span> sizes) {</span>
<span id="cb444-45"><a href="two-way-fixed-effects.html#cb444-45" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag.&quot;</span>, size, <span class="st">&quot;m&quot;</span>)</span>
<span id="cb444-46"><a href="two-way-fixed-effects.html#cb444-46" tabindex="-1"></a>        tmp[[name]] <span class="ot">&lt;-</span></span>
<span id="cb444-47"><a href="two-way-fixed-effects.html#cb444-47" tabindex="-1"></a>          <span class="fu">runPanelMatch</span>(method, lag, size, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>)</span>
<span id="cb444-48"><a href="two-way-fixed-effects.html#cb444-48" tabindex="-1"></a>      }</span>
<span id="cb444-49"><a href="two-way-fixed-effects.html#cb444-49" tabindex="-1"></a>    }</span>
<span id="cb444-50"><a href="two-way-fixed-effects.html#cb444-50" tabindex="-1"></a>    tmp</span>
<span id="cb444-51"><a href="two-way-fixed-effects.html#cb444-51" tabindex="-1"></a>  }</span>
<span id="cb444-52"><a href="two-way-fixed-effects.html#cb444-52" tabindex="-1"></a></span>
<span id="cb444-53"><a href="two-way-fixed-effects.html#cb444-53" tabindex="-1"></a><span class="co"># Collate results</span></span>
<span id="cb444-54"><a href="two-way-fixed-effects.html#cb444-54" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(results_rev)) {</span>
<span id="cb444-55"><a href="two-way-fixed-effects.html#cb444-55" tabindex="-1"></a>  res_pm_rev[[name]] <span class="ot">&lt;-</span> results_rev[[name]]</span>
<span id="cb444-56"><a href="two-way-fixed-effects.html#cb444-56" tabindex="-1"></a>}</span>
<span id="cb444-57"><a href="two-way-fixed-effects.html#cb444-57" tabindex="-1"></a></span>
<span id="cb444-58"><a href="two-way-fixed-effects.html#cb444-58" tabindex="-1"></a></span>
<span id="cb444-59"><a href="two-way-fixed-effects.html#cb444-59" tabindex="-1"></a><span class="fu">stopImplicitCluster</span>()</span></code></pre></div>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="two-way-fixed-effects.html#cb445-1" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb445-2"><a href="two-way-fixed-effects.html#cb445-2" tabindex="-1"></a></span>
<span id="cb445-3"><a href="two-way-fixed-effects.html#cb445-3" tabindex="-1"></a><span class="co"># Updated plotting function</span></span>
<span id="cb445-4"><a href="two-way-fixed-effects.html#cb445-4" tabindex="-1"></a>create_balance_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(method, lag, sizes, res_pm, dem) {</span>
<span id="cb445-5"><a href="two-way-fixed-effects.html#cb445-5" tabindex="-1"></a>    matched_set_lists <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sizes, <span class="cf">function</span>(size) {</span>
<span id="cb445-6"><a href="two-way-fixed-effects.html#cb445-6" tabindex="-1"></a>        res_pm[[<span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag.&quot;</span>, size, <span class="st">&quot;m&quot;</span>)]]<span class="sc">$</span>att</span>
<span id="cb445-7"><a href="two-way-fixed-effects.html#cb445-7" tabindex="-1"></a>    })</span>
<span id="cb445-8"><a href="two-way-fixed-effects.html#cb445-8" tabindex="-1"></a>    </span>
<span id="cb445-9"><a href="two-way-fixed-effects.html#cb445-9" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb445-10"><a href="two-way-fixed-effects.html#cb445-10" tabindex="-1"></a>        <span class="fu">balance_scatter_custom</span>(</span>
<span id="cb445-11"><a href="two-way-fixed-effects.html#cb445-11" tabindex="-1"></a>            <span class="at">matched_set_list =</span> matched_set_lists,</span>
<span id="cb445-12"><a href="two-way-fixed-effects.html#cb445-12" tabindex="-1"></a>            <span class="at">legend.title =</span> <span class="st">&quot;Possible Matches&quot;</span>,</span>
<span id="cb445-13"><a href="two-way-fixed-effects.html#cb445-13" tabindex="-1"></a>            <span class="at">set.names =</span> <span class="fu">as.character</span>(sizes),</span>
<span id="cb445-14"><a href="two-way-fixed-effects.html#cb445-14" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>),</span>
<span id="cb445-15"><a href="two-way-fixed-effects.html#cb445-15" tabindex="-1"></a>            </span>
<span id="cb445-16"><a href="two-way-fixed-effects.html#cb445-16" tabindex="-1"></a>            <span class="co"># for compiled plot, you don&#39;t need x,y, or main labs</span></span>
<span id="cb445-17"><a href="two-way-fixed-effects.html#cb445-17" tabindex="-1"></a>            <span class="at">x.axis.label =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb445-18"><a href="two-way-fixed-effects.html#cb445-18" tabindex="-1"></a>            <span class="at">y.axis.label =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb445-19"><a href="two-way-fixed-effects.html#cb445-19" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb445-20"><a href="two-way-fixed-effects.html#cb445-20" tabindex="-1"></a>            <span class="at">data =</span> dem,</span>
<span id="cb445-21"><a href="two-way-fixed-effects.html#cb445-21" tabindex="-1"></a>            <span class="at">dot.size =</span> <span class="dv">5</span>,</span>
<span id="cb445-22"><a href="two-way-fixed-effects.html#cb445-22" tabindex="-1"></a>            <span class="co"># show.legend = F,</span></span>
<span id="cb445-23"><a href="two-way-fixed-effects.html#cb445-23" tabindex="-1"></a>            <span class="at">them_use =</span> causalverse<span class="sc">::</span><span class="fu">ama_theme</span>(<span class="at">base_size =</span> <span class="dv">32</span>),</span>
<span id="cb445-24"><a href="two-way-fixed-effects.html#cb445-24" tabindex="-1"></a>            <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;tradewb&quot;</span>)</span>
<span id="cb445-25"><a href="two-way-fixed-effects.html#cb445-25" tabindex="-1"></a>        )</span>
<span id="cb445-26"><a href="two-way-fixed-effects.html#cb445-26" tabindex="-1"></a>    )</span>
<span id="cb445-27"><a href="two-way-fixed-effects.html#cb445-27" tabindex="-1"></a>}</span>
<span id="cb445-28"><a href="two-way-fixed-effects.html#cb445-28" tabindex="-1"></a></span>
<span id="cb445-29"><a href="two-way-fixed-effects.html#cb445-29" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb445-30"><a href="two-way-fixed-effects.html#cb445-30" tabindex="-1"></a></span>
<span id="cb445-31"><a href="two-way-fixed-effects.html#cb445-31" tabindex="-1"></a><span class="cf">for</span> (method <span class="cf">in</span> methods) {</span>
<span id="cb445-32"><a href="two-way-fixed-effects.html#cb445-32" tabindex="-1"></a>    <span class="cf">for</span> (lag <span class="cf">in</span> lags) {</span>
<span id="cb445-33"><a href="two-way-fixed-effects.html#cb445-33" tabindex="-1"></a>        plots[[<span class="fu">paste0</span>(method, <span class="st">&quot;.&quot;</span>, lag, <span class="st">&quot;lag&quot;</span>)]] <span class="ot">&lt;-</span></span>
<span id="cb445-34"><a href="two-way-fixed-effects.html#cb445-34" tabindex="-1"></a>            <span class="fu">create_balance_plot</span>(method, lag, sizes, res_pm, dem)</span>
<span id="cb445-35"><a href="two-way-fixed-effects.html#cb445-35" tabindex="-1"></a>    }</span>
<span id="cb445-36"><a href="two-way-fixed-effects.html#cb445-36" tabindex="-1"></a>}</span>
<span id="cb445-37"><a href="two-way-fixed-effects.html#cb445-37" tabindex="-1"></a></span>
<span id="cb445-38"><a href="two-way-fixed-effects.html#cb445-38" tabindex="-1"></a><span class="co"># # Arranging plots in a 3x2 grid</span></span>
<span id="cb445-39"><a href="two-way-fixed-effects.html#cb445-39" tabindex="-1"></a><span class="co"># grid.arrange(plots[[&quot;mahalanobis.1lag&quot;]],</span></span>
<span id="cb445-40"><a href="two-way-fixed-effects.html#cb445-40" tabindex="-1"></a><span class="co">#              plots[[&quot;mahalanobis.4lag&quot;]],</span></span>
<span id="cb445-41"><a href="two-way-fixed-effects.html#cb445-41" tabindex="-1"></a><span class="co">#              plots[[&quot;ps.match.1lag&quot;]],</span></span>
<span id="cb445-42"><a href="two-way-fixed-effects.html#cb445-42" tabindex="-1"></a><span class="co">#              plots[[&quot;ps.match.4lag&quot;]],</span></span>
<span id="cb445-43"><a href="two-way-fixed-effects.html#cb445-43" tabindex="-1"></a><span class="co">#              plots[[&quot;ps.weight.1lag&quot;]],</span></span>
<span id="cb445-44"><a href="two-way-fixed-effects.html#cb445-44" tabindex="-1"></a><span class="co">#              plots[[&quot;ps.weight.4lag&quot;]],</span></span>
<span id="cb445-45"><a href="two-way-fixed-effects.html#cb445-45" tabindex="-1"></a><span class="co">#              ncol=2, nrow=3)</span></span>
<span id="cb445-46"><a href="two-way-fixed-effects.html#cb445-46" tabindex="-1"></a></span>
<span id="cb445-47"><a href="two-way-fixed-effects.html#cb445-47" tabindex="-1"></a></span>
<span id="cb445-48"><a href="two-way-fixed-effects.html#cb445-48" tabindex="-1"></a><span class="co"># Standardized Mean Difference of Covariates</span></span>
<span id="cb445-49"><a href="two-way-fixed-effects.html#cb445-49" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb445-50"><a href="two-way-fixed-effects.html#cb445-50" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb445-51"><a href="two-way-fixed-effects.html#cb445-51" tabindex="-1"></a></span>
<span id="cb445-52"><a href="two-way-fixed-effects.html#cb445-52" tabindex="-1"></a><span class="co"># Create column and row labels using textGrob</span></span>
<span id="cb445-53"><a href="two-way-fixed-effects.html#cb445-53" tabindex="-1"></a>col_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1-year Lag&quot;</span>, <span class="st">&quot;4-year Lag&quot;</span>)</span>
<span id="cb445-54"><a href="two-way-fixed-effects.html#cb445-54" tabindex="-1"></a>row_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Maha Matching&quot;</span>, <span class="st">&quot;PS Matching&quot;</span>, <span class="st">&quot;PS Weigthing&quot;</span>)</span>
<span id="cb445-55"><a href="two-way-fixed-effects.html#cb445-55" tabindex="-1"></a></span>
<span id="cb445-56"><a href="two-way-fixed-effects.html#cb445-56" tabindex="-1"></a>major.axes.fontsize <span class="ot">=</span> <span class="dv">40</span></span>
<span id="cb445-57"><a href="two-way-fixed-effects.html#cb445-57" tabindex="-1"></a>minor.axes.fontsize <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb445-58"><a href="two-way-fixed-effects.html#cb445-58" tabindex="-1"></a></span>
<span id="cb445-59"><a href="two-way-fixed-effects.html#cb445-59" tabindex="-1"></a><span class="fu">png</span>(</span>
<span id="cb445-60"><a href="two-way-fixed-effects.html#cb445-60" tabindex="-1"></a>    <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;images&quot;</span>, <span class="st">&quot;did_balance_scatter.png&quot;</span>),</span>
<span id="cb445-61"><a href="two-way-fixed-effects.html#cb445-61" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1200</span>,</span>
<span id="cb445-62"><a href="two-way-fixed-effects.html#cb445-62" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">1000</span></span>
<span id="cb445-63"><a href="two-way-fixed-effects.html#cb445-63" tabindex="-1"></a>)</span>
<span id="cb445-64"><a href="two-way-fixed-effects.html#cb445-64" tabindex="-1"></a></span>
<span id="cb445-65"><a href="two-way-fixed-effects.html#cb445-65" tabindex="-1"></a><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span id="cb445-66"><a href="two-way-fixed-effects.html#cb445-66" tabindex="-1"></a>grid_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb445-67"><a href="two-way-fixed-effects.html#cb445-67" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb445-68"><a href="two-way-fixed-effects.html#cb445-68" tabindex="-1"></a>        <span class="fu">nullGrob</span>(),</span>
<span id="cb445-69"><a href="two-way-fixed-effects.html#cb445-69" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">1</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb445-70"><a href="two-way-fixed-effects.html#cb445-70" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">2</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize))</span>
<span id="cb445-71"><a href="two-way-fixed-effects.html#cb445-71" tabindex="-1"></a>    ),</span>
<span id="cb445-72"><a href="two-way-fixed-effects.html#cb445-72" tabindex="-1"></a>    </span>
<span id="cb445-73"><a href="two-way-fixed-effects.html#cb445-73" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">textGrob</span>(</span>
<span id="cb445-74"><a href="two-way-fixed-effects.html#cb445-74" tabindex="-1"></a>        row_labels[<span class="dv">1</span>],</span>
<span id="cb445-75"><a href="two-way-fixed-effects.html#cb445-75" tabindex="-1"></a>        <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize),</span>
<span id="cb445-76"><a href="two-way-fixed-effects.html#cb445-76" tabindex="-1"></a>        <span class="at">rot =</span> <span class="dv">90</span></span>
<span id="cb445-77"><a href="two-way-fixed-effects.html#cb445-77" tabindex="-1"></a>    ), plots[[<span class="st">&quot;mahalanobis.1lag&quot;</span>]], plots[[<span class="st">&quot;mahalanobis.4lag&quot;</span>]]),</span>
<span id="cb445-78"><a href="two-way-fixed-effects.html#cb445-78" tabindex="-1"></a>    </span>
<span id="cb445-79"><a href="two-way-fixed-effects.html#cb445-79" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">textGrob</span>(</span>
<span id="cb445-80"><a href="two-way-fixed-effects.html#cb445-80" tabindex="-1"></a>        row_labels[<span class="dv">2</span>],</span>
<span id="cb445-81"><a href="two-way-fixed-effects.html#cb445-81" tabindex="-1"></a>        <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize),</span>
<span id="cb445-82"><a href="two-way-fixed-effects.html#cb445-82" tabindex="-1"></a>        <span class="at">rot =</span> <span class="dv">90</span></span>
<span id="cb445-83"><a href="two-way-fixed-effects.html#cb445-83" tabindex="-1"></a>    ), plots[[<span class="st">&quot;ps.match.1lag&quot;</span>]], plots[[<span class="st">&quot;ps.match.4lag&quot;</span>]]),</span>
<span id="cb445-84"><a href="two-way-fixed-effects.html#cb445-84" tabindex="-1"></a>    </span>
<span id="cb445-85"><a href="two-way-fixed-effects.html#cb445-85" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">textGrob</span>(</span>
<span id="cb445-86"><a href="two-way-fixed-effects.html#cb445-86" tabindex="-1"></a>        row_labels[<span class="dv">3</span>],</span>
<span id="cb445-87"><a href="two-way-fixed-effects.html#cb445-87" tabindex="-1"></a>        <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize),</span>
<span id="cb445-88"><a href="two-way-fixed-effects.html#cb445-88" tabindex="-1"></a>        <span class="at">rot =</span> <span class="dv">90</span></span>
<span id="cb445-89"><a href="two-way-fixed-effects.html#cb445-89" tabindex="-1"></a>    ), plots[[<span class="st">&quot;ps.weight.1lag&quot;</span>]], plots[[<span class="st">&quot;ps.weight.4lag&quot;</span>]])</span>
<span id="cb445-90"><a href="two-way-fixed-effects.html#cb445-90" tabindex="-1"></a>)</span>
<span id="cb445-91"><a href="two-way-fixed-effects.html#cb445-91" tabindex="-1"></a></span>
<span id="cb445-92"><a href="two-way-fixed-effects.html#cb445-92" tabindex="-1"></a><span class="co"># &quot;Flatten&quot; the list-of-lists into a single list of grobs</span></span>
<span id="cb445-93"><a href="two-way-fixed-effects.html#cb445-93" tabindex="-1"></a>grobs <span class="ot">&lt;-</span> <span class="fu">do.call</span>(c, grid_list)</span>
<span id="cb445-94"><a href="two-way-fixed-effects.html#cb445-94" tabindex="-1"></a></span>
<span id="cb445-95"><a href="two-way-fixed-effects.html#cb445-95" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb445-96"><a href="two-way-fixed-effects.html#cb445-96" tabindex="-1"></a>    <span class="at">grobs =</span> grobs,</span>
<span id="cb445-97"><a href="two-way-fixed-effects.html#cb445-97" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb445-98"><a href="two-way-fixed-effects.html#cb445-98" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">4</span>,</span>
<span id="cb445-99"><a href="two-way-fixed-effects.html#cb445-99" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.42</span>, <span class="fl">0.42</span>),</span>
<span id="cb445-100"><a href="two-way-fixed-effects.html#cb445-100" tabindex="-1"></a>    <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.28</span>, <span class="fl">0.28</span>, <span class="fl">0.28</span>)</span>
<span id="cb445-101"><a href="two-way-fixed-effects.html#cb445-101" tabindex="-1"></a>)</span>
<span id="cb445-102"><a href="two-way-fixed-effects.html#cb445-102" tabindex="-1"></a></span>
<span id="cb445-103"><a href="two-way-fixed-effects.html#cb445-103" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb445-104"><a href="two-way-fixed-effects.html#cb445-104" tabindex="-1"></a>    <span class="st">&quot;Before Refinement&quot;</span>,</span>
<span id="cb445-105"><a href="two-way-fixed-effects.html#cb445-105" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb445-106"><a href="two-way-fixed-effects.html#cb445-106" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.03</span>,</span>
<span id="cb445-107"><a href="two-way-fixed-effects.html#cb445-107" tabindex="-1"></a>    <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb445-108"><a href="two-way-fixed-effects.html#cb445-108" tabindex="-1"></a>)</span>
<span id="cb445-109"><a href="two-way-fixed-effects.html#cb445-109" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb445-110"><a href="two-way-fixed-effects.html#cb445-110" tabindex="-1"></a>    <span class="st">&quot;After Refinement&quot;</span>,</span>
<span id="cb445-111"><a href="two-way-fixed-effects.html#cb445-111" tabindex="-1"></a>    <span class="at">x =</span> <span class="fl">0.03</span>,</span>
<span id="cb445-112"><a href="two-way-fixed-effects.html#cb445-112" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.5</span>,</span>
<span id="cb445-113"><a href="two-way-fixed-effects.html#cb445-113" tabindex="-1"></a>    <span class="at">rot =</span> <span class="dv">90</span>,</span>
<span id="cb445-114"><a href="two-way-fixed-effects.html#cb445-114" tabindex="-1"></a>    <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb445-115"><a href="two-way-fixed-effects.html#cb445-115" tabindex="-1"></a>)</span>
<span id="cb445-116"><a href="two-way-fixed-effects.html#cb445-116" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb445-117"><a href="two-way-fixed-effects.html#cb445-117" tabindex="-1"></a><span class="co">#&gt; png </span></span>
<span id="cb445-118"><a href="two-way-fixed-effects.html#cb445-118" tabindex="-1"></a><span class="co">#&gt;   2</span></span></code></pre></div>
<p>Note: Scatter plots display the standardized mean difference of each covariate <span class="math inline">\(j\)</span> and lag year <span class="math inline">\(l\)</span> as defined in Equation <a href="#eq:aggbalance">(<strong>??</strong>)</a> before (x-axis) and after (y-axis) matched set refinement. Each plot includes varying numbers of possible matches for each matching method. Rows represent different matching/weighting methods, while columns indicate adjustments for various lag lengths.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="two-way-fixed-effects.html#cb446-1" tabindex="-1"></a><span class="co"># Step 1: Define configurations</span></span>
<span id="cb446-2"><a href="two-way-fixed-effects.html#cb446-2" tabindex="-1"></a>configurations <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb446-3"><a href="two-way-fixed-effects.html#cb446-3" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;none&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>),</span>
<span id="cb446-4"><a href="two-way-fixed-effects.html#cb446-4" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;none&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>),</span>
<span id="cb446-5"><a href="two-way-fixed-effects.html#cb446-5" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;mahalanobis&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>),</span>
<span id="cb446-6"><a href="two-way-fixed-effects.html#cb446-6" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;mahalanobis&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>),</span>
<span id="cb446-7"><a href="two-way-fixed-effects.html#cb446-7" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;ps.match&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>),</span>
<span id="cb446-8"><a href="two-way-fixed-effects.html#cb446-8" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;ps.match&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>),</span>
<span id="cb446-9"><a href="two-way-fixed-effects.html#cb446-9" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;ps.weight&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;att&quot;</span>),</span>
<span id="cb446-10"><a href="two-way-fixed-effects.html#cb446-10" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">refinement.method =</span> <span class="st">&quot;ps.weight&quot;</span>, <span class="at">qoi =</span> <span class="st">&quot;art&quot;</span>)</span>
<span id="cb446-11"><a href="two-way-fixed-effects.html#cb446-11" tabindex="-1"></a>)</span>
<span id="cb446-12"><a href="two-way-fixed-effects.html#cb446-12" tabindex="-1"></a></span>
<span id="cb446-13"><a href="two-way-fixed-effects.html#cb446-13" tabindex="-1"></a><span class="co"># Step 2: Use lapply or loop to generate results</span></span>
<span id="cb446-14"><a href="two-way-fixed-effects.html#cb446-14" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(configurations, <span class="cf">function</span>(config) {</span>
<span id="cb446-15"><a href="two-way-fixed-effects.html#cb446-15" tabindex="-1"></a>    <span class="fu">PanelMatch</span>(</span>
<span id="cb446-16"><a href="two-way-fixed-effects.html#cb446-16" tabindex="-1"></a>        <span class="at">lag                       =</span> <span class="dv">4</span>,</span>
<span id="cb446-17"><a href="two-way-fixed-effects.html#cb446-17" tabindex="-1"></a>        <span class="at">time.id                   =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb446-18"><a href="two-way-fixed-effects.html#cb446-18" tabindex="-1"></a>        <span class="at">unit.id                   =</span> <span class="st">&quot;wbcode2&quot;</span>,</span>
<span id="cb446-19"><a href="two-way-fixed-effects.html#cb446-19" tabindex="-1"></a>        <span class="at">treatment                 =</span> <span class="st">&quot;dem&quot;</span>,</span>
<span id="cb446-20"><a href="two-way-fixed-effects.html#cb446-20" tabindex="-1"></a>        <span class="at">data                      =</span> dem,</span>
<span id="cb446-21"><a href="two-way-fixed-effects.html#cb446-21" tabindex="-1"></a>        <span class="at">match.missing             =</span> <span class="cn">FALSE</span>,</span>
<span id="cb446-22"><a href="two-way-fixed-effects.html#cb446-22" tabindex="-1"></a>        <span class="at">listwise.delete           =</span> <span class="cn">TRUE</span>,</span>
<span id="cb446-23"><a href="two-way-fixed-effects.html#cb446-23" tabindex="-1"></a>        <span class="at">size.match                =</span> <span class="dv">5</span>,</span>
<span id="cb446-24"><a href="two-way-fixed-effects.html#cb446-24" tabindex="-1"></a>        <span class="at">outcome.var               =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb446-25"><a href="two-way-fixed-effects.html#cb446-25" tabindex="-1"></a>        <span class="at">lead                      =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb446-26"><a href="two-way-fixed-effects.html#cb446-26" tabindex="-1"></a>        <span class="at">forbid.treatment.reversal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb446-27"><a href="two-way-fixed-effects.html#cb446-27" tabindex="-1"></a>        <span class="at">refinement.method         =</span> config<span class="sc">$</span>refinement.method,</span>
<span id="cb446-28"><a href="two-way-fixed-effects.html#cb446-28" tabindex="-1"></a>        <span class="at">covs.formula              =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">lag</span>(tradewb, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">lag</span>(y, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb446-29"><a href="two-way-fixed-effects.html#cb446-29" tabindex="-1"></a>        <span class="at">qoi                       =</span> config<span class="sc">$</span>qoi</span>
<span id="cb446-30"><a href="two-way-fixed-effects.html#cb446-30" tabindex="-1"></a>    )</span>
<span id="cb446-31"><a href="two-way-fixed-effects.html#cb446-31" tabindex="-1"></a>})</span>
<span id="cb446-32"><a href="two-way-fixed-effects.html#cb446-32" tabindex="-1"></a></span>
<span id="cb446-33"><a href="two-way-fixed-effects.html#cb446-33" tabindex="-1"></a><span class="co"># Step 3: Get covariate balance and plot</span></span>
<span id="cb446-34"><a href="two-way-fixed-effects.html#cb446-34" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">mapply</span>(<span class="cf">function</span>(result, config) {</span>
<span id="cb446-35"><a href="two-way-fixed-effects.html#cb446-35" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">get_covariate_balance</span>(</span>
<span id="cb446-36"><a href="two-way-fixed-effects.html#cb446-36" tabindex="-1"></a>        <span class="cf">if</span> (config<span class="sc">$</span>qoi <span class="sc">==</span> <span class="st">&quot;att&quot;</span>)</span>
<span id="cb446-37"><a href="two-way-fixed-effects.html#cb446-37" tabindex="-1"></a>            result<span class="sc">$</span>att</span>
<span id="cb446-38"><a href="two-way-fixed-effects.html#cb446-38" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb446-39"><a href="two-way-fixed-effects.html#cb446-39" tabindex="-1"></a>            result<span class="sc">$</span>art,</span>
<span id="cb446-40"><a href="two-way-fixed-effects.html#cb446-40" tabindex="-1"></a>        <span class="at">data =</span> dem,</span>
<span id="cb446-41"><a href="two-way-fixed-effects.html#cb446-41" tabindex="-1"></a>        <span class="at">covariates =</span> <span class="fu">c</span>(<span class="st">&quot;tradewb&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb446-42"><a href="two-way-fixed-effects.html#cb446-42" tabindex="-1"></a>        <span class="at">plot =</span> F</span>
<span id="cb446-43"><a href="two-way-fixed-effects.html#cb446-43" tabindex="-1"></a>    )</span>
<span id="cb446-44"><a href="two-way-fixed-effects.html#cb446-44" tabindex="-1"></a>    causalverse<span class="sc">::</span><span class="fu">plot_covariate_balance_pretrend</span>(df, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_legend =</span> F)</span>
<span id="cb446-45"><a href="two-way-fixed-effects.html#cb446-45" tabindex="-1"></a>}, results, configurations, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb446-46"><a href="two-way-fixed-effects.html#cb446-46" tabindex="-1"></a></span>
<span id="cb446-47"><a href="two-way-fixed-effects.html#cb446-47" tabindex="-1"></a><span class="co"># Set names for plots</span></span>
<span id="cb446-48"><a href="two-way-fixed-effects.html#cb446-48" tabindex="-1"></a><span class="fu">names</span>(plots) <span class="ot">&lt;-</span> <span class="fu">sapply</span>(configurations, <span class="cf">function</span>(config) {</span>
<span id="cb446-49"><a href="two-way-fixed-effects.html#cb446-49" tabindex="-1"></a>    <span class="fu">paste</span>(config<span class="sc">$</span>qoi, config<span class="sc">$</span>refinement.method, <span class="at">sep =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb446-50"><a href="two-way-fixed-effects.html#cb446-50" tabindex="-1"></a>})</span></code></pre></div>
<p>To export</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="two-way-fixed-effects.html#cb447-1" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb447-2"><a href="two-way-fixed-effects.html#cb447-2" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb447-3"><a href="two-way-fixed-effects.html#cb447-3" tabindex="-1"></a></span>
<span id="cb447-4"><a href="two-way-fixed-effects.html#cb447-4" tabindex="-1"></a><span class="co"># Column and row labels</span></span>
<span id="cb447-5"><a href="two-way-fixed-effects.html#cb447-5" tabindex="-1"></a>col_labels <span class="ot">&lt;-</span></span>
<span id="cb447-6"><a href="two-way-fixed-effects.html#cb447-6" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;None&quot;</span>,</span>
<span id="cb447-7"><a href="two-way-fixed-effects.html#cb447-7" tabindex="-1"></a>      <span class="st">&quot;Mahalanobis&quot;</span>,</span>
<span id="cb447-8"><a href="two-way-fixed-effects.html#cb447-8" tabindex="-1"></a>      <span class="st">&quot;Propensity Score Matching&quot;</span>,</span>
<span id="cb447-9"><a href="two-way-fixed-effects.html#cb447-9" tabindex="-1"></a>      <span class="st">&quot;Propensity Score Weighting&quot;</span>)</span>
<span id="cb447-10"><a href="two-way-fixed-effects.html#cb447-10" tabindex="-1"></a>row_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ATT&quot;</span>, <span class="st">&quot;ART&quot;</span>)</span>
<span id="cb447-11"><a href="two-way-fixed-effects.html#cb447-11" tabindex="-1"></a></span>
<span id="cb447-12"><a href="two-way-fixed-effects.html#cb447-12" tabindex="-1"></a><span class="co"># Specify your desired fontsize for labels</span></span>
<span id="cb447-13"><a href="two-way-fixed-effects.html#cb447-13" tabindex="-1"></a>minor.axes.fontsize <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb447-14"><a href="two-way-fixed-effects.html#cb447-14" tabindex="-1"></a>major.axes.fontsize <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb447-15"><a href="two-way-fixed-effects.html#cb447-15" tabindex="-1"></a></span>
<span id="cb447-16"><a href="two-way-fixed-effects.html#cb447-16" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;images&quot;</span>, <span class="st">&quot;p_covariate_balance.png&quot;</span>), <span class="at">width=</span><span class="dv">1200</span>, <span class="at">height=</span><span class="dv">1000</span>)</span>
<span id="cb447-17"><a href="two-way-fixed-effects.html#cb447-17" tabindex="-1"></a></span>
<span id="cb447-18"><a href="two-way-fixed-effects.html#cb447-18" tabindex="-1"></a><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span id="cb447-19"><a href="two-way-fixed-effects.html#cb447-19" tabindex="-1"></a>grid_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb447-20"><a href="two-way-fixed-effects.html#cb447-20" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb447-21"><a href="two-way-fixed-effects.html#cb447-21" tabindex="-1"></a>        <span class="fu">nullGrob</span>(),</span>
<span id="cb447-22"><a href="two-way-fixed-effects.html#cb447-22" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">1</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb447-23"><a href="two-way-fixed-effects.html#cb447-23" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">2</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb447-24"><a href="two-way-fixed-effects.html#cb447-24" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">3</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb447-25"><a href="two-way-fixed-effects.html#cb447-25" tabindex="-1"></a>        <span class="fu">textGrob</span>(col_labels[<span class="dv">4</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize))</span>
<span id="cb447-26"><a href="two-way-fixed-effects.html#cb447-26" tabindex="-1"></a>    ),</span>
<span id="cb447-27"><a href="two-way-fixed-effects.html#cb447-27" tabindex="-1"></a>    </span>
<span id="cb447-28"><a href="two-way-fixed-effects.html#cb447-28" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb447-29"><a href="two-way-fixed-effects.html#cb447-29" tabindex="-1"></a>        <span class="fu">textGrob</span>(</span>
<span id="cb447-30"><a href="two-way-fixed-effects.html#cb447-30" tabindex="-1"></a>            row_labels[<span class="dv">1</span>],</span>
<span id="cb447-31"><a href="two-way-fixed-effects.html#cb447-31" tabindex="-1"></a>            <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize),</span>
<span id="cb447-32"><a href="two-way-fixed-effects.html#cb447-32" tabindex="-1"></a>            <span class="at">rot =</span> <span class="dv">90</span></span>
<span id="cb447-33"><a href="two-way-fixed-effects.html#cb447-33" tabindex="-1"></a>        ),</span>
<span id="cb447-34"><a href="two-way-fixed-effects.html#cb447-34" tabindex="-1"></a>        plots<span class="sc">$</span>att.none,</span>
<span id="cb447-35"><a href="two-way-fixed-effects.html#cb447-35" tabindex="-1"></a>        plots<span class="sc">$</span>att.mahalanobis,</span>
<span id="cb447-36"><a href="two-way-fixed-effects.html#cb447-36" tabindex="-1"></a>        plots<span class="sc">$</span>att.ps.match,</span>
<span id="cb447-37"><a href="two-way-fixed-effects.html#cb447-37" tabindex="-1"></a>        plots<span class="sc">$</span>att.ps.weight</span>
<span id="cb447-38"><a href="two-way-fixed-effects.html#cb447-38" tabindex="-1"></a>    ),</span>
<span id="cb447-39"><a href="two-way-fixed-effects.html#cb447-39" tabindex="-1"></a>    </span>
<span id="cb447-40"><a href="two-way-fixed-effects.html#cb447-40" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb447-41"><a href="two-way-fixed-effects.html#cb447-41" tabindex="-1"></a>        <span class="fu">textGrob</span>(</span>
<span id="cb447-42"><a href="two-way-fixed-effects.html#cb447-42" tabindex="-1"></a>            row_labels[<span class="dv">2</span>],</span>
<span id="cb447-43"><a href="two-way-fixed-effects.html#cb447-43" tabindex="-1"></a>            <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize),</span>
<span id="cb447-44"><a href="two-way-fixed-effects.html#cb447-44" tabindex="-1"></a>            <span class="at">rot =</span> <span class="dv">90</span></span>
<span id="cb447-45"><a href="two-way-fixed-effects.html#cb447-45" tabindex="-1"></a>        ),</span>
<span id="cb447-46"><a href="two-way-fixed-effects.html#cb447-46" tabindex="-1"></a>        plots<span class="sc">$</span>art.none,</span>
<span id="cb447-47"><a href="two-way-fixed-effects.html#cb447-47" tabindex="-1"></a>        plots<span class="sc">$</span>art.mahalanobis,</span>
<span id="cb447-48"><a href="two-way-fixed-effects.html#cb447-48" tabindex="-1"></a>        plots<span class="sc">$</span>art.ps.match,</span>
<span id="cb447-49"><a href="two-way-fixed-effects.html#cb447-49" tabindex="-1"></a>        plots<span class="sc">$</span>art.ps.weight</span>
<span id="cb447-50"><a href="two-way-fixed-effects.html#cb447-50" tabindex="-1"></a>    )</span>
<span id="cb447-51"><a href="two-way-fixed-effects.html#cb447-51" tabindex="-1"></a>)</span>
<span id="cb447-52"><a href="two-way-fixed-effects.html#cb447-52" tabindex="-1"></a></span>
<span id="cb447-53"><a href="two-way-fixed-effects.html#cb447-53" tabindex="-1"></a><span class="co"># &quot;Flatten&quot; the list-of-lists into a single list of grobs</span></span>
<span id="cb447-54"><a href="two-way-fixed-effects.html#cb447-54" tabindex="-1"></a>grobs <span class="ot">&lt;-</span> <span class="fu">do.call</span>(c, grid_list)</span>
<span id="cb447-55"><a href="two-way-fixed-effects.html#cb447-55" tabindex="-1"></a></span>
<span id="cb447-56"><a href="two-way-fixed-effects.html#cb447-56" tabindex="-1"></a><span class="co"># Arrange your plots with text labels</span></span>
<span id="cb447-57"><a href="two-way-fixed-effects.html#cb447-57" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb447-58"><a href="two-way-fixed-effects.html#cb447-58" tabindex="-1"></a>    <span class="at">grobs   =</span> grobs,</span>
<span id="cb447-59"><a href="two-way-fixed-effects.html#cb447-59" tabindex="-1"></a>    <span class="at">ncol    =</span> <span class="dv">5</span>,</span>
<span id="cb447-60"><a href="two-way-fixed-effects.html#cb447-60" tabindex="-1"></a>    <span class="at">nrow    =</span> <span class="dv">3</span>,</span>
<span id="cb447-61"><a href="two-way-fixed-effects.html#cb447-61" tabindex="-1"></a>    <span class="at">widths  =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span>, <span class="fl">0.225</span>),</span>
<span id="cb447-62"><a href="two-way-fixed-effects.html#cb447-62" tabindex="-1"></a>    <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.45</span>, <span class="fl">0.45</span>)</span>
<span id="cb447-63"><a href="two-way-fixed-effects.html#cb447-63" tabindex="-1"></a>)</span>
<span id="cb447-64"><a href="two-way-fixed-effects.html#cb447-64" tabindex="-1"></a></span>
<span id="cb447-65"><a href="two-way-fixed-effects.html#cb447-65" tabindex="-1"></a><span class="co"># Add main x and y axis titles</span></span>
<span id="cb447-66"><a href="two-way-fixed-effects.html#cb447-66" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb447-67"><a href="two-way-fixed-effects.html#cb447-67" tabindex="-1"></a>    <span class="st">&quot;Refinement Methods&quot;</span>,</span>
<span id="cb447-68"><a href="two-way-fixed-effects.html#cb447-68" tabindex="-1"></a>    <span class="at">x  =</span> <span class="fl">0.5</span>,</span>
<span id="cb447-69"><a href="two-way-fixed-effects.html#cb447-69" tabindex="-1"></a>    <span class="at">y  =</span> <span class="fl">0.01</span>,</span>
<span id="cb447-70"><a href="two-way-fixed-effects.html#cb447-70" tabindex="-1"></a>    <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb447-71"><a href="two-way-fixed-effects.html#cb447-71" tabindex="-1"></a>)</span>
<span id="cb447-72"><a href="two-way-fixed-effects.html#cb447-72" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb447-73"><a href="two-way-fixed-effects.html#cb447-73" tabindex="-1"></a>    <span class="st">&quot;Quantities of Interest&quot;</span>,</span>
<span id="cb447-74"><a href="two-way-fixed-effects.html#cb447-74" tabindex="-1"></a>    <span class="at">x   =</span> <span class="fl">0.02</span>,</span>
<span id="cb447-75"><a href="two-way-fixed-effects.html#cb447-75" tabindex="-1"></a>    <span class="at">y   =</span> <span class="fl">0.5</span>,</span>
<span id="cb447-76"><a href="two-way-fixed-effects.html#cb447-76" tabindex="-1"></a>    <span class="at">rot =</span> <span class="dv">90</span>,</span>
<span id="cb447-77"><a href="two-way-fixed-effects.html#cb447-77" tabindex="-1"></a>    <span class="at">gp  =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb447-78"><a href="two-way-fixed-effects.html#cb447-78" tabindex="-1"></a>)</span>
<span id="cb447-79"><a href="two-way-fixed-effects.html#cb447-79" tabindex="-1"></a></span>
<span id="cb447-80"><a href="two-way-fixed-effects.html#cb447-80" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="two-way-fixed-effects.html#cb448-1" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb448-2"><a href="two-way-fixed-effects.html#cb448-2" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;images&quot;</span>, <span class="st">&quot;p_covariate_balance.png&quot;</span>))</span></code></pre></div>
<p><img src="images/p_covariate_balance.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Note: Each graph displays the standardized mean difference, as outlined in Equation <a href="#eq:aggbalance">(<strong>??</strong>)</a>, plotted on the vertical axis across a pre-treatment duration of four years represented on the horizontal axis. The leftmost column illustrates the balance prior to refinement, while the subsequent three columns depict the covariate balance post the application of distinct refinement techniques. Each individual line signifies the balance of a specific variable during the pre-treatment phase.The red line is tradewb and blue line is the lagged outcome variable.</p>
<p>In Figure <a href="#fig:balancepretreat"><strong>??</strong></a>, we observe a marked improvement in covariate balance due to the implemented matching procedures during the pre-treatment period. Our analysis prioritizes methods that adjust for time-varying covariates over a span of four years preceding the treatment initiation. The two rows delineate the standardized mean balance for both treatment modalities, with individual lines representing the balance for each covariate.</p>
<p>Across all scenarios, the refinement attributed to matched sets significantly enhances balance. Notably, using propensity score weighting considerably mitigates imbalances in confounders. While some degree of imbalance remains evident in the Mahalanobis distance and propensity score matching techniques, the standardized mean difference for the lagged outcome remains stable throughout the pre-treatment phase. This consistency lends credence to the validity of the proposed DiD estimator.</p>
<p><strong>Estimation Results</strong></p>
<p>We now detail the estimated ATTs derived from the matching techniques. Figure below offers visual representations of the impacts of treatment initiation (upper panel) and treatment reversal (lower panel) on the outcome variable for a duration of 5 years post-transition, specifically, (F = 0, 1, …, 4). Across the five methods (columns), it becomes evident that the point estimates of effects associated with treatment initiation consistently approximate zero over the 5-year window. In contrast, the estimated outcomes of treatment reversal are notably negative and maintain statistical significance through all refinement techniques during the initial year of transition and the 1 to 4 years that follow, provided treatment reversal is permissible. These effects are notably pronounced, pointing to an estimated reduction of roughly X% in the outcome variable.</p>
<p>Collectively, these findings indicate that the transition into the treated state from its absence doesn’t invariably lead to a heightened outcome. Instead, the transition from the treated state back to its absence exerts a considerable negative effect on the outcome variable in both the short and intermediate terms. Hence, the positive effect of the treatment (if we were to use traditional DiD) is actually driven by the negative effect of treatment reversal.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="two-way-fixed-effects.html#cb449-1" tabindex="-1"></a><span class="co"># sequential</span></span>
<span id="cb449-2"><a href="two-way-fixed-effects.html#cb449-2" tabindex="-1"></a><span class="co"># Step 1: Apply PanelEstimate function</span></span>
<span id="cb449-3"><a href="two-way-fixed-effects.html#cb449-3" tabindex="-1"></a></span>
<span id="cb449-4"><a href="two-way-fixed-effects.html#cb449-4" tabindex="-1"></a><span class="co"># Initialize an empty list to store results</span></span>
<span id="cb449-5"><a href="two-way-fixed-effects.html#cb449-5" tabindex="-1"></a>res_est <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(res_pm))</span>
<span id="cb449-6"><a href="two-way-fixed-effects.html#cb449-6" tabindex="-1"></a></span>
<span id="cb449-7"><a href="two-way-fixed-effects.html#cb449-7" tabindex="-1"></a><span class="co"># Iterate over each element in res_pm</span></span>
<span id="cb449-8"><a href="two-way-fixed-effects.html#cb449-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_pm)) {</span>
<span id="cb449-9"><a href="two-way-fixed-effects.html#cb449-9" tabindex="-1"></a>  res_est[[i]] <span class="ot">&lt;-</span> <span class="fu">PanelEstimate</span>(</span>
<span id="cb449-10"><a href="two-way-fixed-effects.html#cb449-10" tabindex="-1"></a>    res_pm[[i]],</span>
<span id="cb449-11"><a href="two-way-fixed-effects.html#cb449-11" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb449-12"><a href="two-way-fixed-effects.html#cb449-12" tabindex="-1"></a>    <span class="at">se.method =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb449-13"><a href="two-way-fixed-effects.html#cb449-13" tabindex="-1"></a>    <span class="at">number.iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb449-14"><a href="two-way-fixed-effects.html#cb449-14" tabindex="-1"></a>    <span class="at">confidence.level =</span> .<span class="dv">95</span></span>
<span id="cb449-15"><a href="two-way-fixed-effects.html#cb449-15" tabindex="-1"></a>  )</span>
<span id="cb449-16"><a href="two-way-fixed-effects.html#cb449-16" tabindex="-1"></a>  <span class="co"># Transfer the name of the current element to the res_est list</span></span>
<span id="cb449-17"><a href="two-way-fixed-effects.html#cb449-17" tabindex="-1"></a>  <span class="fu">names</span>(res_est)[i] <span class="ot">&lt;-</span> <span class="fu">names</span>(res_pm)[i]</span>
<span id="cb449-18"><a href="two-way-fixed-effects.html#cb449-18" tabindex="-1"></a>}</span>
<span id="cb449-19"><a href="two-way-fixed-effects.html#cb449-19" tabindex="-1"></a></span>
<span id="cb449-20"><a href="two-way-fixed-effects.html#cb449-20" tabindex="-1"></a><span class="co"># Step 2: Apply plot_PanelEstimate function</span></span>
<span id="cb449-21"><a href="two-way-fixed-effects.html#cb449-21" tabindex="-1"></a></span>
<span id="cb449-22"><a href="two-way-fixed-effects.html#cb449-22" tabindex="-1"></a><span class="co"># Initialize an empty list to store plot results</span></span>
<span id="cb449-23"><a href="two-way-fixed-effects.html#cb449-23" tabindex="-1"></a>res_est_plot <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(res_est))</span>
<span id="cb449-24"><a href="two-way-fixed-effects.html#cb449-24" tabindex="-1"></a></span>
<span id="cb449-25"><a href="two-way-fixed-effects.html#cb449-25" tabindex="-1"></a><span class="co"># Iterate over each element in res_est</span></span>
<span id="cb449-26"><a href="two-way-fixed-effects.html#cb449-26" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_est)) {</span>
<span id="cb449-27"><a href="two-way-fixed-effects.html#cb449-27" tabindex="-1"></a>    res_est_plot[[i]] <span class="ot">&lt;-</span></span>
<span id="cb449-28"><a href="two-way-fixed-effects.html#cb449-28" tabindex="-1"></a>        <span class="fu">plot_PanelEstimate</span>(res_est[[i]],</span>
<span id="cb449-29"><a href="two-way-fixed-effects.html#cb449-29" tabindex="-1"></a>                           <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb449-30"><a href="two-way-fixed-effects.html#cb449-30" tabindex="-1"></a>                           <span class="at">theme_use =</span> causalverse<span class="sc">::</span><span class="fu">ama_theme</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb449-31"><a href="two-way-fixed-effects.html#cb449-31" tabindex="-1"></a>    <span class="co"># Transfer the name of the current element to the res_est_plot list</span></span>
<span id="cb449-32"><a href="two-way-fixed-effects.html#cb449-32" tabindex="-1"></a>    <span class="fu">names</span>(res_est_plot)[i] <span class="ot">&lt;-</span> <span class="fu">names</span>(res_est)[i]</span>
<span id="cb449-33"><a href="two-way-fixed-effects.html#cb449-33" tabindex="-1"></a>}</span>
<span id="cb449-34"><a href="two-way-fixed-effects.html#cb449-34" tabindex="-1"></a></span>
<span id="cb449-35"><a href="two-way-fixed-effects.html#cb449-35" tabindex="-1"></a><span class="co"># check results</span></span>
<span id="cb449-36"><a href="two-way-fixed-effects.html#cb449-36" tabindex="-1"></a><span class="co"># res_est_plot$mahalanobis.1lag.5m</span></span>
<span id="cb449-37"><a href="two-way-fixed-effects.html#cb449-37" tabindex="-1"></a></span>
<span id="cb449-38"><a href="two-way-fixed-effects.html#cb449-38" tabindex="-1"></a></span>
<span id="cb449-39"><a href="two-way-fixed-effects.html#cb449-39" tabindex="-1"></a><span class="co"># Step 1: Apply PanelEstimate function for res_pm_rev</span></span>
<span id="cb449-40"><a href="two-way-fixed-effects.html#cb449-40" tabindex="-1"></a></span>
<span id="cb449-41"><a href="two-way-fixed-effects.html#cb449-41" tabindex="-1"></a><span class="co"># Initialize an empty list to store results</span></span>
<span id="cb449-42"><a href="two-way-fixed-effects.html#cb449-42" tabindex="-1"></a>res_est_rev <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(res_pm_rev))</span>
<span id="cb449-43"><a href="two-way-fixed-effects.html#cb449-43" tabindex="-1"></a></span>
<span id="cb449-44"><a href="two-way-fixed-effects.html#cb449-44" tabindex="-1"></a><span class="co"># Iterate over each element in res_pm_rev</span></span>
<span id="cb449-45"><a href="two-way-fixed-effects.html#cb449-45" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_pm_rev)) {</span>
<span id="cb449-46"><a href="two-way-fixed-effects.html#cb449-46" tabindex="-1"></a>  res_est_rev[[i]] <span class="ot">&lt;-</span> <span class="fu">PanelEstimate</span>(</span>
<span id="cb449-47"><a href="two-way-fixed-effects.html#cb449-47" tabindex="-1"></a>    res_pm_rev[[i]],</span>
<span id="cb449-48"><a href="two-way-fixed-effects.html#cb449-48" tabindex="-1"></a>    <span class="at">data =</span> dem,</span>
<span id="cb449-49"><a href="two-way-fixed-effects.html#cb449-49" tabindex="-1"></a>    <span class="at">se.method =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb449-50"><a href="two-way-fixed-effects.html#cb449-50" tabindex="-1"></a>    <span class="at">number.iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb449-51"><a href="two-way-fixed-effects.html#cb449-51" tabindex="-1"></a>    <span class="at">confidence.level =</span> .<span class="dv">95</span></span>
<span id="cb449-52"><a href="two-way-fixed-effects.html#cb449-52" tabindex="-1"></a>  )</span>
<span id="cb449-53"><a href="two-way-fixed-effects.html#cb449-53" tabindex="-1"></a>  <span class="co"># Transfer the name of the current element to the res_est_rev list</span></span>
<span id="cb449-54"><a href="two-way-fixed-effects.html#cb449-54" tabindex="-1"></a>  <span class="fu">names</span>(res_est_rev)[i] <span class="ot">&lt;-</span> <span class="fu">names</span>(res_pm_rev)[i]</span>
<span id="cb449-55"><a href="two-way-fixed-effects.html#cb449-55" tabindex="-1"></a>}</span>
<span id="cb449-56"><a href="two-way-fixed-effects.html#cb449-56" tabindex="-1"></a></span>
<span id="cb449-57"><a href="two-way-fixed-effects.html#cb449-57" tabindex="-1"></a><span class="co"># Step 2: Apply plot_PanelEstimate function for res_est_rev</span></span>
<span id="cb449-58"><a href="two-way-fixed-effects.html#cb449-58" tabindex="-1"></a></span>
<span id="cb449-59"><a href="two-way-fixed-effects.html#cb449-59" tabindex="-1"></a><span class="co"># Initialize an empty list to store plot results</span></span>
<span id="cb449-60"><a href="two-way-fixed-effects.html#cb449-60" tabindex="-1"></a>res_est_plot_rev <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(res_est_rev))</span>
<span id="cb449-61"><a href="two-way-fixed-effects.html#cb449-61" tabindex="-1"></a></span>
<span id="cb449-62"><a href="two-way-fixed-effects.html#cb449-62" tabindex="-1"></a><span class="co"># Iterate over each element in res_est_rev</span></span>
<span id="cb449-63"><a href="two-way-fixed-effects.html#cb449-63" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_est_rev)) {</span>
<span id="cb449-64"><a href="two-way-fixed-effects.html#cb449-64" tabindex="-1"></a>    res_est_plot_rev[[i]] <span class="ot">&lt;-</span></span>
<span id="cb449-65"><a href="two-way-fixed-effects.html#cb449-65" tabindex="-1"></a>        <span class="fu">plot_PanelEstimate</span>(res_est_rev[[i]],</span>
<span id="cb449-66"><a href="two-way-fixed-effects.html#cb449-66" tabindex="-1"></a>                           <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb449-67"><a href="two-way-fixed-effects.html#cb449-67" tabindex="-1"></a>                           <span class="at">theme_use =</span> causalverse<span class="sc">::</span><span class="fu">ama_theme</span>(<span class="at">base_size =</span> <span class="dv">14</span>))</span>
<span id="cb449-68"><a href="two-way-fixed-effects.html#cb449-68" tabindex="-1"></a>  <span class="co"># Transfer the name of the current element to the res_est_plot_rev list</span></span>
<span id="cb449-69"><a href="two-way-fixed-effects.html#cb449-69" tabindex="-1"></a>  <span class="fu">names</span>(res_est_plot_rev)[i] <span class="ot">&lt;-</span> <span class="fu">names</span>(res_est_rev)[i]</span>
<span id="cb449-70"><a href="two-way-fixed-effects.html#cb449-70" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="two-way-fixed-effects.html#cb450-1" tabindex="-1"></a><span class="co"># parallel</span></span>
<span id="cb450-2"><a href="two-way-fixed-effects.html#cb450-2" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb450-3"><a href="two-way-fixed-effects.html#cb450-3" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb450-4"><a href="two-way-fixed-effects.html#cb450-4" tabindex="-1"></a></span>
<span id="cb450-5"><a href="two-way-fixed-effects.html#cb450-5" tabindex="-1"></a><span class="co"># Detect the number of cores to use for parallel processing</span></span>
<span id="cb450-6"><a href="two-way-fixed-effects.html#cb450-6" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb450-7"><a href="two-way-fixed-effects.html#cb450-7" tabindex="-1"></a></span>
<span id="cb450-8"><a href="two-way-fixed-effects.html#cb450-8" tabindex="-1"></a><span class="co"># Register the parallel backend</span></span>
<span id="cb450-9"><a href="two-way-fixed-effects.html#cb450-9" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(num_cores)</span>
<span id="cb450-10"><a href="two-way-fixed-effects.html#cb450-10" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb450-11"><a href="two-way-fixed-effects.html#cb450-11" tabindex="-1"></a></span>
<span id="cb450-12"><a href="two-way-fixed-effects.html#cb450-12" tabindex="-1"></a><span class="co"># Step 1: Apply PanelEstimate function in parallel</span></span>
<span id="cb450-13"><a href="two-way-fixed-effects.html#cb450-13" tabindex="-1"></a>res_est <span class="ot">&lt;-</span></span>
<span id="cb450-14"><a href="two-way-fixed-effects.html#cb450-14" tabindex="-1"></a>    <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_pm), <span class="at">.packages =</span> <span class="st">&quot;PanelMatch&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb450-15"><a href="two-way-fixed-effects.html#cb450-15" tabindex="-1"></a>        <span class="fu">PanelEstimate</span>(</span>
<span id="cb450-16"><a href="two-way-fixed-effects.html#cb450-16" tabindex="-1"></a>            res_pm[[i]],</span>
<span id="cb450-17"><a href="two-way-fixed-effects.html#cb450-17" tabindex="-1"></a>            <span class="at">data =</span> dem,</span>
<span id="cb450-18"><a href="two-way-fixed-effects.html#cb450-18" tabindex="-1"></a>            <span class="at">se.method =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb450-19"><a href="two-way-fixed-effects.html#cb450-19" tabindex="-1"></a>            <span class="at">number.iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb450-20"><a href="two-way-fixed-effects.html#cb450-20" tabindex="-1"></a>            <span class="at">confidence.level =</span> .<span class="dv">95</span></span>
<span id="cb450-21"><a href="two-way-fixed-effects.html#cb450-21" tabindex="-1"></a>        )</span>
<span id="cb450-22"><a href="two-way-fixed-effects.html#cb450-22" tabindex="-1"></a>    }</span>
<span id="cb450-23"><a href="two-way-fixed-effects.html#cb450-23" tabindex="-1"></a></span>
<span id="cb450-24"><a href="two-way-fixed-effects.html#cb450-24" tabindex="-1"></a><span class="co"># Transfer names from res_pm to res_est</span></span>
<span id="cb450-25"><a href="two-way-fixed-effects.html#cb450-25" tabindex="-1"></a><span class="fu">names</span>(res_est) <span class="ot">&lt;-</span> <span class="fu">names</span>(res_pm)</span>
<span id="cb450-26"><a href="two-way-fixed-effects.html#cb450-26" tabindex="-1"></a></span>
<span id="cb450-27"><a href="two-way-fixed-effects.html#cb450-27" tabindex="-1"></a><span class="co"># Step 2: Apply plot_PanelEstimate function in parallel</span></span>
<span id="cb450-28"><a href="two-way-fixed-effects.html#cb450-28" tabindex="-1"></a>res_est_plot <span class="ot">&lt;-</span></span>
<span id="cb450-29"><a href="two-way-fixed-effects.html#cb450-29" tabindex="-1"></a>    <span class="fu">foreach</span>(</span>
<span id="cb450-30"><a href="two-way-fixed-effects.html#cb450-30" tabindex="-1"></a>        <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_est),</span>
<span id="cb450-31"><a href="two-way-fixed-effects.html#cb450-31" tabindex="-1"></a>        <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;PanelMatch&quot;</span>, <span class="st">&quot;causalverse&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb450-32"><a href="two-way-fixed-effects.html#cb450-32" tabindex="-1"></a>    ) <span class="sc">%dopar%</span> {</span>
<span id="cb450-33"><a href="two-way-fixed-effects.html#cb450-33" tabindex="-1"></a>        <span class="fu">plot_PanelEstimate</span>(res_est[[i]],</span>
<span id="cb450-34"><a href="two-way-fixed-effects.html#cb450-34" tabindex="-1"></a>                           <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb450-35"><a href="two-way-fixed-effects.html#cb450-35" tabindex="-1"></a>                           <span class="at">theme_use =</span> causalverse<span class="sc">::</span><span class="fu">ama_theme</span>(<span class="at">base_size =</span> <span class="dv">10</span>))</span>
<span id="cb450-36"><a href="two-way-fixed-effects.html#cb450-36" tabindex="-1"></a>    }</span>
<span id="cb450-37"><a href="two-way-fixed-effects.html#cb450-37" tabindex="-1"></a></span>
<span id="cb450-38"><a href="two-way-fixed-effects.html#cb450-38" tabindex="-1"></a><span class="co"># Transfer names from res_est to res_est_plot</span></span>
<span id="cb450-39"><a href="two-way-fixed-effects.html#cb450-39" tabindex="-1"></a><span class="fu">names</span>(res_est_plot) <span class="ot">&lt;-</span> <span class="fu">names</span>(res_est)</span>
<span id="cb450-40"><a href="two-way-fixed-effects.html#cb450-40" tabindex="-1"></a></span>
<span id="cb450-41"><a href="two-way-fixed-effects.html#cb450-41" tabindex="-1"></a></span>
<span id="cb450-42"><a href="two-way-fixed-effects.html#cb450-42" tabindex="-1"></a></span>
<span id="cb450-43"><a href="two-way-fixed-effects.html#cb450-43" tabindex="-1"></a><span class="co"># Step 1: Apply PanelEstimate function for res_pm_rev in parallel</span></span>
<span id="cb450-44"><a href="two-way-fixed-effects.html#cb450-44" tabindex="-1"></a>res_est_rev <span class="ot">&lt;-</span></span>
<span id="cb450-45"><a href="two-way-fixed-effects.html#cb450-45" tabindex="-1"></a>    <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_pm_rev), <span class="at">.packages =</span> <span class="st">&quot;PanelMatch&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb450-46"><a href="two-way-fixed-effects.html#cb450-46" tabindex="-1"></a>        <span class="fu">PanelEstimate</span>(</span>
<span id="cb450-47"><a href="two-way-fixed-effects.html#cb450-47" tabindex="-1"></a>            res_pm_rev[[i]],</span>
<span id="cb450-48"><a href="two-way-fixed-effects.html#cb450-48" tabindex="-1"></a>            <span class="at">data =</span> dem,</span>
<span id="cb450-49"><a href="two-way-fixed-effects.html#cb450-49" tabindex="-1"></a>            <span class="at">se.method =</span> <span class="st">&quot;bootstrap&quot;</span>,</span>
<span id="cb450-50"><a href="two-way-fixed-effects.html#cb450-50" tabindex="-1"></a>            <span class="at">number.iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb450-51"><a href="two-way-fixed-effects.html#cb450-51" tabindex="-1"></a>            <span class="at">confidence.level =</span> .<span class="dv">95</span></span>
<span id="cb450-52"><a href="two-way-fixed-effects.html#cb450-52" tabindex="-1"></a>        )</span>
<span id="cb450-53"><a href="two-way-fixed-effects.html#cb450-53" tabindex="-1"></a>    }</span>
<span id="cb450-54"><a href="two-way-fixed-effects.html#cb450-54" tabindex="-1"></a></span>
<span id="cb450-55"><a href="two-way-fixed-effects.html#cb450-55" tabindex="-1"></a><span class="co"># Transfer names from res_pm_rev to res_est_rev</span></span>
<span id="cb450-56"><a href="two-way-fixed-effects.html#cb450-56" tabindex="-1"></a><span class="fu">names</span>(res_est_rev) <span class="ot">&lt;-</span> <span class="fu">names</span>(res_pm_rev)</span>
<span id="cb450-57"><a href="two-way-fixed-effects.html#cb450-57" tabindex="-1"></a></span>
<span id="cb450-58"><a href="two-way-fixed-effects.html#cb450-58" tabindex="-1"></a><span class="co"># Step 2: Apply plot_PanelEstimate function for res_est_rev in parallel</span></span>
<span id="cb450-59"><a href="two-way-fixed-effects.html#cb450-59" tabindex="-1"></a>res_est_plot_rev <span class="ot">&lt;-</span></span>
<span id="cb450-60"><a href="two-way-fixed-effects.html#cb450-60" tabindex="-1"></a>    <span class="fu">foreach</span>(</span>
<span id="cb450-61"><a href="two-way-fixed-effects.html#cb450-61" tabindex="-1"></a>        <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_est_rev),</span>
<span id="cb450-62"><a href="two-way-fixed-effects.html#cb450-62" tabindex="-1"></a>        <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;PanelMatch&quot;</span>, <span class="st">&quot;causalverse&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb450-63"><a href="two-way-fixed-effects.html#cb450-63" tabindex="-1"></a>    ) <span class="sc">%dopar%</span> {</span>
<span id="cb450-64"><a href="two-way-fixed-effects.html#cb450-64" tabindex="-1"></a>        <span class="fu">plot_PanelEstimate</span>(res_est_rev[[i]],</span>
<span id="cb450-65"><a href="two-way-fixed-effects.html#cb450-65" tabindex="-1"></a>                           <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb450-66"><a href="two-way-fixed-effects.html#cb450-66" tabindex="-1"></a>                           <span class="at">theme_use =</span> causalverse<span class="sc">::</span><span class="fu">ama_theme</span>(<span class="at">base_size =</span> <span class="dv">10</span>))</span>
<span id="cb450-67"><a href="two-way-fixed-effects.html#cb450-67" tabindex="-1"></a>    }</span>
<span id="cb450-68"><a href="two-way-fixed-effects.html#cb450-68" tabindex="-1"></a></span>
<span id="cb450-69"><a href="two-way-fixed-effects.html#cb450-69" tabindex="-1"></a><span class="co"># Transfer names from res_est_rev to res_est_plot_rev</span></span>
<span id="cb450-70"><a href="two-way-fixed-effects.html#cb450-70" tabindex="-1"></a><span class="fu">names</span>(res_est_plot_rev) <span class="ot">&lt;-</span> <span class="fu">names</span>(res_est_rev)</span>
<span id="cb450-71"><a href="two-way-fixed-effects.html#cb450-71" tabindex="-1"></a></span>
<span id="cb450-72"><a href="two-way-fixed-effects.html#cb450-72" tabindex="-1"></a><span class="co"># Stop the cluster</span></span>
<span id="cb450-73"><a href="two-way-fixed-effects.html#cb450-73" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>To export</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="two-way-fixed-effects.html#cb451-1" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb451-2"><a href="two-way-fixed-effects.html#cb451-2" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb451-3"><a href="two-way-fixed-effects.html#cb451-3" tabindex="-1"></a></span>
<span id="cb451-4"><a href="two-way-fixed-effects.html#cb451-4" tabindex="-1"></a><span class="co"># Column and row labels</span></span>
<span id="cb451-5"><a href="two-way-fixed-effects.html#cb451-5" tabindex="-1"></a>col_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mahalanobis 5m&quot;</span>, </span>
<span id="cb451-6"><a href="two-way-fixed-effects.html#cb451-6" tabindex="-1"></a>                <span class="st">&quot;Mahalanobis 10m&quot;</span>, </span>
<span id="cb451-7"><a href="two-way-fixed-effects.html#cb451-7" tabindex="-1"></a>                <span class="st">&quot;PS Matching 5m&quot;</span>, </span>
<span id="cb451-8"><a href="two-way-fixed-effects.html#cb451-8" tabindex="-1"></a>                <span class="st">&quot;PS Matching 10m&quot;</span>, </span>
<span id="cb451-9"><a href="two-way-fixed-effects.html#cb451-9" tabindex="-1"></a>                <span class="st">&quot;PS Weighting 5m&quot;</span>)</span>
<span id="cb451-10"><a href="two-way-fixed-effects.html#cb451-10" tabindex="-1"></a></span>
<span id="cb451-11"><a href="two-way-fixed-effects.html#cb451-11" tabindex="-1"></a>row_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ATT&quot;</span>, <span class="st">&quot;ART&quot;</span>)</span>
<span id="cb451-12"><a href="two-way-fixed-effects.html#cb451-12" tabindex="-1"></a></span>
<span id="cb451-13"><a href="two-way-fixed-effects.html#cb451-13" tabindex="-1"></a><span class="co"># Specify your desired fontsize for labels</span></span>
<span id="cb451-14"><a href="two-way-fixed-effects.html#cb451-14" tabindex="-1"></a>minor.axes.fontsize <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb451-15"><a href="two-way-fixed-effects.html#cb451-15" tabindex="-1"></a>major.axes.fontsize <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb451-16"><a href="two-way-fixed-effects.html#cb451-16" tabindex="-1"></a></span>
<span id="cb451-17"><a href="two-way-fixed-effects.html#cb451-17" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;images&quot;</span>, <span class="st">&quot;p_did_est_in_n_out.png&quot;</span>), <span class="at">width=</span><span class="dv">1200</span>, <span class="at">height=</span><span class="dv">1000</span>)</span>
<span id="cb451-18"><a href="two-way-fixed-effects.html#cb451-18" tabindex="-1"></a></span>
<span id="cb451-19"><a href="two-way-fixed-effects.html#cb451-19" tabindex="-1"></a><span class="co"># Create a list-of-lists, where each inner list represents a row</span></span>
<span id="cb451-20"><a href="two-way-fixed-effects.html#cb451-20" tabindex="-1"></a>grid_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb451-21"><a href="two-way-fixed-effects.html#cb451-21" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb451-22"><a href="two-way-fixed-effects.html#cb451-22" tabindex="-1"></a>    <span class="fu">nullGrob</span>(),</span>
<span id="cb451-23"><a href="two-way-fixed-effects.html#cb451-23" tabindex="-1"></a>    <span class="fu">textGrob</span>(col_labels[<span class="dv">1</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb451-24"><a href="two-way-fixed-effects.html#cb451-24" tabindex="-1"></a>    <span class="fu">textGrob</span>(col_labels[<span class="dv">2</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb451-25"><a href="two-way-fixed-effects.html#cb451-25" tabindex="-1"></a>    <span class="fu">textGrob</span>(col_labels[<span class="dv">3</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb451-26"><a href="two-way-fixed-effects.html#cb451-26" tabindex="-1"></a>    <span class="fu">textGrob</span>(col_labels[<span class="dv">4</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize)),</span>
<span id="cb451-27"><a href="two-way-fixed-effects.html#cb451-27" tabindex="-1"></a>    <span class="fu">textGrob</span>(col_labels[<span class="dv">5</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize))</span>
<span id="cb451-28"><a href="two-way-fixed-effects.html#cb451-28" tabindex="-1"></a>  ),</span>
<span id="cb451-29"><a href="two-way-fixed-effects.html#cb451-29" tabindex="-1"></a>  </span>
<span id="cb451-30"><a href="two-way-fixed-effects.html#cb451-30" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb451-31"><a href="two-way-fixed-effects.html#cb451-31" tabindex="-1"></a>    <span class="fu">textGrob</span>(row_labels[<span class="dv">1</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize), <span class="at">rot =</span> <span class="dv">90</span>),</span>
<span id="cb451-32"><a href="two-way-fixed-effects.html#cb451-32" tabindex="-1"></a>    res_est_plot<span class="sc">$</span>mahalanobis<span class="fl">.1</span>lag<span class="fl">.5</span>m,</span>
<span id="cb451-33"><a href="two-way-fixed-effects.html#cb451-33" tabindex="-1"></a>    res_est_plot<span class="sc">$</span>mahalanobis<span class="fl">.1</span>lag<span class="fl">.10</span>m,</span>
<span id="cb451-34"><a href="two-way-fixed-effects.html#cb451-34" tabindex="-1"></a>    res_est_plot<span class="sc">$</span>ps.match<span class="fl">.1</span>lag<span class="fl">.5</span>m,</span>
<span id="cb451-35"><a href="two-way-fixed-effects.html#cb451-35" tabindex="-1"></a>    res_est_plot<span class="sc">$</span>ps.match<span class="fl">.1</span>lag<span class="fl">.10</span>m,</span>
<span id="cb451-36"><a href="two-way-fixed-effects.html#cb451-36" tabindex="-1"></a>    res_est_plot<span class="sc">$</span>ps.weight<span class="fl">.1</span>lag<span class="fl">.5</span>m</span>
<span id="cb451-37"><a href="two-way-fixed-effects.html#cb451-37" tabindex="-1"></a>  ),</span>
<span id="cb451-38"><a href="two-way-fixed-effects.html#cb451-38" tabindex="-1"></a>  </span>
<span id="cb451-39"><a href="two-way-fixed-effects.html#cb451-39" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb451-40"><a href="two-way-fixed-effects.html#cb451-40" tabindex="-1"></a>    <span class="fu">textGrob</span>(row_labels[<span class="dv">2</span>], <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> minor.axes.fontsize), <span class="at">rot =</span> <span class="dv">90</span>),</span>
<span id="cb451-41"><a href="two-way-fixed-effects.html#cb451-41" tabindex="-1"></a>    res_est_plot_rev<span class="sc">$</span>mahalanobis<span class="fl">.1</span>lag<span class="fl">.5</span>m,</span>
<span id="cb451-42"><a href="two-way-fixed-effects.html#cb451-42" tabindex="-1"></a>    res_est_plot_rev<span class="sc">$</span>mahalanobis<span class="fl">.1</span>lag<span class="fl">.10</span>m,</span>
<span id="cb451-43"><a href="two-way-fixed-effects.html#cb451-43" tabindex="-1"></a>    res_est_plot_rev<span class="sc">$</span>ps.match<span class="fl">.1</span>lag<span class="fl">.5</span>m,</span>
<span id="cb451-44"><a href="two-way-fixed-effects.html#cb451-44" tabindex="-1"></a>    res_est_plot_rev<span class="sc">$</span>ps.match<span class="fl">.1</span>lag<span class="fl">.10</span>m,</span>
<span id="cb451-45"><a href="two-way-fixed-effects.html#cb451-45" tabindex="-1"></a>    res_est_plot_rev<span class="sc">$</span>ps.weight<span class="fl">.1</span>lag<span class="fl">.5</span>m</span>
<span id="cb451-46"><a href="two-way-fixed-effects.html#cb451-46" tabindex="-1"></a>  )</span>
<span id="cb451-47"><a href="two-way-fixed-effects.html#cb451-47" tabindex="-1"></a>)</span>
<span id="cb451-48"><a href="two-way-fixed-effects.html#cb451-48" tabindex="-1"></a></span>
<span id="cb451-49"><a href="two-way-fixed-effects.html#cb451-49" tabindex="-1"></a><span class="co"># &quot;Flatten&quot; the list-of-lists into a single list of grobs</span></span>
<span id="cb451-50"><a href="two-way-fixed-effects.html#cb451-50" tabindex="-1"></a>grobs <span class="ot">&lt;-</span> <span class="fu">do.call</span>(c, grid_list)</span>
<span id="cb451-51"><a href="two-way-fixed-effects.html#cb451-51" tabindex="-1"></a></span>
<span id="cb451-52"><a href="two-way-fixed-effects.html#cb451-52" tabindex="-1"></a><span class="co"># Arrange your plots with text labels</span></span>
<span id="cb451-53"><a href="two-way-fixed-effects.html#cb451-53" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb451-54"><a href="two-way-fixed-effects.html#cb451-54" tabindex="-1"></a>  <span class="at">grobs   =</span> grobs,</span>
<span id="cb451-55"><a href="two-way-fixed-effects.html#cb451-55" tabindex="-1"></a>  <span class="at">ncol    =</span> <span class="dv">6</span>,</span>
<span id="cb451-56"><a href="two-way-fixed-effects.html#cb451-56" tabindex="-1"></a>  <span class="at">nrow    =</span> <span class="dv">3</span>,</span>
<span id="cb451-57"><a href="two-way-fixed-effects.html#cb451-57" tabindex="-1"></a>  <span class="at">widths  =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>, <span class="fl">0.18</span>),</span>
<span id="cb451-58"><a href="two-way-fixed-effects.html#cb451-58" tabindex="-1"></a>  <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.45</span>, <span class="fl">0.45</span>)</span>
<span id="cb451-59"><a href="two-way-fixed-effects.html#cb451-59" tabindex="-1"></a>)</span>
<span id="cb451-60"><a href="two-way-fixed-effects.html#cb451-60" tabindex="-1"></a></span>
<span id="cb451-61"><a href="two-way-fixed-effects.html#cb451-61" tabindex="-1"></a><span class="co"># Add main x and y axis titles</span></span>
<span id="cb451-62"><a href="two-way-fixed-effects.html#cb451-62" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb451-63"><a href="two-way-fixed-effects.html#cb451-63" tabindex="-1"></a>  <span class="st">&quot;Methods&quot;</span>,</span>
<span id="cb451-64"><a href="two-way-fixed-effects.html#cb451-64" tabindex="-1"></a>  <span class="at">x  =</span> <span class="fl">0.5</span>,</span>
<span id="cb451-65"><a href="two-way-fixed-effects.html#cb451-65" tabindex="-1"></a>  <span class="at">y  =</span> <span class="fl">0.02</span>,</span>
<span id="cb451-66"><a href="two-way-fixed-effects.html#cb451-66" tabindex="-1"></a>  <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb451-67"><a href="two-way-fixed-effects.html#cb451-67" tabindex="-1"></a>)</span>
<span id="cb451-68"><a href="two-way-fixed-effects.html#cb451-68" tabindex="-1"></a><span class="fu">grid.text</span>(</span>
<span id="cb451-69"><a href="two-way-fixed-effects.html#cb451-69" tabindex="-1"></a>  <span class="st">&quot;&quot;</span>,</span>
<span id="cb451-70"><a href="two-way-fixed-effects.html#cb451-70" tabindex="-1"></a>  <span class="at">x   =</span> <span class="fl">0.02</span>,</span>
<span id="cb451-71"><a href="two-way-fixed-effects.html#cb451-71" tabindex="-1"></a>  <span class="at">y   =</span> <span class="fl">0.5</span>,</span>
<span id="cb451-72"><a href="two-way-fixed-effects.html#cb451-72" tabindex="-1"></a>  <span class="at">rot =</span> <span class="dv">90</span>,</span>
<span id="cb451-73"><a href="two-way-fixed-effects.html#cb451-73" tabindex="-1"></a>  <span class="at">gp  =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> major.axes.fontsize)</span>
<span id="cb451-74"><a href="two-way-fixed-effects.html#cb451-74" tabindex="-1"></a>)</span>
<span id="cb451-75"><a href="two-way-fixed-effects.html#cb451-75" tabindex="-1"></a></span>
<span id="cb451-76"><a href="two-way-fixed-effects.html#cb451-76" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="two-way-fixed-effects.html#cb452-1" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb452-2"><a href="two-way-fixed-effects.html#cb452-2" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;images&quot;</span>, <span class="st">&quot;p_did_est_in_n_out.png&quot;</span>))</span></code></pre></div>
</div>
<div id="chaisemartin-dhaultfoeuille" class="section level4 hasAnchor" number="26.3.2.4">
<h4><span class="header-section-number">26.3.2.4</span> Chaisemartin-d’Haultfoeuille<a href="two-way-fixed-effects.html#chaisemartin-dhaultfoeuille" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>use <code>twowayfeweights</code> from <a href="https://github.com/shuo-zhang-ucsb/twowayfeweights">GitHub</a> <span class="citation">(<a href="#ref-de2020two">De Chaisemartin and d’Haultfoeuille 2020</a>)</span></p>
</div>
<div id="didimputation" class="section level4 hasAnchor" number="26.3.2.5">
<h4><span class="header-section-number">26.3.2.5</span> didimputation<a href="two-way-fixed-effects.html#didimputation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>use <code>didimputation</code> from <a href="https://github.com/kylebutts/didimputation">GitHub</a></p>
</div>
<div id="staggered" class="section level4 hasAnchor" number="26.3.2.6">
<h4><span class="header-section-number">26.3.2.6</span> staggered<a href="two-way-fixed-effects.html#staggered" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>staggered</code> <a href="https://github.com/jonathandroth/staggered">package</a></p>
</div>
<div id="wooldridges-solution" class="section level4 hasAnchor" number="26.3.2.7">
<h4><span class="header-section-number">26.3.2.7</span> Wooldridge’s Solution<a href="two-way-fixed-effects.html#wooldridges-solution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>use <a href="https://grantmcdermott.com/etwfe/">etwfe</a>(Extended two-way Fixed Effects) <span class="citation">(<a href="#ref-wooldridge2022simple">Wooldridge 2022</a>)</span></p>
</div>
</div>
<div id="two-stage-did" class="section level3 hasAnchor" number="26.3.3">
<h3><span class="header-section-number">26.3.3</span> Two-stage DiD<a href="two-way-fixed-effects.html#two-stage-did" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://cran.r-project.org/web/packages/did2s/vignettes/Two-Stage-Difference-in-Differences.html">Example</a> from CRAN</p>
</div>
<div id="multiple-treatment-groups" class="section level3 hasAnchor" number="26.3.4">
<h3><span class="header-section-number">26.3.4</span> Multiple Treatment groups<a href="two-way-fixed-effects.html#multiple-treatment-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you have 2 treatments in a setting, you should always try to model both of them under one regression to see whether they are significantly different.</p>
<ul>
<li>Never use one treated groups as control for the other, and run separate regression.</li>
<li>Could check this <a href="https://stats.stackexchange.com/questions/474533/difference-in-difference-with-two-treatment-groups-and-one-control-group-classi">answer</a></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
Y_{it} &amp;= \alpha + \gamma_1 Treat1_{i} + \gamma_2 Treat2_{i} + \lambda Post_t  \\
&amp;+ \delta_1(Treat1_i \times Post_t) + \delta_2(Treat2_i \times Post_t) + \epsilon_{it}
\end{aligned}
\]</span></p>
<p><span class="citation">(<a href="#ref-fricke2017identification">Fricke 2017</a>)</span></p>
</div>
<div id="multiple-treatments" class="section level3 hasAnchor" number="26.3.5">
<h3><span class="header-section-number">26.3.5</span> Multiple Treatments<a href="two-way-fixed-effects.html#multiple-treatments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">(<a href="#ref-de2022two">De Chaisemartin and d’Haultfoeuille 2022</a>)</span> <a href="https://www.youtube.com/watch?v=UHeJoc27qEM&amp;ab_channel=TaylorWright">video</a> <a href="https://drive.google.com/file/d/156Fu73avBvvV_H64wePm7eW04V0jEG3K/view">code</a></p>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-arkhangelsky2021double" class="csl-entry">
2020, July. <a href="http://dx.doi.org/10.1038/s41562-020-0912-z">http://dx.doi.org/10.1038/s41562-020-0912-z</a>.
</div>
<div id="ref-acemoglu2019democracy" class="csl-entry">
Acemoglu, Daron, Suresh Naidu, Pascual Restrepo, and James A Robinson. 2019. <span>“Democracy Does Cause Growth.”</span> <em>Journal of Political Economy</em> 127 (1): 47–100.
</div>
<div id="ref-arellano1987computing" class="csl-entry">
Arellano, Manuel. 1987. <span>“Computing Robust Standard Errors for Within-Groups Estimators.”</span> <em>Oxford Bulletin of Economics and Statistics</em> 49 (4): 431–34.
</div>
<div id="ref-athey2022design" class="csl-entry">
Athey, Susan, and Guido W Imbens. 2022. <span>“Design-Based Analysis in Difference-in-Differences Settings with Staggered Adoption.”</span> <em>Journal of Econometrics</em> 226 (1): 62–79.
</div>
<div id="ref-baker2022much" class="csl-entry">
Baker, Andrew C, David F Larcker, and Charles CY Wang. 2022. <span>“How Much Should We Trust Staggered Difference-in-Differences Estimates?”</span> <em>Journal of Financial Economics</em> 144 (2): 370–95.
</div>
<div id="ref-borusyak2017revisiting" class="csl-entry">
Borusyak, Kirill, and Xavier Jaravel. 2017. <span>“Revisiting Event Study Designs. SSRN Scholarly Paper ID 2826228.”</span> <em>Social Science Research Network, Rochester, NY</em>.
</div>
<div id="ref-borusyak2021revisiting" class="csl-entry">
Borusyak, Kirill, Xavier Jaravel, and Jann Spiess. 2021. <span>“Revisiting Event Study Designs: Robust and Efficient Estimation.”</span> <em>arXiv Preprint arXiv:2108.12419</em>.
</div>
<div id="ref-callaway2021difference" class="csl-entry">
Callaway, Brantly, and Pedro HC Sant’Anna. 2021. <span>“Difference-in-Differences with Multiple Time Periods.”</span> <em>Journal of Econometrics</em> 225 (2): 200–230.
</div>
<div id="ref-cengiz2019effect" class="csl-entry">
Cengiz, Doruk, Arindrajit Dube, Attila Lindner, and Ben Zipperer. 2019. <span>“The Effect of Minimum Wages on Low-Wage Jobs.”</span> <em>The Quarterly Journal of Economics</em> 134 (3): 1405–54.
</div>
<div id="ref-de2020two" class="csl-entry">
De Chaisemartin, Clément, and Xavier d’Haultfoeuille. 2020. <span>“Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects.”</span> <em>American Economic Review</em> 110 (9): 2964–96.
</div>
<div id="ref-de2022two" class="csl-entry">
———. 2022. <span>“Two-Way Fixed Effects and Differences-in-Differences with Heterogeneous Treatment Effects: A Survey.”</span> National Bureau of Economic Research.
</div>
<div id="ref-deshpande2019screened" class="csl-entry">
Deshpande, Manasi, and Yue Li. 2019. <span>“Who Is Screened Out? Application Costs and the Targeting of Disability Programs.”</span> <em>American Economic Journal: Economic Policy</em> 11 (4): 213–48.
</div>
<div id="ref-fricke2017identification" class="csl-entry">
Fricke, Hans. 2017. <span>“Identification Based on Difference-in-Differences Approaches with Multiple Treatments.”</span> <em>Oxford Bulletin of Economics and Statistics</em> 79 (3): 426–33.
</div>
<div id="ref-gardner2022two" class="csl-entry">
Gardner, John. 2022. <span>“Two-Stage Differences in Differences.”</span> <em>arXiv Preprint arXiv:2207.05943</em>.
</div>
<div id="ref-goodman2021difference" class="csl-entry">
Goodman-Bacon, Andrew. 2021. <span>“Difference-in-Differences with Variation in Treatment Timing.”</span> <em>Journal of Econometrics</em> 225 (2): 254–77.
</div>
<div id="ref-gormley2011growing" class="csl-entry">
Gormley, Todd A, and David A Matsa. 2011. <span>“Growing Out of Trouble? Corporate Responses to Liability Risk.”</span> <em>The Review of Financial Studies</em> 24 (8): 2781–821.
</div>
<div id="ref-ho2007matching" class="csl-entry">
Ho, Daniel E, Kosuke Imai, Gary King, and Elizabeth A Stuart. 2007. <span>“Matching as Nonparametric Preprocessing for Reducing Model Dependence in Parametric Causal Inference.”</span> <em>Political Analysis</em> 15 (3): 199–236.
</div>
<div id="ref-hoynes2009consumption" class="csl-entry">
Hoynes, Hilary W, and Diane Whitmore Schanzenbach. 2009. <span>“Consumption Responses to in-Kind Transfers: Evidence from the Introduction of the Food Stamp Program.”</span> <em>American Economic Journal: Applied Economics</em> 1 (4): 109–39.
</div>
<div id="ref-imai2019should" class="csl-entry">
Imai, Kosuke, and In Song Kim. 2019. <span>“When Should We Use Unit Fixed Effects Regression Models for Causal Inference with Longitudinal Data?”</span> <em>American Journal of Political Science</em> 63 (2): 467–90.
</div>
<div id="ref-imai2021use" class="csl-entry">
———. 2021. <span>“On the Use of Two-Way Fixed Effects Regression Models for Causal Inference with Panel Data.”</span> <em>Political Analysis</em> 29 (3): 405–15.
</div>
<div id="ref-imai2021matching" class="csl-entry">
Imai, Kosuke, In Song Kim, and Erik H Wang. 2021. <span>“Matching Methods for Causal Inference with Time-Series Cross-Sectional Data.”</span> <em>American Journal of Political Science</em>.
</div>
<div id="ref-imbens2015causal" class="csl-entry">
Imbens, Guido W, and Donald B Rubin. 2015. <em>Causal Inference in Statistics, Social, and Biomedical Sciences</em>. Cambridge University Press.
</div>
<div id="ref-marcus2021role" class="csl-entry">
Marcus, Michelle, and Pedro HC Sant’Anna. 2021. <span>“The Role of Parallel Trends in Event Study Settings: An Application to Environmental Economics.”</span> <em>Journal of the Association of Environmental and Resource Economists</em> 8 (2): 235–75.
</div>
<div id="ref-rosenbaum1983central" class="csl-entry">
Rosenbaum, Paul R, and Donald B Rubin. 1983. <span>“The Central Role of the Propensity Score in Observational Studies for Causal Effects.”</span> <em>Biometrika</em> 70 (1): 41–55.
</div>
<div id="ref-somaini2016algorithm" class="csl-entry">
Somaini, Paulo, and Frank A Wolak. 2016. <span>“An Algorithm to Estimate the Two-Way Fixed Effects Model.”</span> <em>Journal of Econometric Methods</em> 5 (1): 143–52.
</div>
<div id="ref-somaini2021twfem" class="csl-entry">
———. 2021. <span>“TWFEM: Stata Module to Efficiently Estimate a Two-Way Fixed Effects Model Based on Somaini and Wolak (2015).”</span>
</div>
<div id="ref-stevenson2006bargaining" class="csl-entry">
Stevenson, Betsey, and Justin Wolfers. 2006. <span>“Bargaining in the Shadow of the Law: Divorce Laws and Family Distress.”</span> <em>The Quarterly Journal of Economics</em> 121 (1): 267–88.
</div>
<div id="ref-sun2021estimating" class="csl-entry">
Sun, Liyang, and Sarah Abraham. 2021. <span>“Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects.”</span> <em>Journal of Econometrics</em> 225 (2): 175–99.
</div>
<div id="ref-wooldridge2022simple" class="csl-entry">
Wooldridge, Jeffrey M. 2022. <span>“Simple Approaches to Nonlinear Difference-in-Differences with Panel Data.”</span> <em>Available at SSRN 4183726</em>.
</div>
<div id="ref-xu2017generalized" class="csl-entry">
Xu, Yiqing. 2017. <span>“Generalized Synthetic Control Method: Causal Inference with Interactive Fixed Effects Models.”</span> <em>Political Analysis</em> 25 (1): 57–76.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="one-difference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assumption-violation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mikenguyen13/data_analysis/edit/main/26-dif-in-dif.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/mikenguyen13/data_analysis/blob/main/26-dif-in-dif.Rmd",
"text": null
},
"download": ["data_analysis.pdf", "data_analysis.epub", "data_analysis.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true,
"sharing": {
"facebook": true,
"github": true,
"twitter": true,
"linkedin": true
},
"info": true,
"edit": "https://github.com/mikenguyen13/data_analysis/edit/main/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
